async function e(){return await async function(){try{let e=localStorage.getItem("twitchToken");if(e){let r=await t(e);if(r&&r.login)return r.token=e,r}}catch(e){return null}}()||await async function(){try{const e=new URLSearchParams(location.hash.replace("#","")).get("access_token");if(e){let r=await t(e);if(r&&r.login){localStorage.setItem("twitchToken",e);const t=window.location.href.split("#")[0];return window.location.replace(t),r.token=e,r}}}catch(e){return null}}()}async function t(e){return await fetch("https://id.twitch.tv/oauth2/validate",{headers:{Authorization:"OAuth "+e}}).then(e=>e.json()).catch(e=>({error:e}))}let r={UserId:0,User:"",ClientID:"",Token:"",Scopes:[],Logout:function(){localStorage.removeItem("twitchToken")},Login:function(e,t,r=["user:read:email"]){window.location.href=`https://id.twitch.tv/oauth2/authorize?client_id=${e}&redirect_uri=${t}&response_type=token&scope=${r.join(" ")}`},Check:async function(t){let n=await e();return n?(r.ClientID=n.client_id,r.UserId=n.user_id,r.User=n.login,r.Token=n.token,r.Scopes=n.scopes):(r.Logout(),t&&(window.location.href=t)),n},GetUser:async function(e,t){return await fetch("https://api.twitch.tv/helix/users?id="+t,{headers:{"Client-ID":e,Authorization:"Bearer "+r.Token}}).then(e=>e.json()).then(e=>e.data.length>0?e.data[0]:{}).catch(e=>({error:e}))}};window.ComfyTwitch=r,function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Matter=e()}((function(){return function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[s]={exports:{}};t[s][0].call(h.exports,(function(e){return i(t[s][1][e]||e)}),h,h.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),s=e("../core/Sleeping"),a=(e("../render/Render"),e("../core/Common")),c=e("../geometry/Bounds"),u=e("../geometry/Axes");!function(){n._inertiaScale=4,n._nextCollidingGroupId=1,n._nextNonCollidingGroupId=-1,n._nextCategory=1,n.create=function(t){var r={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:i.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0},lineWidth:0}},n=a.extend(r,t);return e(n,t),n},n.nextGroup=function(e){return e?n._nextNonCollidingGroupId--:n._nextCollidingGroupId++},n.nextCategory=function(){return n._nextCategory=n._nextCategory<<1,n._nextCategory};var e=function(e,t){t=t||{},n.set(e,{bounds:e.bounds||c.create(e.vertices),positionPrev:e.positionPrev||o.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),i.rotate(e.vertices,e.angle,e.position),u.rotate(e.axes,e.angle),c.update(e.bounds,e.vertices,e.velocity),n.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var r=e.isStatic?"#2e2b44":a.choose(["#006BA6","#0496FF","#FFBC42","#D81159","#8F2D56"]);e.render.fillStyle=e.render.fillStyle||r,e.render.strokeStyle=e.render.strokeStyle||"#000",e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};n.set=function(e,t,r){var i;for(i in"string"==typeof t&&(i=t,(t={})[i]=r),t)if(r=t[i],t.hasOwnProperty(i))switch(i){case"isStatic":n.setStatic(e,r);break;case"isSleeping":s.set(e,r);break;case"mass":n.setMass(e,r);break;case"density":n.setDensity(e,r);break;case"inertia":n.setInertia(e,r);break;case"vertices":n.setVertices(e,r);break;case"position":n.setPosition(e,r);break;case"angle":n.setAngle(e,r);break;case"velocity":n.setVelocity(e,r);break;case"angularVelocity":n.setAngularVelocity(e,r);break;case"parts":n.setParts(e,r);break;default:e[i]=r}},n.setStatic=function(e,t){for(var r=0;r<e.parts.length;r++){var n=e.parts[r];n.isStatic=t,t?(n._original={restitution:n.restitution,friction:n.friction,mass:n.mass,inertia:n.inertia,density:n.density,inverseMass:n.inverseMass,inverseInertia:n.inverseInertia},n.restitution=0,n.friction=1,n.mass=n.inertia=n.density=1/0,n.inverseMass=n.inverseInertia=0,n.positionPrev.x=n.position.x,n.positionPrev.y=n.position.y,n.anglePrev=n.angle,n.angularVelocity=0,n.speed=0,n.angularSpeed=0,n.motion=0):n._original&&(n.restitution=n._original.restitution,n.friction=n._original.friction,n.mass=n._original.mass,n.inertia=n._original.inertia,n.density=n._original.density,n.inverseMass=n._original.inverseMass,n.inverseInertia=n._original.inverseInertia,delete n._original)}},n.setMass=function(e,t){var r=e.inertia/(e.mass/6);e.inertia=r*(t/6),e.inverseInertia=1/e.inertia,e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},n.setDensity=function(e,t){n.setMass(e,t*e.area),e.density=t},n.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},n.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=i.create(t,e),e.axes=u.fromVertices(e.vertices),e.area=i.area(e.vertices),n.setMass(e,e.density*e.area);var r=i.centre(e.vertices);i.translate(e.vertices,r,-1),n.setInertia(e,n._inertiaScale*i.inertia(e.vertices,e.mass)),i.translate(e.vertices,e.position),c.update(e.bounds,e.vertices,e.velocity)},n.setParts=function(e,t,r){var o;for(t=t.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,o=0;o<t.length;o++){var s=t[o];s!==e&&(s.parent=e,e.parts.push(s))}if(1!==e.parts.length){if(r=void 0===r||r){var a=[];for(o=0;o<t.length;o++)a=a.concat(t[o].vertices);i.clockwiseSort(a);var c=i.hull(a),u=i.centre(c);n.setVertices(e,c),i.translate(e.vertices,u)}var h=n._totalProperties(e);e.area=h.area,e.parent=e,e.position.x=h.centre.x,e.position.y=h.centre.y,e.positionPrev.x=h.centre.x,e.positionPrev.y=h.centre.y,n.setMass(e,h.mass),n.setInertia(e,h.inertia),n.setPosition(e,h.centre)}},n.setPosition=function(e,t){var r=o.sub(t,e.position);e.positionPrev.x+=r.x,e.positionPrev.y+=r.y;for(var n=0;n<e.parts.length;n++){var s=e.parts[n];s.position.x+=r.x,s.position.y+=r.y,i.translate(s.vertices,r),c.update(s.bounds,s.vertices,e.velocity)}},n.setAngle=function(e,t){var r=t-e.angle;e.anglePrev+=r;for(var n=0;n<e.parts.length;n++){var s=e.parts[n];s.angle+=r,i.rotate(s.vertices,r,e.position),u.rotate(s.axes,r),c.update(s.bounds,s.vertices,e.velocity),n>0&&o.rotateAbout(s.position,r,e.position,s.position)}},n.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=o.magnitude(e.velocity)},n.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},n.translate=function(e,t){n.setPosition(e,o.add(e.position,t))},n.rotate=function(e,t,r){if(r){var i=Math.cos(t),o=Math.sin(t),s=e.position.x-r.x,a=e.position.y-r.y;n.setPosition(e,{x:r.x+(s*i-a*o),y:r.y+(s*o+a*i)}),n.setAngle(e,e.angle+t)}else n.setAngle(e,e.angle+t)},n.scale=function(e,t,r,o){var s=0,a=0;o=o||e.position;for(var h=0;h<e.parts.length;h++){var l=e.parts[h];i.scale(l.vertices,t,r,o),l.axes=u.fromVertices(l.vertices),l.area=i.area(l.vertices),n.setMass(l,e.density*l.area),i.translate(l.vertices,{x:-l.position.x,y:-l.position.y}),n.setInertia(l,n._inertiaScale*i.inertia(l.vertices,l.mass)),i.translate(l.vertices,{x:l.position.x,y:l.position.y}),h>0&&(s+=l.area,a+=l.inertia),l.position.x=o.x+(l.position.x-o.x)*t,l.position.y=o.y+(l.position.y-o.y)*r,c.update(l.bounds,l.vertices,e.velocity)}e.parts.length>1&&(e.area=s,e.isStatic||(n.setMass(e,e.density*s),n.setInertia(e,a))),e.circleRadius&&(t===r?e.circleRadius*=t:e.circleRadius=null)},n.update=function(e,t,r,n){var s=Math.pow(t*r*e.timeScale,2),a=1-e.frictionAir*r*e.timeScale,h=e.position.x-e.positionPrev.x,l=e.position.y-e.positionPrev.y;e.velocity.x=h*a*n+e.force.x/e.mass*s,e.velocity.y=l*a*n+e.force.y/e.mass*s,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*a*n+e.torque/e.inertia*s,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=o.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var d=0;d<e.parts.length;d++){var p=e.parts[d];i.translate(p.vertices,e.velocity),d>0&&(p.position.x+=e.velocity.x,p.position.y+=e.velocity.y),0!==e.angularVelocity&&(i.rotate(p.vertices,e.angularVelocity,e.position),u.rotate(p.axes,e.angularVelocity),d>0&&o.rotateAbout(p.position,e.angularVelocity,e.position,p.position)),c.update(p.bounds,p.vertices,e.velocity)}},n.applyForce=function(e,t,r){e.force.x+=r.x,e.force.y+=r.y;var n=t.x-e.position.x,i=t.y-e.position.y;e.torque+=n*r.y-i*r.x},n._totalProperties=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},r=1===e.parts.length?0:1;r<e.parts.length;r++){var n=e.parts[r],i=n.mass!==1/0?n.mass:1;t.mass+=i,t.area+=n.area,t.inertia+=n.inertia,t.centre=o.add(t.centre,o.mult(n.position,i))}return t.centre=o.div(t.centre,t.mass),t}}()},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31}],2:[function(e,t,r){var n={};t.exports=n;var i=e("../core/Events"),o=e("../core/Common"),s=e("../geometry/Bounds"),a=e("./Body");n.create=function(e){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{}},e)},n.setModified=function(e,t,r,i){if(e.isModified=t,r&&e.parent&&n.setModified(e.parent,t,r,i),i)for(var o=0;o<e.composites.length;o++){var s=e.composites[o];n.setModified(s,t,r,i)}},n.add=function(e,t){var r=[].concat(t);i.trigger(e,"beforeAdd",{object:t});for(var s=0;s<r.length;s++){var a=r[s];switch(a.type){case"body":if(a.parent!==a){o.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}n.addBody(e,a);break;case"constraint":n.addConstraint(e,a);break;case"composite":n.addComposite(e,a);break;case"mouseConstraint":n.addConstraint(e,a.constraint)}}return i.trigger(e,"afterAdd",{object:t}),e},n.remove=function(e,t,r){var o=[].concat(t);i.trigger(e,"beforeRemove",{object:t});for(var s=0;s<o.length;s++){var a=o[s];switch(a.type){case"body":n.removeBody(e,a,r);break;case"constraint":n.removeConstraint(e,a,r);break;case"composite":n.removeComposite(e,a,r);break;case"mouseConstraint":n.removeConstraint(e,a.constraint)}}return i.trigger(e,"afterRemove",{object:t}),e},n.addComposite=function(e,t){return e.composites.push(t),t.parent=e,n.setModified(e,!0,!0,!1),e},n.removeComposite=function(e,t,r){var i=o.indexOf(e.composites,t);if(-1!==i&&(n.removeCompositeAt(e,i),n.setModified(e,!0,!0,!1)),r)for(var s=0;s<e.composites.length;s++)n.removeComposite(e.composites[s],t,!0);return e},n.removeCompositeAt=function(e,t){return e.composites.splice(t,1),n.setModified(e,!0,!0,!1),e},n.addBody=function(e,t){return e.bodies.push(t),n.setModified(e,!0,!0,!1),e},n.removeBody=function(e,t,r){var i=o.indexOf(e.bodies,t);if(-1!==i&&(n.removeBodyAt(e,i),n.setModified(e,!0,!0,!1)),r)for(var s=0;s<e.composites.length;s++)n.removeBody(e.composites[s],t,!0);return e},n.removeBodyAt=function(e,t){return e.bodies.splice(t,1),n.setModified(e,!0,!0,!1),e},n.addConstraint=function(e,t){return e.constraints.push(t),n.setModified(e,!0,!0,!1),e},n.removeConstraint=function(e,t,r){var i=o.indexOf(e.constraints,t);if(-1!==i&&n.removeConstraintAt(e,i),r)for(var s=0;s<e.composites.length;s++)n.removeConstraint(e.composites[s],t,!0);return e},n.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),n.setModified(e,!0,!0,!1),e},n.clear=function(e,t,r){if(r)for(var i=0;i<e.composites.length;i++)n.clear(e.composites[i],t,!0);return t?e.bodies=e.bodies.filter((function(e){return e.isStatic})):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,n.setModified(e,!0,!0,!1),e},n.allBodies=function(e){for(var t=[].concat(e.bodies),r=0;r<e.composites.length;r++)t=t.concat(n.allBodies(e.composites[r]));return t},n.allConstraints=function(e){for(var t=[].concat(e.constraints),r=0;r<e.composites.length;r++)t=t.concat(n.allConstraints(e.composites[r]));return t},n.allComposites=function(e){for(var t=[].concat(e.composites),r=0;r<e.composites.length;r++)t=t.concat(n.allComposites(e.composites[r]));return t},n.get=function(e,t,r){var i,o;switch(r){case"body":i=n.allBodies(e);break;case"constraint":i=n.allConstraints(e);break;case"composite":i=n.allComposites(e).concat(e)}return i?0===(o=i.filter((function(e){return e.id.toString()===t.toString()}))).length?null:o[0]:null},n.move=function(e,t,r){return n.remove(e,t),n.add(r,t),e},n.rebase=function(e){for(var t=n.allBodies(e).concat(n.allConstraints(e)).concat(n.allComposites(e)),r=0;r<t.length;r++)t[r].id=o.nextId();return n.setModified(e,!0,!0,!1),e},n.translate=function(e,t,r){for(var i=r?n.allBodies(e):e.bodies,o=0;o<i.length;o++)a.translate(i[o],t);return n.setModified(e,!0,!0,!1),e},n.rotate=function(e,t,r,i){for(var o=Math.cos(t),s=Math.sin(t),c=i?n.allBodies(e):e.bodies,u=0;u<c.length;u++){var h=c[u],l=h.position.x-r.x,d=h.position.y-r.y;a.setPosition(h,{x:r.x+(l*o-d*s),y:r.y+(l*s+d*o)}),a.rotate(h,t)}return n.setModified(e,!0,!0,!1),e},n.scale=function(e,t,r,i,o){for(var s=o?n.allBodies(e):e.bodies,c=0;c<s.length;c++){var u=s[c],h=u.position.x-i.x,l=u.position.y-i.y;a.setPosition(u,{x:i.x+h*t,y:i.y+l*r}),a.scale(u,t,r)}return n.setModified(e,!0,!0,!1),e},n.bounds=function(e){for(var t=n.allBodies(e),r=[],i=0;i<t.length;i+=1){var o=t[i];r.push(o.bounds.min,o.bounds.max)}return s.create(r)}},{"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"./Body":1}],3:[function(e,t,r){var n={};t.exports=n;var i=e("./Composite"),o=(e("../constraint/Constraint"),e("../core/Common"));n.create=function(e){var t=i.create();return o.extend(t,{label:"World",gravity:{x:0,y:1,scale:.001},bounds:{min:{x:-1/0,y:-1/0},max:{x:1/0,y:1/0}}},e)}},{"../constraint/Constraint":12,"../core/Common":14,"./Composite":2}],4:[function(e,t,r){var n={};t.exports=n,n.create=function(e){return{id:n.id(e),vertex:e,normalImpulse:0,tangentImpulse:0}},n.id=function(e){return e.body.id+"_"+e.index}},{}],5:[function(e,t,r){var n={};t.exports=n;var i=e("./SAT"),o=e("./Pair"),s=e("../geometry/Bounds");n.collisions=function(e,t){for(var r=[],a=t.pairs.table,c=0;c<e.length;c++){var u=e[c][0],h=e[c][1];if((!u.isStatic&&!u.isSleeping||!h.isStatic&&!h.isSleeping)&&n.canCollide(u.collisionFilter,h.collisionFilter)&&s.overlaps(u.bounds,h.bounds))for(var l=u.parts.length>1?1:0;l<u.parts.length;l++)for(var d=u.parts[l],p=h.parts.length>1?1:0;p<h.parts.length;p++){var f=h.parts[p];if(d===u&&f===h||s.overlaps(d.bounds,f.bounds)){var m,v=a[o.id(d,f)];m=v&&v.isActive?v.collision:null;var g=i.collides(d,f,m);g.collided&&r.push(g)}}}return r},n.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!=(e.mask&t.category)&&0!=(t.mask&e.category)}},{"../geometry/Bounds":26,"./Pair":7,"./SAT":11}],6:[function(e,t,r){var n={};t.exports=n;var i=e("./Pair"),o=e("./Detector"),s=e("../core/Common");n.create=function(e){var t={controller:n,detector:o.collisions,buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48};return s.extend(t,e)},n.update=function(e,t,r,i){var o,s,a,c,u,h=r.world,l=e.buckets,d=!1;for(o=0;o<t.length;o++){var p=t[o];if((!p.isSleeping||i)&&!(p.bounds.max.x<h.bounds.min.x||p.bounds.min.x>h.bounds.max.x||p.bounds.max.y<h.bounds.min.y||p.bounds.min.y>h.bounds.max.y)){var f=n._getRegion(e,p);if(!p.region||f.id!==p.region.id||i){p.region&&!i||(p.region=f);var m=n._regionUnion(f,p.region);for(s=m.startCol;s<=m.endCol;s++)for(a=m.startRow;a<=m.endRow;a++){c=l[u=n._getBucketId(s,a)];var v=s>=f.startCol&&s<=f.endCol&&a>=f.startRow&&a<=f.endRow,g=s>=p.region.startCol&&s<=p.region.endCol&&a>=p.region.startRow&&a<=p.region.endRow;!v&&g&&g&&c&&n._bucketRemoveBody(e,c,p),(p.region===f||v&&!g||i)&&(c||(c=n._createBucket(l,u)),n._bucketAddBody(e,c,p))}p.region=f,d=!0}}}d&&(e.pairsList=n._createActivePairsList(e))},n.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]},n._regionUnion=function(e,t){var r=Math.min(e.startCol,t.startCol),i=Math.max(e.endCol,t.endCol),o=Math.min(e.startRow,t.startRow),s=Math.max(e.endRow,t.endRow);return n._createRegion(r,i,o,s)},n._getRegion=function(e,t){var r=t.bounds,i=Math.floor(r.min.x/e.bucketWidth),o=Math.floor(r.max.x/e.bucketWidth),s=Math.floor(r.min.y/e.bucketHeight),a=Math.floor(r.max.y/e.bucketHeight);return n._createRegion(i,o,s,a)},n._createRegion=function(e,t,r,n){return{id:e+","+t+","+r+","+n,startCol:e,endCol:t,startRow:r,endRow:n}},n._getBucketId=function(e,t){return"C"+e+"R"+t},n._createBucket=function(e,t){return e[t]=[]},n._bucketAddBody=function(e,t,r){for(var n=0;n<t.length;n++){var o=t[n];if(!(r.id===o.id||r.isStatic&&o.isStatic)){var s=i.id(r,o),a=e.pairs[s];a?a[2]+=1:e.pairs[s]=[r,o,1]}}t.push(r)},n._bucketRemoveBody=function(e,t,r){t.splice(s.indexOf(t,r),1);for(var n=0;n<t.length;n++){var o=t[n],a=i.id(r,o),c=e.pairs[a];c&&(c[2]-=1)}},n._createActivePairsList=function(e){var t,r,n=[];t=s.keys(e.pairs);for(var i=0;i<t.length;i++)(r=e.pairs[t[i]])[2]>0?n.push(r):delete e.pairs[t[i]];return n}},{"../core/Common":14,"./Detector":5,"./Pair":7}],7:[function(e,t,r){var n={};t.exports=n;var i=e("./Contact");n.create=function(e,t){var r=e.bodyA,i=e.bodyB,o=e.parentA,s=e.parentB,a={id:n.id(r,i),bodyA:r,bodyB:i,contacts:{},activeContacts:[],separation:0,isActive:!0,isSensor:r.isSensor||i.isSensor,timeCreated:t,timeUpdated:t,inverseMass:o.inverseMass+s.inverseMass,friction:Math.min(o.friction,s.friction),frictionStatic:Math.max(o.frictionStatic,s.frictionStatic),restitution:Math.max(o.restitution,s.restitution),slop:Math.max(o.slop,s.slop)};return n.update(a,e,t),a},n.update=function(e,t,r){var o=e.contacts,s=t.supports,a=e.activeContacts,c=t.parentA,u=t.parentB;if(e.collision=t,e.inverseMass=c.inverseMass+u.inverseMass,e.friction=Math.min(c.friction,u.friction),e.frictionStatic=Math.max(c.frictionStatic,u.frictionStatic),e.restitution=Math.max(c.restitution,u.restitution),e.slop=Math.max(c.slop,u.slop),a.length=0,t.collided){for(var h=0;h<s.length;h++){var l=s[h],d=i.id(l),p=o[d];p?a.push(p):a.push(o[d]=i.create(l))}e.separation=t.depth,n.setActive(e,!0,r)}else!0===e.isActive&&n.setActive(e,!1,r)},n.setActive=function(e,t,r){t?(e.isActive=!0,e.timeUpdated=r):(e.isActive=!1,e.activeContacts.length=0)},n.id=function(e,t){return e.id<t.id?"A"+e.id+"B"+t.id:"A"+t.id+"B"+e.id}},{"./Contact":4}],8:[function(e,t,r){var n={};t.exports=n;var i=e("./Pair"),o=e("../core/Common");n._pairMaxIdleLife=1e3,n.create=function(e){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},n.update=function(e,t,r){var n,s,a,c,u=e.list,h=e.table,l=e.collisionStart,d=e.collisionEnd,p=e.collisionActive,f=[];for(l.length=0,d.length=0,p.length=0,c=0;c<t.length;c++)(n=t[c]).collided&&(s=i.id(n.bodyA,n.bodyB),f.push(s),(a=h[s])?(a.isActive?p.push(a):l.push(a),i.update(a,n,r)):(a=i.create(n,r),h[s]=a,l.push(a),u.push(a)));for(c=0;c<u.length;c++)(a=u[c]).isActive&&-1===o.indexOf(f,a.id)&&(i.setActive(a,!1,r),d.push(a))},n.removeOld=function(e,t){var r,i,o,s,a=e.list,c=e.table,u=[];for(s=0;s<a.length;s++)(i=(r=a[s]).collision).bodyA.isSleeping||i.bodyB.isSleeping?r.timeUpdated=t:t-r.timeUpdated>n._pairMaxIdleLife&&u.push(s);for(s=0;s<u.length;s++)delete c[(r=a[o=u[s]-s]).id],a.splice(o,1)},n.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}},{"../core/Common":14,"./Pair":7}],9:[function(e,t,r){var n={};t.exports=n;var i=e("../geometry/Vector"),o=e("./SAT"),s=e("../geometry/Bounds"),a=e("../factory/Bodies"),c=e("../geometry/Vertices");n.collides=function(e,t){for(var r=[],n=0;n<t.length;n++){var i=t[n];if(s.overlaps(i.bounds,e.bounds))for(var a=1===i.parts.length?0:1;a<i.parts.length;a++){var c=i.parts[a];if(s.overlaps(c.bounds,e.bounds)){var u=o.collides(c,e);if(u.collided){r.push(u);break}}}}return r},n.ray=function(e,t,r,o){o=o||1e-100;for(var s=i.angle(t,r),c=i.magnitude(i.sub(t,r)),u=.5*(r.x+t.x),h=.5*(r.y+t.y),l=a.rectangle(u,h,c,o,{angle:s}),d=n.collides(l,e),p=0;p<d.length;p+=1){var f=d[p];f.body=f.bodyB=f.bodyA}return d},n.region=function(e,t,r){for(var n=[],i=0;i<e.length;i++){var o=e[i],a=s.overlaps(o.bounds,t);(a&&!r||!a&&r)&&n.push(o)}return n},n.point=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n];if(s.contains(i.bounds,t))for(var o=1===i.parts.length?0:1;o<i.parts.length;o++){var a=i.parts[o];if(s.contains(a.bounds,t)&&c.contains(a.vertices,t)){r.push(i);break}}}return r}},{"../factory/Bodies":23,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29,"./SAT":11}],10:[function(e,t,r){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),s=e("../core/Common"),a=e("../geometry/Bounds");n._restingThresh=4,n._restingThreshTangent=6,n._positionDampen=.9,n._positionWarming=.8,n._frictionNormalMultiplier=5,n.preSolvePosition=function(e){var t,r,n;for(t=0;t<e.length;t++)(r=e[t]).isActive&&(n=r.activeContacts.length,r.collision.parentA.totalContacts+=n,r.collision.parentB.totalContacts+=n)},n.solvePosition=function(e,t){var r,i,s,a,c,u,h,l,d,p=o._temp[0],f=o._temp[1],m=o._temp[2],v=o._temp[3];for(r=0;r<e.length;r++)(i=e[r]).isActive&&!i.isSensor&&(a=(s=i.collision).parentA,c=s.parentB,u=s.normal,h=o.sub(o.add(c.positionImpulse,c.position,p),o.add(a.positionImpulse,o.sub(c.position,s.penetration,f),m),v),i.separation=o.dot(u,h));for(r=0;r<e.length;r++)(i=e[r]).isActive&&!i.isSensor&&(a=(s=i.collision).parentA,c=s.parentB,u=s.normal,d=(i.separation-i.slop)*t,(a.isStatic||c.isStatic)&&(d*=2),a.isStatic||a.isSleeping||(l=n._positionDampen/a.totalContacts,a.positionImpulse.x+=u.x*d*l,a.positionImpulse.y+=u.y*d*l),c.isStatic||c.isSleeping||(l=n._positionDampen/c.totalContacts,c.positionImpulse.x-=u.x*d*l,c.positionImpulse.y-=u.y*d*l))},n.postSolvePosition=function(e){for(var t=0;t<e.length;t++){var r=e[t];if(r.totalContacts=0,0!==r.positionImpulse.x||0!==r.positionImpulse.y){for(var s=0;s<r.parts.length;s++){var c=r.parts[s];i.translate(c.vertices,r.positionImpulse),a.update(c.bounds,c.vertices,r.velocity),c.position.x+=r.positionImpulse.x,c.position.y+=r.positionImpulse.y}r.positionPrev.x+=r.positionImpulse.x,r.positionPrev.y+=r.positionImpulse.y,o.dot(r.positionImpulse,r.velocity)<0?(r.positionImpulse.x=0,r.positionImpulse.y=0):(r.positionImpulse.x*=n._positionWarming,r.positionImpulse.y*=n._positionWarming)}}},n.preSolveVelocity=function(e){var t,r,n,i,s,a,c,u,h,l,d,p,f,m,v=o._temp[0],g=o._temp[1];for(t=0;t<e.length;t++)if((n=e[t]).isActive&&!n.isSensor)for(i=n.activeContacts,a=(s=n.collision).parentA,c=s.parentB,u=s.normal,h=s.tangent,r=0;r<i.length;r++)d=(l=i[r]).vertex,p=l.normalImpulse,f=l.tangentImpulse,0===p&&0===f||(v.x=u.x*p+h.x*f,v.y=u.y*p+h.y*f,a.isStatic||a.isSleeping||(m=o.sub(d,a.position,g),a.positionPrev.x+=v.x*a.inverseMass,a.positionPrev.y+=v.y*a.inverseMass,a.anglePrev+=o.cross(m,v)*a.inverseInertia),c.isStatic||c.isSleeping||(m=o.sub(d,c.position,g),c.positionPrev.x-=v.x*c.inverseMass,c.positionPrev.y-=v.y*c.inverseMass,c.anglePrev-=o.cross(m,v)*c.inverseInertia))},n.solveVelocity=function(e,t){for(var r=t*t,i=o._temp[0],a=o._temp[1],c=o._temp[2],u=o._temp[3],h=o._temp[4],l=o._temp[5],d=0;d<e.length;d++){var p=e[d];if(p.isActive&&!p.isSensor){var f=p.collision,m=f.parentA,v=f.parentB,g=f.normal,y=f.tangent,_=p.activeContacts,b=1/_.length;m.velocity.x=m.position.x-m.positionPrev.x,m.velocity.y=m.position.y-m.positionPrev.y,v.velocity.x=v.position.x-v.positionPrev.x,v.velocity.y=v.position.y-v.positionPrev.y,m.angularVelocity=m.angle-m.anglePrev,v.angularVelocity=v.angle-v.anglePrev;for(var x=0;x<_.length;x++){var w=_[x],T=w.vertex,S=o.sub(T,m.position,a),C=o.sub(T,v.position,c),P=o.add(m.velocity,o.mult(o.perp(S),m.angularVelocity),u),E=o.add(v.velocity,o.mult(o.perp(C),v.angularVelocity),h),I=o.sub(P,E,l),A=o.dot(g,I),M=o.dot(y,I),O=Math.abs(M),R=s.sign(M),D=(1+p.restitution)*A,k=s.clamp(p.separation+A,0,1)*n._frictionNormalMultiplier,L=M,B=1/0;O>p.friction*p.frictionStatic*k*r&&(B=O,L=s.clamp(p.friction*R*r,-B,B));var F=o.cross(S,g),N=o.cross(C,g),j=b/(m.inverseMass+v.inverseMass+m.inverseInertia*F*F+v.inverseInertia*N*N);if(D*=j,L*=j,A<0&&A*A>n._restingThresh*r)w.normalImpulse=0;else{var U=w.normalImpulse;w.normalImpulse=Math.min(w.normalImpulse+D,0),D=w.normalImpulse-U}if(M*M>n._restingThreshTangent*r)w.tangentImpulse=0;else{var G=w.tangentImpulse;w.tangentImpulse=s.clamp(w.tangentImpulse+L,-B,B),L=w.tangentImpulse-G}i.x=g.x*D+y.x*L,i.y=g.y*D+y.y*L,m.isStatic||m.isSleeping||(m.positionPrev.x+=i.x*m.inverseMass,m.positionPrev.y+=i.y*m.inverseMass,m.anglePrev+=o.cross(S,i)*m.inverseInertia),v.isStatic||v.isSleeping||(v.positionPrev.x-=i.x*v.inverseMass,v.positionPrev.y-=i.y*v.inverseMass,v.anglePrev-=o.cross(C,i)*v.inverseInertia)}}}}},{"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],11:[function(e,t,r){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../geometry/Vector");n.collides=function(e,t,r){var s,a,c,u,h=!1;if(r){var l=e.parent,d=t.parent,p=l.speed*l.speed+l.angularSpeed*l.angularSpeed+d.speed*d.speed+d.angularSpeed*d.angularSpeed;h=r&&r.collided&&p<.2,u=r}else u={collided:!1,bodyA:e,bodyB:t};if(r&&h){var f=u.axisBody,m=f===e?t:e,v=[f.axes[r.axisNumber]];if(c=n._overlapAxes(f.vertices,m.vertices,v),u.reused=!0,c.overlap<=0)return u.collided=!1,u}else{if((s=n._overlapAxes(e.vertices,t.vertices,e.axes)).overlap<=0)return u.collided=!1,u;if((a=n._overlapAxes(t.vertices,e.vertices,t.axes)).overlap<=0)return u.collided=!1,u;s.overlap<a.overlap?(c=s,u.axisBody=e):(c=a,u.axisBody=t),u.axisNumber=c.axisNumber}u.bodyA=e.id<t.id?e:t,u.bodyB=e.id<t.id?t:e,u.collided=!0,u.depth=c.overlap,u.parentA=u.bodyA.parent,u.parentB=u.bodyB.parent,e=u.bodyA,t=u.bodyB,o.dot(c.axis,o.sub(t.position,e.position))<0?u.normal={x:c.axis.x,y:c.axis.y}:u.normal={x:-c.axis.x,y:-c.axis.y},u.tangent=o.perp(u.normal),u.penetration=u.penetration||{},u.penetration.x=u.normal.x*u.depth,u.penetration.y=u.normal.y*u.depth;var g=n._findSupports(e,t,u.normal),y=[];if(i.contains(e.vertices,g[0])&&y.push(g[0]),i.contains(e.vertices,g[1])&&y.push(g[1]),y.length<2){var _=n._findSupports(t,e,o.neg(u.normal));i.contains(t.vertices,_[0])&&y.push(_[0]),y.length<2&&i.contains(t.vertices,_[1])&&y.push(_[1])}return y.length<1&&(y=[g[0]]),u.supports=y,u},n._overlapAxes=function(e,t,r){for(var i,s,a=o._temp[0],c=o._temp[1],u={overlap:Number.MAX_VALUE},h=0;h<r.length;h++){if(s=r[h],n._projectToAxis(a,e,s),n._projectToAxis(c,t,s),(i=Math.min(a.max-c.min,c.max-a.min))<=0)return u.overlap=i,u;i<u.overlap&&(u.overlap=i,u.axis=s,u.axisNumber=h)}return u},n._projectToAxis=function(e,t,r){for(var n=o.dot(t[0],r),i=n,s=1;s<t.length;s+=1){var a=o.dot(t[s],r);a>i?i=a:a<n&&(n=a)}e.min=n,e.max=i},n._findSupports=function(e,t,r){for(var n,i,s,a,c=Number.MAX_VALUE,u=o._temp[0],h=t.vertices,l=e.position,d=0;d<h.length;d++)i=h[d],u.x=i.x-l.x,u.y=i.y-l.y,(n=-o.dot(r,u))<c&&(c=n,s=i);return i=h[s.index-1>=0?s.index-1:h.length-1],u.x=i.x-l.x,u.y=i.y-l.y,c=-o.dot(r,u),a=i,i=h[(s.index+1)%h.length],u.x=i.x-l.x,u.y=i.y-l.y,(n=-o.dot(r,u))<c&&(a=i),[s,a]}},{"../geometry/Vector":28,"../geometry/Vertices":29}],12:[function(e,t,r){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../geometry/Vector"),s=e("../core/Sleeping"),a=e("../geometry/Bounds"),c=e("../geometry/Axes"),u=e("../core/Common");n._warming=.4,n._torqueDampen=1,n._minLength=1e-6,n.create=function(e){var t=e;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var r=t.bodyA?o.add(t.bodyA.position,t.pointA):t.pointA,n=t.bodyB?o.add(t.bodyB.position,t.pointB):t.pointB,i=o.magnitude(o.sub(r,n));t.length=void 0!==t.length?t.length:i,t.id=t.id||u.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var s={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===t.length&&t.stiffness>.1?(s.type="pin",s.anchors=!1):t.stiffness<.9&&(s.type="spring"),t.render=u.extend(s,t.render),t},n.preSolveAll=function(e){for(var t=0;t<e.length;t+=1){var r=e[t],n=r.constraintImpulse;r.isStatic||0===n.x&&0===n.y&&0===n.angle||(r.position.x+=n.x,r.position.y+=n.y,r.angle+=n.angle)}},n.solveAll=function(e,t){for(var r=0;r<e.length;r+=1){var i=e[r],o=!i.bodyA||i.bodyA&&i.bodyA.isStatic,s=!i.bodyB||i.bodyB&&i.bodyB.isStatic;(o||s)&&n.solve(e[r],t)}for(r=0;r<e.length;r+=1)o=!(i=e[r]).bodyA||i.bodyA&&i.bodyA.isStatic,s=!i.bodyB||i.bodyB&&i.bodyB.isStatic,o||s||n.solve(e[r],t)},n.solve=function(e,t){var r=e.bodyA,i=e.bodyB,s=e.pointA,a=e.pointB;if(r||i){r&&!r.isStatic&&(o.rotate(s,r.angle-e.angleA,s),e.angleA=r.angle),i&&!i.isStatic&&(o.rotate(a,i.angle-e.angleB,a),e.angleB=i.angle);var c=s,u=a;if(r&&(c=o.add(r.position,s)),i&&(u=o.add(i.position,a)),c&&u){var h=o.sub(c,u),l=o.magnitude(h);l<n._minLength&&(l=n._minLength);var d,p,f,m,v,g=(l-e.length)/l,y=e.stiffness<1?e.stiffness*t:e.stiffness,_=o.mult(h,g*y),b=(r?r.inverseMass:0)+(i?i.inverseMass:0),x=b+((r?r.inverseInertia:0)+(i?i.inverseInertia:0));if(e.damping){var w=o.create();f=o.div(h,l),v=o.sub(i&&o.sub(i.position,i.positionPrev)||w,r&&o.sub(r.position,r.positionPrev)||w),m=o.dot(f,v)}r&&!r.isStatic&&(p=r.inverseMass/b,r.constraintImpulse.x-=_.x*p,r.constraintImpulse.y-=_.y*p,r.position.x-=_.x*p,r.position.y-=_.y*p,e.damping&&(r.positionPrev.x-=e.damping*f.x*m*p,r.positionPrev.y-=e.damping*f.y*m*p),d=o.cross(s,_)/x*n._torqueDampen*r.inverseInertia*(1-e.angularStiffness),r.constraintImpulse.angle-=d,r.angle-=d),i&&!i.isStatic&&(p=i.inverseMass/b,i.constraintImpulse.x+=_.x*p,i.constraintImpulse.y+=_.y*p,i.position.x+=_.x*p,i.position.y+=_.y*p,e.damping&&(i.positionPrev.x+=e.damping*f.x*m*p,i.positionPrev.y+=e.damping*f.y*m*p),d=o.cross(a,_)/x*n._torqueDampen*i.inverseInertia*(1-e.angularStiffness),i.constraintImpulse.angle+=d,i.angle+=d)}}},n.postSolveAll=function(e){for(var t=0;t<e.length;t++){var r=e[t],u=r.constraintImpulse;if(!(r.isStatic||0===u.x&&0===u.y&&0===u.angle)){s.set(r,!1);for(var h=0;h<r.parts.length;h++){var l=r.parts[h];i.translate(l.vertices,u),h>0&&(l.position.x+=u.x,l.position.y+=u.y),0!==u.angle&&(i.rotate(l.vertices,u.angle,r.position),c.rotate(l.axes,u.angle),h>0&&o.rotateAbout(l.position,u.angle,r.position,l.position)),a.update(l.bounds,l.vertices,r.velocity)}u.angle*=n._warming,u.x*=n._warming,u.y*=n._warming}}}},{"../core/Common":14,"../core/Sleeping":22,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],13:[function(e,t,r){var n={};t.exports=n;var i=e("../geometry/Vertices"),o=e("../core/Sleeping"),s=e("../core/Mouse"),a=e("../core/Events"),c=e("../collision/Detector"),u=e("./Constraint"),h=e("../body/Composite"),l=e("../core/Common"),d=e("../geometry/Bounds");n.create=function(e,t){var r=(e?e.mouse:null)||(t?t.mouse:null);r||(e&&e.render&&e.render.canvas?r=s.create(e.render.canvas):t&&t.element?r=s.create(t.element):(r=s.create(),l.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var i={type:"mouseConstraint",mouse:r,element:null,body:null,constraint:u.create({label:"Mouse Constraint",pointA:r.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},o=l.extend(i,t);return a.on(e,"beforeUpdate",(function(){var t=h.allBodies(e.world);n.update(o,t),n._triggerEvents(o)})),o},n.update=function(e,t){var r=e.mouse,n=e.constraint,s=e.body;if(0===r.button){if(n.bodyB)o.set(n.bodyB,!1),n.pointA=r.position;else for(var u=0;u<t.length;u++)if(s=t[u],d.contains(s.bounds,r.position)&&c.canCollide(s.collisionFilter,e.collisionFilter))for(var h=s.parts.length>1?1:0;h<s.parts.length;h++){var l=s.parts[h];if(i.contains(l.vertices,r.position)){n.pointA=r.position,n.bodyB=e.body=s,n.pointB={x:r.position.x-s.position.x,y:r.position.y-s.position.y},n.angleB=s.angle,o.set(s,!1),a.trigger(e,"startdrag",{mouse:r,body:s});break}}}else n.bodyB=e.body=null,n.pointB=null,s&&a.trigger(e,"enddrag",{mouse:r,body:s})},n._triggerEvents=function(e){var t=e.mouse,r=t.sourceEvents;r.mousemove&&a.trigger(e,"mousemove",{mouse:t}),r.mousedown&&a.trigger(e,"mousedown",{mouse:t}),r.mouseup&&a.trigger(e,"mouseup",{mouse:t}),s.clearSourceEvents(t)}},{"../body/Composite":2,"../collision/Detector":5,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../core/Sleeping":22,"../geometry/Bounds":26,"../geometry/Vertices":29,"./Constraint":12}],14:[function(e,t,r){(function(r){var n={};t.exports=n,function(){n._nextId=0,n._seed=0,n._nowStartTime=+new Date,n.extend=function(e,t){var r,i;"boolean"==typeof t?(r=2,i=t):(r=1,i=!0);for(var o=r;o<arguments.length;o++){var s=arguments[o];if(s)for(var a in s)i&&s[a]&&s[a].constructor===Object?e[a]&&e[a].constructor!==Object?e[a]=s[a]:(e[a]=e[a]||{},n.extend(e[a],i,s[a])):e[a]=s[a]}return e},n.clone=function(e,t){return n.extend({},t,e)},n.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var r in e)t.push(r);return t},n.values=function(e){var t=[];if(Object.keys){for(var r=Object.keys(e),n=0;n<r.length;n++)t.push(e[r[n]]);return t}for(var i in e)t.push(e[i]);return t},n.get=function(e,t,r,n){t=t.split(".").slice(r,n);for(var i=0;i<t.length;i+=1)e=e[t[i]];return e},n.set=function(e,t,r,i,o){var s=t.split(".").slice(i,o);return n.get(e,t,0,-1)[s[s.length-1]]=r,r},n.shuffle=function(e){for(var t=e.length-1;t>0;t--){var r=Math.floor(n.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e},n.choose=function(e){return e[Math.floor(n.random()*e.length)]},n.isElement=function(e){return"undefined"!=typeof HTMLElement?e instanceof HTMLElement:!!(e&&e.nodeType&&e.nodeName)},n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},n.isFunction=function(e){return"function"==typeof e},n.isPlainObject=function(e){return"object"==typeof e&&e.constructor===Object},n.isString=function(e){return"[object String]"===toString.call(e)},n.clamp=function(e,t,r){return e<t?t:e>r?r:e},n.sign=function(e){return e<0?-1:1},n.now=function(){if(window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return new Date-n._nowStartTime},n.random=function(e,r){return r=void 0!==r?r:1,(e=void 0!==e?e:0)+t()*(r-e)};var t=function(){return n._seed=(9301*n._seed+49297)%233280,n._seed/233280};n.colorToNumber=function(e){return 3==(e=e.replace("#","")).length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},n.logLevel=1,n.log=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.info=function(){console&&n.logLevel>0&&n.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.warn=function(){console&&n.logLevel>0&&n.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},n.nextId=function(){return n._nextId++},n.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var r=0;r<e.length;r++)if(e[r]===t)return r;return-1},n.map=function(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n+=1)r.push(t(e[n]));return r},n.topologicalSort=function(e){var t=[],r=[],i=[];for(var o in e)r[o]||i[o]||n._topologicalSort(o,r,i,e,t);return t},n._topologicalSort=function(e,t,r,i,o){var s=i[e]||[];r[e]=!0;for(var a=0;a<s.length;a+=1){var c=s[a];r[c]||t[c]||n._topologicalSort(c,t,r,i,o)}r[e]=!1,t[e]=!0,o.push(e)},n.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var r=arguments[t];r._chained?e.push.apply(e,r._chained):e.push(r)}var n=function(){for(var t,r=new Array(arguments.length),n=0,i=arguments.length;n<i;n++)r[n]=arguments[n];for(n=0;n<e.length;n+=1){var o=e[n].apply(t,r);void 0!==o&&(t=o)}return t};return n._chained=e,n},n.chainPathBefore=function(e,t,r){return n.set(e,t,n.chain(r,n.get(e,t)))},n.chainPathAfter=function(e,t,r){return n.set(e,t,n.chain(n.get(e,t),r))},n._requireGlobal=function(t,n){return("undefined"!=typeof window?window[t]:void 0!==r?r[t]:null)||e(n)}}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(e,t,r){var n={};t.exports=n;var i=e("../body/World"),o=e("./Sleeping"),s=e("../collision/Resolver"),a=e("../render/Render"),c=e("../collision/Pairs"),u=(e("./Metrics"),e("../collision/Grid")),h=e("./Events"),l=e("../body/Composite"),d=e("../constraint/Constraint"),p=e("./Common"),f=e("../body/Body");n.create=function(e,t){t=(t=p.isElement(e)?t:e)||{},((e=p.isElement(e)?e:null)||t.render)&&p.warn("Engine.create: engine.render is deprecated (see docs)");var r={positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},timing:{timestamp:0,timeScale:1},broadphase:{controller:u}},n=p.extend(r,t);if(e||n.render){var o={element:e,controller:a};n.render=p.extend(o,n.render)}return n.render&&n.render.controller&&(n.render=n.render.controller.create(n.render)),n.render&&(n.render.engine=n),n.world=t.world||i.create(n.world),n.pairs=c.create(),n.broadphase=n.broadphase.controller.create(n.broadphase),n.metrics=n.metrics||{extended:!1},n},n.update=function(e,t,r){t=t||1e3/60,r=r||1;var i,a=e.world,u=e.timing,p=e.broadphase,f=[];u.timestamp+=t*u.timeScale;var m={timestamp:u.timestamp};h.trigger(e,"beforeUpdate",m);var v=l.allBodies(a),g=l.allConstraints(a);for(e.enableSleeping&&o.update(v,u.timeScale),n._bodiesApplyGravity(v,a.gravity),n._bodiesUpdate(v,t,u.timeScale,r,a.bounds),d.preSolveAll(v),i=0;i<e.constraintIterations;i++)d.solveAll(g,u.timeScale);d.postSolveAll(v),p.controller?(a.isModified&&p.controller.clear(p),p.controller.update(p,v,e,a.isModified),f=p.pairsList):f=v,a.isModified&&l.setModified(a,!1,!1,!0);var y=p.detector(f,e),_=e.pairs,b=u.timestamp;for(c.update(_,y,b),c.removeOld(_,b),e.enableSleeping&&o.afterCollisions(_.list,u.timeScale),_.collisionStart.length>0&&h.trigger(e,"collisionStart",{pairs:_.collisionStart}),s.preSolvePosition(_.list),i=0;i<e.positionIterations;i++)s.solvePosition(_.list,u.timeScale);for(s.postSolvePosition(v),d.preSolveAll(v),i=0;i<e.constraintIterations;i++)d.solveAll(g,u.timeScale);for(d.postSolveAll(v),s.preSolveVelocity(_.list),i=0;i<e.velocityIterations;i++)s.solveVelocity(_.list,u.timeScale);return _.collisionActive.length>0&&h.trigger(e,"collisionActive",{pairs:_.collisionActive}),_.collisionEnd.length>0&&h.trigger(e,"collisionEnd",{pairs:_.collisionEnd}),n._bodiesClearForces(v),h.trigger(e,"afterUpdate",m),e},n.merge=function(e,t){if(p.extend(e,t),t.world){e.world=t.world,n.clear(e);for(var r=l.allBodies(e.world),i=0;i<r.length;i++){var s=r[i];o.set(s,!1),s.id=p.nextId()}}},n.clear=function(e){var t=e.world;c.clear(e.pairs);var r=e.broadphase;if(r.controller){var n=l.allBodies(t);r.controller.clear(r),r.controller.update(r,n,e,!0)}},n._bodiesClearForces=function(e){for(var t=0;t<e.length;t++){var r=e[t];r.force.x=0,r.force.y=0,r.torque=0}},n._bodiesApplyGravity=function(e,t){var r=void 0!==t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==r)for(var n=0;n<e.length;n++){var i=e[n];i.isStatic||i.isSleeping||(i.force.y+=i.mass*t.y*r,i.force.x+=i.mass*t.x*r)}},n._bodiesUpdate=function(e,t,r,n,i){for(var o=0;o<e.length;o++){var s=e[o];s.isStatic||s.isSleeping||f.update(s,t,r,n)}}},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Grid":6,"../collision/Pairs":8,"../collision/Resolver":10,"../constraint/Constraint":12,"../render/Render":31,"./Common":14,"./Events":16,"./Metrics":18,"./Sleeping":22}],16:[function(e,t,r){var n={};t.exports=n;var i=e("./Common");n.on=function(e,t,r){for(var n,i=t.split(" "),o=0;o<i.length;o++)n=i[o],e.events=e.events||{},e.events[n]=e.events[n]||[],e.events[n].push(r);return r},n.off=function(e,t,r){if(t){"function"==typeof t&&(r=t,t=i.keys(e.events).join(" "));for(var n=t.split(" "),o=0;o<n.length;o++){var s=e.events[n[o]],a=[];if(r&&s)for(var c=0;c<s.length;c++)s[c]!==r&&a.push(s[c]);e.events[n[o]]=a}}else e.events={}},n.trigger=function(e,t,r){var n,o,s,a;if(e.events){r||(r={}),n=t.split(" ");for(var c=0;c<n.length;c++)if(o=n[c],s=e.events[o]){(a=i.clone(r,!1)).name=o,a.source=e;for(var u=0;u<s.length;u++)s[u].apply(e,[a])}}}},{"./Common":14}],17:[function(e,t,r){var n={};t.exports=n;var i=e("./Plugin"),o=e("./Common");n.name="matter-js",n.version="0.14.2",n.uses=[],n.used=[],n.use=function(){i.use(n,Array.prototype.slice.call(arguments))},n.before=function(e,t){return e=e.replace(/^Matter./,""),o.chainPathBefore(n,e,t)},n.after=function(e,t){return e=e.replace(/^Matter./,""),o.chainPathAfter(n,e,t)}},{"./Common":14,"./Plugin":20}],18:[function(e,t,r){},{"../body/Composite":2,"./Common":14}],19:[function(e,t,r){var n={};t.exports=n;var i=e("../core/Common");n.create=function(e){var t={};return e||i.log("Mouse.create: element was undefined, defaulting to document.body","warn"),t.element=e||document.body,t.absolute={x:0,y:0},t.position={x:0,y:0},t.mousedownPosition={x:0,y:0},t.mouseupPosition={x:0,y:0},t.offset={x:0,y:0},t.scale={x:1,y:1},t.wheelDelta=0,t.button=-1,t.pixelRatio=t.element.getAttribute("data-pixel-ratio")||1,t.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},t.mousemove=function(e){var r=n._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&(t.button=0,e.preventDefault()),t.absolute.x=r.x,t.absolute.y=r.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.sourceEvents.mousemove=e},t.mousedown=function(e){var r=n._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches?(t.button=0,e.preventDefault()):t.button=e.button,t.absolute.x=r.x,t.absolute.y=r.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mousedownPosition.x=t.position.x,t.mousedownPosition.y=t.position.y,t.sourceEvents.mousedown=e},t.mouseup=function(e){var r=n._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&e.preventDefault(),t.button=-1,t.absolute.x=r.x,t.absolute.y=r.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mouseupPosition.x=t.position.x,t.mouseupPosition.y=t.position.y,t.sourceEvents.mouseup=e},t.mousewheel=function(e){t.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},n.setElement(t,t.element),t},n.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},n.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},n.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},n.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},n._getRelativeMousePosition=function(e,t,r){var n,i,o=t.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:s.scrollLeft,c=void 0!==window.pageYOffset?window.pageYOffset:s.scrollTop,u=e.changedTouches;return u?(n=u[0].pageX-o.left-a,i=u[0].pageY-o.top-c):(n=e.pageX-o.left-a,i=e.pageY-o.top-c),{x:n/(t.clientWidth/(t.width||t.clientWidth)*r),y:i/(t.clientHeight/(t.height||t.clientHeight)*r)}}},{"../core/Common":14}],20:[function(e,t,r){var n={};t.exports=n;var i=e("./Common");n._registry={},n.register=function(e){if(n.isPlugin(e)||i.warn("Plugin.register:",n.toString(e),"does not implement all required fields."),e.name in n._registry){var t=n._registry[e.name],r=n.versionParse(e.version).number,o=n.versionParse(t.version).number;r>o?(i.warn("Plugin.register:",n.toString(t),"was upgraded to",n.toString(e)),n._registry[e.name]=e):r<o?i.warn("Plugin.register:",n.toString(t),"can not be downgraded to",n.toString(e)):e!==t&&i.warn("Plugin.register:",n.toString(e),"is already registered to different plugin object")}else n._registry[e.name]=e;return e},n.resolve=function(e){return n._registry[n.dependencyParse(e).name]},n.toString=function(e){return"string"==typeof e?e:(e.name||"anonymous")+"@"+(e.version||e.range||"0.0.0")},n.isPlugin=function(e){return e&&e.name&&e.version&&e.install},n.isUsed=function(e,t){return e.used.indexOf(t)>-1},n.isFor=function(e,t){var r=e.for&&n.dependencyParse(e.for);return!e.for||t.name===r.name&&n.versionSatisfies(t.version,r.range)},n.use=function(e,t){if(e.uses=(e.uses||[]).concat(t||[]),0!==e.uses.length){for(var r=n.dependencies(e),o=i.topologicalSort(r),s=[],a=0;a<o.length;a+=1)if(o[a]!==e.name){var c=n.resolve(o[a]);c?n.isUsed(e,c.name)||(n.isFor(c,e)||(i.warn("Plugin.use:",n.toString(c),"is for",c.for,"but installed on",n.toString(e)+"."),c._warned=!0),c.install?c.install(e):(i.warn("Plugin.use:",n.toString(c),"does not specify an install function."),c._warned=!0),c._warned?(s.push("ðŸ”¶ "+n.toString(c)),delete c._warned):s.push("âœ… "+n.toString(c)),e.used.push(c.name)):s.push("âŒ "+o[a])}s.length>0&&i.info(s.join("  "))}else i.warn("Plugin.use:",n.toString(e),"does not specify any dependencies to install.")},n.dependencies=function(e,t){var r=n.dependencyParse(e),o=r.name;if(!(o in(t=t||{}))){e=n.resolve(e)||e,t[o]=i.map(e.uses||[],(function(t){n.isPlugin(t)&&n.register(t);var o=n.dependencyParse(t),s=n.resolve(t);return s&&!n.versionSatisfies(s.version,o.range)?(i.warn("Plugin.dependencies:",n.toString(s),"does not satisfy",n.toString(o),"used by",n.toString(r)+"."),s._warned=!0,e._warned=!0):s||(i.warn("Plugin.dependencies:",n.toString(t),"used by",n.toString(r),"could not be resolved."),e._warned=!0),o.name}));for(var s=0;s<t[o].length;s+=1)n.dependencies(t[o][s],t);return t}},n.dependencyParse=function(e){return i.isString(e)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?))?$/.test(e)||i.warn("Plugin.dependencyParse:",e,"is not a valid dependency string."),{name:e.split("@")[0],range:e.split("@")[1]||"*"}):{name:e.name,range:e.range||e.version}},n.versionParse=function(e){/^\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-]+)?$/.test(e)||i.warn("Plugin.versionParse:",e,"is not a valid version or range.");var t=e.split("-");e=t[0];var r=isNaN(Number(e[0])),n=r?e.substr(1):e,o=i.map(n.split("."),(function(e){return Number(e)}));return{isRange:r,version:n,range:e,operator:r?e[0]:"",parts:o,prerelease:t[1],number:1e8*o[0]+1e4*o[1]+o[2]}},n.versionSatisfies=function(e,t){t=t||"*";var r=n.versionParse(t),i=r.parts,o=n.versionParse(e),s=o.parts;if(r.isRange){if("*"===r.operator||"*"===e)return!0;if("~"===r.operator)return s[0]===i[0]&&s[1]===i[1]&&s[2]>=i[2];if("^"===r.operator)return i[0]>0?s[0]===i[0]&&o.number>=r.number:i[1]>0?s[1]===i[1]&&s[2]>=i[2]:s[2]===i[2]}return e===t||"*"===e}},{"./Common":14}],21:[function(e,t,r){var n={};t.exports=n;var i=e("./Events"),o=e("./Engine"),s=e("./Common");!function(){var e,t,r;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),e||(e=function(e){r=setTimeout((function(){e(s.now())}),1e3/60)},t=function(){clearTimeout(r)}),n.create=function(e){var t=s.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},e);return t.delta=t.delta||1e3/t.fps,t.deltaMin=t.deltaMin||1e3/t.fps,t.deltaMax=t.deltaMax||1e3/(.5*t.fps),t.fps=1e3/t.delta,t},n.run=function(t,r){return void 0!==t.positionIterations&&(r=t,t=n.create()),function i(o){t.frameRequestId=e(i),o&&t.enabled&&n.tick(t,r,o)}(),t},n.tick=function(e,t,r){var n,s=t.timing,a=1,c={timestamp:s.timestamp};i.trigger(e,"beforeTick",c),i.trigger(t,"beforeTick",c),e.isFixed?n=e.delta:(n=r-e.timePrev||e.delta,e.timePrev=r,e.deltaHistory.push(n),e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize),a=(n=(n=(n=Math.min.apply(null,e.deltaHistory))<e.deltaMin?e.deltaMin:n)>e.deltaMax?e.deltaMax:n)/e.delta,e.delta=n),0!==e.timeScalePrev&&(a*=s.timeScale/e.timeScalePrev),0===s.timeScale&&(a=0),e.timeScalePrev=s.timeScale,e.correction=a,e.frameCounter+=1,r-e.counterTimestamp>=1e3&&(e.fps=e.frameCounter*((r-e.counterTimestamp)/1e3),e.counterTimestamp=r,e.frameCounter=0),i.trigger(e,"tick",c),i.trigger(t,"tick",c),t.world.isModified&&t.render&&t.render.controller&&t.render.controller.clear&&t.render.controller.clear(t.render),i.trigger(e,"beforeUpdate",c),o.update(t,n,a),i.trigger(e,"afterUpdate",c),t.render&&t.render.controller&&(i.trigger(e,"beforeRender",c),i.trigger(t,"beforeRender",c),t.render.controller.world(t.render),i.trigger(e,"afterRender",c),i.trigger(t,"afterRender",c)),i.trigger(e,"afterTick",c),i.trigger(t,"afterTick",c)},n.stop=function(e){t(e.frameRequestId)},n.start=function(e,t){n.run(e,t)}}()},{"./Common":14,"./Engine":15,"./Events":16}],22:[function(e,t,r){var n={};t.exports=n;var i=e("./Events");n._motionWakeThreshold=.18,n._motionSleepThreshold=.08,n._minBias=.9,n.update=function(e,t){for(var r=t*t*t,i=0;i<e.length;i++){var o=e[i],s=o.speed*o.speed+o.angularSpeed*o.angularSpeed;if(0===o.force.x&&0===o.force.y){var a=Math.min(o.motion,s),c=Math.max(o.motion,s);o.motion=n._minBias*a+(1-n._minBias)*c,o.sleepThreshold>0&&o.motion<n._motionSleepThreshold*r?(o.sleepCounter+=1,o.sleepCounter>=o.sleepThreshold&&n.set(o,!0)):o.sleepCounter>0&&(o.sleepCounter-=1)}else n.set(o,!1)}},n.afterCollisions=function(e,t){for(var r=t*t*t,i=0;i<e.length;i++){var o=e[i];if(o.isActive){var s=o.collision,a=s.bodyA.parent,c=s.bodyB.parent;if(!(a.isSleeping&&c.isSleeping||a.isStatic||c.isStatic)&&(a.isSleeping||c.isSleeping)){var u=a.isSleeping&&!a.isStatic?a:c,h=u===a?c:a;!u.isStatic&&h.motion>n._motionWakeThreshold*r&&n.set(u,!1)}}}},n.set=function(e,t){var r=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,r||i.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,r&&i.trigger(e,"sleepEnd"))}},{"./Events":16}],23:[function(e,t,r){var n={};t.exports=n;var i,o=e("../geometry/Vertices"),s=e("../core/Common"),a=e("../body/Body"),c=e("../geometry/Bounds"),u=e("../geometry/Vector");n.rectangle=function(e,t,r,n,i){i=i||{};var c={label:"Rectangle Body",position:{x:e,y:t},vertices:o.fromPath("L 0 0 L "+r+" 0 L "+r+" "+n+" L 0 "+n)};if(i.chamfer){var u=i.chamfer;c.vertices=o.chamfer(c.vertices,u.radius,u.quality,u.qualityMin,u.qualityMax),delete i.chamfer}return a.create(s.extend({},c,i))},n.trapezoid=function(e,t,r,n,i,c){c=c||{};var u,h=r*(i*=.5),l=h+(1-2*i)*r,d=l+h;u=i<.5?"L 0 0 L "+h+" "+-n+" L "+l+" "+-n+" L "+d+" 0":"L 0 0 L "+l+" "+-n+" L "+d+" 0";var p={label:"Trapezoid Body",position:{x:e,y:t},vertices:o.fromPath(u)};if(c.chamfer){var f=c.chamfer;p.vertices=o.chamfer(p.vertices,f.radius,f.quality,f.qualityMin,f.qualityMax),delete c.chamfer}return a.create(s.extend({},p,c))},n.circle=function(e,t,r,i,o){i=i||{};var a={label:"Circle Body",circleRadius:r};o=o||25;var c=Math.ceil(Math.max(10,Math.min(o,r)));return c%2==1&&(c+=1),n.polygon(e,t,c,r,s.extend({},a,i))},n.polygon=function(e,t,r,i,c){if(c=c||{},r<3)return n.circle(e,t,i,c);for(var u=2*Math.PI/r,h="",l=.5*u,d=0;d<r;d+=1){var p=l+d*u,f=Math.cos(p)*i,m=Math.sin(p)*i;h+="L "+f.toFixed(3)+" "+m.toFixed(3)+" "}var v={label:"Polygon Body",position:{x:e,y:t},vertices:o.fromPath(h)};if(c.chamfer){var g=c.chamfer;v.vertices=o.chamfer(v.vertices,g.radius,g.quality,g.qualityMin,g.qualityMax),delete c.chamfer}return a.create(s.extend({},v,c))},n.fromVertices=function(e,t,r,n,h,l,d){var p,f,m,v,g,y,_,b,x;for(i||(i=s._requireGlobal("decomp","poly-decomp")),n=n||{},f=[],h=void 0!==h&&h,l=void 0!==l?l:.01,d=void 0!==d?d:10,i||s.warn("Bodies.fromVertices: poly-decomp.js required. Could not decompose vertices. Fallback to convex hull."),s.isArray(r[0])||(r=[r]),b=0;b<r.length;b+=1)if(v=r[b],(m=o.isConvex(v))||!i)v=m?o.clockwiseSort(v):o.hull(v),f.push({position:{x:e,y:t},vertices:v});else{var w=v.map((function(e){return[e.x,e.y]}));i.makeCCW(w),!1!==l&&i.removeCollinearPoints(w,l);var T=i.quickDecomp(w);for(g=0;g<T.length;g++){var S=T[g].map((function(e){return{x:e[0],y:e[1]}}));d>0&&o.area(S)<d||f.push({position:o.centre(S),vertices:S})}}for(g=0;g<f.length;g++)f[g]=a.create(s.extend(f[g],n));if(h)for(g=0;g<f.length;g++){var C=f[g];for(y=g+1;y<f.length;y++){var P=f[y];if(c.overlaps(C.bounds,P.bounds)){var E=C.vertices,I=P.vertices;for(_=0;_<C.vertices.length;_++)for(x=0;x<P.vertices.length;x++){var A=u.magnitudeSquared(u.sub(E[(_+1)%E.length],I[x])),M=u.magnitudeSquared(u.sub(E[_],I[(x+1)%I.length]));A<5&&M<5&&(E[_].isInternal=!0,I[x].isInternal=!0)}}}}return f.length>1?(p=a.create(s.extend({parts:f.slice(0)},n)),a.setPosition(p,{x:e,y:t}),p):f[0]}},{"../body/Body":1,"../core/Common":14,"../geometry/Bounds":26,"../geometry/Vector":28,"../geometry/Vertices":29}],24:[function(e,t,r){var n={};t.exports=n;var i=e("../body/Composite"),o=e("../constraint/Constraint"),s=e("../core/Common"),a=e("../body/Body"),c=e("./Bodies");n.stack=function(e,t,r,n,o,s,c){for(var u,h=i.create({label:"Stack"}),l=e,d=t,p=0,f=0;f<n;f++){for(var m=0,v=0;v<r;v++){var g=c(l,d,v,f,u,p);if(g){var y=g.bounds.max.y-g.bounds.min.y,_=g.bounds.max.x-g.bounds.min.x;y>m&&(m=y),a.translate(g,{x:.5*_,y:.5*y}),l=g.bounds.max.x+o,i.addBody(h,g),u=g,p+=1}else l+=o}d+=m+s,l=e}return h},n.chain=function(e,t,r,n,a,c){for(var u=e.bodies,h=1;h<u.length;h++){var l=u[h-1],d=u[h],p=l.bounds.max.y-l.bounds.min.y,f=l.bounds.max.x-l.bounds.min.x,m=d.bounds.max.y-d.bounds.min.y,v={bodyA:l,pointA:{x:f*t,y:p*r},bodyB:d,pointB:{x:(d.bounds.max.x-d.bounds.min.x)*n,y:m*a}},g=s.extend(v,c);i.addConstraint(e,o.create(g))}return e.label+=" Chain",e},n.mesh=function(e,t,r,n,a){var c,u,h,l,d,p=e.bodies;for(c=0;c<r;c++){for(u=1;u<t;u++)h=p[u-1+c*t],l=p[u+c*t],i.addConstraint(e,o.create(s.extend({bodyA:h,bodyB:l},a)));if(c>0)for(u=0;u<t;u++)h=p[u+(c-1)*t],l=p[u+c*t],i.addConstraint(e,o.create(s.extend({bodyA:h,bodyB:l},a))),n&&u>0&&(d=p[u-1+(c-1)*t],i.addConstraint(e,o.create(s.extend({bodyA:d,bodyB:l},a)))),n&&u<t-1&&(d=p[u+1+(c-1)*t],i.addConstraint(e,o.create(s.extend({bodyA:d,bodyB:l},a))))}return e.label+=" Mesh",e},n.pyramid=function(e,t,r,i,o,s,c){return n.stack(e,t,r,i,o,s,(function(t,n,s,u,h,l){var d=Math.min(i,Math.ceil(r/2)),p=h?h.bounds.max.x-h.bounds.min.x:0;if(!(u>d||s<(u=d-u)||s>r-1-u))return 1===l&&a.translate(h,{x:(s+(r%2==1?1:-1))*p,y:0}),c(e+(h?s*p:0)+s*o,n,s,u,h,l)}))},n.newtonsCradle=function(e,t,r,n,s){for(var a=i.create({label:"Newtons Cradle"}),u=0;u<r;u++){var h=c.circle(e+u*(1.9*n),t+s,n,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),l=o.create({pointA:{x:e+u*(1.9*n),y:t},bodyB:h});i.addBody(a,h),i.addConstraint(a,l)}return a},n.car=function(e,t,r,n,s){var u=a.nextGroup(!0),h=.5*-r+20,l=.5*r-20,d=i.create({label:"Car"}),p=c.rectangle(e,t,r,n,{collisionFilter:{group:u},chamfer:{radius:.5*n},density:2e-4}),f=c.circle(e+h,t+0,s,{collisionFilter:{group:u},friction:.8}),m=c.circle(e+l,t+0,s,{collisionFilter:{group:u},friction:.8}),v=o.create({bodyB:p,pointB:{x:h,y:0},bodyA:f,stiffness:1,length:0}),g=o.create({bodyB:p,pointB:{x:l,y:0},bodyA:m,stiffness:1,length:0});return i.addBody(d,p),i.addBody(d,f),i.addBody(d,m),i.addConstraint(d,v),i.addConstraint(d,g),d},n.softBody=function(e,t,r,i,o,a,u,h,l,d){l=s.extend({inertia:1/0},l),d=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},d);var p=n.stack(e,t,r,i,o,a,(function(e,t){return c.circle(e,t,h,l)}));return n.mesh(p,r,i,u,d),p.label="Soft Body",p}},{"../body/Body":1,"../body/Composite":2,"../constraint/Constraint":12,"../core/Common":14,"./Bodies":23}],25:[function(e,t,r){var n={};t.exports=n;var i=e("../geometry/Vector"),o=e("../core/Common");n.fromVertices=function(e){for(var t={},r=0;r<e.length;r++){var n=(r+1)%e.length,s=i.normalise({x:e[n].y-e[r].y,y:e[r].x-e[n].x}),a=0===s.y?1/0:s.x/s.y;t[a=a.toFixed(3).toString()]=s}return o.values(t)},n.rotate=function(e,t){if(0!==t)for(var r=Math.cos(t),n=Math.sin(t),i=0;i<e.length;i++){var o,s=e[i];o=s.x*r-s.y*n,s.y=s.x*n+s.y*r,s.x=o}}},{"../core/Common":14,"../geometry/Vector":28}],26:[function(e,t,r){var n={};t.exports=n,n.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&n.update(t,e),t},n.update=function(e,t,r){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var n=0;n<t.length;n++){var i=t[n];i.x>e.max.x&&(e.max.x=i.x),i.x<e.min.x&&(e.min.x=i.x),i.y>e.max.y&&(e.max.y=i.y),i.y<e.min.y&&(e.min.y=i.y)}r&&(r.x>0?e.max.x+=r.x:e.min.x+=r.x,r.y>0?e.max.y+=r.y:e.min.y+=r.y)},n.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},n.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},n.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},n.shift=function(e,t){var r=e.max.x-e.min.x,n=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+r,e.min.y=t.y,e.max.y=t.y+n}},{}],27:[function(e,t,r){var n={};t.exports=n;var i=(e("../geometry/Bounds"),e("../core/Common"));n.pathToVertices=function(e,t){"undefined"==typeof window||"SVGPathSeg"in window||i.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var r,o,s,a,c,u,h,l,d,p,f,m=[],v=0,g=0,y=0;t=t||15;var _=function(e,t,r){var n=r%2==1&&r>1;if(!d||e!=d.x||t!=d.y){d&&n?(p=d.x,f=d.y):(p=0,f=0);var i={x:p+e,y:f+t};!n&&d||(d=i),m.push(i),g=p+e,y=f+t}},b=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":g=e.x,y=e.y;break;case"H":g=e.x;break;case"V":y=e.y}_(g,y,e.pathSegType)}};for(n._svgPathToAbsolute(e),s=e.getTotalLength(),u=[],r=0;r<e.pathSegList.numberOfItems;r+=1)u.push(e.pathSegList.getItem(r));for(h=u.concat();v<s;){if((c=u[e.getPathSegAtLength(v)])!=l){for(;h.length&&h[0]!=c;)b(h.shift());l=c}switch(c.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=e.getPointAtLength(v),_(a.x,a.y,0)}v+=t}for(r=0,o=h.length;r<o;++r)b(h[r]);return m},n._svgPathToAbsolute=function(e){for(var t,r,n,i,o,s,a=e.pathSegList,c=0,u=0,h=a.numberOfItems,l=0;l<h;++l){var d=a.getItem(l),p=d.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(p))"x"in d&&(c=d.x),"y"in d&&(u=d.y);else switch("x1"in d&&(n=c+d.x1),"x2"in d&&(o=c+d.x2),"y1"in d&&(i=u+d.y1),"y2"in d&&(s=u+d.y2),"x"in d&&(c+=d.x),"y"in d&&(u+=d.y),p){case"m":a.replaceItem(e.createSVGPathSegMovetoAbs(c,u),l);break;case"l":a.replaceItem(e.createSVGPathSegLinetoAbs(c,u),l);break;case"h":a.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(c),l);break;case"v":a.replaceItem(e.createSVGPathSegLinetoVerticalAbs(u),l);break;case"c":a.replaceItem(e.createSVGPathSegCurvetoCubicAbs(c,u,n,i,o,s),l);break;case"s":a.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(c,u,o,s),l);break;case"q":a.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(c,u,n,i),l);break;case"t":a.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(c,u),l);break;case"a":a.replaceItem(e.createSVGPathSegArcAbs(c,u,d.r1,d.r2,d.angle,d.largeArcFlag,d.sweepFlag),l);break;case"z":case"Z":c=t,u=r}"M"!=p&&"m"!=p||(t=c,r=u)}}},{"../core/Common":14,"../geometry/Bounds":26}],28:[function(e,t,r){var n={};t.exports=n,n.create=function(e,t){return{x:e||0,y:t||0}},n.clone=function(e){return{x:e.x,y:e.y}},n.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},n.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},n.rotate=function(e,t,r){var n=Math.cos(t),i=Math.sin(t);r||(r={});var o=e.x*n-e.y*i;return r.y=e.x*i+e.y*n,r.x=o,r},n.rotateAbout=function(e,t,r,n){var i=Math.cos(t),o=Math.sin(t);n||(n={});var s=r.x+((e.x-r.x)*i-(e.y-r.y)*o);return n.y=r.y+((e.x-r.x)*o+(e.y-r.y)*i),n.x=s,n},n.normalise=function(e){var t=n.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},n.dot=function(e,t){return e.x*t.x+e.y*t.y},n.cross=function(e,t){return e.x*t.y-e.y*t.x},n.cross3=function(e,t,r){return(t.x-e.x)*(r.y-e.y)-(t.y-e.y)*(r.x-e.x)},n.add=function(e,t,r){return r||(r={}),r.x=e.x+t.x,r.y=e.y+t.y,r},n.sub=function(e,t,r){return r||(r={}),r.x=e.x-t.x,r.y=e.y-t.y,r},n.mult=function(e,t){return{x:e.x*t,y:e.y*t}},n.div=function(e,t){return{x:e.x/t,y:e.y/t}},n.perp=function(e,t){return{x:(t=!0===t?-1:1)*-e.y,y:t*e.x}},n.neg=function(e){return{x:-e.x,y:-e.y}},n.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]},{}],29:[function(e,t,r){var n={};t.exports=n;var i=e("../geometry/Vector"),o=e("../core/Common");n.create=function(e,t){for(var r=[],n=0;n<e.length;n++){var i=e[n],o={x:i.x,y:i.y,index:n,body:t,isInternal:!1};r.push(o)}return r},n.fromPath=function(e,t){var r=[];return e.replace(/L?\s*([\-\d\.e]+)[\s,]*([\-\d\.e]+)*/gi,(function(e,t,n){r.push({x:parseFloat(t),y:parseFloat(n)})})),n.create(r,t)},n.centre=function(e){for(var t,r,o,s=n.area(e,!0),a={x:0,y:0},c=0;c<e.length;c++)o=(c+1)%e.length,t=i.cross(e[c],e[o]),r=i.mult(i.add(e[c],e[o]),t),a=i.add(a,r);return i.div(a,6*s)},n.mean=function(e){for(var t={x:0,y:0},r=0;r<e.length;r++)t.x+=e[r].x,t.y+=e[r].y;return i.div(t,e.length)},n.area=function(e,t){for(var r=0,n=e.length-1,i=0;i<e.length;i++)r+=(e[n].x-e[i].x)*(e[n].y+e[i].y),n=i;return t?r/2:Math.abs(r)/2},n.inertia=function(e,t){for(var r,n,o=0,s=0,a=e,c=0;c<a.length;c++)n=(c+1)%a.length,o+=(r=Math.abs(i.cross(a[n],a[c])))*(i.dot(a[n],a[n])+i.dot(a[n],a[c])+i.dot(a[c],a[c])),s+=r;return t/6*(o/s)},n.translate=function(e,t,r){var n;if(r)for(n=0;n<e.length;n++)e[n].x+=t.x*r,e[n].y+=t.y*r;else for(n=0;n<e.length;n++)e[n].x+=t.x,e[n].y+=t.y;return e},n.rotate=function(e,t,r){if(0!==t){for(var n=Math.cos(t),i=Math.sin(t),o=0;o<e.length;o++){var s=e[o],a=s.x-r.x,c=s.y-r.y;s.x=r.x+(a*n-c*i),s.y=r.y+(a*i+c*n)}return e}},n.contains=function(e,t){for(var r=0;r<e.length;r++){var n=e[r],i=e[(r+1)%e.length];if((t.x-n.x)*(i.y-n.y)+(t.y-n.y)*(n.x-i.x)>0)return!1}return!0},n.scale=function(e,t,r,o){if(1===t&&1===r)return e;o=o||n.centre(e);for(var s,a,c=0;c<e.length;c++)s=e[c],a=i.sub(s,o),e[c].x=o.x+a.x*t,e[c].y=o.y+a.y*r;return e},n.chamfer=function(e,t,r,n,s){t="number"==typeof t?[t]:t||[8],r=void 0!==r?r:-1,n=n||2,s=s||14;for(var a=[],c=0;c<e.length;c++){var u=e[c-1>=0?c-1:e.length-1],h=e[c],l=e[(c+1)%e.length],d=t[c<t.length?c:t.length-1];if(0!==d){var p=i.normalise({x:h.y-u.y,y:u.x-h.x}),f=i.normalise({x:l.y-h.y,y:h.x-l.x}),m=Math.sqrt(2*Math.pow(d,2)),v=i.mult(o.clone(p),d),g=i.normalise(i.mult(i.add(p,f),.5)),y=i.sub(h,i.mult(g,m)),_=r;-1===r&&(_=1.75*Math.pow(d,.32)),(_=o.clamp(_,n,s))%2==1&&(_+=1);for(var b=Math.acos(i.dot(p,f))/_,x=0;x<_;x++)a.push(i.add(i.rotate(v,b*x),y))}else a.push(h)}return a},n.clockwiseSort=function(e){var t=n.mean(e);return e.sort((function(e,r){return i.angle(t,e)-i.angle(t,r)})),e},n.isConvex=function(e){var t,r,n,i,o=0,s=e.length;if(s<3)return null;for(t=0;t<s;t++)if(n=(t+2)%s,i=(e[r=(t+1)%s].x-e[t].x)*(e[n].y-e[r].y),(i-=(e[r].y-e[t].y)*(e[n].x-e[r].x))<0?o|=1:i>0&&(o|=2),3===o)return!1;return 0!==o||null},n.hull=function(e){var t,r,n=[],o=[];for((e=e.slice(0)).sort((function(e,t){var r=e.x-t.x;return 0!==r?r:e.y-t.y})),r=0;r<e.length;r+=1){for(t=e[r];o.length>=2&&i.cross3(o[o.length-2],o[o.length-1],t)<=0;)o.pop();o.push(t)}for(r=e.length-1;r>=0;r-=1){for(t=e[r];n.length>=2&&i.cross3(n[n.length-2],n[n.length-1],t)<=0;)n.pop();n.push(t)}return n.pop(),o.pop(),n.concat(o)}},{"../core/Common":14,"../geometry/Vector":28}],30:[function(e,t,r){var n=t.exports=e("../core/Matter");n.Body=e("../body/Body"),n.Composite=e("../body/Composite"),n.World=e("../body/World"),n.Contact=e("../collision/Contact"),n.Detector=e("../collision/Detector"),n.Grid=e("../collision/Grid"),n.Pairs=e("../collision/Pairs"),n.Pair=e("../collision/Pair"),n.Query=e("../collision/Query"),n.Resolver=e("../collision/Resolver"),n.SAT=e("../collision/SAT"),n.Constraint=e("../constraint/Constraint"),n.MouseConstraint=e("../constraint/MouseConstraint"),n.Common=e("../core/Common"),n.Engine=e("../core/Engine"),n.Events=e("../core/Events"),n.Mouse=e("../core/Mouse"),n.Runner=e("../core/Runner"),n.Sleeping=e("../core/Sleeping"),n.Plugin=e("../core/Plugin"),n.Bodies=e("../factory/Bodies"),n.Composites=e("../factory/Composites"),n.Axes=e("../geometry/Axes"),n.Bounds=e("../geometry/Bounds"),n.Svg=e("../geometry/Svg"),n.Vector=e("../geometry/Vector"),n.Vertices=e("../geometry/Vertices"),n.Render=e("../render/Render"),n.RenderPixi=e("../render/RenderPixi"),n.World.add=n.Composite.add,n.World.remove=n.Composite.remove,n.World.addComposite=n.Composite.addComposite,n.World.addBody=n.Composite.addBody,n.World.addConstraint=n.Composite.addConstraint,n.World.clear=n.Composite.clear,n.Engine.run=n.Runner.run},{"../body/Body":1,"../body/Composite":2,"../body/World":3,"../collision/Contact":4,"../collision/Detector":5,"../collision/Grid":6,"../collision/Pair":7,"../collision/Pairs":8,"../collision/Query":9,"../collision/Resolver":10,"../collision/SAT":11,"../constraint/Constraint":12,"../constraint/MouseConstraint":13,"../core/Common":14,"../core/Engine":15,"../core/Events":16,"../core/Matter":17,"../core/Metrics":18,"../core/Mouse":19,"../core/Plugin":20,"../core/Runner":21,"../core/Sleeping":22,"../factory/Bodies":23,"../factory/Composites":24,"../geometry/Axes":25,"../geometry/Bounds":26,"../geometry/Svg":27,"../geometry/Vector":28,"../geometry/Vertices":29,"../render/Render":31,"../render/RenderPixi":32}],31:[function(e,t,r){var n={};t.exports=n;var i=e("../core/Common"),o=e("../body/Composite"),s=e("../geometry/Bounds"),a=e("../core/Events"),c=e("../collision/Grid"),u=e("../geometry/Vector"),h=e("../core/Mouse");!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout((function(){e(i.now())}),1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),n.create=function(e){var t={controller:n,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,options:{width:800,height:600,pixelRatio:1,background:"#18181d",wireframeBackground:"#0f0f13",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},o=i.extend(t,e);return o.canvas&&(o.canvas.width=o.options.width||o.canvas.width,o.canvas.height=o.options.height||o.canvas.height),o.mouse=e.mouse,o.engine=e.engine,o.canvas=o.canvas||r(o.options.width,o.options.height),o.context=o.canvas.getContext("2d"),o.textures={},o.bounds=o.bounds||{min:{x:0,y:0},max:{x:o.canvas.width,y:o.canvas.height}},1!==o.options.pixelRatio&&n.setPixelRatio(o,o.options.pixelRatio),i.isElement(o.element)?o.element.appendChild(o.canvas):o.canvas.parentNode||i.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),o},n.run=function(t){!function r(i){t.frameRequestId=e(r),n.world(t)}()},n.stop=function(e){t(e.frameRequestId)},n.setPixelRatio=function(e,t){var r=e.options,n=e.canvas;"auto"===t&&(t=l(n)),r.pixelRatio=t,n.setAttribute("data-pixel-ratio",t),n.width=r.width*t,n.height=r.height*t,n.style.width=r.width+"px",n.style.height=r.height+"px",e.context.scale(t,t)},n.lookAt=function(e,t,r,n){n=void 0===n||n,t=i.isArray(t)?t:[t],r=r||{x:0,y:0};for(var o={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},s=0;s<t.length;s+=1){var a=t[s],c=a.bounds?a.bounds.min:a.min||a.position||a,u=a.bounds?a.bounds.max:a.max||a.position||a;c&&u&&(c.x<o.min.x&&(o.min.x=c.x),u.x>o.max.x&&(o.max.x=u.x),c.y<o.min.y&&(o.min.y=c.y),u.y>o.max.y&&(o.max.y=u.y))}var l=o.max.x-o.min.x+2*r.x,d=o.max.y-o.min.y+2*r.y,p=e.canvas.height,f=e.canvas.width/p,m=l/d,v=1,g=1;m>f?g=m/f:v=f/m,e.options.hasBounds=!0,e.bounds.min.x=o.min.x,e.bounds.max.x=o.min.x+l*v,e.bounds.min.y=o.min.y,e.bounds.max.y=o.min.y+d*g,n&&(e.bounds.min.x+=.5*l-l*v*.5,e.bounds.max.x+=.5*l-l*v*.5,e.bounds.min.y+=.5*d-d*g*.5,e.bounds.max.y+=.5*d-d*g*.5),e.bounds.min.x-=r.x,e.bounds.max.x-=r.x,e.bounds.min.y-=r.y,e.bounds.max.y-=r.y,e.mouse&&(h.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),h.setOffset(e.mouse,e.bounds.min))},n.startViewTransform=function(e){var t=e.bounds.max.x-e.bounds.min.x,r=e.bounds.max.y-e.bounds.min.y,n=t/e.options.width,i=r/e.options.height;e.context.scale(1/n,1/i),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)},n.endViewTransform=function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)},n.world=function(e){var t,r=e.engine,i=r.world,l=e.canvas,d=e.context,f=e.options,m=o.allBodies(i),v=o.allConstraints(i),g=f.wireframes?f.wireframeBackground:f.background,y=[],_=[],b={timestamp:r.timing.timestamp};if(a.trigger(e,"beforeRender",b),e.currentBackground!==g&&p(e,g),d.globalCompositeOperation="source-in",d.fillStyle="transparent",d.fillRect(0,0,l.width,l.height),d.globalCompositeOperation="source-over",f.hasBounds){for(t=0;t<m.length;t++){var x=m[t];s.overlaps(x.bounds,e.bounds)&&y.push(x)}for(t=0;t<v.length;t++){var w=v[t],T=w.bodyA,S=w.bodyB,C=w.pointA,P=w.pointB;T&&(C=u.add(T.position,w.pointA)),S&&(P=u.add(S.position,w.pointB)),C&&P&&(s.contains(e.bounds,C)||s.contains(e.bounds,P))&&_.push(w)}n.startViewTransform(e),e.mouse&&(h.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),h.setOffset(e.mouse,e.bounds.min))}else _=v,y=m;!f.wireframes||r.enableSleeping&&f.showSleeping?n.bodies(e,y,d):(f.showConvexHulls&&n.bodyConvexHulls(e,y,d),n.bodyWireframes(e,y,d)),f.showBounds&&n.bodyBounds(e,y,d),(f.showAxes||f.showAngleIndicator)&&n.bodyAxes(e,y,d),f.showPositions&&n.bodyPositions(e,y,d),f.showVelocity&&n.bodyVelocity(e,y,d),f.showIds&&n.bodyIds(e,y,d),f.showSeparations&&n.separations(e,r.pairs.list,d),f.showCollisions&&n.collisions(e,r.pairs.list,d),f.showVertexNumbers&&n.vertexNumbers(e,y,d),f.showMousePosition&&n.mousePosition(e,e.mouse,d),n.constraints(_,d),f.showBroadphase&&r.broadphase.controller===c&&n.grid(e,r.broadphase,d),f.showDebug&&n.debug(e,d),f.hasBounds&&n.endViewTransform(e),a.trigger(e,"afterRender",b)},n.debug=function(e,t){var r=t,n=e.engine,i=n.world,s=n.metrics,a=e.options;if(o.allBodies(i),n.timing.timestamp-(e.debugTimestamp||0)>=500){var c="";s.timing&&(c+="fps: "+Math.round(s.timing.fps)+"    "),e.debugString=c,e.debugTimestamp=n.timing.timestamp}if(e.debugString){r.font="12px Arial",a.wireframes?r.fillStyle="rgba(255,255,255,0.5)":r.fillStyle="rgba(0,0,0,0.5)";for(var u=e.debugString.split("\n"),h=0;h<u.length;h++)r.fillText(u[h],50,50+18*h)}},n.constraints=function(e,t){for(var r=t,n=0;n<e.length;n++){var o=e[n];if(o.render.visible&&o.pointA&&o.pointB){var s,a,c=o.bodyA,h=o.bodyB;if(s=c?u.add(c.position,o.pointA):o.pointA,"pin"===o.render.type)r.beginPath(),r.arc(s.x,s.y,3,0,2*Math.PI),r.closePath();else{if(a=h?u.add(h.position,o.pointB):o.pointB,r.beginPath(),r.moveTo(s.x,s.y),"spring"===o.render.type)for(var l,d=u.sub(a,s),p=u.perp(u.normalise(d)),f=Math.ceil(i.clamp(o.length/5,12,20)),m=1;m<f;m+=1)l=m%2==0?1:-1,r.lineTo(s.x+d.x*(m/f)+p.x*l*4,s.y+d.y*(m/f)+p.y*l*4);r.lineTo(a.x,a.y)}o.render.lineWidth&&(r.lineWidth=o.render.lineWidth,r.strokeStyle=o.render.strokeStyle,r.stroke()),o.render.anchors&&(r.fillStyle=o.render.strokeStyle,r.beginPath(),r.arc(s.x,s.y,3,0,2*Math.PI),r.arc(a.x,a.y,3,0,2*Math.PI),r.closePath(),r.fill())}}},n.bodyShadows=function(e,t,r){for(var n=r,i=(e.engine,0);i<t.length;i++){var o=t[i];if(o.render.visible){if(o.circleRadius)n.beginPath(),n.arc(o.position.x,o.position.y,o.circleRadius,0,2*Math.PI),n.closePath();else{n.beginPath(),n.moveTo(o.vertices[0].x,o.vertices[0].y);for(var s=1;s<o.vertices.length;s++)n.lineTo(o.vertices[s].x,o.vertices[s].y);n.closePath()}var a=o.position.x-.5*e.options.width,c=o.position.y-.2*e.options.height,u=Math.abs(a)+Math.abs(c);n.shadowColor="rgba(0,0,0,0.15)",n.shadowOffsetX=.05*a,n.shadowOffsetY=.05*c,n.shadowBlur=1+12*Math.min(1,u/1e3),n.fill(),n.shadowColor=null,n.shadowOffsetX=null,n.shadowOffsetY=null,n.shadowBlur=null}}},n.bodies=function(e,t,r){var n,i,o,s,a=r,c=(e.engine,e.options),u=c.showInternalEdges||!c.wireframes;for(o=0;o<t.length;o++)if((n=t[o]).render.visible)for(s=n.parts.length>1?1:0;s<n.parts.length;s++)if((i=n.parts[s]).render.visible){if(c.showSleeping&&n.isSleeping?a.globalAlpha=.5*i.render.opacity:1!==i.render.opacity&&(a.globalAlpha=i.render.opacity),i.render.sprite&&i.render.sprite.texture&&!c.wireframes){var h=i.render.sprite,l=d(e,h.texture);a.translate(i.position.x,i.position.y),a.rotate(i.angle),a.drawImage(l,l.width*-h.xOffset*h.xScale,l.height*-h.yOffset*h.yScale,l.width*h.xScale,l.height*h.yScale),a.rotate(-i.angle),a.translate(-i.position.x,-i.position.y)}else{if(i.circleRadius)a.beginPath(),a.arc(i.position.x,i.position.y,i.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(i.vertices[0].x,i.vertices[0].y);for(var p=1;p<i.vertices.length;p++)!i.vertices[p-1].isInternal||u?a.lineTo(i.vertices[p].x,i.vertices[p].y):a.moveTo(i.vertices[p].x,i.vertices[p].y),i.vertices[p].isInternal&&!u&&a.moveTo(i.vertices[(p+1)%i.vertices.length].x,i.vertices[(p+1)%i.vertices.length].y);a.lineTo(i.vertices[0].x,i.vertices[0].y),a.closePath()}c.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",a.stroke()):(a.fillStyle=i.render.fillStyle,i.render.lineWidth&&(a.lineWidth=i.render.lineWidth,a.strokeStyle=i.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},n.bodyWireframes=function(e,t,r){var n,i,o,s,a,c=r,u=e.options.showInternalEdges;for(c.beginPath(),o=0;o<t.length;o++)if((n=t[o]).render.visible)for(a=n.parts.length>1?1:0;a<n.parts.length;a++){for(i=n.parts[a],c.moveTo(i.vertices[0].x,i.vertices[0].y),s=1;s<i.vertices.length;s++)!i.vertices[s-1].isInternal||u?c.lineTo(i.vertices[s].x,i.vertices[s].y):c.moveTo(i.vertices[s].x,i.vertices[s].y),i.vertices[s].isInternal&&!u&&c.moveTo(i.vertices[(s+1)%i.vertices.length].x,i.vertices[(s+1)%i.vertices.length].y);c.lineTo(i.vertices[0].x,i.vertices[0].y)}c.lineWidth=1,c.strokeStyle="#bbb",c.stroke()},n.bodyConvexHulls=function(e,t,r){var n,i,o,s=r;for(s.beginPath(),i=0;i<t.length;i++)if((n=t[i]).render.visible&&1!==n.parts.length){for(s.moveTo(n.vertices[0].x,n.vertices[0].y),o=1;o<n.vertices.length;o++)s.lineTo(n.vertices[o].x,n.vertices[o].y);s.lineTo(n.vertices[0].x,n.vertices[0].y)}s.lineWidth=1,s.strokeStyle="rgba(255,255,255,0.2)",s.stroke()},n.vertexNumbers=function(e,t,r){var n,i,o,s=r;for(n=0;n<t.length;n++){var a=t[n].parts;for(o=a.length>1?1:0;o<a.length;o++){var c=a[o];for(i=0;i<c.vertices.length;i++)s.fillStyle="rgba(255,255,255,0.2)",s.fillText(n+"_"+i,c.position.x+.8*(c.vertices[i].x-c.position.x),c.position.y+.8*(c.vertices[i].y-c.position.y))}}},n.mousePosition=function(e,t,r){var n=r;n.fillStyle="rgba(255,255,255,0.8)",n.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},n.bodyBounds=function(e,t,r){var n=r,i=(e.engine,e.options);n.beginPath();for(var o=0;o<t.length;o++)if(t[o].render.visible)for(var s=t[o].parts,a=s.length>1?1:0;a<s.length;a++){var c=s[a];n.rect(c.bounds.min.x,c.bounds.min.y,c.bounds.max.x-c.bounds.min.x,c.bounds.max.y-c.bounds.min.y)}i.wireframes?n.strokeStyle="rgba(255,255,255,0.08)":n.strokeStyle="rgba(0,0,0,0.1)",n.lineWidth=1,n.stroke()},n.bodyAxes=function(e,t,r){var n,i,o,s,a=r,c=(e.engine,e.options);for(a.beginPath(),i=0;i<t.length;i++){var u=t[i],h=u.parts;if(u.render.visible)if(c.showAxes)for(o=h.length>1?1:0;o<h.length;o++)for(n=h[o],s=0;s<n.axes.length;s++){var l=n.axes[s];a.moveTo(n.position.x,n.position.y),a.lineTo(n.position.x+20*l.x,n.position.y+20*l.y)}else for(o=h.length>1?1:0;o<h.length;o++)for(n=h[o],s=0;s<n.axes.length;s++)a.moveTo(n.position.x,n.position.y),a.lineTo((n.vertices[0].x+n.vertices[n.vertices.length-1].x)/2,(n.vertices[0].y+n.vertices[n.vertices.length-1].y)/2)}c.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},n.bodyPositions=function(e,t,r){var n,i,o,s,a=r,c=(e.engine,e.options);for(a.beginPath(),o=0;o<t.length;o++)if((n=t[o]).render.visible)for(s=0;s<n.parts.length;s++)i=n.parts[s],a.arc(i.position.x,i.position.y,3,0,2*Math.PI,!1),a.closePath();for(c.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),o=0;o<t.length;o++)(n=t[o]).render.visible&&(a.arc(n.positionPrev.x,n.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},n.bodyVelocity=function(e,t,r){var n=r;n.beginPath();for(var i=0;i<t.length;i++){var o=t[i];o.render.visible&&(n.moveTo(o.position.x,o.position.y),n.lineTo(o.position.x+2*(o.position.x-o.positionPrev.x),o.position.y+2*(o.position.y-o.positionPrev.y)))}n.lineWidth=3,n.strokeStyle="cornflowerblue",n.stroke()},n.bodyIds=function(e,t,r){var n,i,o=r;for(n=0;n<t.length;n++)if(t[n].render.visible){var s=t[n].parts;for(i=s.length>1?1:0;i<s.length;i++){var a=s[i];o.font="12px Arial",o.fillStyle="rgba(255,255,255,0.5)",o.fillText(a.id,a.position.x+10,a.position.y-10)}}},n.collisions=function(e,t,r){var n,i,o,s,a=r,c=e.options;for(a.beginPath(),o=0;o<t.length;o++)if((n=t[o]).isActive)for(i=n.collision,s=0;s<n.activeContacts.length;s++){var u=n.activeContacts[s].vertex;a.rect(u.x-1.5,u.y-1.5,3.5,3.5)}for(c.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),o=0;o<t.length;o++)if((n=t[o]).isActive&&(i=n.collision,n.activeContacts.length>0)){var h=n.activeContacts[0].vertex.x,l=n.activeContacts[0].vertex.y;2===n.activeContacts.length&&(h=(n.activeContacts[0].vertex.x+n.activeContacts[1].vertex.x)/2,l=(n.activeContacts[0].vertex.y+n.activeContacts[1].vertex.y)/2),i.bodyB===i.supports[0].body||!0===i.bodyA.isStatic?a.moveTo(h-8*i.normal.x,l-8*i.normal.y):a.moveTo(h+8*i.normal.x,l+8*i.normal.y),a.lineTo(h,l)}c.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},n.separations=function(e,t,r){var n,i,o,s,a,c=r,u=e.options;for(c.beginPath(),a=0;a<t.length;a++)if((n=t[a]).isActive){o=(i=n.collision).bodyA;var h=1;(s=i.bodyB).isStatic||o.isStatic||(h=.5),s.isStatic&&(h=0),c.moveTo(s.position.x,s.position.y),c.lineTo(s.position.x-i.penetration.x*h,s.position.y-i.penetration.y*h),h=1,s.isStatic||o.isStatic||(h=.5),o.isStatic&&(h=0),c.moveTo(o.position.x,o.position.y),c.lineTo(o.position.x+i.penetration.x*h,o.position.y+i.penetration.y*h)}u.wireframes?c.strokeStyle="rgba(255,165,0,0.5)":c.strokeStyle="orange",c.stroke()},n.grid=function(e,t,r){var n=r;e.options.wireframes?n.strokeStyle="rgba(255,180,0,0.1)":n.strokeStyle="rgba(255,180,0,0.5)",n.beginPath();for(var o=i.keys(t.buckets),s=0;s<o.length;s++){var a=o[s];if(!(t.buckets[a].length<2)){var c=a.split(/C|R/);n.rect(.5+parseInt(c[1],10)*t.bucketWidth,.5+parseInt(c[2],10)*t.bucketHeight,t.bucketWidth,t.bucketHeight)}}n.lineWidth=1,n.stroke()},n.inspector=function(e,t){var r,n=(e.engine,e.selected),i=e.render,o=i.options;if(o.hasBounds){var s=i.bounds.max.x-i.bounds.min.x,a=i.bounds.max.y-i.bounds.min.y,c=s/i.options.width,u=a/i.options.height;t.scale(1/c,1/u),t.translate(-i.bounds.min.x,-i.bounds.min.y)}for(var h=0;h<n.length;h++){var l=n[h].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),l.type){case"body":r=l.bounds,t.beginPath(),t.rect(Math.floor(r.min.x-3),Math.floor(r.min.y-3),Math.floor(r.max.x-r.min.x+6),Math.floor(r.max.y-r.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var d=l.pointA;l.bodyA&&(d=l.pointB),t.beginPath(),t.arc(d.x,d.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",r=e.selectBounds,t.beginPath(),t.rect(Math.floor(r.min.x),Math.floor(r.min.y),Math.floor(r.max.x-r.min.x),Math.floor(r.max.y-r.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),o.hasBounds&&t.setTransform(1,0,0,1,0,0)};var r=function(e,t){var r=document.createElement("canvas");return r.width=e,r.height=t,r.oncontextmenu=function(){return!1},r.onselectstart=function(){return!1},r},l=function(e){var t=e.getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},d=function(e,t){var r=e.textures[t];return r||((r=e.textures[t]=new Image).src=t,r)},p=function(e,t){var r=t;/(jpg|gif|png)$/.test(t)&&(r="url("+t+")"),e.canvas.style.background=r,e.canvas.style.backgroundSize="contain",e.currentBackground=t}}()},{"../body/Composite":2,"../collision/Grid":6,"../core/Common":14,"../core/Events":16,"../core/Mouse":19,"../geometry/Bounds":26,"../geometry/Vector":28}],32:[function(e,t,r){var i={};t.exports=i;var o=e("../geometry/Bounds"),s=e("../body/Composite"),a=e("../core/Common"),c=e("../core/Events"),u=e("../geometry/Vector");!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout((function(){e(a.now())}),1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),i.create=function(e){a.warn("RenderPixi.create: Matter.RenderPixi is deprecated (see docs)");var t={controller:i,engine:null,element:null,frameRequestId:null,canvas:null,renderer:null,container:null,spriteContainer:null,pixiOptions:null,options:{width:800,height:600,background:"#fafafa",wireframeBackground:"#222",hasBounds:!1,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showBroadphase:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showShadows:!1}},r=a.extend(t,e),o=!r.options.wireframes&&"transparent"===r.options.background;return r.pixiOptions=r.pixiOptions||{view:r.canvas,transparent:o,antialias:!0,backgroundColor:e.background},r.mouse=e.mouse,r.engine=e.engine,r.renderer=r.renderer||new n.WebGLRenderer(r.options.width,r.options.height,r.pixiOptions),r.container=r.container||new n.Container,r.spriteContainer=r.spriteContainer||new n.Container,r.canvas=r.canvas||r.renderer.view,r.bounds=r.bounds||{min:{x:0,y:0},max:{x:r.options.width,y:r.options.height}},c.on(r.engine,"beforeUpdate",(function(){i.clear(r)})),r.textures={},r.sprites={},r.primitives={},r.container.addChild(r.spriteContainer),a.isElement(r.element)?r.element.appendChild(r.canvas):a.warn('No "render.element" passed, "render.canvas" was not inserted into document.'),r.canvas.oncontextmenu=function(){return!1},r.canvas.onselectstart=function(){return!1},r},i.run=function(t){!function r(n){t.frameRequestId=e(r),i.world(t)}()},i.stop=function(e){t(e.frameRequestId)},i.clear=function(e){for(var t=e.container,r=e.spriteContainer;t.children[0];)t.removeChild(t.children[0]);for(;r.children[0];)r.removeChild(r.children[0]);var n=e.sprites["bg-0"];e.textures={},e.sprites={},e.primitives={},e.sprites["bg-0"]=n,n&&t.addChildAt(n,0),e.container.addChild(e.spriteContainer),e.currentBackground=null,t.scale.set(1,1),t.position.set(0,0)},i.setBackground=function(e,t){if(e.currentBackground!==t){var r=t.indexOf&&-1!==t.indexOf("#"),i=e.sprites["bg-0"];if(r){var o=a.colorToNumber(t);e.renderer.backgroundColor=o,i&&e.container.removeChild(i)}else if(!i){var s=l(e,t);(i=e.sprites["bg-0"]=new n.Sprite(s)).position.x=0,i.position.y=0,e.container.addChildAt(i,0)}e.currentBackground=t}},i.world=function(e){var t,r=e.engine.world,n=e.renderer,a=e.container,c=e.options,h=s.allBodies(r),l=s.allConstraints(r),d=[];c.wireframes?i.setBackground(e,c.wireframeBackground):i.setBackground(e,c.background);var p=e.bounds.max.x-e.bounds.min.x,f=e.bounds.max.y-e.bounds.min.y,m=p/e.options.width,v=f/e.options.height;if(c.hasBounds){for(t=0;t<h.length;t++){var g=h[t];g.render.sprite.visible=o.overlaps(g.bounds,e.bounds)}for(t=0;t<l.length;t++){var y=l[t],_=y.bodyA,b=y.bodyB,x=y.pointA,w=y.pointB;_&&(x=u.add(_.position,y.pointA)),b&&(w=u.add(b.position,y.pointB)),x&&w&&(o.contains(e.bounds,x)||o.contains(e.bounds,w))&&d.push(y)}a.scale.set(1/m,1/v),a.position.set(-e.bounds.min.x*(1/m),-e.bounds.min.y*(1/v))}else d=l;for(t=0;t<h.length;t++)i.body(e,h[t]);for(t=0;t<d.length;t++)i.constraint(e,d[t]);n.render(a)},i.constraint=function(e,t){var r=(e.engine,t.bodyA),i=t.bodyB,o=t.pointA,s=t.pointB,c=e.container,u=t.render,h="c-"+t.id,l=e.primitives[h];l||(l=e.primitives[h]=new n.Graphics),u.visible&&t.pointA&&t.pointB?(-1===a.indexOf(c.children,l)&&c.addChild(l),l.clear(),l.beginFill(0,0),l.lineStyle(u.lineWidth,a.colorToNumber(u.strokeStyle),1),r?l.moveTo(r.position.x+o.x,r.position.y+o.y):l.moveTo(o.x,o.y),i?l.lineTo(i.position.x+s.x,i.position.y+s.y):l.lineTo(s.x,s.y),l.endFill()):l.clear()},i.body=function(e,t){var n=(e.engine,t.render);if(n.visible)if(n.sprite&&n.sprite.texture){var i="b-"+t.id,o=e.sprites[i],s=e.spriteContainer;o||(o=e.sprites[i]=r(e,t)),-1===a.indexOf(s.children,o)&&s.addChild(o),o.position.x=t.position.x,o.position.y=t.position.y,o.rotation=t.angle,o.scale.x=n.sprite.xScale||1,o.scale.y=n.sprite.yScale||1}else{var c="b-"+t.id,u=e.primitives[c],l=e.container;u||((u=e.primitives[c]=h(e,t)).initialAngle=t.angle),-1===a.indexOf(l.children,u)&&l.addChild(u),u.position.x=t.position.x,u.position.y=t.position.y,u.rotation=t.angle-u.initialAngle}};var r=function(e,t){var r=t.render.sprite.texture,i=l(e,r),o=new n.Sprite(i);return o.anchor.x=t.render.sprite.xOffset,o.anchor.y=t.render.sprite.yOffset,o},h=function(e,t){var r,i=t.render,o=e.options,s=new n.Graphics,c=a.colorToNumber(i.fillStyle),u=a.colorToNumber(i.strokeStyle),h=a.colorToNumber(i.strokeStyle),l=a.colorToNumber("#bbb"),d=a.colorToNumber("#CD5C5C");s.clear();for(var p=t.parts.length>1?1:0;p<t.parts.length;p++){r=t.parts[p],o.wireframes?(s.beginFill(0,0),s.lineStyle(1,l,1)):(s.beginFill(c,1),s.lineStyle(i.lineWidth,u,1)),s.moveTo(r.vertices[0].x-t.position.x,r.vertices[0].y-t.position.y);for(var f=1;f<r.vertices.length;f++)s.lineTo(r.vertices[f].x-t.position.x,r.vertices[f].y-t.position.y);s.lineTo(r.vertices[0].x-t.position.x,r.vertices[0].y-t.position.y),s.endFill(),(o.showAngleIndicator||o.showAxes)&&(s.beginFill(0,0),o.wireframes?s.lineStyle(1,d,1):s.lineStyle(1,h),s.moveTo(r.position.x-t.position.x,r.position.y-t.position.y),s.lineTo((r.vertices[0].x+r.vertices[r.vertices.length-1].x)/2-t.position.x,(r.vertices[0].y+r.vertices[r.vertices.length-1].y)/2-t.position.y),s.endFill())}return s},l=function(e,t){var r=e.textures[t];return r||(r=e.textures[t]=n.Texture.fromImage(t)),r}}()},{"../body/Composite":2,"../core/Common":14,"../core/Events":16,"../geometry/Bounds":26,"../geometry/Vector":28}]},{},[30])(30)}));var n=function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e,t){return e(t={exports:{}},t.exports),t.exports}var n=r((function(e,r){!function(e){var t=e.Promise,n=t&&"resolve"in t&&"reject"in t&&"all"in t&&"race"in t&&function(){var e;return new t((function(t){e=t})),"function"==typeof e}();r?(r.Promise=n?t:T,r.Polyfill=T):n||(e.Promise=T);var i="pending",o="sealed",s="fulfilled",a="rejected",c=function(){};function u(e){return"[object Array]"===Object.prototype.toString.call(e)}var h,l="undefined"!=typeof setImmediate?setImmediate:setTimeout,d=[];function p(){for(var e=0;e<d.length;e++)d[e][0](d[e][1]);d=[],h=!1}function f(e,t){d.push([e,t]),h||(h=!0,l(p,0))}function m(e){var t=e.owner,r=t.state_,n=t.data_,i=e[r],o=e.then;if("function"==typeof i){r=s;try{n=i(n)}catch(e){_(o,e)}}v(o,n)||(r===s&&g(o,n),r===a&&_(o,n))}function v(e,t){var r;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"==typeof t)){var n=t.then;if("function"==typeof n)return n.call(t,(function(n){r||(r=!0,t!==n?g(e,n):y(e,n))}),(function(t){r||(r=!0,_(e,t))})),!0}}catch(t){return r||_(e,t),!0}return!1}function g(e,t){e!==t&&v(e,t)||y(e,t)}function y(e,t){e.state_===i&&(e.state_=o,e.data_=t,f(x,e))}function _(e,t){e.state_===i&&(e.state_=o,e.data_=t,f(w,e))}function b(e){var t=e.then_;e.then_=void 0;for(var r=0;r<t.length;r++)m(t[r])}function x(e){e.state_=s,b(e)}function w(e){e.state_=a,b(e)}function T(e){if("function"!=typeof e)throw new TypeError("Promise constructor takes a function argument");if(this instanceof T==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(e,t){function r(e){_(t,e)}try{e((function(e){g(t,e)}),r)}catch(e){r(e)}}(e,this)}T.prototype={constructor:T,state_:i,then_:null,data_:void 0,then:function(e,t){var r={owner:this,then:new this.constructor(c),fulfilled:e,rejected:t};return this.state_===s||this.state_===a?f(m,r):this.then_.push(r),r.then},catch:function(e){return this.then(null,e)}},T.all=function(e){if(!u(e))throw new TypeError("You must pass an array to Promise.all().");return new this((function(t,r){var n=[],i=0;function o(e){return i++,function(r){n[e]=r,--i||t(n)}}for(var s,a=0;a<e.length;a++)(s=e[a])&&"function"==typeof s.then?s.then(o(a),r):n[a]=s;i||t(n)}))},T.race=function(e){if(!u(e))throw new TypeError("You must pass an array to Promise.race().");return new this((function(t,r){for(var n,i=0;i<e.length;i++)(n=e[i])&&"function"==typeof n.then?n.then(t,r):t(n)}))},T.resolve=function(e){return e&&"object"==typeof e&&e.constructor===this?e:new this((function(t){t(e)}))},T.reject=function(e){return new this((function(t,r){r(e)}))}}("undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:t)})),i=(n.Promise,n.Polyfill),o=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,c=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},r=0;r<10;r++)t["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var r,n,i=arguments,c=function(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}(e),u=1;u<arguments.length;u++){for(var h in r=Object(i[u]))s.call(r,h)&&(c[h]=r[h]);if(o){n=o(r);for(var l=0;l<n.length;l++)a.call(r,n[l])&&(c[n[l]]=r[n[l]])}}return c};window.Promise||(window.Promise=i),Object.assign||(Object.assign=c);var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!u.performance||!u.performance.now){var h=Date.now();u.performance||(u.performance={}),u.performance.now=function(){return Date.now()-h}}for(var l=Date.now(),d=["ms","moz","webkit","o"],p=0;p<d.length&&!u.requestAnimationFrame;++p){var f=d[p];u.requestAnimationFrame=u[f+"RequestAnimationFrame"],u.cancelAnimationFrame=u[f+"CancelAnimationFrame"]||u[f+"CancelRequestAnimationFrame"]}u.requestAnimationFrame||(u.requestAnimationFrame=function(e){if("function"!=typeof e)throw new TypeError(e+"is not a function");var t=Date.now(),r=16+l-t;return r<0&&(r=0),l=t,setTimeout((function(){l=Date.now(),e(performance.now())}),r)}),u.cancelAnimationFrame||(u.cancelAnimationFrame=function(e){return clearTimeout(e)}),Math.sign||(Math.sign=function(e){return 0===(e=Number(e))||isNaN(e)?e:e>0?1:-1}),Number.isInteger||(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),window.ArrayBuffer||(window.ArrayBuffer=Array),window.Float32Array||(window.Float32Array=Array),window.Uint32Array||(window.Uint32Array=Array),window.Uint16Array||(window.Uint16Array=Array),window.Uint8Array||(window.Uint8Array=Array),window.Int32Array||(window.Int32Array=Array);var m=r((function(e){!function(t){var r=/iPhone/i,n=/iPod/i,i=/iPad/i,o=/\bAndroid(?:.+)Mobile\b/i,s=/Android/i,a=/\bAndroid(?:.+)SD4930UR\b/i,c=/\bAndroid(?:.+)(?:KF[A-Z]{2,4})\b/i,u=/Windows Phone/i,h=/\bWindows(?:.+)ARM\b/i,l=/BlackBerry/i,d=/BB10/i,p=/Opera Mini/i,f=/\b(CriOS|Chrome)(?:.+)Mobile/i,m=/Mobile(?:.+)Firefox\b/i;function v(e,t){return e.test(t)}function g(e){var t=e||("undefined"!=typeof navigator?navigator.userAgent:""),g=t.split("[FBAN");void 0!==g[1]&&(t=g[0]),void 0!==(g=t.split("Twitter"))[1]&&(t=g[0]);var y={apple:{phone:v(r,t)&&!v(u,t),ipod:v(n,t),tablet:!v(r,t)&&v(i,t)&&!v(u,t),device:(v(r,t)||v(n,t)||v(i,t))&&!v(u,t)},amazon:{phone:v(a,t),tablet:!v(a,t)&&v(c,t),device:v(a,t)||v(c,t)},android:{phone:!v(u,t)&&v(a,t)||!v(u,t)&&v(o,t),tablet:!v(u,t)&&!v(a,t)&&!v(o,t)&&(v(c,t)||v(s,t)),device:!v(u,t)&&(v(a,t)||v(c,t)||v(o,t)||v(s,t))||v(/\bokhttp\b/i,t)},windows:{phone:v(u,t),tablet:v(h,t),device:v(u,t)||v(h,t)},other:{blackberry:v(l,t),blackberry10:v(d,t),opera:v(p,t),firefox:v(m,t),chrome:v(f,t),device:v(l,t)||v(d,t)||v(p,t)||v(m,t)||v(f,t)}};return y.any=y.apple.device||y.android.device||y.windows.device||y.other.device,y.phone=y.apple.phone||y.android.phone||y.windows.phone,y.tablet=y.apple.tablet||y.android.tablet||y.windows.tablet,y}e.exports&&"undefined"==typeof window?e.exports=g:e.exports&&"undefined"!=typeof window?(e.exports=g(),e.exports.isMobile=g):t.isMobile=g()}(t)}));m.isMobile;var v={MIPMAP_TEXTURES:1,ANISOTROPIC_LEVEL:0,RESOLUTION:1,FILTER_RESOLUTION:1,SPRITE_MAX_TEXTURES:function(e){var t=!0;if(m.tablet||m.phone){if(t=!1,m.apple.device){var r=navigator.userAgent.match(/OS (\d+)_(\d+)?/);r&&parseInt(r[1],10)>=11&&(t=!0)}if(m.android.device){var n=navigator.userAgent.match(/Android\s([0-9.]*)/);n&&parseInt(n[1],10)>=7&&(t=!0)}}return t?32:4}(),SPRITE_BATCH_SIZE:4096,RENDER_OPTIONS:{view:null,antialias:!1,forceFXAA:!1,autoDensity:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,width:800,height:600,legacy:!1},GC_MODE:0,GC_MAX_IDLE:3600,GC_MAX_CHECK_COUNT:600,WRAP_MODE:33071,SCALE_MODE:1,PRECISION_VERTEX:"highp",PRECISION_FRAGMENT:m.apple.device?"highp":"mediump",CAN_UPLOAD_SAME_BUFFER:!m.apple.device,CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1},g=r((function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,n,i,o){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new function(e,t,r){this.fn=e,this.context=t,this.once=r||!1}(n,i||e,o),a=r?r+t:t;return e._events[a]?e._events[a].fn?e._events[a]=[e._events[a],s]:e._events[a].push(s):(e._events[a]=s,e._eventsCount++),e}function o(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,s=new Array(o);i<o;i++)s[i]=n[i].fn;return s},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,s){var a=arguments,c=r?r+e:e;if(!this._events[c])return!1;var u,h,l=this._events[c],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,i),!0;case 5:return l.fn.call(l.context,t,n,i,o),!0;case 6:return l.fn.call(l.context,t,n,i,o,s),!0}for(h=1,u=new Array(d-1);h<d;h++)u[h-1]=a[h];l.fn.apply(l.context,u)}else{var p,f=l.length;for(h=0;h<f;h++)switch(l[h].once&&this.removeListener(e,l[h].fn,void 0,!0),d){case 1:l[h].fn.call(l[h].context);break;case 2:l[h].fn.call(l[h].context,t);break;case 3:l[h].fn.call(l[h].context,t,n);break;case 4:l[h].fn.call(l[h].context,t,n,i);break;default:if(!u)for(p=1,u=new Array(d-1);p<d;p++)u[p-1]=a[p];l[h].fn.apply(l[h].context,u)}}return!0},s.prototype.on=function(e,t,r){return i(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return i(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==t||i&&!a.once||n&&a.context!==n||o(this,s);else{for(var c=0,u=[],h=a.length;c<h;c++)(a[c].fn!==t||i&&!a[c].once||n&&a[c].context!==n)&&u.push(a[c]);u.length?this._events[s]=1===u.length?u[0]:u:o(this,s)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&o(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})),y=b,_=b;function b(e,t,r){r=r||2;var n,i,o,s,a,c,u,h=t&&t.length,l=h?t[0]*r:e.length,d=x(e,0,l,r,!0),p=[];if(!d||d.next===d.prev)return p;if(h&&(d=function(e,t,r,n){var i,o,s,a=[];for(i=0,o=t.length;i<o;i++)(s=x(e,t[i]*n,i<o-1?t[i+1]*n:e.length,n,!1))===s.next&&(s.steiner=!0),a.push(R(s));for(a.sort(I),i=0;i<a.length;i++)A(a[i],r),r=w(r,r.next);return r}(e,t,d,r)),e.length>80*r){n=o=e[0],i=s=e[1];for(var f=r;f<l;f+=r)(a=e[f])<n&&(n=a),(c=e[f+1])<i&&(i=c),a>o&&(o=a),c>s&&(s=c);u=0!==(u=Math.max(o-n,s-i))?1/u:0}return T(d,p,r,n,i,u),p}function x(e,t,r,n,i){var o,s;if(i===H(e,t,r,n)>0)for(o=t;o<r;o+=n)s=X(o,e[o],e[o+1],s);else for(o=r-n;o>=t;o-=n)s=X(o,e[o],e[o+1],s);return s&&B(s,s.next)&&(V(s),s=s.next),s}function w(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!B(n,n.next)&&0!==L(n.prev,n,n.next))n=n.next;else{if(V(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function T(e,t,r,n,i,o,s){if(e){!s&&o&&function(e,t,r,n){var i=e;do{null===i.z&&(i.z=O(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,o,s,a,c,u=1;do{for(r=e,e=null,o=null,s=0;r;){for(s++,n=r,a=0,t=0;t<u&&(a++,n=n.nextZ);t++);for(c=u;a>0||c>0&&n;)0!==a&&(0===c||!n||r.z<=n.z)?(i=r,r=r.nextZ,a--):(i=n,n=n.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;r=n}o.nextZ=null,u*=2}while(s>1)}(i)}(e,n,i,o);for(var a,c,u=e;e.prev!==e.next;)if(a=e.prev,c=e.next,o?C(e,n,i,o):S(e))t.push(a.i/r),t.push(e.i/r),t.push(c.i/r),V(e),e=c.next,u=c.next;else if((e=c)===u){s?1===s?T(e=P(w(e),t,r),t,r,n,i,o,2):2===s&&E(e,t,r,n,i,o):T(w(e),t,r,n,i,o,1);break}}}function S(e){var t=e.prev,r=e,n=e.next;if(L(t,r,n)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(D(t.x,t.y,r.x,r.y,n.x,n.y,i.x,i.y)&&L(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function C(e,t,r,n){var i=e.prev,o=e,s=e.next;if(L(i,o,s)>=0)return!1;for(var a=i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,c=i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,u=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,h=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,l=O(a,c,t,r,n),d=O(u,h,t,r,n),p=e.prevZ,f=e.nextZ;p&&p.z>=l&&f&&f.z<=d;){if(p!==e.prev&&p!==e.next&&D(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&L(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&D(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&L(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=l;){if(p!==e.prev&&p!==e.next&&D(i.x,i.y,o.x,o.y,s.x,s.y,p.x,p.y)&&L(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=d;){if(f!==e.prev&&f!==e.next&&D(i.x,i.y,o.x,o.y,s.x,s.y,f.x,f.y)&&L(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function P(e,t,r){var n=e;do{var i=n.prev,o=n.next.next;!B(i,o)&&F(i,n,n.next,o)&&U(i,o)&&U(o,i)&&(t.push(i.i/r),t.push(n.i/r),t.push(o.i/r),V(n),V(n.next),n=e=o),n=n.next}while(n!==e);return w(n)}function E(e,t,r,n,i,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&k(s,a)){var c=G(s,a);return s=w(s,s.next),c=w(c,c.next),T(s,t,r,n,i,o),void T(c,t,r,n,i,o)}a=a.next}s=s.next}while(s!==e)}function I(e,t){return e.x-t.x}function A(e,t){if(t=function(e,t){var r,n=t,i=e.x,o=e.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=i&&a>s){if(s=a,a===i){if(o===n.y)return n;if(o===n.next.y)return n.next}r=n.x<n.next.x?n:n.next}}n=n.next}while(n!==t);if(!r)return null;if(i===s)return r;var c,u=r,h=r.x,l=r.y,d=1/0;n=r;do{i>=n.x&&n.x>=h&&i!==n.x&&D(o<l?i:s,o,h,l,o<l?s:i,o,n.x,n.y)&&(c=Math.abs(o-n.y)/(i-n.x),U(n,e)&&(c<d||c===d&&(n.x>r.x||n.x===r.x&&M(r,n)))&&(r=n,d=c)),n=n.next}while(n!==u);return r}(e,t)){var r=G(t,e);w(r,r.next)}}function M(e,t){return L(e.prev,e,t.prev)<0&&L(t.next,e,e.next)<0}function O(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function R(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function D(e,t,r,n,i,o,s,a){return(i-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(n-a)-(r-s)*(t-a)>=0&&(r-s)*(o-a)-(i-s)*(n-a)>=0}function k(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&F(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(U(e,t)&&U(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(L(e.prev,e,t.prev)||L(e,t.prev,t))||B(e,t)&&L(e.prev,e,e.next)>0&&L(t.prev,t,t.next)>0)}function L(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function B(e,t){return e.x===t.x&&e.y===t.y}function F(e,t,r,n){var i=j(L(e,t,r)),o=j(L(e,t,n)),s=j(L(r,n,e)),a=j(L(r,n,t));return i!==o&&s!==a||!(0!==i||!N(e,r,t))||!(0!==o||!N(e,n,t))||!(0!==s||!N(r,e,n))||!(0!==a||!N(r,t,n))}function N(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function j(e){return e>0?1:e<0?-1:0}function U(e,t){return L(e.prev,e,e.next)<0?L(e,t,e.next)>=0&&L(e,e.prev,t)>=0:L(e,t,e.prev)<0||L(e,e.next,t)<0}function G(e,t){var r=new z(e.i,e.x,e.y),n=new z(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function X(e,t,r,n){var i=new z(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function V(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function z(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function H(e,t,r,n){for(var i=0,o=t,s=r-n;o<r;o+=n)i+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return i}b.deviation=function(e,t,r,n){var i=t&&t.length,o=i?t[0]*r:e.length,s=Math.abs(H(e,0,o,r));if(i)for(var a=0,c=t.length;a<c;a++){var u=t[a]*r,h=a<c-1?t[a+1]*r:e.length;s-=Math.abs(H(e,u,h,r))}var l=0;for(a=0;a<n.length;a+=3){var d=n[a]*r,p=n[a+1]*r,f=n[a+2]*r;l+=Math.abs((e[d]-e[f])*(e[p+1]-e[d+1])-(e[d]-e[p])*(e[f+1]-e[d+1]))}return 0===s&&0===l?0:Math.abs((l-s)/s)},b.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var s=0;s<t;s++)r.vertices.push(e[i][o][s]);i>0&&(n+=e[i-1].length,r.holes.push(n))}return r},y.default=_;var W=r((function(e,r){!function(n){var i=r&&!r.nodeType&&r,o=e&&!e.nodeType&&e,s="object"==typeof t&&t;s.global!==s&&s.window!==s&&s.self!==s||(n=s);var a,c,u=2147483647,h=36,l=/^xn--/,d=/[^\x20-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,f={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,v=String.fromCharCode;function g(e){throw RangeError(f[e])}function y(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}function _(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+y((e=e.replace(p,".")).split("."),t).join(".")}function b(e){for(var t,r,n=[],i=0,o=e.length;i<o;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<o?56320==(64512&(r=e.charCodeAt(i++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),i--):n.push(t);return n}function x(e){return y(e,(function(e){var t="";return e>65535&&(t+=v((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+v(e)})).join("")}function w(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function T(e,t,r){var n=0;for(e=r?m(e/700):e>>1,e+=m(e/t);e>455;n+=h)e=m(e/35);return m(n+36*e/(e+38))}function S(e){var t,r,n,i,o,s,a,c,l,d,p,f=[],v=e.length,y=0,_=128,b=72;for((r=e.lastIndexOf("-"))<0&&(r=0),n=0;n<r;++n)e.charCodeAt(n)>=128&&g("not-basic"),f.push(e.charCodeAt(n));for(i=r>0?r+1:0;i<v;){for(o=y,s=1,a=h;i>=v&&g("invalid-input"),((c=(p=e.charCodeAt(i++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:h)>=h||c>m((u-y)/s))&&g("overflow"),y+=c*s,!(c<(l=a<=b?1:a>=b+26?26:a-b));a+=h)s>m(u/(d=h-l))&&g("overflow"),s*=d;b=T(y-o,t=f.length+1,0==o),m(y/t)>u-_&&g("overflow"),_+=m(y/t),y%=t,f.splice(y++,0,_)}return x(f)}function C(e){var t,r,n,i,o,s,a,c,l,d,p,f,y,_,x,S=[];for(f=(e=b(e)).length,t=128,r=0,o=72,s=0;s<f;++s)(p=e[s])<128&&S.push(v(p));for(n=i=S.length,i&&S.push("-");n<f;){for(a=u,s=0;s<f;++s)(p=e[s])>=t&&p<a&&(a=p);for(a-t>m((u-r)/(y=n+1))&&g("overflow"),r+=(a-t)*y,t=a,s=0;s<f;++s)if((p=e[s])<t&&++r>u&&g("overflow"),p==t){for(c=r,l=h;!(c<(d=l<=o?1:l>=o+26?26:l-o));l+=h)x=c-d,_=h-d,S.push(v(w(d+x%_,0))),c=m(x/_);S.push(v(w(c,0))),o=T(r,y,n==i),r=0,++n}++r,++t}return S.join("")}if(a={version:"1.3.2",ucs2:{decode:b,encode:x},decode:S,encode:C,toASCII:function(e){return _(e,(function(e){return d.test(e)?"xn--"+C(e):e}))},toUnicode:function(e){return _(e,(function(e){return l.test(e)?S(e.slice(4).toLowerCase()):e}))}},i&&o)if(e.exports==i)o.exports=a;else for(c in a)a.hasOwnProperty(c)&&(i[c]=a[c]);else n.punycode=a}(t)})),Y=function(e){return"string"==typeof e},q=function(e){return"object"==typeof e&&null!==e},J=function(e){return null===e},K=function(e){return null==e};function Z(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Q=function(e,t,r,n){t=t||"&",r=r||"=";var i={};if("string"!=typeof e||0===e.length)return i;var o=/\+/g;e=e.split(t);var s=1e3;n&&"number"==typeof n.maxKeys&&(s=n.maxKeys);var a=e.length;s>0&&a>s&&(a=s);for(var c=0;c<a;++c){var u,h,l,d,p=e[c].replace(o,"%20"),f=p.indexOf(r);f>=0?(u=p.substr(0,f),h=p.substr(f+1)):(u=p,h=""),l=decodeURIComponent(u),d=decodeURIComponent(h),Z(i,l)?Array.isArray(i[l])?i[l].push(d):i[l]=[i[l],d]:i[l]=d}return i},$=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}},ee=function(e,t,r,n){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(n){var i=encodeURIComponent($(n))+r;return Array.isArray(e[n])?e[n].map((function(e){return i+encodeURIComponent($(e))})).join(t):i+encodeURIComponent($(e[n]))})).join(t):n?encodeURIComponent($(n))+r+encodeURIComponent($(e)):""},te=r((function(e,t){t.decode=t.parse=Q,t.encode=t.stringify=ee})),re=(te.decode,te.parse,te.encode,te.stringify,ge),ne=ie;function ie(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var oe=/^([a-z0-9.+-]+:)/i,se=/:[0-9]*$/,ae=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,ce=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),ue=["'"].concat(ce),he=["%","/","?",";","#"].concat(ue),le=["/","?","#"],de=/^[+a-z0-9A-Z_-]{0,63}$/,pe=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,fe={javascript:!0,"javascript:":!0},me={javascript:!0,"javascript:":!0},ve={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function ge(e,t,r){if(e&&q(e)&&e instanceof ie)return e;var n=new ie;return n.parse(e,t,r),n}ie.prototype.parse=function(e,t,r){if(!Y(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var n=e.indexOf("?"),i=-1!==n&&n<e.indexOf("#")?"?":"#",o=e.split(i);o[0]=o[0].replace(/\\/g,"/");var s=e=o.join(i);if(s=s.trim(),!r&&1===e.split("#").length){var a=ae.exec(s);if(a)return this.path=s,this.href=s,this.pathname=a[1],a[2]?(this.search=a[2],this.query=t?te.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var c=oe.exec(s);if(c){var u=(c=c[0]).toLowerCase();this.protocol=u,s=s.substr(c.length)}if(r||c||s.match(/^\/\/[^@\/]+@[^@\/]+/)){var h="//"===s.substr(0,2);!h||c&&me[c]||(s=s.substr(2),this.slashes=!0)}if(!me[c]&&(h||c&&!ve[c])){for(var l,d,p=-1,f=0;f<le.length;f++)-1!==(m=s.indexOf(le[f]))&&(-1===p||m<p)&&(p=m);for(-1!==(d=-1===p?s.lastIndexOf("@"):s.lastIndexOf("@",p))&&(l=s.slice(0,d),s=s.slice(d+1),this.auth=decodeURIComponent(l)),p=-1,f=0;f<he.length;f++){var m;-1!==(m=s.indexOf(he[f]))&&(-1===p||m<p)&&(p=m)}-1===p&&(p=s.length),this.host=s.slice(0,p),s=s.slice(p),this.parseHost(),this.hostname=this.hostname||"";var v="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!v)for(var g=this.hostname.split(/\./),y=(f=0,g.length);f<y;f++){var _=g[f];if(_&&!_.match(de)){for(var b="",x=0,w=_.length;x<w;x++)_.charCodeAt(x)>127?b+="x":b+=_[x];if(!b.match(de)){var T=g.slice(0,f),S=g.slice(f+1),C=_.match(pe);C&&(T.push(C[1]),S.unshift(C[2])),S.length&&(s="/"+S.join(".")+s),this.hostname=T.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),v||(this.hostname=W.toASCII(this.hostname));var P=this.port?":"+this.port:"",E=this.hostname||"";this.host=E+P,this.href+=this.host,v&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==s[0]&&(s="/"+s))}if(!fe[u])for(f=0,y=ue.length;f<y;f++){var I=ue[f];if(-1!==s.indexOf(I)){var A=encodeURIComponent(I);A===I&&(A=escape(I)),s=s.split(I).join(A)}}var M=s.indexOf("#");-1!==M&&(this.hash=s.substr(M),s=s.slice(0,M));var O=s.indexOf("?");if(-1!==O?(this.search=s.substr(O),this.query=s.substr(O+1),t&&(this.query=te.parse(this.query)),s=s.slice(0,O)):t&&(this.search="",this.query={}),s&&(this.pathname=s),ve[u]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){P=this.pathname||"";var R=this.search||"";this.path=P+R}return this.href=this.format(),this},ie.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",r=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&q(this.query)&&Object.keys(this.query).length&&(o=te.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||ve[t])&&!1!==i?(i="//"+(i||""),r&&"/"!==r.charAt(0)&&(r="/"+r)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),s&&"?"!==s.charAt(0)&&(s="?"+s),t+i+(r=r.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(s=s.replace("#","%23"))+n},ie.prototype.resolve=function(e){return this.resolveObject(ge(e,!1,!0)).format()},ie.prototype.resolveObject=function(e){if(Y(e)){var t=new ie;t.parse(e,!1,!0),e=t}for(var r=new ie,n=Object.keys(this),i=0;i<n.length;i++){var o=n[i];r[o]=this[o]}if(r.hash=e.hash,""===e.href)return r.href=r.format(),r;if(e.slashes&&!e.protocol){for(var s=Object.keys(e),a=0;a<s.length;a++){var c=s[a];"protocol"!==c&&(r[c]=e[c])}return ve[r.protocol]&&r.hostname&&!r.pathname&&(r.path=r.pathname="/"),r.href=r.format(),r}if(e.protocol&&e.protocol!==r.protocol){if(!ve[e.protocol]){for(var u=Object.keys(e),h=0;h<u.length;h++){var l=u[h];r[l]=e[l]}return r.href=r.format(),r}if(r.protocol=e.protocol,e.host||me[e.protocol])r.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),r.pathname=d.join("/")}if(r.search=e.search,r.query=e.query,r.host=e.host||"",r.auth=e.auth,r.hostname=e.hostname||e.host,r.port=e.port,r.pathname||r.search){var p=r.pathname||"",f=r.search||"";r.path=p+f}return r.slashes=r.slashes||e.slashes,r.href=r.format(),r}var m=r.pathname&&"/"===r.pathname.charAt(0),v=e.host||e.pathname&&"/"===e.pathname.charAt(0),g=v||m||r.host&&e.pathname,y=g,_=r.pathname&&r.pathname.split("/")||[],b=(d=e.pathname&&e.pathname.split("/")||[],r.protocol&&!ve[r.protocol]);if(b&&(r.hostname="",r.port=null,r.host&&(""===_[0]?_[0]=r.host:_.unshift(r.host)),r.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),g=g&&(""===d[0]||""===_[0])),v)r.host=e.host||""===e.host?e.host:r.host,r.hostname=e.hostname||""===e.hostname?e.hostname:r.hostname,r.search=e.search,r.query=e.query,_=d;else if(d.length)_||(_=[]),_.pop(),_=_.concat(d),r.search=e.search,r.query=e.query;else if(!K(e.search))return b&&(r.hostname=r.host=_.shift(),(C=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=C.shift(),r.host=r.hostname=C.shift())),r.search=e.search,r.query=e.query,J(r.pathname)&&J(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.href=r.format(),r;if(!_.length)return r.pathname=null,r.search?r.path="/"+r.search:r.path=null,r.href=r.format(),r;for(var x=_.slice(-1)[0],w=(r.host||e.host||_.length>1)&&("."===x||".."===x)||""===x,T=0,S=_.length;S>=0;S--)"."===(x=_[S])?_.splice(S,1):".."===x?(_.splice(S,1),T++):T&&(_.splice(S,1),T--);if(!g&&!y)for(;T--;T)_.unshift("..");!g||""===_[0]||_[0]&&"/"===_[0].charAt(0)||_.unshift(""),w&&"/"!==_.join("/").substr(-1)&&_.push("");var C,P=""===_[0]||_[0]&&"/"===_[0].charAt(0);return b&&(r.hostname=r.host=P?"":_.length?_.shift():"",(C=!!(r.host&&r.host.indexOf("@")>0)&&r.host.split("@"))&&(r.auth=C.shift(),r.host=r.hostname=C.shift())),(g=g||r.host&&_.length)&&!P&&_.unshift(""),_.length?r.pathname=_.join("/"):(r.pathname=null,r.path=null),J(r.pathname)&&J(r.search)||(r.path=(r.pathname?r.pathname:"")+(r.search?r.search:"")),r.auth=e.auth||r.auth,r.slashes=r.slashes||e.slashes,r.href=r.format(),r},ie.prototype.parseHost=function(){var e=this.host,t=se.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)};var ye={parse:re,resolve:function(e,t){return ge(e,!1,!0).resolve(t)},resolveObject:function(e,t){return e?ge(e,!1,!0).resolveObject(t):t},format:function(e){return Y(e)&&(e=ge(e)),e instanceof ie?e.format():ie.prototype.format.call(e)},Url:ne},_e={WEBGL_LEGACY:0,WEBGL:1,WEBGL2:2},be={UNKNOWN:0,WEBGL:1,CANVAS:2},xe={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16,NORMAL_NPM:17,ADD_NPM:18,SCREEN_NPM:19,NONE:20,SRC_OVER:0,SRC_IN:21,SRC_OUT:22,SRC_ATOP:23,DST_OVER:24,DST_IN:25,DST_OUT:26,DST_ATOP:27,ERASE:26,SUBTRACT:28},we={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},Te={RGBA:6408,RGB:6407,ALPHA:6406,LUMINANCE:6409,LUMINANCE_ALPHA:6410,DEPTH_COMPONENT:6402,DEPTH_STENCIL:34041},Se={TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067,TEXTURE_2D_ARRAY:35866,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074},Ce={UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,FLOAT:5126,HALF_FLOAT:36193},Pe={LINEAR:1,NEAREST:0},Ee={CLAMP:33071,REPEAT:10497,MIRRORED_REPEAT:33648},Ie={OFF:0,POW2:1,ON:2},Ae={AUTO:0,MANUAL:1},Me={LOW:"lowp",MEDIUM:"mediump",HIGH:"highp"};v.RETINA_PREFIX=/@([0-9\.]+)x/,v.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!0;var Oe,Re=!1;function De(e){if(!Re){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var t=["\n %c %c %c PixiJS 5.1.5 - âœ° "+e+" âœ°  %c  %c  http://www.pixijs.com/  %c %c â™¥%câ™¥%câ™¥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,t)}else window.console&&window.console.log("PixiJS 5.1.5 - "+e+" - http://www.pixijs.com/");Re=!0}}function ke(){return void 0===Oe&&(Oe=function(){var e={stencil:!0,failIfMajorPerformanceCaveat:v.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!window.WebGLRenderingContext)return!1;var t=document.createElement("canvas"),r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),n=!(!r||!r.getContextAttributes().stencil);if(r){var i=r.getExtension("WEBGL_lose_context");i&&i.loseContext()}return r=null,n}catch(e){return!1}}()),Oe}function Le(e,t){return(t=t||[])[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t}function Be(e){return e=e.toString(16),"#"+("000000".substr(0,6-e.length)+e)}function Fe(e){return"string"==typeof e&&"#"===e[0]&&(e=e.substr(1)),parseInt(e,16)}function Ne(e){return(255*e[0]<<16)+(255*e[1]<<8)+(255*e[2]|0)}var je=function(){for(var e=[],t=[],r=0;r<32;r++)e[r]=r,t[r]=r;e[xe.NORMAL_NPM]=xe.NORMAL,e[xe.ADD_NPM]=xe.ADD,e[xe.SCREEN_NPM]=xe.SCREEN,t[xe.NORMAL]=xe.NORMAL_NPM,t[xe.ADD]=xe.ADD_NPM,t[xe.SCREEN]=xe.SCREEN_NPM;var n=[];return n.push(t),n.push(e),n}();function Ue(e,t){return je[t?1:0][e]}function Ge(e,t,r,n){return r=r||new Float32Array(4),n||void 0===n?(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t):(r[0]=e[0],r[1]=e[1],r[2]=e[2]),r[3]=t,r}function Xe(e,t){if(1===t)return(255*t<<24)+e;if(0===t)return 0;var r=e>>16&255,n=e>>8&255;return(255*t<<24)+((r=r*t+.5|0)<<16)+((n=n*t+.5|0)<<8)+((255&e)*t+.5|0)}function Ve(e,t,r,n){return(r=r||new Float32Array(4))[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,(n||void 0===n)&&(r[0]*=t,r[1]*=t,r[2]*=t),r[3]=t,r}function ze(e,t){void 0===t&&(t=null);var r=6*e;if((t=t||new Uint16Array(r)).length!==r)throw new Error("Out buffer length is incorrect, got "+t.length+" and expected "+r);for(var n=0,i=0;n<r;n+=6,i+=4)t[n+0]=i+0,t[n+1]=i+1,t[n+2]=i+2,t[n+3]=i+0,t[n+4]=i+2,t[n+5]=i+3;return t}function He(e,t,r){var n,i=e.length;if(!(t>=i||0===r)){var o=i-(r=t+r>i?i-t:r);for(n=t;n<o;++n)e[n]=e[n+r];e.length=o}}var We=0;function Ye(){return++We}function qe(e){return 0===e?0:e<0?-1:1}function Je(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,1+((e|=e>>>8)|e>>>16)}function Ke(e){return!(e&e-1||!e)}function Ze(e){var t=(e>65535)<<4,r=((e>>>=t)>255)<<3;return t|=r,t|=r=((e>>>=r)>15)<<2,(t|=r=((e>>>=r)>3)<<1)|(e>>>=r)>>1}var Qe={},$e=Object.create(null),et=Object.create(null);function tt(e){var t,r,n,i=e.width,o=e.height,s=e.getContext("2d"),a=s.getImageData(0,0,i,o).data,c=a.length,u={top:null,left:null,right:null,bottom:null},h=null;for(t=0;t<c;t+=4)0!==a[t+3]&&(r=t/4%i,n=~~(t/4/i),null===u.top&&(u.top=n),(null===u.left||r<u.left)&&(u.left=r),(null===u.right||u.right<r)&&(u.right=r+1),(null===u.bottom||u.bottom<n)&&(u.bottom=n));return null!==u.top&&(i=u.right-u.left,o=u.bottom-u.top+1,h=s.getImageData(u.left,u.top,i,o)),{height:o,width:i,data:h}}var rt=function(e,t,r){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=r||v.RESOLUTION,this.resize(e,t)},nt={width:{configurable:!0},height:{configurable:!0}};rt.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},rt.prototype.resize=function(e,t){this.canvas.width=e*this.resolution,this.canvas.height=t*this.resolution},rt.prototype.destroy=function(){this.context=null,this.canvas=null},nt.width.get=function(){return this.canvas.width},nt.width.set=function(e){this.canvas.width=e},nt.height.get=function(){return this.canvas.height},nt.height.set=function(e){this.canvas.height=e},Object.defineProperties(rt.prototype,nt);var it,ot=/^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i;function st(e,t){if(void 0===t&&(t=window.location),0===e.indexOf("data:"))return"";t=t||window.location,it||(it=document.createElement("a")),it.href=e;var r=!(e=ye.parse(it.href)).port&&""===t.port||e.port===t.port;return e.hostname===t.hostname&&r&&e.protocol===t.protocol?"":"anonymous"}function at(e,t){var r=v.RETINA_PREFIX.exec(e);return r?parseFloat(r[1]):void 0!==t?t:1}var ct={};function ut(e,t,r){if(void 0===r&&(r=3),!ct[t]){var n=(new Error).stack;void 0===n?console.warn("PixiJS Deprecation Warning: ",t+"\nDeprecated since v"+e):(n=n.split("\n").splice(r).join("\n"),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",t+"\nDeprecated since v"+e),console.warn(n),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",t+"\nDeprecated since v"+e),console.warn(n))),ct[t]=!0}}var ht={BaseTextureCache:et,CanvasRenderTarget:rt,DATA_URI:ot,ProgramCache:Qe,TextureCache:$e,clearTextureCache:function(){var e;for(e in $e)delete $e[e];for(e in et)delete et[e]},correctBlendMode:Ue,createIndicesForQuads:ze,decomposeDataUri:function(e){var t=ot.exec(e);if(t)return{mediaType:t[1]?t[1].toLowerCase():void 0,subType:t[2]?t[2].toLowerCase():void 0,charset:t[3]?t[3].toLowerCase():void 0,encoding:t[4]?t[4].toLowerCase():void 0,data:t[5]}},deprecation:ut,destroyTextureCache:function(){var e;for(e in $e)$e[e].destroy();for(e in et)et[e].destroy()},determineCrossOrigin:st,getResolutionOfUrl:at,hex2rgb:Le,hex2string:Be,isPow2:Ke,isWebGLSupported:ke,log2:Ze,nextPow2:Je,premultiplyBlendMode:je,premultiplyRgba:Ge,premultiplyTint:Xe,premultiplyTintToRgba:Ve,removeItems:He,rgb2hex:Ne,sayHello:De,sign:qe,skipHello:function(){Re=!0},string2hex:Fe,trimCanvas:tt,uid:Ye,isMobile:m,EventEmitter:g,earcut:y,url:ye},lt=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t};lt.prototype.clone=function(){return new lt(this.x,this.y)},lt.prototype.copyFrom=function(e){return this.set(e.x,e.y),this},lt.prototype.copyTo=function(e){return e.set(this.x,this.y),e},lt.prototype.equals=function(e){return e.x===this.x&&e.y===this.y},lt.prototype.set=function(e,t){this.x=e||0,this.y=t||(0!==t?this.x:0)};var dt=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0),this._x=r,this._y=n,this.cb=e,this.scope=t},pt={x:{configurable:!0},y:{configurable:!0}};dt.prototype.clone=function(e,t){void 0===e&&(e=null),void 0===t&&(t=null);var r=e||this.cb,n=t||this.scope;return new dt(r,n,this._x,this._y)},dt.prototype.set=function(e,t){var r=e||0,n=t||(0!==t?r:0);this._x===r&&this._y===n||(this._x=r,this._y=n,this.cb.call(this.scope))},dt.prototype.copyFrom=function(e){return this._x===e.x&&this._y===e.y||(this._x=e.x,this._y=e.y,this.cb.call(this.scope)),this},dt.prototype.copyTo=function(e){return e.set(this._x,this._y),e},dt.prototype.equals=function(e){return e.x===this._x&&e.y===this._y},pt.x.get=function(){return this._x},pt.x.set=function(e){this._x!==e&&(this._x=e,this.cb.call(this.scope))},pt.y.get=function(){return this._y},pt.y.set=function(e){this._y!==e&&(this._y=e,this.cb.call(this.scope))},Object.defineProperties(dt.prototype,pt);var ft=2*Math.PI,mt=180/Math.PI,vt=Math.PI/180,gt={POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},yt=function(e,t,r,n,i,o){void 0===e&&(e=1),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),this.a=e,this.b=t,this.c=r,this.d=n,this.tx=i,this.ty=o,this.array=null},_t={IDENTITY:{configurable:!0},TEMP_MATRIX:{configurable:!0}};yt.prototype.fromArray=function(e){this.a=e[0],this.b=e[1],this.c=e[3],this.d=e[4],this.tx=e[2],this.ty=e[5]},yt.prototype.set=function(e,t,r,n,i,o){return this.a=e,this.b=t,this.c=r,this.d=n,this.tx=i,this.ty=o,this},yt.prototype.toArray=function(e,t){this.array||(this.array=new Float32Array(9));var r=t||this.array;return e?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r},yt.prototype.apply=function(e,t){t=t||new lt;var r=e.x,n=e.y;return t.x=this.a*r+this.c*n+this.tx,t.y=this.b*r+this.d*n+this.ty,t},yt.prototype.applyInverse=function(e,t){t=t||new lt;var r=1/(this.a*this.d+this.c*-this.b),n=e.x,i=e.y;return t.x=this.d*r*n+-this.c*r*i+(this.ty*this.c-this.tx*this.d)*r,t.y=this.a*r*i+-this.b*r*n+(-this.ty*this.a+this.tx*this.b)*r,t},yt.prototype.translate=function(e,t){return this.tx+=e,this.ty+=t,this},yt.prototype.scale=function(e,t){return this.a*=e,this.d*=t,this.c*=e,this.b*=t,this.tx*=e,this.ty*=t,this},yt.prototype.rotate=function(e){var t=Math.cos(e),r=Math.sin(e),n=this.a,i=this.c,o=this.tx;return this.a=n*t-this.b*r,this.b=n*r+this.b*t,this.c=i*t-this.d*r,this.d=i*r+this.d*t,this.tx=o*t-this.ty*r,this.ty=o*r+this.ty*t,this},yt.prototype.append=function(e){var t=this.a,r=this.b,n=this.c,i=this.d;return this.a=e.a*t+e.b*n,this.b=e.a*r+e.b*i,this.c=e.c*t+e.d*n,this.d=e.c*r+e.d*i,this.tx=e.tx*t+e.ty*n+this.tx,this.ty=e.tx*r+e.ty*i+this.ty,this},yt.prototype.setTransform=function(e,t,r,n,i,o,s,a,c){return this.a=Math.cos(s+c)*i,this.b=Math.sin(s+c)*i,this.c=-Math.sin(s-a)*o,this.d=Math.cos(s-a)*o,this.tx=e-(r*this.a+n*this.c),this.ty=t-(r*this.b+n*this.d),this},yt.prototype.prepend=function(e){var t=this.tx;if(1!==e.a||0!==e.b||0!==e.c||1!==e.d){var r=this.a,n=this.c;this.a=r*e.a+this.b*e.c,this.b=r*e.b+this.b*e.d,this.c=n*e.a+this.d*e.c,this.d=n*e.b+this.d*e.d}return this.tx=t*e.a+this.ty*e.c+e.tx,this.ty=t*e.b+this.ty*e.d+e.ty,this},yt.prototype.decompose=function(e){var t=this.a,r=this.b,n=this.c,i=this.d,o=-Math.atan2(-n,i),s=Math.atan2(r,t),a=Math.abs(o+s);return a<1e-5||Math.abs(ft-a)<1e-5?(e.rotation=s,e.skew.x=e.skew.y=0):(e.rotation=0,e.skew.x=o,e.skew.y=s),e.scale.x=Math.sqrt(t*t+r*r),e.scale.y=Math.sqrt(n*n+i*i),e.position.x=this.tx,e.position.y=this.ty,e},yt.prototype.invert=function(){var e=this.a,t=this.b,r=this.c,n=this.d,i=this.tx,o=e*n-t*r;return this.a=n/o,this.b=-t/o,this.c=-r/o,this.d=e/o,this.tx=(r*this.ty-n*i)/o,this.ty=-(e*this.ty-t*i)/o,this},yt.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},yt.prototype.clone=function(){var e=new yt;return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},yt.prototype.copyTo=function(e){return e.a=this.a,e.b=this.b,e.c=this.c,e.d=this.d,e.tx=this.tx,e.ty=this.ty,e},yt.prototype.copyFrom=function(e){return this.a=e.a,this.b=e.b,this.c=e.c,this.d=e.d,this.tx=e.tx,this.ty=e.ty,this},_t.IDENTITY.get=function(){return new yt},_t.TEMP_MATRIX.get=function(){return new yt},Object.defineProperties(yt,_t);var bt=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],xt=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],wt=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Tt=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],St=[],Ct=[],Pt=Math.sign;!function(){for(var e=0;e<16;e++){var t=[];St.push(t);for(var r=0;r<16;r++)for(var n=Pt(bt[e]*bt[r]+wt[e]*xt[r]),i=Pt(xt[e]*bt[r]+Tt[e]*xt[r]),o=Pt(bt[e]*wt[r]+wt[e]*Tt[r]),s=Pt(xt[e]*wt[r]+Tt[e]*Tt[r]),a=0;a<16;a++)if(bt[a]===n&&xt[a]===i&&wt[a]===o&&Tt[a]===s){t.push(a);break}}for(var c=0;c<16;c++){var u=new yt;u.set(bt[c],xt[c],wt[c],Tt[c],0,0),Ct.push(u)}}();var Et={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:function(e){return bt[e]},uY:function(e){return xt[e]},vX:function(e){return wt[e]},vY:function(e){return Tt[e]},inv:function(e){return 8&e?15&e:7&-e},add:function(e,t){return St[e][t]},sub:function(e,t){return St[e][Et.inv(t)]},rotate180:function(e){return 4^e},isVertical:function(e){return 2==(3&e)},byDirection:function(e,t){return 2*Math.abs(e)<=Math.abs(t)?t>=0?Et.S:Et.N:2*Math.abs(t)<=Math.abs(e)?e>0?Et.E:Et.W:t>0?e>0?Et.SE:Et.SW:e>0?Et.NE:Et.NW},matrixAppendRotationInv:function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=Ct[Et.inv(t)];i.tx=r,i.ty=n,e.append(i)}},It=function(){this.worldTransform=new yt,this.localTransform=new yt,this.position=new dt(this.onChange,this,0,0),this.scale=new dt(this.onChange,this,1,1),this.pivot=new dt(this.onChange,this,0,0),this.skew=new dt(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0},At={rotation:{configurable:!0}};It.prototype.onChange=function(){this._localID++},It.prototype.updateSkew=function(){this._cx=Math.cos(this._rotation+this.skew._y),this._sx=Math.sin(this._rotation+this.skew._y),this._cy=-Math.sin(this._rotation-this.skew._x),this._sy=Math.cos(this._rotation-this.skew._x),this._localID++},It.prototype.updateLocalTransform=function(){var e=this.localTransform;this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale._x,e.b=this._sx*this.scale._x,e.c=this._cy*this.scale._y,e.d=this._sy*this.scale._y,e.tx=this.position._x-(this.pivot._x*e.a+this.pivot._y*e.c),e.ty=this.position._y-(this.pivot._x*e.b+this.pivot._y*e.d),this._currentLocalID=this._localID,this._parentID=-1)},It.prototype.updateTransform=function(e){var t=this.localTransform;if(this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale._x,t.b=this._sx*this.scale._x,t.c=this._cy*this.scale._y,t.d=this._sy*this.scale._y,t.tx=this.position._x-(this.pivot._x*t.a+this.pivot._y*t.c),t.ty=this.position._y-(this.pivot._x*t.b+this.pivot._y*t.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==e._worldID){var r=e.worldTransform,n=this.worldTransform;n.a=t.a*r.a+t.b*r.c,n.b=t.a*r.b+t.b*r.d,n.c=t.c*r.a+t.d*r.c,n.d=t.c*r.b+t.d*r.d,n.tx=t.tx*r.a+t.ty*r.c+r.tx,n.ty=t.tx*r.b+t.ty*r.d+r.ty,this._parentID=e._worldID,this._worldID++}},It.prototype.setFromMatrix=function(e){e.decompose(this),this._localID++},At.rotation.get=function(){return this._rotation},At.rotation.set=function(e){this._rotation!==e&&(this._rotation=e,this.updateSkew())},Object.defineProperties(It.prototype,At),It.IDENTITY=new It;var Mt=function(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=0),this.x=Number(e),this.y=Number(t),this.width=Number(r),this.height=Number(n),this.type=gt.RECT},Ot={left:{configurable:!0},right:{configurable:!0},top:{configurable:!0},bottom:{configurable:!0}},Rt={EMPTY:{configurable:!0}};Ot.left.get=function(){return this.x},Ot.right.get=function(){return this.x+this.width},Ot.top.get=function(){return this.y},Ot.bottom.get=function(){return this.y+this.height},Rt.EMPTY.get=function(){return new Mt(0,0,0,0)},Mt.prototype.clone=function(){return new Mt(this.x,this.y,this.width,this.height)},Mt.prototype.copyFrom=function(e){return this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height,this},Mt.prototype.copyTo=function(e){return e.x=this.x,e.y=this.y,e.width=this.width,e.height=this.height,e},Mt.prototype.contains=function(e,t){return!(this.width<=0||this.height<=0)&&e>=this.x&&e<this.x+this.width&&t>=this.y&&t<this.y+this.height},Mt.prototype.pad=function(e,t){e=e||0,t=t||(0!==t?e:0),this.x-=e,this.y-=t,this.width+=2*e,this.height+=2*t},Mt.prototype.fit=function(e){var t=Math.max(this.x,e.x),r=Math.min(this.x+this.width,e.x+e.width),n=Math.max(this.y,e.y),i=Math.min(this.y+this.height,e.y+e.height);this.x=t,this.width=Math.max(r-t,0),this.y=n,this.height=Math.max(i-n,0)},Mt.prototype.ceil=function(e,t){void 0===e&&(e=1),void 0===t&&(t=.001);var r=Math.ceil((this.x+this.width-t)*e)/e,n=Math.ceil((this.y+this.height-t)*e)/e;this.x=Math.floor((this.x+t)*e)/e,this.y=Math.floor((this.y+t)*e)/e,this.width=r-this.x,this.height=n-this.y},Mt.prototype.enlarge=function(e){var t=Math.min(this.x,e.x),r=Math.max(this.x+this.width,e.x+e.width),n=Math.min(this.y,e.y),i=Math.max(this.y+this.height,e.y+e.height);this.x=t,this.width=r-t,this.y=n,this.height=i-n},Object.defineProperties(Mt.prototype,Ot),Object.defineProperties(Mt,Rt);var Dt=function(e,t,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),this.x=e,this.y=t,this.radius=r,this.type=gt.CIRC};Dt.prototype.clone=function(){return new Dt(this.x,this.y,this.radius)},Dt.prototype.contains=function(e,t){if(this.radius<=0)return!1;var r=this.radius*this.radius,n=this.x-e,i=this.y-t;return(n*=n)+(i*=i)<=r},Dt.prototype.getBounds=function(){return new Mt(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)};var kt=function(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=0),this.x=e,this.y=t,this.width=r,this.height=n,this.type=gt.ELIP};kt.prototype.clone=function(){return new kt(this.x,this.y,this.width,this.height)},kt.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;var r=(e-this.x)/this.width,n=(t-this.y)/this.height;return(r*=r)+(n*=n)<=1},kt.prototype.getBounds=function(){return new Mt(this.x-this.width,this.y-this.height,this.width,this.height)};var Lt=function(){for(var e=arguments,t=[],r=arguments.length;r--;)t[r]=e[r];if(Array.isArray(t[0])&&(t=t[0]),t[0]instanceof lt){for(var n=[],i=0,o=t.length;i<o;i++)n.push(t[i].x,t[i].y);t=n}this.points=t,this.type=gt.POLY,this.closeStroke=!0};Lt.prototype.clone=function(){var e=new Lt(this.points.slice());return e.closeStroke=this.closeStroke,e},Lt.prototype.contains=function(e,t){for(var r=!1,n=this.points.length/2,i=0,o=n-1;i<n;o=i++){var s=this.points[2*i],a=this.points[2*i+1],c=this.points[2*o],u=this.points[2*o+1];a>t!=u>t&&e<(t-a)/(u-a)*(c-s)+s&&(r=!r)}return r};var Bt=function(e,t,r,n,i){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=20),this.x=e,this.y=t,this.width=r,this.height=n,this.radius=i,this.type=gt.RREC};Bt.prototype.clone=function(){return new Bt(this.x,this.y,this.width,this.height,this.radius)},Bt.prototype.contains=function(e,t){if(this.width<=0||this.height<=0)return!1;if(e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height){if(t>=this.y+this.radius&&t<=this.y+this.height-this.radius||e>=this.x+this.radius&&e<=this.x+this.width-this.radius)return!0;var r=e-(this.x+this.radius),n=t-(this.y+this.radius),i=this.radius*this.radius;if(r*r+n*n<=i)return!0;if((r=e-(this.x+this.width-this.radius))*r+n*n<=i)return!0;if(r*r+(n=t-(this.y+this.height-this.radius))*n<=i)return!0;if((r=e-(this.x+this.radius))*r+n*n<=i)return!0}return!1},v.SORTABLE_CHILDREN=!1;var Ft=function(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null};Ft.prototype.isEmpty=function(){return this.minX>this.maxX||this.minY>this.maxY},Ft.prototype.clear=function(){this.updateID++,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0},Ft.prototype.getRectangle=function(e){return this.minX>this.maxX||this.minY>this.maxY?Mt.EMPTY:((e=e||new Mt(0,0,1,1)).x=this.minX,e.y=this.minY,e.width=this.maxX-this.minX,e.height=this.maxY-this.minY,e)},Ft.prototype.addPoint=function(e){this.minX=Math.min(this.minX,e.x),this.maxX=Math.max(this.maxX,e.x),this.minY=Math.min(this.minY,e.y),this.maxY=Math.max(this.maxY,e.y)},Ft.prototype.addQuad=function(e){var t=this.minX,r=this.minY,n=this.maxX,i=this.maxY,o=e[0],s=e[1];t=o<t?o:t,r=s<r?s:r,n=o>n?o:n,i=s>i?s:i,t=(o=e[2])<t?o:t,r=(s=e[3])<r?s:r,n=o>n?o:n,i=s>i?s:i,t=(o=e[4])<t?o:t,r=(s=e[5])<r?s:r,n=o>n?o:n,i=s>i?s:i,t=(o=e[6])<t?o:t,r=(s=e[7])<r?s:r,n=o>n?o:n,i=s>i?s:i,this.minX=t,this.minY=r,this.maxX=n,this.maxY=i},Ft.prototype.addFrame=function(e,t,r,n,i){var o=e.worldTransform,s=o.a,a=o.b,c=o.c,u=o.d,h=o.tx,l=o.ty,d=this.minX,p=this.minY,f=this.maxX,m=this.maxY,v=s*t+c*r+h,g=a*t+u*r+l;d=v<d?v:d,p=g<p?g:p,f=v>f?v:f,m=g>m?g:m,d=(v=s*n+c*r+h)<d?v:d,p=(g=a*n+u*r+l)<p?g:p,f=v>f?v:f,m=g>m?g:m,d=(v=s*t+c*i+h)<d?v:d,p=(g=a*t+u*i+l)<p?g:p,f=v>f?v:f,m=g>m?g:m,d=(v=s*n+c*i+h)<d?v:d,p=(g=a*n+u*i+l)<p?g:p,f=v>f?v:f,m=g>m?g:m,this.minX=d,this.minY=p,this.maxX=f,this.maxY=m},Ft.prototype.addVertexData=function(e,t,r){for(var n=this.minX,i=this.minY,o=this.maxX,s=this.maxY,a=t;a<r;a+=2){var c=e[a],u=e[a+1];n=c<n?c:n,i=u<i?u:i,o=c>o?c:o,s=u>s?u:s}this.minX=n,this.minY=i,this.maxX=o,this.maxY=s},Ft.prototype.addVertices=function(e,t,r,n){for(var i=e.worldTransform,o=i.a,s=i.b,a=i.c,c=i.d,u=i.tx,h=i.ty,l=this.minX,d=this.minY,p=this.maxX,f=this.maxY,m=r;m<n;m+=2){var v=t[m],g=t[m+1],y=o*v+a*g+u,_=c*g+s*v+h;l=y<l?y:l,d=_<d?_:d,p=y>p?y:p,f=_>f?_:f}this.minX=l,this.minY=d,this.maxX=p,this.maxY=f},Ft.prototype.addBounds=function(e){var t=this.minX,r=this.minY,n=this.maxX,i=this.maxY;this.minX=e.minX<t?e.minX:t,this.minY=e.minY<r?e.minY:r,this.maxX=e.maxX>n?e.maxX:n,this.maxY=e.maxY>i?e.maxY:i},Ft.prototype.addBoundsMask=function(e,t){var r=e.minX>t.minX?e.minX:t.minX,n=e.minY>t.minY?e.minY:t.minY,i=e.maxX<t.maxX?e.maxX:t.maxX,o=e.maxY<t.maxY?e.maxY:t.maxY;if(r<=i&&n<=o){var s=this.minX,a=this.minY,c=this.maxX,u=this.maxY;this.minX=r<s?r:s,this.minY=n<a?n:a,this.maxX=i>c?i:c,this.maxY=o>u?o:u}},Ft.prototype.addBoundsArea=function(e,t){var r=e.minX>t.x?e.minX:t.x,n=e.minY>t.y?e.minY:t.y,i=e.maxX<t.x+t.width?e.maxX:t.x+t.width,o=e.maxY<t.y+t.height?e.maxY:t.y+t.height;if(r<=i&&n<=o){var s=this.minX,a=this.minY,c=this.maxX,u=this.maxY;this.minX=r<s?r:s,this.minY=n<a?n:a,this.maxX=i>c?i:c,this.maxY=o>u?o:u}};var Nt=function(e){function t(){e.call(this),this.tempDisplayObjectParent=null,this.transform=new It,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Ft,this._boundsID=0,this._lastBoundsID=-1,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._destroyed=!1,this.isSprite=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={_tempDisplayObjectParent:{configurable:!0},x:{configurable:!0},y:{configurable:!0},worldTransform:{configurable:!0},localTransform:{configurable:!0},position:{configurable:!0},scale:{configurable:!0},pivot:{configurable:!0},skew:{configurable:!0},rotation:{configurable:!0},angle:{configurable:!0},zIndex:{configurable:!0},worldVisible:{configurable:!0},mask:{configurable:!0}};return t.mixin=function(e){for(var r=Object.keys(e),n=0;n<r.length;++n){var i=r[n];Object.defineProperty(t.prototype,i,Object.getOwnPropertyDescriptor(e,i))}},r._tempDisplayObjectParent.get=function(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new t),this.tempDisplayObjectParent},t.prototype.updateTransform=function(){this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._bounds.updateID++},t.prototype._recursivePostUpdateTransform=function(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)},t.prototype.getBounds=function(e,t){return e||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._boundsID!==this._lastBoundsID&&(this.calculateBounds(),this._lastBoundsID=this._boundsID),t||(this._boundsRect||(this._boundsRect=new Mt),t=this._boundsRect),this._bounds.getRectangle(t)},t.prototype.getLocalBounds=function(e){var t=this.transform,r=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform,e||(this._localBoundsRect||(this._localBoundsRect=new Mt),e=this._localBoundsRect);var n=this.getBounds(!1,e);return this.parent=r,this.transform=t,n},t.prototype.toGlobal=function(e,t,r){return void 0===r&&(r=!1),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(e,t)},t.prototype.toLocal=function(e,t,r,n){return t&&(e=t.toGlobal(e,r,n)),n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(e,r)},t.prototype.render=function(e){},t.prototype.setParent=function(e){if(!e||!e.addChild)throw new Error("setParent: Argument must be a Container");return e.addChild(this),e},t.prototype.setTransform=function(e,t,r,n,i,o,s,a,c){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=1),void 0===n&&(n=1),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===c&&(c=0),this.position.x=e,this.position.y=t,this.scale.x=r||1,this.scale.y=n||1,this.rotation=i,this.skew.x=o,this.skew.y=s,this.pivot.x=a,this.pivot.y=c,this},t.prototype.destroy=function(){this.removeAllListeners(),this.parent&&this.parent.removeChild(this),this.transform=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.filterArea=null,this.interactive=!1,this.interactiveChildren=!1,this._destroyed=!0},r.x.get=function(){return this.position.x},r.x.set=function(e){this.transform.position.x=e},r.y.get=function(){return this.position.y},r.y.set=function(e){this.transform.position.y=e},r.worldTransform.get=function(){return this.transform.worldTransform},r.localTransform.get=function(){return this.transform.localTransform},r.position.get=function(){return this.transform.position},r.position.set=function(e){this.transform.position.copyFrom(e)},r.scale.get=function(){return this.transform.scale},r.scale.set=function(e){this.transform.scale.copyFrom(e)},r.pivot.get=function(){return this.transform.pivot},r.pivot.set=function(e){this.transform.pivot.copyFrom(e)},r.skew.get=function(){return this.transform.skew},r.skew.set=function(e){this.transform.skew.copyFrom(e)},r.rotation.get=function(){return this.transform.rotation},r.rotation.set=function(e){this.transform.rotation=e},r.angle.get=function(){return this.transform.rotation*mt},r.angle.set=function(e){this.transform.rotation=e*vt},r.zIndex.get=function(){return this._zIndex},r.zIndex.set=function(e){this._zIndex=e,this.parent&&(this.parent.sortDirty=!0)},r.worldVisible.get=function(){var e=this;do{if(!e.visible)return!1;e=e.parent}while(e);return!0},r.mask.get=function(){return this._mask},r.mask.set=function(e){this._mask&&(this._mask.renderable=!0,this._mask.isMask=!1),this._mask=e,this._mask&&(this._mask.renderable=!1,this._mask.isMask=!0)},Object.defineProperties(t.prototype,r),t}(g);function jt(e,t){return e.zIndex===t.zIndex?e._lastSortedIndex-t._lastSortedIndex:e.zIndex-t.zIndex}Nt.prototype.displayObjectUpdateTransform=Nt.prototype.updateTransform;var Ut=function(e){function t(){e.call(this),this.children=[],this.sortableChildren=v.SORTABLE_CHILDREN,this.sortDirty=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={width:{configurable:!0},height:{configurable:!0}};return t.prototype.onChildrenChange=function(){},t.prototype.addChild=function(e){var t=arguments,r=arguments.length;if(r>1)for(var n=0;n<r;n++)this.addChild(t[n]);else e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this);return e},t.prototype.addChildAt=function(e,t){if(t<0||t>this.children.length)throw new Error(e+"addChildAt: The index "+t+" supplied is out of bounds "+this.children.length);return e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.splice(t,0,e),this._boundsID++,this.onChildrenChange(t),e.emit("added",this),this.emit("childAdded",e,this,t),e},t.prototype.swapChildren=function(e,t){if(e!==t){var r=this.getChildIndex(e),n=this.getChildIndex(t);this.children[r]=t,this.children[n]=e,this.onChildrenChange(r<n?r:n)}},t.prototype.getChildIndex=function(e){var t=this.children.indexOf(e);if(-1===t)throw new Error("The supplied DisplayObject must be a child of the caller");return t},t.prototype.setChildIndex=function(e,t){if(t<0||t>=this.children.length)throw new Error("The index "+t+" supplied is out of bounds "+this.children.length);var r=this.getChildIndex(e);He(this.children,r,1),this.children.splice(t,0,e),this.onChildrenChange(t)},t.prototype.getChildAt=function(e){if(e<0||e>=this.children.length)throw new Error("getChildAt: Index ("+e+") does not exist.");return this.children[e]},t.prototype.removeChild=function(e){var t=arguments,r=arguments.length;if(r>1)for(var n=0;n<r;n++)this.removeChild(t[n]);else{var i=this.children.indexOf(e);if(-1===i)return null;e.parent=null,e.transform._parentID=-1,He(this.children,i,1),this._boundsID++,this.onChildrenChange(i),e.emit("removed",this),this.emit("childRemoved",e,this,i)}return e},t.prototype.removeChildAt=function(e){var t=this.getChildAt(e);return t.parent=null,t.transform._parentID=-1,He(this.children,e,1),this._boundsID++,this.onChildrenChange(e),t.emit("removed",this),this.emit("childRemoved",t,this,e),t},t.prototype.removeChildren=function(e,t){void 0===e&&(e=0);var r,n=e,i="number"==typeof t?t:this.children.length,o=i-n;if(o>0&&o<=i){r=this.children.splice(n,o);for(var s=0;s<r.length;++s)r[s].parent=null,r[s].transform&&(r[s].transform._parentID=-1);this._boundsID++,this.onChildrenChange(e);for(var a=0;a<r.length;++a)r[a].emit("removed",this),this.emit("childRemoved",r[a],this,a);return r}if(0===o&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},t.prototype.sortChildren=function(){for(var e=!1,t=0,r=this.children.length;t<r;++t){var n=this.children[t];n._lastSortedIndex=t,e||0===n.zIndex||(e=!0)}e&&this.children.length>1&&this.children.sort(jt),this.sortDirty=!1},t.prototype.updateTransform=function(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(var e=0,t=this.children.length;e<t;++e){var r=this.children[e];r.visible&&r.updateTransform()}},t.prototype.calculateBounds=function(){this._bounds.clear(),this._calculateBounds();for(var e=0;e<this.children.length;e++){var t=this.children[e];t.visible&&t.renderable&&(t.calculateBounds(),t._mask?(t._mask.calculateBounds(),this._bounds.addBoundsMask(t._bounds,t._mask._bounds)):t.filterArea?this._bounds.addBoundsArea(t._bounds,t.filterArea):this._bounds.addBounds(t._bounds))}this._lastBoundsID=this._boundsID},t.prototype._calculateBounds=function(){},t.prototype.render=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||this.filters&&this.filters.length)this.renderAdvanced(e);else{this._render(e);for(var t=0,r=this.children.length;t<r;++t)this.children[t].render(e)}},t.prototype.renderAdvanced=function(e){e.batch.flush();var t=this.filters,r=this._mask;if(t){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(var n=0;n<t.length;n++)t[n].enabled&&this._enabledFilters.push(t[n]);this._enabledFilters.length&&e.filter.push(this,this._enabledFilters)}r&&e.mask.push(this,this._mask),this._render(e);for(var i=0,o=this.children.length;i<o;i++)this.children[i].render(e);e.batch.flush(),r&&e.mask.pop(this,this._mask),t&&this._enabledFilters&&this._enabledFilters.length&&e.filter.pop()},t.prototype._render=function(e){},t.prototype.destroy=function(t){e.prototype.destroy.call(this),this.sortDirty=!1;var r="boolean"==typeof t?t:t&&t.children,n=this.removeChildren(0,this.children.length);if(r)for(var i=0;i<n.length;++i)n[i].destroy(t)},r.width.get=function(){return this.scale.x*this.getLocalBounds().width},r.width.set=function(e){var t=this.getLocalBounds().width;this.scale.x=0!==t?e/t:1,this._width=e},r.height.get=function(){return this.scale.y*this.getLocalBounds().height},r.height.set=function(e){var t=this.getLocalBounds().height;this.scale.y=0!==t?e/t:1,this._height=e},Object.defineProperties(t.prototype,r),t}(Nt);Ut.prototype.containerUpdateTransform=Ut.prototype.updateTransform;var Gt={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1};Nt.mixin(Gt);var Xt=function(e){this._hookDiv=null,(m.tablet||m.phone)&&this.createTouchHook();var t=document.createElement("div");t.style.width="100px",t.style.height="100px",t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.zIndex=2,this.div=t,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=e,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,this.isMobileAccessibility=!1,window.addEventListener("keydown",this._onKeyDown,!1)};Xt.prototype.createTouchHook=function(){var e=this,t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2,t.style.backgroundColor="#FF0000",t.title="HOOK DIV",t.addEventListener("focus",(function(){e.isMobileAccessibility=!0,e.activate(),e.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t},Xt.prototype.destroyTouchHook=function(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)},Xt.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode&&this.renderer.view.parentNode.appendChild(this.div))},Xt.prototype.deactivate=function(){this.isActive&&!this.isMobileAccessibility&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode&&this.div.parentNode.removeChild(this.div))},Xt.prototype.updateAccessibleObjects=function(e){if(e.visible){e.accessible&&e.interactive&&(e._accessibleActive||this.addChild(e),e.renderId=this.renderId);for(var t=e.children,r=0;r<t.length;r++)this.updateAccessibleObjects(t[r])}},Xt.prototype.update=function(){if(this.renderer.renderingToScreen){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var e=this.renderer.view.getBoundingClientRect(),t=e.width/this.renderer.width,r=e.height/this.renderer.height,n=this.div;n.style.left=e.left+"px",n.style.top=e.top+"px",n.style.width=this.renderer.width+"px",n.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var o=this.children[i];if(o.renderId!==this.renderId)o._accessibleActive=!1,He(this.children,i,1),this.div.removeChild(o._accessibleDiv),this.pool.push(o._accessibleDiv),o._accessibleDiv=null,i--,0===this.children.length&&this.deactivate();else{n=o._accessibleDiv;var s=o.hitArea,a=o.worldTransform;o.hitArea?(n.style.left=(a.tx+s.x*a.a)*t+"px",n.style.top=(a.ty+s.y*a.d)*r+"px",n.style.width=s.width*a.a*t+"px",n.style.height=s.height*a.d*r+"px"):(s=o.getBounds(),this.capHitArea(s),n.style.left=s.x*t+"px",n.style.top=s.y*r+"px",n.style.width=s.width*t+"px",n.style.height=s.height*r+"px",n.title!==o.accessibleTitle&&null!==o.accessibleTitle&&(n.title=o.accessibleTitle),n.getAttribute("aria-label")!==o.accessibleHint&&null!==o.accessibleHint&&n.setAttribute("aria-label",o.accessibleHint))}}this.renderId++}},Xt.prototype.capHitArea=function(e){e.x<0&&(e.width+=e.x,e.x=0),e.y<0&&(e.height+=e.y,e.y=0),e.x+e.width>this.renderer.width&&(e.width=this.renderer.width-e.x),e.y+e.height>this.renderer.height&&(e.height=this.renderer.height-e.y)},Xt.prototype.addChild=function(e){var t=this.pool.pop();t||((t=document.createElement("button")).style.width="100px",t.style.height="100px",t.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",t.style.position="absolute",t.style.zIndex=2,t.style.borderStyle="none",navigator.userAgent.toLowerCase().indexOf("chrome")>-1?t.setAttribute("aria-live","off"):t.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?t.setAttribute("aria-relevant","additions"):t.setAttribute("aria-relevant","text"),t.addEventListener("click",this._onClick.bind(this)),t.addEventListener("focus",this._onFocus.bind(this)),t.addEventListener("focusout",this._onFocusOut.bind(this))),e.accessibleTitle&&null!==e.accessibleTitle?t.title=e.accessibleTitle:e.accessibleHint&&null!==e.accessibleHint||(t.title="displayObject "+e.tabIndex),e.accessibleHint&&null!==e.accessibleHint&&t.setAttribute("aria-label",e.accessibleHint),e._accessibleActive=!0,e._accessibleDiv=t,t.displayObject=e,this.children.push(e),this.div.appendChild(e._accessibleDiv),e._accessibleDiv.tabIndex=e.tabIndex},Xt.prototype._onClick=function(e){var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"click",t.eventData),t.dispatchEvent(e.target.displayObject,"pointertap",t.eventData),t.dispatchEvent(e.target.displayObject,"tap",t.eventData)},Xt.prototype._onFocus=function(e){e.target.getAttribute("aria-live","off")||e.target.setAttribute("aria-live","assertive");var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseover",t.eventData)},Xt.prototype._onFocusOut=function(e){e.target.getAttribute("aria-live","off")||e.target.setAttribute("aria-live","polite");var t=this.renderer.plugins.interaction;t.dispatchEvent(e.target.displayObject,"mouseout",t.eventData)},Xt.prototype._onKeyDown=function(e){9===e.keyCode&&this.activate()},Xt.prototype._onMouseMove=function(e){0===e.movementX&&0===e.movementY||this.deactivate()},Xt.prototype.destroy=function(){this.destroyTouchHook(),this.div=null;for(var e=0;e<this.children.length;e++)this.children[e].div=null;window.document.removeEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null};var Vt={AccessibilityManager:Xt,accessibleTarget:Gt},zt=function(e){this.items=[],this._name=e,this._aliasCount=0},Ht={empty:{configurable:!0},name:{configurable:!0}};zt.prototype.emit=function(e,t,r,n,i,o,s,a){if(arguments.length>8)throw new Error("max arguments reached");var c=this.name,u=this.items;this._aliasCount++;for(var h=0,l=u.length;h<l;h++)u[h][c](e,t,r,n,i,o,s,a);return u===this.items&&this._aliasCount--,this},zt.prototype.ensureNonAliasedItems=function(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))},zt.prototype.add=function(e){return e[this._name]&&(this.ensureNonAliasedItems(),this.remove(e),this.items.push(e)),this},zt.prototype.remove=function(e){var t=this.items.indexOf(e);return-1!==t&&(this.ensureNonAliasedItems(),this.items.splice(t,1)),this},zt.prototype.contains=function(e){return-1!==this.items.indexOf(e)},zt.prototype.removeAll=function(){return this.ensureNonAliasedItems(),this.items.length=0,this},zt.prototype.destroy=function(){this.removeAll(),this.items=null,this._name=null},Ht.empty.get=function(){return 0===this.items.length},Ht.name.get=function(){return this._name},Object.defineProperties(zt.prototype,Ht),zt.prototype.dispatch=zt.prototype.emit,zt.prototype.run=zt.prototype.emit,v.TARGET_FPMS=.06;var Wt={INTERACTION:50,HIGH:25,NORMAL:0,LOW:-25,UTILITY:-50},Yt=function(e,t,r,n){void 0===t&&(t=null),void 0===r&&(r=0),void 0===n&&(n=!1),this.fn=e,this.context=t,this.priority=r,this.once=n,this.next=null,this.previous=null,this._destroyed=!1};Yt.prototype.match=function(e,t){return t=t||null,this.fn===e&&this.context===t},Yt.prototype.emit=function(e){this.fn&&(this.context?this.fn.call(this.context,e):this.fn(e));var t=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),t},Yt.prototype.connect=function(e){this.previous=e,e.next&&(e.next.previous=this),this.next=e.next,e.next=this},Yt.prototype.destroy=function(e){void 0===e&&(e=!1),this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);var t=this.next;return this.next=e?null:t,this.previous=null,t};var qt=function(){var e=this;this._head=new Yt(null,null,1/0),this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this.autoStart=!1,this.deltaTime=1,this.deltaMS=1/v.TARGET_FPMS,this.elapsedMS=1/v.TARGET_FPMS,this.lastTime=-1,this.speed=1,this.started=!1,this._protected=!1,this._lastFrame=-1,this._tick=function(t){e._requestId=null,e.started&&(e.update(t),e.started&&null===e._requestId&&e._head.next&&(e._requestId=requestAnimationFrame(e._tick)))}},Jt={FPS:{configurable:!0},minFPS:{configurable:!0},maxFPS:{configurable:!0}},Kt={shared:{configurable:!0},system:{configurable:!0}};qt.prototype._requestIfNeeded=function(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))},qt.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},qt.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},qt.prototype.add=function(e,t,r){return void 0===r&&(r=Wt.NORMAL),this._addListener(new Yt(e,t,r))},qt.prototype.addOnce=function(e,t,r){return void 0===r&&(r=Wt.NORMAL),this._addListener(new Yt(e,t,r,!0))},qt.prototype._addListener=function(e){var t=this._head.next,r=this._head;if(t){for(;t;){if(e.priority>t.priority){e.connect(r);break}r=t,t=t.next}e.previous||e.connect(r)}else e.connect(r);return this._startIfPossible(),this},qt.prototype.remove=function(e,t){for(var r=this._head.next;r;)r=r.match(e,t)?r.destroy():r.next;return this._head.next||this._cancelIfNeeded(),this},qt.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},qt.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},qt.prototype.destroy=function(){if(!this._protected){this.stop();for(var e=this._head.next;e;)e=e.destroy(!0);this._head.destroy(),this._head=null}},qt.prototype.update=function(e){var t;if(void 0===e&&(e=performance.now()),e>this.lastTime){if((t=this.elapsedMS=e-this.lastTime)>this._maxElapsedMS&&(t=this._maxElapsedMS),t*=this.speed,this._minElapsedMS){var r=e-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=e-r%this._minElapsedMS}this.deltaMS=t,this.deltaTime=this.deltaMS*v.TARGET_FPMS;for(var n=this._head,i=n.next;i;)i=i.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=e},Jt.FPS.get=function(){return 1e3/this.elapsedMS},Jt.minFPS.get=function(){return 1e3/this._maxElapsedMS},Jt.minFPS.set=function(e){var t=Math.min(this.maxFPS,e),r=Math.min(Math.max(0,t)/1e3,v.TARGET_FPMS);this._maxElapsedMS=1/r},Jt.maxFPS.get=function(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0},Jt.maxFPS.set=function(e){if(0===e)this._minElapsedMS=0;else{var t=Math.max(this.minFPS,e);this._minElapsedMS=1/(t/1e3)}},Kt.shared.get=function(){if(!qt._shared){var e=qt._shared=new qt;e.autoStart=!0,e._protected=!0}return qt._shared},Kt.system.get=function(){if(!qt._system){var e=qt._system=new qt;e.autoStart=!0,e._protected=!0}return qt._system},Object.defineProperties(qt.prototype,Jt),Object.defineProperties(qt,Kt);var Zt=function(){};Zt.init=function(e){var t=this;e=Object.assign({autoStart:!0,sharedTicker:!1},e),Object.defineProperty(this,"ticker",{set:function(e){this._ticker&&this._ticker.remove(this.render,this),this._ticker=e,e&&e.add(this.render,this,Wt.LOW)},get:function(){return this._ticker}}),this.stop=function(){t._ticker.stop()},this.start=function(){t._ticker.start()},this._ticker=null,this.ticker=e.sharedTicker?qt.shared:new qt,e.autoStart&&this.start()},Zt.destroy=function(){if(this._ticker){var e=this._ticker;this.ticker=null,e.destroy()}};var Qt=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this._width=e,this._height=t,this.destroyed=!1,this.internal=!1,this.onResize=new zt("setRealSize",2),this.onUpdate=new zt("update"),this.onError=new zt("onError",1)},$t={valid:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};Qt.prototype.bind=function(e){this.onResize.add(e),this.onUpdate.add(e),this.onError.add(e),(this._width||this._height)&&this.onResize.run(this._width,this._height)},Qt.prototype.unbind=function(e){this.onResize.remove(e),this.onUpdate.remove(e),this.onError.remove(e)},Qt.prototype.resize=function(e,t){e===this._width&&t===this._height||(this._width=e,this._height=t,this.onResize.run(e,t))},$t.valid.get=function(){return!!this._width&&!!this._height},Qt.prototype.update=function(){this.destroyed||this.onUpdate.run()},Qt.prototype.load=function(){return Promise.resolve()},$t.width.get=function(){return this._width},$t.height.get=function(){return this._height},Qt.prototype.upload=function(e,t,r){return!1},Qt.prototype.style=function(e,t,r){return!1},Qt.prototype.dispose=function(){},Qt.prototype.destroy=function(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)},Object.defineProperties(Qt.prototype,$t);var er=function(e){function t(t){var r=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;e.call(this,r,n),this.source=t,this.noSubImage=!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.crossOrigin=function(e,t,r){void 0===r&&0!==t.indexOf("data:")?e.crossOrigin=st(t):!1!==r&&(e.crossOrigin="string"==typeof r?r:"anonymous")},t.prototype.upload=function(e,t,r,n){var i=e.gl,o=t.realWidth,s=t.realHeight;return n=n||this.source,i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),this.noSubImage||t.target!==i.TEXTURE_2D||r.width!==o||r.height!==s?(r.width=o,r.height=s,i.texImage2D(t.target,0,t.format,t.format,t.type,n)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,t.format,t.type,n),!0},t.prototype.update=function(){if(!this.destroyed){var t=this.source.naturalWidth||this.source.videoWidth||this.source.width,r=this.source.naturalHeight||this.source.videoHeight||this.source.height;this.resize(t,r),e.prototype.update.call(this)}},t.prototype.dispose=function(){this.source=null},t}(Qt),tr=function(e){function t(t,r){if(r=r||{},!(t instanceof HTMLImageElement)){var n=new Image;e.crossOrigin(n,t,r.crossorigin),n.src=t,t=n}e.call(this,t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(void 0!==r.createBitmap?r.createBitmap:v.CREATE_IMAGE_BITMAP)&&!!window.createImageBitmap,this.premultiplyAlpha=!1!==r.premultiplyAlpha,this.bitmap=null,this._load=null,!1!==r.autoLoad&&this.load()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(e){var t=this;return void 0!==e&&(this.createBitmap=e),this._load||(this._load=new Promise((function(e){t.url=t.source.src;var r=t.source,n=function(){t.destroyed||(r.onload=null,r.onerror=null,t.resize(r.width,r.height),t._load=null,t.createBitmap?e(t.process()):e(t))};r.complete&&r.src?n():(r.onload=n,r.onerror=function(e){return t.onError.run(e)})}))),this._load},t.prototype.process=function(){var e=this;return null!==this._process?this._process:null===this.bitmap&&window.createImageBitmap?(this._process=window.createImageBitmap(this.source,0,0,this.source.width,this.source.height,{premultiplyAlpha:this.premultiplyAlpha?"premultiply":"none"}).then((function(t){return e.destroyed?Promise.reject():(e.bitmap=t,e.update(),e._process=null,Promise.resolve(e))})),this._process):Promise.resolve(this)},t.prototype.upload=function(t,r,n){if(r.premultiplyAlpha=this.premultiplyAlpha,!this.createBitmap)return e.prototype.upload.call(this,t,r,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(e.prototype.upload.call(this,t,r,n,this.bitmap),!this.preserveBitmap){var i=!0;for(var o in r._glTextures){var s=r._glTextures[o];if(s!==n&&s.dirtyId!==r.dirtyId){i=!1;break}}i&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0},t.prototype.dispose=function(){this.source.onload=null,this.source.onerror=null,e.prototype.dispose.call(this),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null},t}(er),rr=[];function nr(e,t){if(!e)return null;var r="";if("string"==typeof e){var n=/\.(\w{3,4})(?:$|\?|#)/i.exec(e);n&&(r=n[1].toLowerCase())}for(var i=rr.length-1;i>=0;--i){var o=rr[i];if(o.test&&o.test(e,r))return new o(e,t)}return new tr(e,t)}var ir=function(e){function t(t,r){var n=r||{},i=n.width,o=n.height;if(!i||!o)throw new Error("BufferResource width or height invalid");e.call(this,i,o),this.data=t}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.upload=function(e,t,r){var n=e.gl;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.width===t.width&&r.height===t.height?n.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.type,this.data):(r.width=t.width,r.height=t.height,n.texImage2D(t.target,0,r.internalFormat,t.width,t.height,0,t.format,r.type,this.data)),!0},t.prototype.dispose=function(){this.data=null},t.test=function(e){return e instanceof Float32Array||e instanceof Uint8Array||e instanceof Uint32Array},t}(Qt),or={scaleMode:Pe.NEAREST,format:Te.RGBA,premultiplyAlpha:!1},sr=function(e){function t(t,r){void 0===t&&(t=null),void 0===r&&(r=null),e.call(this);var n=(r=r||{}).premultiplyAlpha,i=r.mipmap,o=r.anisotropicLevel,s=r.scaleMode,a=r.width,c=r.height,u=r.wrapMode,h=r.format,l=r.type,d=r.target,p=r.resolution,f=r.resourceOptions;!t||t instanceof Qt||((t=nr(t,f)).internal=!0),this.width=a||0,this.height=c||0,this.resolution=p||v.RESOLUTION,this.mipmap=void 0!==i?i:v.MIPMAP_TEXTURES,this.anisotropicLevel=void 0!==o?o:v.ANISOTROPIC_LEVEL,this.wrapMode=u||v.WRAP_MODE,this.scaleMode=void 0!==s?s:v.SCALE_MODE,this.format=h||Te.RGBA,this.type=l||Ce.UNSIGNED_BYTE,this.target=d||Se.TEXTURE_2D,this.premultiplyAlpha=!1!==n,this.uid=Ye(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=a>0&&c>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this.setResource(t)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={realWidth:{configurable:!0},realHeight:{configurable:!0}};return r.realWidth.get=function(){return Math.ceil(this.width*this.resolution-1e-4)},r.realHeight.get=function(){return Math.ceil(this.height*this.resolution-1e-4)},t.prototype.setStyle=function(e,t){var r;return void 0!==e&&e!==this.scaleMode&&(this.scaleMode=e,r=!0),void 0!==t&&t!==this.mipmap&&(this.mipmap=t,r=!0),r&&this.dirtyStyleId++,this},t.prototype.setSize=function(e,t,r){return this.resolution=r||this.resolution,this.width=e,this.height=t,this._refreshPOT(),this.update(),this},t.prototype.setRealSize=function(e,t,r){return this.resolution=r||this.resolution,this.width=e/this.resolution,this.height=t/this.resolution,this._refreshPOT(),this.update(),this},t.prototype._refreshPOT=function(){this.isPowerOfTwo=Ke(this.realWidth)&&Ke(this.realHeight)},t.prototype.setResolution=function(e){var t=this.resolution;return t===e||(this.resolution=e,this.valid&&(this.width=this.width*t/e,this.height=this.height*t/e,this.emit("update",this)),this._refreshPOT()),this},t.prototype.setResource=function(e){if(this.resource===e)return this;if(this.resource)throw new Error("Resource can be set only once");return e.bind(this),this.resource=e,this},t.prototype.update=function(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))},t.prototype.onError=function(e){this.emit("error",this,e)},t.prototype.destroy=function(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete et[this.cacheId],delete $e[this.cacheId],this.cacheId=null),this.dispose(),t.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0},t.prototype.dispose=function(){this.emit("dispose",this)},t.from=function(e,r){var n=null;"string"==typeof e?n=e:(e._pixiId||(e._pixiId="pixiid_"+Ye()),n=e._pixiId);var i=et[n];return i||((i=new t(e,r)).cacheId=n,t.addToCache(i,n)),i},t.fromBuffer=function(e,r,n,i){e=e||new Float32Array(r*n*4);var o=new ir(e,{width:r,height:n}),s=e instanceof Float32Array?Ce.FLOAT:Ce.UNSIGNED_BYTE;return new t(o,Object.assign(or,i||{width:r,height:n,type:s}))},t.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),et[t]&&console.warn("BaseTexture added to the cache with an id ["+t+"] that already had an entry"),et[t]=e)},t.removeFromCache=function(e){if("string"==typeof e){var t=et[e];if(t){var r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete et[e],t}}else if(e&&e.textureCacheIds){for(var n=0;n<e.textureCacheIds.length;++n)delete et[e.textureCacheIds[n]];return e.textureCacheIds.length=0,e}return null},Object.defineProperties(t.prototype,r),t}(g);sr._globalBatch=0;var ar=function(e){function t(t,r){var n;r=r||{};var i=t;Array.isArray(t)&&(n=t,i=t.length),e.call(this,r.width,r.height),this.items=[],this.itemDirtyIds=[];for(var o=0;o<i;o++){var s=new sr;this.items.push(s),this.itemDirtyIds.push(-1)}if(this.length=i,this._load=null,n)for(var a=0;a<i;a++)this.addResourceAt(nr(n[a],r),a)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.dispose=function(){for(var e=0,t=this.length;e<t;e++)this.items[e].destroy();this.items=null,this.itemDirtyIds=null,this._load=null},t.prototype.addResourceAt=function(e,t){if(!this.items[t])throw new Error("Index "+t+" is out of bounds");return e.valid&&!this.valid&&this.resize(e.width,e.height),this.items[t].setResource(e),this},t.prototype.bind=function(t){e.prototype.bind.call(this,t),t.target=Se.TEXTURE_2D_ARRAY;for(var r=0;r<this.length;r++)this.items[r].on("update",t.update,t)},t.prototype.unbind=function(t){e.prototype.unbind.call(this,t);for(var r=0;r<this.length;r++)this.items[r].off("update",t.update,t)},t.prototype.load=function(){var e=this;if(this._load)return this._load;var t=this.items.map((function(e){return e.resource})),r=t.map((function(e){return e.load()}));return this._load=Promise.all(r).then((function(){var r=t[0],n=r.width,i=r.height;return e.resize(n,i),Promise.resolve(e)})),this._load},t.prototype.upload=function(e,t,r){var n=this.length,i=this.itemDirtyIds,o=this.items,s=e.gl;r.dirtyId<0&&s.texImage3D(s.TEXTURE_2D_ARRAY,0,t.format,this._width,this._height,n,0,t.format,t.type,null);for(var a=0;a<n;a++){var c=o[a];i[a]<c.dirtyId&&(i[a]=c.dirtyId,c.valid&&s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,a,c.resource.width,c.resource.height,1,t.format,t.type,c.resource.source))}return!0},t}(Qt),cr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.test=function(e){var t=window.OffscreenCanvas;return!!(t&&e instanceof t)||e instanceof HTMLCanvasElement},t}(er),ur=function(e){function t(r,n){if(n=n||{},e.call(this,r,n),this.length!==t.SIDES)throw new Error("Invalid length. Got "+this.length+", expected 6");for(var i=0;i<t.SIDES;i++)this.items[i].target=Se.TEXTURE_CUBE_MAP_POSITIVE_X+i;!1!==n.autoLoad&&this.load()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.bind=function(t){e.prototype.bind.call(this,t),t.target=Se.TEXTURE_CUBE_MAP},t.prototype.upload=function(e,r,n){for(var i=this.itemDirtyIds,o=0;o<t.SIDES;o++){var s=this.items[o];i[o]<s.dirtyId&&(i[o]=s.dirtyId,s.valid&&s.resource.upload(e,s,n))}return!0},t}(ar);ur.SIDES=6;var hr=function(e){function t(t,r){r=r||{},e.call(this,document.createElement("canvas")),this._width=0,this._height=0,this.svg=t,this.scale=r.scale||1,this._overrideWidth=r.width,this._overrideHeight=r.height,this._resolve=null,this._crossorigin=r.crossorigin,this._load=null,!1!==r.autoLoad&&this.load()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.load=function(){var e=this;return this._load||(this._load=new Promise((function(t){if(e._resolve=function(){e.resize(e.source.width,e.source.height),t(e)},/^\<svg/.test(e.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");e.svg="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(e.svg)))}e._loadSvg()}))),this._load},t.prototype._loadSvg=function(){var t=this,r=new Image;e.crossOrigin(r,this.svg,this._crossorigin),r.src=this.svg,r.onerror=function(e){r.onerror=null,t.onError.run(e)},r.onload=function(){var e=r.width,n=r.height;if(!e||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");var i=e*t.scale,o=n*t.scale;(t._overrideWidth||t._overrideHeight)&&(i=t._overrideWidth||t._overrideHeight/n*e,o=t._overrideHeight||t._overrideWidth/e*n),i=Math.round(i),o=Math.round(o);var s=t.source;s.width=i,s.height=o,s._pixiId="canvas_"+Ye(),s.getContext("2d").drawImage(r,0,0,e,n,0,0,i,o),t._resolve(),t._resolve=null}},t.getSize=function(e){var r=t.SVG_SIZE.exec(e),n={};return r&&(n[r[1]]=Math.round(parseFloat(r[3])),n[r[5]]=Math.round(parseFloat(r[7]))),n},t.prototype.dispose=function(){e.prototype.dispose.call(this),this._resolve=null,this._crossorigin=null},t.test=function(e,t){return"svg"===t||"string"==typeof e&&0===e.indexOf("data:image/svg+xml;base64")||"string"==typeof e&&0===e.indexOf("<svg")},t}(er);hr.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;var lr=function(e){function t(t,r){if(r=r||{},!(t instanceof HTMLVideoElement)){var n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]),e.crossOrigin(n,t[0].src||t[0],r.crossorigin);for(var i=0;i<t.length;++i){var o=document.createElement("source"),s=t[i],a=s.src,c=s.mime,u=(a=a||t[i]).split("?").shift().toLowerCase(),h=u.substr(u.lastIndexOf(".")+1);c=c||"video/"+h,o.src=a,o.type=c,n.appendChild(o)}t=n}e.call(this,t),this.noSubImage=!0,this._autoUpdate=!0,this._isAutoUpdating=!1,this._updateFPS=r.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==r.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==r.autoLoad&&this.load()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={autoUpdate:{configurable:!0},updateFPS:{configurable:!0}};return t.prototype.update=function(t){if(void 0===t&&(t=0),!this.destroyed){var r=qt.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-r),(!this._updateFPS||this._msToNextUpdate<=0)&&(e.prototype.update.call(this,t),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}},t.prototype.load=function(){var e=this;if(this._load)return this._load;var t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((function(r){e.valid?r(e):(e._resolve=r,t.load())})),this._load},t.prototype._onError=function(){this.source.removeEventListener("error",this._onError,!0),this.onError.run(event)},t.prototype._isSourcePlaying=function(){var e=this.source;return e.currentTime>0&&!1===e.paused&&!1===e.ended&&e.readyState>2},t.prototype._isSourceReady=function(){return 3===this.source.readyState||4===this.source.readyState},t.prototype._onPlayStart=function(){this.valid||this._onCanPlay(),!this._isAutoUpdating&&this.autoUpdate&&(qt.shared.add(this.update,this),this._isAutoUpdating=!0)},t.prototype._onPlayStop=function(){this._isAutoUpdating&&(qt.shared.remove(this.update,this),this._isAutoUpdating=!1)},t.prototype._onCanPlay=function(){var e=this.source;e.removeEventListener("canplay",this._onCanPlay),e.removeEventListener("canplaythrough",this._onCanPlay);var t=this.valid;this.resize(e.videoWidth,e.videoHeight),!t&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&e.play()},t.prototype.dispose=function(){this._isAutoUpdating&&qt.shared.remove(this.update,this),this.source&&(this.source.removeEventListener("error",this._onError,!0),this.source.pause(),this.source.src="",this.source.load()),e.prototype.dispose.call(this)},r.autoUpdate.get=function(){return this._autoUpdate},r.autoUpdate.set=function(e){e!==this._autoUpdate&&(this._autoUpdate=e,!this._autoUpdate&&this._isAutoUpdating?(qt.shared.remove(this.update,this),this._isAutoUpdating=!1):this._autoUpdate&&!this._isAutoUpdating&&(qt.shared.add(this.update,this),this._isAutoUpdating=!0))},r.updateFPS.get=function(){return this._updateFPS},r.updateFPS.set=function(e){e!==this._updateFPS&&(this._updateFPS=e)},t.test=function(e,r){return e instanceof HTMLVideoElement||t.TYPES.indexOf(r)>-1},Object.defineProperties(t.prototype,r),t}(er);lr.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"];var dr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.test=function(e){return!!window.createImageBitmap&&e instanceof ImageBitmap},t}(er);rr.push(tr,dr,cr,lr,hr,ir,ur,ar);var pr={INSTALLED:rr,autoDetectResource:nr,ArrayResource:ar,BufferResource:ir,CanvasResource:cr,CubeResource:ur,ImageResource:tr,ImageBitmapResource:dr,SVGResource:hr,VideoResource:lr,Resource:Qt,BaseImageResource:er},fr=function(e){this.renderer=e};fr.prototype.destroy=function(){this.renderer=null};var mr=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.upload=function(e,t,r){var n=e.gl;return n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),r.width===t.width&&r.height===t.height?n.texSubImage2D(t.target,0,0,0,t.width,t.height,t.format,t.type,this.data):(r.width=t.width,r.height=t.height,n.texImage2D(t.target,0,n.DEPTH_COMPONENT16,t.width,t.height,0,t.format,t.type,this.data)),!0},t}(ir),vr=function(e,t){this.width=Math.ceil(e||100),this.height=Math.ceil(t||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new zt("disposeFramebuffer",2)},gr={colorTexture:{configurable:!0}};gr.colorTexture.get=function(){return this.colorTextures[0]},vr.prototype.addColorTexture=function(e,t){return void 0===e&&(e=0),this.colorTextures[e]=t||new sr(null,{scaleMode:0,resolution:1,mipmap:!1,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this},vr.prototype.addDepthTexture=function(e){return this.depthTexture=e||new sr(new mr(null,{width:this.width,height:this.height}),{scaleMode:0,resolution:1,width:this.width,height:this.height,mipmap:!1,format:Te.DEPTH_COMPONENT,type:Ce.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this},vr.prototype.enableDepth=function(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this},vr.prototype.enableStencil=function(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this},vr.prototype.resize=function(e,t){if(e=Math.ceil(e),t=Math.ceil(t),e!==this.width||t!==this.height){this.width=e,this.height=t,this.dirtyId++,this.dirtySize++;for(var r=0;r<this.colorTextures.length;r++){var n=this.colorTextures[r],i=n.resolution;n.setSize(e/i,t/i)}if(this.depthTexture){var o=this.depthTexture.resolution;this.depthTexture.setSize(e/o,t/o)}}},vr.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Object.defineProperties(vr.prototype,gr);var yr=function(e){function t(t){"number"==typeof t&&(t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),e.call(this,null,t);var r=t||{},n=r.width,i=r.height;this.mipmap=!1,this.width=Math.ceil(n)||100,this.height=Math.ceil(i)||100,this.valid=!0,this._canvasRenderTarget=null,this.clearColor=[0,0,0,0],this.framebuffer=new vr(this.width*this.resolution,this.height*this.resolution).addColorTexture(0,this),this.stencilMaskStack=[],this.filterStack=[{}]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.resize=function(e,t){e=Math.ceil(e),t=Math.ceil(t),this.framebuffer.resize(e*this.resolution,t*this.resolution)},t.prototype.dispose=function(){this.framebuffer.dispose(),e.prototype.dispose.call(this)},t.prototype.destroy=function(){e.prototype.destroy.call(this,!0),this.framebuffer=null},t}(sr),_r=function(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)};_r.prototype.set=function(e,t,r){var n=t.width,i=t.height;if(r){var o=e.width/2/n,s=e.height/2/i,a=e.x/n+o,c=e.y/i+s;r=Et.add(r,Et.NW),this.x0=a+o*Et.uX(r),this.y0=c+s*Et.uY(r),r=Et.add(r,2),this.x1=a+o*Et.uX(r),this.y1=c+s*Et.uY(r),r=Et.add(r,2),this.x2=a+o*Et.uX(r),this.y2=c+s*Et.uY(r),r=Et.add(r,2),this.x3=a+o*Et.uX(r),this.y3=c+s*Et.uY(r)}else this.x0=e.x/n,this.y0=e.y/i,this.x1=(e.x+e.width)/n,this.y1=e.y/i,this.x2=(e.x+e.width)/n,this.y2=(e.y+e.height)/i,this.x3=e.x/n,this.y3=(e.y+e.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3};var br=new _r,xr=function(e){function t(r,n,i,o,s,a){if(e.call(this),this.noFrame=!1,n||(this.noFrame=!0,n=new Mt(0,0,1,1)),r instanceof t&&(r=r.baseTexture),this.baseTexture=r,this._frame=n,this.trim=o,this.valid=!1,this.requiresUpdate=!1,this._uvs=br,this.uvMatrix=null,this.orig=i||n,this._rotate=Number(s||0),!0===s)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=a?new lt(a.x,a.y):new lt(0,0),this._updateID=0,this.textureCacheIds=[],r.valid?this.noFrame?r.valid&&this.onBaseTextureUpdated(r):this.frame=n:r.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&r.on("update",this.onBaseTextureUpdated,this)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={resolution:{configurable:!0},frame:{configurable:!0},rotate:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return t.prototype.update=function(){this.baseTexture.resource&&this.baseTexture.resource.update()},t.prototype.onBaseTextureUpdated=function(e){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=e.width,this._frame.height=e.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)},t.prototype.destroy=function(e){if(this.baseTexture){if(e){var r=this.baseTexture.resource;r&&$e[r.url]&&t.removeFromCache(r.url),this.baseTexture.destroy()}this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,t.removeFromCache(this),this.textureCacheIds=null},t.prototype.clone=function(){return new t(this.baseTexture,this.frame,this.orig,this.trim,this.rotate,this.defaultAnchor)},t.prototype.updateUvs=function(){this._uvs===br&&(this._uvs=new _r),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++},t.from=function(e,r){void 0===r&&(r={});var n=null;"string"==typeof e?n=e:(e._pixiId||(e._pixiId="pixiid_"+Ye()),n=e._pixiId);var i=$e[n];return i||(r.resolution||(r.resolution=at(e)),(i=new t(new sr(e,r))).baseTexture.cacheId=n,sr.addToCache(i.baseTexture,n),t.addToCache(i,n)),i},t.fromBuffer=function(e,r,n,i){return new t(sr.fromBuffer(e,r,n,i))},t.fromLoader=function(e,r,n){var i=new tr(e);i.url=r;var o=new t(new sr(i,{scaleMode:v.SCALE_MODE,resolution:at(r)}));return n||(n=r),sr.addToCache(o.baseTexture,n),t.addToCache(o,n),n!==r&&(sr.addToCache(o.baseTexture,r),t.addToCache(o,r)),o},t.addToCache=function(e,t){t&&(-1===e.textureCacheIds.indexOf(t)&&e.textureCacheIds.push(t),$e[t]&&console.warn("Texture added to the cache with an id ["+t+"] that already had an entry"),$e[t]=e)},t.removeFromCache=function(e){if("string"==typeof e){var t=$e[e];if(t){var r=t.textureCacheIds.indexOf(e);return r>-1&&t.textureCacheIds.splice(r,1),delete $e[e],t}}else if(e&&e.textureCacheIds){for(var n=0;n<e.textureCacheIds.length;++n)$e[e.textureCacheIds[n]]===e&&delete $e[e.textureCacheIds[n]];return e.textureCacheIds.length=0,e}return null},r.resolution.get=function(){return this.baseTexture.resolution},r.frame.get=function(){return this._frame},r.frame.set=function(e){this._frame=e,this.noFrame=!1;var t=e.x,r=e.y,n=e.width,i=e.height,o=t+n>this.baseTexture.width,s=r+i>this.baseTexture.height;if(o||s){var a=o&&s?"and":"or",c="X: "+t+" + "+n+" = "+(t+n)+" > "+this.baseTexture.width,u="Y: "+r+" + "+i+" = "+(r+i)+" > "+this.baseTexture.height;throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: "+c+" "+a+" "+u)}this.valid=n&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=e),this.valid&&this.updateUvs()},r.rotate.get=function(){return this._rotate},r.rotate.set=function(e){this._rotate=e,this.valid&&this.updateUvs()},r.width.get=function(){return this.orig.width},r.height.get=function(){return this.orig.height},Object.defineProperties(t.prototype,r),t}(g);function wr(e){e.destroy=function(){},e.on=function(){},e.once=function(){},e.emit=function(){}}xr.EMPTY=new xr(new sr),wr(xr.EMPTY),wr(xr.EMPTY.baseTexture),xr.WHITE=function(){var e=document.createElement("canvas");e.width=16,e.height=16;var t=e.getContext("2d");return t.fillStyle="white",t.fillRect(0,0,16,16),new xr(new sr(new cr(e)))}(),wr(xr.WHITE),wr(xr.WHITE.baseTexture);var Tr=function(e){function t(t,r){var n=null;if(!(t instanceof yr)){var i=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4];console.warn("Please use RenderTexture.create("+i+", "+o+") instead of the ctor directly."),n=arguments[0],r=null,t=new yr({width:i,height:o,scaleMode:s,resolution:a})}e.call(this,t,r),this.legacyRenderer=n,this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.resize=function(e,t,r){void 0===r&&(r=!0),e=Math.ceil(e),t=Math.ceil(t),this.valid=e>0&&t>0,this._frame.width=this.orig.width=e,this._frame.height=this.orig.height=t,r&&this.baseTexture.resize(e,t),this.updateUvs()},t.prototype.setResolution=function(e){var t=this.baseTexture;t.resolution!==e&&(t.setResolution(e),this.resize(t.width,t.height,!1))},t.create=function(e){return"number"==typeof e&&(e={width:e,height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}),new t(new yr(e))},t}(xr),Sr=function(e){this.texturePool={},this.textureOptions=e||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0};Sr.prototype.createTexture=function(e,t){var r=new yr(Object.assign({width:e,height:t,resolution:1},this.textureOptions));return new Tr(r)},Sr.prototype.getOptimalTexture=function(e,t,r){void 0===r&&(r=1);var n=Sr.SCREEN_KEY;e*=r,t*=r,this.enableFullScreen&&e===this._pixelsWidth&&t===this._pixelsHeight||(n=(65535&(e=Je(e)))<<16|65535&(t=Je(t))),this.texturePool[n]||(this.texturePool[n]=[]);var i=this.texturePool[n].pop();return i||(i=this.createTexture(e,t)),i.filterPoolKey=n,i.setResolution(r),i},Sr.prototype.getFilterTexture=function(e,t){var r=this.getOptimalTexture(e.width,e.height,t||e.resolution);return r.filterFrame=e.filterFrame,r},Sr.prototype.returnTexture=function(e){var t=e.filterPoolKey;e.filterFrame=null,this.texturePool[t].push(e)},Sr.prototype.returnFilterTexture=function(e){this.returnTexture(e)},Sr.prototype.clear=function(e){if(e=!1!==e)for(var t in this.texturePool){var r=this.texturePool[t];if(r)for(var n=0;n<r.length;n++)r[n].destroy(!0)}this.texturePool={}},Sr.prototype.setScreenSize=function(e){if(e.width!==this._pixelsWidth||e.height!==this._pixelsHeight){var t=Sr.SCREEN_KEY,r=this.texturePool[t];if(this.enableFullScreen=e.width>0&&e.height>0,r)for(var n=0;n<r.length;n++)r[n].destroy(!0);this.texturePool[t]=[],this._pixelsWidth=e.width,this._pixelsHeight=e.height}},Sr.SCREEN_KEY="screen";var Cr=function(e,t,r,n,i,o,s){void 0===r&&(r=!1),void 0===n&&(n=5126),this.buffer=e,this.size=t,this.normalized=r,this.type=n,this.stride=i,this.start=o,this.instance=s};Cr.prototype.destroy=function(){this.buffer=null},Cr.from=function(e,t,r,n,i){return new Cr(e,t,r,n,i)};var Pr=0,Er=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=!1),this.data=e||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=r,this.static=t,this.id=Pr++,this.disposeRunner=new zt("disposeBuffer",2)};function Ir(e){if(4===e.BYTES_PER_ELEMENT)return e instanceof Float32Array?"Float32Array":e instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===e.BYTES_PER_ELEMENT){if(e instanceof Uint16Array)return"Uint16Array"}else if(1===e.BYTES_PER_ELEMENT&&e instanceof Uint8Array)return"Uint8Array";return null}Er.prototype.update=function(e){this.data=e||this.data,this._updateID++},Er.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Er.prototype.destroy=function(){this.dispose(),this.data=null},Er.from=function(e){return e instanceof Array&&(e=new Float32Array(e)),new Er(e)};var Ar={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array},Mr={5126:4,5123:2,5121:1},Or=0,Rr={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array},Dr=function(e,t){void 0===e&&(e=[]),void 0===t&&(t={}),this.buffers=e,this.indexBuffer=null,this.attributes=t,this.glVertexArrayObjects={},this.id=Or++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new zt("disposeGeometry",2),this.refCount=0};Dr.prototype.addAttribute=function(e,t,r,n,i,o,s,a){if(void 0===n&&(n=!1),void 0===a&&(a=!1),!t)throw new Error("You must pass a buffer when creating an attribute");t.data||(t instanceof Array&&(t=new Float32Array(t)),t=new Er(t));var c=e.split("|");if(c.length>1){for(var u=0;u<c.length;u++)this.addAttribute(c[u],t,r,n,i);return this}var h=this.buffers.indexOf(t);return-1===h&&(this.buffers.push(t),h=this.buffers.length-1),this.attributes[e]=new Cr(h,r,n,i,o,s,a),this.instanced=this.instanced||a,this},Dr.prototype.getAttribute=function(e){return this.attributes[e]},Dr.prototype.getBuffer=function(e){return this.buffers[this.getAttribute(e).buffer]},Dr.prototype.addIndex=function(e){return e.data||(e instanceof Array&&(e=new Uint16Array(e)),e=new Er(e)),e.index=!0,this.indexBuffer=e,-1===this.buffers.indexOf(e)&&this.buffers.push(e),this},Dr.prototype.getIndex=function(){return this.indexBuffer},Dr.prototype.interleave=function(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;var e,t=[],r=[],n=new Er;for(e in this.attributes){var i=this.attributes[e],o=this.buffers[i.buffer];t.push(o.data),r.push(i.size*Mr[i.type]/4),i.buffer=0}for(n.data=function(e,t){for(var r=0,n=0,i={},o=0;o<e.length;o++)n+=t[o],r+=e[o].length;for(var s=new ArrayBuffer(4*r),a=null,c=0,u=0;u<e.length;u++){var h=t[u],l=e[u],d=Ir(l);i[d]||(i[d]=new Ar[d](s)),a=i[d];for(var p=0;p<l.length;p++)a[(p/h|0)*n+c+p%h]=l[p];c+=h}return new Float32Array(s)}(t,r),e=0;e<this.buffers.length;e++)this.buffers[e]!==this.indexBuffer&&this.buffers[e].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this},Dr.prototype.getSize=function(){for(var e in this.attributes){var t=this.attributes[e];return this.buffers[t.buffer].data.length/(t.stride/4||t.size)}return 0},Dr.prototype.dispose=function(){this.disposeRunner.run(this,!1)},Dr.prototype.destroy=function(){this.dispose(),this.buffers=null,this.indexBuffer.destroy(),this.attributes=null},Dr.prototype.clone=function(){for(var e=new Dr,t=0;t<this.buffers.length;t++)e.buffers[t]=new Er(this.buffers[t].data.slice());for(var r in this.attributes){var n=this.attributes[r];e.attributes[r]=new Cr(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(e.indexBuffer=e.buffers[this.buffers.indexOf(this.indexBuffer)],e.indexBuffer.index=!0),e},Dr.merge=function(e){for(var t,r=new Dr,n=[],i=[],o=[],s=0;s<e.length;s++){t=e[s];for(var a=0;a<t.buffers.length;a++)i[a]=i[a]||0,i[a]+=t.buffers[a].data.length,o[a]=0}for(var c=0;c<t.buffers.length;c++)n[c]=new(Rr[Ir(t.buffers[c].data)])(i[c]),r.buffers[c]=new Er(n[c]);for(var u=0;u<e.length;u++){t=e[u];for(var h=0;h<t.buffers.length;h++)n[h].set(t.buffers[h].data,o[h]),o[h]+=t.buffers[h].data.length}if(r.attributes=t.attributes,t.indexBuffer){r.indexBuffer=r.buffers[t.buffers.indexOf(t.indexBuffer)],r.indexBuffer.index=!0;for(var l=0,d=0,p=0,f=0,m=0;m<t.buffers.length;m++)if(t.buffers[m]!==t.indexBuffer){f=m;break}for(var v in t.attributes){var g=t.attributes[v];(0|g.buffer)===f&&(d+=g.size*Mr[g.type]/4)}for(var y=0;y<e.length;y++){for(var _=e[y].indexBuffer.data,b=0;b<_.length;b++)r.indexBuffer.data[b+p]+=l;l+=t.buffers[f].data.length/d,p+=_.length}}return r};var kr=function(e){function t(){e.call(this),this.addAttribute("aVertexPosition",[0,0,1,0,1,1,0,1]).addIndex([0,1,3,2])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Dr),Lr=function(e){function t(){e.call(this),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new Er(this.vertices),this.uvBuffer=new Er(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.map=function(e,t){var r=0,n=0;return this.uvs[0]=r,this.uvs[1]=n,this.uvs[2]=r+t.width/e.width,this.uvs[3]=n,this.uvs[4]=r+t.width/e.width,this.uvs[5]=n+t.height/e.height,this.uvs[6]=r,this.uvs[7]=n+t.height/e.height,r=t.x,n=t.y,this.vertices[0]=r,this.vertices[1]=n,this.vertices[2]=r+t.width,this.vertices[3]=n,this.vertices[4]=r+t.width,this.vertices[5]=n+t.height,this.vertices[6]=r,this.vertices[7]=n+t.height,this.invalidate(),this},t.prototype.invalidate=function(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this},t}(Dr),Br=0,Fr=function(e,t){this.uniforms=e,this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=Br++,this.static=!!t};Fr.prototype.update=function(){this.dirtyId++},Fr.prototype.add=function(e,t,r){this.uniforms[e]=new Fr(t,r)},Fr.from=function(e,t){return new Fr(e,t)};var Nr=function(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.sourceFrame=new Mt,this.destinationFrame=new Mt,this.filters=[]};Nr.prototype.clear=function(){this.target=null,this.filters=null,this.renderTexture=null};var jr=function(e){function t(t){e.call(this,t),this.defaultFilterStack=[{}],this.texturePool=new Sr,this.texturePool.setScreenSize(t.view),this.statePool=[],this.quad=new kr,this.quadUv=new Lr,this.tempRect=new Mt,this.activeState={},this.globalUniforms=new Fr({outputFrame:this.tempRect,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this._pixelsWidth=t.view.width,this._pixelsHeight=t.view.height}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.push=function(e,t){for(var r=this.renderer,n=this.defaultFilterStack,i=this.statePool.pop()||new Nr,o=t[0].resolution,s=t[0].padding,a=t[0].autoFit,c=t[0].legacy,u=1;u<t.length;u++){var h=t[u];o=Math.min(o,h.resolution),s=Math.max(s,h.padding),a=a||h.autoFit,c=c||h.legacy}1===n.length&&(this.defaultFilterStack[0].renderTexture=r.renderTexture.current),n.push(i),i.resolution=o,i.legacy=c,i.target=e,i.sourceFrame.copyFrom(e.filterArea||e.getBounds(!0)),i.sourceFrame.pad(s),a&&i.sourceFrame.fit(this.renderer.renderTexture.sourceFrame),i.sourceFrame.ceil(o),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o),i.filters=t,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height,i.renderTexture.filterFrame=i.sourceFrame,r.renderTexture.bind(i.renderTexture,i.sourceFrame),r.renderTexture.clear()},t.prototype.pop=function(){var e=this.defaultFilterStack,t=e.pop(),r=t.filters;this.activeState=t;var n=this.globalUniforms.uniforms;n.outputFrame=t.sourceFrame,n.resolution=t.resolution;var i=n.inputSize,o=n.inputPixel,s=n.inputClamp;if(i[0]=t.destinationFrame.width,i[1]=t.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],o[0]=i[0]*t.resolution,o[1]=i[1]*t.resolution,o[2]=1/o[0],o[3]=1/o[1],s[0]=.5*o[2],s[1]=.5*o[3],s[2]=t.sourceFrame.width*i[2]-.5*o[2],s[3]=t.sourceFrame.height*i[3]-.5*o[3],t.legacy){var a=n.filterArea;a[0]=t.destinationFrame.width,a[1]=t.destinationFrame.height,a[2]=t.sourceFrame.x,a[3]=t.sourceFrame.y,n.filterClamp=n.inputClamp}this.globalUniforms.update();var c=e[e.length-1];if(1===r.length)r[0].apply(this,t.renderTexture,c.renderTexture,!1,t),this.returnFilterTexture(t.renderTexture);else{var u=t.renderTexture,h=this.getOptimalFilterTexture(u.width,u.height,t.resolution);h.filterFrame=u.filterFrame;var l=0;for(l=0;l<r.length-1;++l){r[l].apply(this,u,h,!0,t);var d=u;u=h,h=d}r[l].apply(this,u,c.renderTexture,!1,t),this.returnFilterTexture(u),this.returnFilterTexture(h)}t.clear(),this.statePool.push(t)},t.prototype.applyFilter=function(e,t,r,n){var i=this.renderer;i.renderTexture.bind(r,r?r.filterFrame:null),n&&i.renderTexture.clear(),e.uniforms.uSampler=t,e.uniforms.filterGlobals=this.globalUniforms,i.state.set(e.state),i.shader.bind(e),e.legacy?(this.quadUv.map(t._frame,t.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(we.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(we.TRIANGLE_STRIP))},t.prototype.calculateSpriteMatrix=function(e,t){var r=this.activeState,n=r.sourceFrame,i=r.destinationFrame,o=t._texture.orig,s=e.set(i.width,0,0,i.height,n.x,n.y),a=t.worldTransform.copyTo(yt.TEMP_MATRIX);return a.invert(),s.prepend(a),s.scale(1/o.width,1/o.height),s.translate(t.anchor.x,t.anchor.y),s},t.prototype.destroy=function(){this.texturePool.clear(!1)},t.prototype.getOptimalFilterTexture=function(e,t,r){return void 0===r&&(r=1),this.texturePool.getOptimalTexture(e,t,r)},t.prototype.getFilterTexture=function(e,t){if("number"==typeof e){var r=e;e=t,t=r}e=e||this.activeState.renderTexture;var n=this.texturePool.getOptimalTexture(e.width,e.height,t||e.resolution);return n.filterFrame=e.filterFrame,n},t.prototype.returnFilterTexture=function(e){this.texturePool.returnTexture(e)},t.prototype.emptyPool=function(){this.texturePool.clear(!0)},t.prototype.resize=function(){this.texturePool.setScreenSize(this.renderer.view)},t}(fr),Ur=function(e){this.renderer=e};Ur.prototype.flush=function(){},Ur.prototype.destroy=function(){this.renderer=null},Ur.prototype.start=function(){},Ur.prototype.stop=function(){this.flush()},Ur.prototype.render=function(e){};var Gr=function(e){function t(t){e.call(this,t),this.emptyRenderer=new Ur(t),this.currentRenderer=this.emptyRenderer}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setObjectRenderer=function(e){this.currentRenderer!==e&&(this.currentRenderer.stop(),this.currentRenderer=e,this.currentRenderer.start())},t.prototype.flush=function(){this.setObjectRenderer(this.emptyRenderer)},t.prototype.reset=function(){this.setObjectRenderer(this.emptyRenderer)},t}(fr);v.PREFER_ENV=m.any?_e.WEBGL:_e.WEBGL2;var Xr=0,Vr=function(e){function t(t){e.call(this,t),this.webGLVersion=1,this.extensions={},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),t.view.addEventListener("webglcontextlost",this.handleContextLost,!1),t.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={isLost:{configurable:!0}};return r.isLost.get=function(){return!this.gl||this.gl.isContextLost()},t.prototype.contextChange=function(e){this.gl=e,this.renderer.gl=e,this.renderer.CONTEXT_UID=Xr++,e.isContextLost()&&e.getExtension("WEBGL_lose_context")&&e.getExtension("WEBGL_lose_context").restoreContext()},t.prototype.initFromContext=function(e){this.gl=e,this.validateContext(e),this.renderer.gl=e,this.renderer.CONTEXT_UID=Xr++,this.renderer.runners.contextChange.run(e)},t.prototype.initFromOptions=function(e){var t=this.createContext(this.renderer.view,e);this.initFromContext(t)},t.prototype.createContext=function(e,t){var r;if(v.PREFER_ENV>=_e.WEBGL2&&(r=e.getContext("webgl2",t)),r)this.webGLVersion=2;else if(this.webGLVersion=1,!(r=e.getContext("webgl",t)||e.getContext("experimental-webgl",t)))throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=r,this.getExtensions(),r},t.prototype.getExtensions=function(){var e=this.gl;1===this.webGLVersion?Object.assign(this.extensions,{drawBuffers:e.getExtension("WEBGL_draw_buffers"),depthTexture:e.getExtension("WEBKIT_WEBGL_depth_texture"),loseContext:e.getExtension("WEBGL_lose_context"),vertexArrayObject:e.getExtension("OES_vertex_array_object")||e.getExtension("MOZ_OES_vertex_array_object")||e.getExtension("WEBKIT_OES_vertex_array_object"),anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),uint32ElementIndex:e.getExtension("OES_element_index_uint"),floatTexture:e.getExtension("OES_texture_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear"),textureHalfFloat:e.getExtension("OES_texture_half_float"),textureHalfFloatLinear:e.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,{anisotropicFiltering:e.getExtension("EXT_texture_filter_anisotropic"),colorBufferFloat:e.getExtension("EXT_color_buffer_float"),floatTextureLinear:e.getExtension("OES_texture_float_linear")})},t.prototype.handleContextLost=function(e){e.preventDefault()},t.prototype.handleContextRestored=function(){this.renderer.runners.contextChange.run(this.gl)},t.prototype.destroy=function(){var e=this.renderer.view;e.removeEventListener("webglcontextlost",this.handleContextLost),e.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()},t.prototype.postrender=function(){this.gl.flush()},t.prototype.validateContext=function(e){e.getContextAttributes().stencil||console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly")},Object.defineProperties(t.prototype,r),t}(fr),zr=function(e){function t(t){e.call(this,t),this.managedFramebuffers=[],this.unknownFramebuffer=new vr(10,10)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={size:{configurable:!0}};return t.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new Mt,this.hasMRT=!0,this.writeDepthTexture=!0,this.disposeAll(!0),1===this.renderer.context.webGLVersion){var t=this.renderer.context.extensions.drawBuffers,r=this.renderer.context.extensions.depthTexture;v.PREFER_ENV===_e.WEBGL_LEGACY&&(t=null,r=null),t?e.drawBuffers=function(e){return t.drawBuffersWEBGL(e)}:(this.hasMRT=!1,e.drawBuffers=function(){}),r||(this.writeDepthTexture=!1)}},t.prototype.bind=function(e,t){var r=this.gl;if(e){var n=e.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(e);this.current!==e&&(this.current=e,r.bindFramebuffer(r.FRAMEBUFFER,n.framebuffer)),n.dirtyId!==e.dirtyId&&(n.dirtyId=e.dirtyId,n.dirtyFormat!==e.dirtyFormat?(n.dirtyFormat=e.dirtyFormat,this.updateFramebuffer(e)):n.dirtySize!==e.dirtySize&&(n.dirtySize=e.dirtySize,this.resizeFramebuffer(e)));for(var i=0;i<e.colorTextures.length;i++)e.colorTextures[i].texturePart?this.renderer.texture.unbind(e.colorTextures[i].texture):this.renderer.texture.unbind(e.colorTextures[i]);e.depthTexture&&this.renderer.texture.unbind(e.depthTexture),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,e.width,e.height)}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),t?this.setViewport(t.x,t.y,t.width,t.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)},t.prototype.setViewport=function(e,t,r,n){var i=this.viewport;i.width===r&&i.height===n&&i.x===e&&i.y===t||(i.x=e,i.y=t,i.width=r,i.height=n,this.gl.viewport(e,t,r,n))},r.size.get=function(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}},t.prototype.clear=function(e,t,r,n){var i=this.gl;i.clearColor(e,t,r,n),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},t.prototype.initFramebuffer=function(e){var t={framebuffer:this.gl.createFramebuffer(),stencil:null,dirtyId:0,dirtyFormat:0,dirtySize:0};return e.glFramebuffers[this.CONTEXT_UID]=t,this.managedFramebuffers.push(e),e.disposeRunner.add(this),t},t.prototype.resizeFramebuffer=function(e){var t=this.gl,r=e.glFramebuffers[this.CONTEXT_UID];r.stencil&&(t.bindRenderbuffer(t.RENDERBUFFER,r.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height));for(var n=e.colorTextures,i=0;i<n.length;i++)this.renderer.texture.bind(n[i],0);e.depthTexture&&this.renderer.texture.bind(e.depthTexture,0)},t.prototype.updateFramebuffer=function(e){var t=this.gl,r=e.glFramebuffers[this.CONTEXT_UID],n=e.colorTextures.length;t.drawBuffers||(n=Math.min(n,1));for(var i=[],o=0;o<n;o++){var s=e.colorTextures[o];s.texturePart?(this.renderer.texture.bind(s.texture,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+o,t.TEXTURE_CUBE_MAP_NEGATIVE_X+s.side,s.texture._glTextures[this.CONTEXT_UID].texture,0)):(this.renderer.texture.bind(s,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+o,t.TEXTURE_2D,s._glTextures[this.CONTEXT_UID].texture,0)),i.push(t.COLOR_ATTACHMENT0+o)}if(i.length>1&&t.drawBuffers(i),e.depthTexture&&this.writeDepthTexture){var a=e.depthTexture;this.renderer.texture.bind(a,0),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,a._glTextures[this.CONTEXT_UID].texture,0)}r.stencil||!e.stencil&&!e.depth||(r.stencil=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,r.stencil),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,e.width,e.height),e.depthTexture||t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,r.stencil))},t.prototype.disposeFramebuffer=function(e,t){var r=e.glFramebuffers[this.CONTEXT_UID],n=this.gl;if(r){delete e.glFramebuffers[this.CONTEXT_UID];var i=this.managedFramebuffers.indexOf(e);i>=0&&this.managedFramebuffers.splice(i,1),e.disposeRunner.remove(this),t||(n.deleteFramebuffer(r.framebuffer),r.stencil&&n.deleteRenderbuffer(r.stencil))}},t.prototype.disposeAll=function(e){var t=this.managedFramebuffers;this.managedFramebuffers=[];for(var r=0;r<t.length;r++)this.disposeFramebuffer(t[r],e)},t.prototype.forceStencil=function(){var e=this.current;if(e){var t=e.glFramebuffers[this.CONTEXT_UID];if(t&&!t.stencil){e.enableStencil();var r=e.width,n=e.height,i=this.gl,o=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,o),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,r,n),t.stencil=o,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,o)}}},t.prototype.reset=function(){this.current=this.unknownFramebuffer,this.viewport=new Mt},Object.defineProperties(t.prototype,r),t}(fr),Hr=function(e){this.buffer=e,this.updateID=-1,this.byteLength=-1,this.refCount=0},Wr={5126:4,5123:2,5121:1},Yr=function(e){function t(t){e.call(this,t),this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.boundBuffers={},this.managedGeometries={},this.managedBuffers={}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contextChange=function(){this.disposeAll(!0);var e=this.gl=this.renderer.gl,t=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,!e.createVertexArray){var r=this.renderer.context.extensions.vertexArrayObject;v.PREFER_ENV===_e.WEBGL_LEGACY&&(r=null),r?(e.createVertexArray=function(){return r.createVertexArrayOES()},e.bindVertexArray=function(e){return r.bindVertexArrayOES(e)},e.deleteVertexArray=function(e){return r.deleteVertexArrayOES(e)}):(this.hasVao=!1,e.createVertexArray=function(){},e.bindVertexArray=function(){},e.deleteVertexArray=function(){})}if(!e.vertexAttribDivisor){var n=e.getExtension("ANGLE_instanced_arrays");n?(e.vertexAttribDivisor=function(e,t){return n.vertexAttribDivisorANGLE(e,t)},e.drawElementsInstanced=function(e,t,r,i,o){return n.drawElementsInstancedANGLE(e,t,r,i,o)},e.drawArraysInstanced=function(e,t,r,i){return n.drawArraysInstancedANGLE(e,t,r,i)}):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===t.webGLVersion||!!t.extensions.uint32ElementIndex},t.prototype.bind=function(e,t){t=t||this.renderer.shader.shader;var r=this.gl,n=e.glVertexArrayObjects[this.CONTEXT_UID];n||(this.managedGeometries[e.id]=e,e.disposeRunner.add(this),e.glVertexArrayObjects[this.CONTEXT_UID]=n={});var i=n[t.program.id]||this.initGeometryVao(e,t.program);this._activeGeometry=e,this._activeVao!==i&&(this._activeVao=i,this.hasVao?r.bindVertexArray(i):this.activateVao(e,t.program)),this.updateBuffers()},t.prototype.reset=function(){this.unbind()},t.prototype.updateBuffers=function(){for(var e=this._activeGeometry,t=this.gl,r=0;r<e.buffers.length;r++){var n=e.buffers[r],i=n._glBuffers[this.CONTEXT_UID];if(n._updateID!==i.updateID){i.updateID=n._updateID;var o=n.index?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER;if(t.bindBuffer(o,i.buffer),this._boundBuffer=i,i.byteLength>=n.data.byteLength)t.bufferSubData(o,0,n.data);else{var s=n.static?t.STATIC_DRAW:t.DYNAMIC_DRAW;i.byteLength=n.data.byteLength,t.bufferData(o,n.data,s)}}}},t.prototype.checkCompatibility=function(e,t){var r=e.attributes,n=t.attributeData;for(var i in n)if(!r[i])throw new Error('shader and geometry incompatible, geometry missing the "'+i+'" attribute')},t.prototype.getSignature=function(e,t){var r=e.attributes,n=t.attributeData,i=["g",e.id];for(var o in r)n[o]&&i.push(o);return i.join("-")},t.prototype.initGeometryVao=function(e,t){this.checkCompatibility(e,t);var r=this.gl,n=this.CONTEXT_UID,i=this.getSignature(e,t),o=e.glVertexArrayObjects[this.CONTEXT_UID],s=o[i];if(s)return o[t.id]=s,s;var a=e.buffers,c=e.attributes,u={},h={};for(var l in a)u[l]=0,h[l]=0;for(var d in c)!c[d].size&&t.attributeData[d]?c[d].size=t.attributeData[d].size:c[d].size||console.warn("PIXI Geometry attribute '"+d+"' size cannot be determined (likely the bound shader does not have the attribute)"),u[c[d].buffer]+=c[d].size*Wr[c[d].type];for(var p in c){var f=c[p],m=f.size;void 0===f.stride&&(u[f.buffer]===m*Wr[f.type]?f.stride=0:f.stride=u[f.buffer]),void 0===f.start&&(f.start=h[f.buffer],h[f.buffer]+=m*Wr[f.type])}s=r.createVertexArray(),r.bindVertexArray(s);for(var v=0;v<a.length;v++){var g=a[v];g._glBuffers[n]||(g._glBuffers[n]=new Hr(r.createBuffer()),this.managedBuffers[g.id]=g,g.disposeRunner.add(this)),g._glBuffers[n].refCount++}return this.activateVao(e,t),this._activeVao=s,o[t.id]=s,o[i]=s,s},t.prototype.disposeBuffer=function(e,t){if(this.managedBuffers[e.id]){delete this.managedBuffers[e.id];var r=e._glBuffers[this.CONTEXT_UID],n=this.gl;e.disposeRunner.remove(this),r&&(t||n.deleteBuffer(r.buffer),delete e._glBuffers[this.CONTEXT_UID])}},t.prototype.disposeGeometry=function(e,t){if(this.managedGeometries[e.id]){delete this.managedGeometries[e.id];var r=e.glVertexArrayObjects[this.CONTEXT_UID],n=this.gl,i=e.buffers;if(e.disposeRunner.remove(this),r){for(var o=0;o<i.length;o++){var s=i[o]._glBuffers[this.CONTEXT_UID];s.refCount--,0!==s.refCount||t||this.disposeBuffer(i[o],t)}if(!t)for(var a in r)if("g"===a[0]){var c=r[a];this._activeVao===c&&this.unbind(),n.deleteVertexArray(c)}delete e.glVertexArrayObjects[this.CONTEXT_UID]}}},t.prototype.disposeAll=function(e){for(var t=Object.keys(this.managedGeometries),r=0;r<t.length;r++)this.disposeGeometry(this.managedGeometries[t[r]],e);t=Object.keys(this.managedBuffers);for(var n=0;n<t.length;n++)this.disposeBuffer(this.managedBuffers[t[n]],e)},t.prototype.activateVao=function(e,t){var r=this.gl,n=this.CONTEXT_UID,i=e.buffers,o=e.attributes;e.indexBuffer&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.indexBuffer._glBuffers[n].buffer);var s=null;for(var a in o){var c=o[a],u=i[c.buffer]._glBuffers[n];if(t.attributeData[a]){s!==u&&(r.bindBuffer(r.ARRAY_BUFFER,u.buffer),s=u);var h=t.attributeData[a].location;if(r.enableVertexAttribArray(h),r.vertexAttribPointer(h,c.size,c.type||r.FLOAT,c.normalized,c.stride,c.start),c.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");r.vertexAttribDivisor(h,1)}}}},t.prototype.draw=function(e,t,r,n){var i=this.gl,o=this._activeGeometry;if(o.indexBuffer){var s=o.indexBuffer.data.BYTES_PER_ELEMENT,a=2===s?i.UNSIGNED_SHORT:i.UNSIGNED_INT;2===s||4===s&&this.canUseUInt32ElementIndex?o.instanced?i.drawElementsInstanced(e,t||o.indexBuffer.data.length,a,(r||0)*s,n||1):i.drawElements(e,t||o.indexBuffer.data.length,a,(r||0)*s):console.warn("unsupported index buffer type: uint32")}else o.instanced?i.drawArraysInstanced(e,r,t||o.getSize(),n||1):i.drawArrays(e,r,t||o.getSize());return this},t.prototype.unbind=function(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null},t}(fr);function qr(e,t,r,n){var i=Jr(e,e.VERTEX_SHADER,t),o=Jr(e,e.FRAGMENT_SHADER,r),s=e.createProgram();if(e.attachShader(s,i),e.attachShader(s,o),n)for(var a in n)e.bindAttribLocation(s,n[a],a);return e.linkProgram(s),e.getProgramParameter(s,e.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",e.getProgramParameter(s,e.VALIDATE_STATUS)),console.error("gl.getError()",e.getError()),""!==e.getProgramInfoLog(s)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",e.getProgramInfoLog(s)),e.deleteProgram(s),s=null),e.deleteShader(i),e.deleteShader(o),s}function Jr(e,t,r){var n=e.createShader(t);return e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS)?n:(console.warn(r),console.error(e.getShaderInfoLog(n)),null)}function Kr(e,t){switch(e){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"bool":return!1;case"bvec2":return Zr(2*t);case"bvec3":return Zr(3*t);case"bvec4":return Zr(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}function Zr(e){for(var t=new Array(e),r=0;r<t.length;r++)t[r]=!1;return t}var Qr,$r={},en=$r;function tn(){if(en===$r||en.isContextLost()){var e,t=document.createElement("canvas");v.PREFER_ENV>=_e.WEBGL2&&(e=t.getContext("webgl2",{})),e||((e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}))?e.getExtension("WEBGL_draw_buffers"):e=null),en=e}return en}function rn(e,t,r){if("precision"!==e.substring(0,9)){var n=t;return t===Me.HIGH&&r!==Me.HIGH&&(n=Me.MEDIUM),"precision "+n+" float;\n"+e}return r!==Me.HIGH&&"precision highp"===e.substring(0,15)?e.replace("precision highp","precision mediump"):e}var nn={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function on(e){return nn[e]}var sn=null,an={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray"};function cn(e,t){if(!sn){var r=Object.keys(an);sn={};for(var n=0;n<r.length;++n){var i=r[n];sn[e[i]]=an[i]}}return sn[t]}var un,hn={float:"\n    if(cv !== v)\n    {\n        cv.v = v;\n        gl.uniform1f(location, v)\n    }",vec2:"\n    if(cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"gl.uniform4f(location, v[0], v[1], v[2], v[3])",int:"gl.uniform1i(location, v)",ivec2:"gl.uniform2i(location, v[0], v[1])",ivec3:"gl.uniform3i(location, v[0], v[1], v[2])",ivec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",bool:"gl.uniform1i(location, v)",bvec2:"gl.uniform2i(location, v[0], v[1])",bvec3:"gl.uniform3i(location, v[0], v[1], v[2])",bvec4:"gl.uniform4i(location, v[0], v[1], v[2], v[3])",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"gl.uniform1i(location, v)",samplerCube:"gl.uniform1i(location, v)",sampler2DArray:"gl.uniform1i(location, v)"},ln={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"},dn=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function pn(e,t){if(0===e)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");for(var r=t.createShader(t.FRAGMENT_SHADER);;){var n=dn.replace(/%forloop%/gi,fn(e));if(t.shaderSource(r,n),t.compileShader(r),t.getShaderParameter(r,t.COMPILE_STATUS))break;e=e/2|0}return e}function fn(e){for(var t="",r=0;r<e;++r)r>0&&(t+="\nelse "),r<e-1&&(t+="if(test == "+r+".0){}");return t}var mn=0,vn={},gn=function e(t,r,n){void 0===n&&(n="pixi-shader"),this.id=mn++,this.vertexSrc=t||e.defaultVertexSrc,this.fragmentSrc=r||e.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),vn[n]?(vn[n]++,n+="-"+vn[n]):vn[n]=1,this.vertexSrc="#define SHADER_NAME "+n+"\n"+this.vertexSrc,this.fragmentSrc="#define SHADER_NAME "+n+"\n"+this.fragmentSrc,this.vertexSrc=rn(this.vertexSrc,v.PRECISION_VERTEX,Me.HIGH),this.fragmentSrc=rn(this.fragmentSrc,v.PRECISION_FRAGMENT,function(){if(!Qr){Qr=Me.MEDIUM;var e=tn();if(e&&e.getShaderPrecisionFormat){var t=e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT);Qr=t.precision?Me.HIGH:Me.MEDIUM}}return Qr}())),this.extractData(this.vertexSrc,this.fragmentSrc),this.glPrograms={},this.syncUniforms=null},yn={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};gn.prototype.extractData=function(e,t){var r=tn();if(r){var n=qr(r,e,t);this.attributeData=this.getAttributeData(n,r),this.uniformData=this.getUniformData(n,r),r.deleteProgram(n)}else this.uniformData={},this.attributeData={}},gn.prototype.getAttributeData=function(e,t){for(var r={},n=[],i=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),o=0;o<i;o++){var s=t.getActiveAttrib(e,o),a=cn(t,s.type),c={type:a,name:s.name,size:on(a),location:0};r[s.name]=c,n.push(c)}n.sort((function(e,t){return e.name>t.name?1:-1}));for(var u=0;u<n.length;u++)n[u].location=u;return r},gn.prototype.getUniformData=function(e,t){for(var r={},n=t.getProgramParameter(e,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var o=t.getActiveUniform(e,i),s=o.name.replace(/\[.*?\]/,""),a=o.name.match(/\[.*?\]/,""),c=cn(t,o.type);r[s]={type:c,size:o.size,isArray:a,value:Kr(c,o.size)}}return r},yn.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"},yn.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"},gn.from=function(e,t,r){var n=e+t,i=Qe[n];return i||(Qe[n]=i=new gn(e,t,r)),i},Object.defineProperties(gn,yn);var _n=function(e,t){for(var r in this.program=e,this.uniformGroup=t?t instanceof Fr?t:new Fr(t):new Fr({}),e.uniformData)this.uniformGroup.uniforms[r]instanceof Array&&(this.uniformGroup.uniforms[r]=new Float32Array(this.uniformGroup.uniforms[r]))},bn={uniforms:{configurable:!0}};_n.prototype.checkUniformExists=function(e,t){if(t.uniforms[e])return!0;for(var r in t.uniforms){var n=t.uniforms[r];if(n.group&&this.checkUniformExists(e,n))return!0}return!1},_n.prototype.destroy=function(){this.uniformGroup=null},bn.uniforms.get=function(){return this.uniformGroup.uniforms},_n.from=function(e,t,r){var n=gn.from(e,t);return new _n(n,r)},Object.defineProperties(_n.prototype,bn);var xn=function(){this.data=0,this.blendMode=xe.NORMAL,this.polygonOffset=0,this.blend=!0},wn={blend:{configurable:!0},offsets:{configurable:!0},culling:{configurable:!0},depthTest:{configurable:!0},clockwiseFrontFace:{configurable:!0},blendMode:{configurable:!0},polygonOffset:{configurable:!0}};wn.blend.get=function(){return!!(1&this.data)},wn.blend.set=function(e){!!(1&this.data)!==e&&(this.data^=1)},wn.offsets.get=function(){return!!(2&this.data)},wn.offsets.set=function(e){!!(2&this.data)!==e&&(this.data^=2)},wn.culling.get=function(){return!!(4&this.data)},wn.culling.set=function(e){!!(4&this.data)!==e&&(this.data^=4)},wn.depthTest.get=function(){return!!(8&this.data)},wn.depthTest.set=function(e){!!(8&this.data)!==e&&(this.data^=8)},wn.clockwiseFrontFace.get=function(){return!!(16&this.data)},wn.clockwiseFrontFace.set=function(e){!!(16&this.data)!==e&&(this.data^=16)},wn.blendMode.get=function(){return this._blendMode},wn.blendMode.set=function(e){this.blend=e!==xe.NONE,this._blendMode=e},wn.polygonOffset.get=function(){return this._polygonOffset},wn.polygonOffset.set=function(e){this.offsets=!!e,this._polygonOffset=e},xn.for2d=function(){var e=new xn;return e.depthTest=!1,e.blend=!0,e},Object.defineProperties(xn.prototype,wn);var Tn=function(e){function t(r,n,i){var o=gn.from(r||t.defaultVertexSrc,n||t.defaultFragmentSrc);e.call(this,o,i),this.padding=0,this.resolution=v.FILTER_RESOLUTION,this.enabled=!0,this.autoFit=!0,this.legacy=!!this.program.attributeData.aTextureCoord,this.state=new xn}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={blendMode:{configurable:!0}},n={defaultVertexSrc:{configurable:!0},defaultFragmentSrc:{configurable:!0}};return t.prototype.apply=function(e,t,r,n,i){e.applyFilter(this,t,r,n,i)},r.blendMode.get=function(){return this.state.blendMode},r.blendMode.set=function(e){this.state.blendMode=e},n.defaultVertexSrc.get=function(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"},n.defaultFragmentSrc.get=function(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"},Object.defineProperties(t.prototype,r),Object.defineProperties(t,n),t}(_n);Tn.SOURCE_KEY_MAP={};var Sn=new yt,Cn=function(e,t){this._texture=e,this.mapCoord=new yt,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._updateID=-1,this.clampOffset=0,this.clampMargin=void 0===t?.5:t,this.isSimple=!1},Pn={texture:{configurable:!0}};Pn.texture.get=function(){return this._texture},Pn.texture.set=function(e){this._texture=e,this._updateID=-1},Cn.prototype.multiplyUvs=function(e,t){void 0===t&&(t=e);for(var r=this.mapCoord,n=0;n<e.length;n+=2){var i=e[n],o=e[n+1];t[n]=i*r.a+o*r.c+r.tx,t[n+1]=i*r.b+o*r.d+r.ty}return t},Cn.prototype.update=function(e){var t=this._texture;if(!t||!t.valid)return!1;if(!e&&this._updateID===t._updateID)return!1;this._updateID=t._updateID;var r=t._uvs;this.mapCoord.set(r.x1-r.x0,r.y1-r.y0,r.x3-r.x0,r.y3-r.y0,r.x0,r.y0);var n=t.orig,i=t.trim;i&&(Sn.set(n.width/i.width,0,0,n.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(Sn));var o=t.baseTexture,s=this.uClampFrame,a=this.clampMargin/o.resolution,c=this.clampOffset;return s[0]=(t._frame.x+a+c)/o.width,s[1]=(t._frame.y+a+c)/o.height,s[2]=(t._frame.x+t._frame.width-a+c)/o.width,s[3]=(t._frame.y+t._frame.height-a+c)/o.height,this.uClampOffset[0]=c/o.realWidth,this.uClampOffset[1]=c/o.realHeight,this.isSimple=t._frame.width===o.width&&t._frame.height===o.height&&0===t.rotate,!0},Object.defineProperties(Cn.prototype,Pn);var En=function(e){function t(t){var r=new yt;e.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n"),t.renderable=!1,this.maskSprite=t,this.maskMatrix=r}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.apply=function(e,t,r,n){var i=this.maskSprite,o=this.maskSprite.texture;o.valid&&(o.transform||(o.transform=new Cn(o,0)),o.transform.update(),this.uniforms.npmAlpha=o.baseTexture.premultiplyAlpha?0:1,this.uniforms.mask=o,this.uniforms.otherMatrix=e.calculateSpriteMatrix(this.maskMatrix,i).prepend(o.transform.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=o.transform.uClampFrame,e.applyFilter(this,t,r,n))},t}(Tn),In=function(e){function t(t){e.call(this,t),this.scissor=!1,this.scissorData=null,this.scissorRenderTarget=null,this.enableScissor=!1,this.alphaMaskPool=[],this.alphaMaskIndex=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.push=function(e,t){if(t.isSprite)this.pushSpriteMask(e,t);else if(this.enableScissor&&!this.scissor&&this.renderer._activeRenderTarget.root&&!this.renderer.stencil.stencilMaskStack.length&&t.isFastRect()){var r=t.worldTransform,n=Math.atan2(r.b,r.a);(n=Math.round(n*(180/Math.PI)))%90?this.pushStencilMask(t):this.pushScissorMask(e,t)}else this.pushStencilMask(t)},t.prototype.pop=function(e,t){t.isSprite?this.popSpriteMask(e,t):this.enableScissor&&!this.renderer.stencil.stencilMaskStack.length?this.popScissorMask(e,t):this.popStencilMask(e,t)},t.prototype.pushSpriteMask=function(e,t){var r=this.alphaMaskPool[this.alphaMaskIndex];r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new En(t)]),r[0].resolution=this.renderer.resolution,r[0].maskSprite=t;var n=e.filterArea;e.filterArea=t.getBounds(!0),this.renderer.filter.push(e,r),e.filterArea=n,this.alphaMaskIndex++},t.prototype.popSpriteMask=function(){this.renderer.filter.pop(),this.alphaMaskIndex--},t.prototype.pushStencilMask=function(e){this.renderer.batch.flush(),this.renderer.stencil.pushStencil(e)},t.prototype.popStencilMask=function(){this.renderer.stencil.popStencil()},t.prototype.pushScissorMask=function(e,t){t.renderable=!0;var r=this.renderer._activeRenderTarget,n=t.getBounds();n.fit(r.size),t.renderable=!1,this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);var i=this.renderer.resolution;this.renderer.gl.scissor(n.x*i,(r.root?r.size.height-n.y-n.height:n.y)*i,n.width*i,n.height*i),this.scissorRenderTarget=r,this.scissorData=t,this.scissor=!0},t.prototype.popScissorMask=function(){this.scissorRenderTarget=null,this.scissorData=null,this.scissor=!1;var e=this.renderer.gl;e.disable(e.SCISSOR_TEST)},t}(fr),An=function(e){function t(t){e.call(this,t),this.stencilMaskStack=[]}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setMaskStack=function(e){var t=this.renderer.gl,r=this.stencilMaskStack.length;this.stencilMaskStack=e,e.length!==r&&(0===e.length?t.disable(t.STENCIL_TEST):(t.enable(t.STENCIL_TEST),this._useCurrent()))},t.prototype.pushStencil=function(e){var t=this.renderer.gl,r=this.stencilMaskStack.length;0===r&&(this.renderer.framebuffer.forceStencil(),t.enable(t.STENCIL_TEST)),this.stencilMaskStack.push(e),t.colorMask(!1,!1,!1,!1),t.stencilFunc(t.EQUAL,r,this._getBitwiseMask()),t.stencilOp(t.KEEP,t.KEEP,t.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,this._useCurrent()},t.prototype.popStencil=function(){var e=this.renderer.gl,t=this.stencilMaskStack.pop();0===this.stencilMaskStack.length?(e.disable(e.STENCIL_TEST),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(0)):(e.colorMask(!1,!1,!1,!1),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,this._useCurrent())},t.prototype._useCurrent=function(){var e=this.renderer.gl;e.colorMask(!0,!0,!0,!0),e.stencilFunc(e.EQUAL,this.stencilMaskStack.length,this._getBitwiseMask()),e.stencilOp(e.KEEP,e.KEEP,e.KEEP)},t.prototype._getBitwiseMask=function(){return(1<<this.stencilMaskStack.length)-1},t.prototype.destroy=function(){e.prototype.destroy.call(this,this),this.stencilMaskStack=null},t}(fr),Mn=function(e){function t(t){e.call(this,t),this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new yt,this.transform=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.update=function(e,t,r,n){this.destinationFrame=e||this.destinationFrame||this.defaultFrame,this.sourceFrame=t||this.sourceFrame||e,this.calculateProjection(this.destinationFrame,this.sourceFrame,r,n),this.transform&&this.projectionMatrix.append(this.transform);var i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)},t.prototype.calculateProjection=function(e,t,r,n){var i=this.projectionMatrix;n?(i.a=1/e.width*2*r,i.d=-1/e.height*2*r,i.tx=-1-t.x*i.a,i.ty=1-t.y*i.d):(i.a=1/e.width*2*r,i.d=1/e.height*2*r,i.tx=-1-t.x*i.a,i.ty=-1-t.y*i.d)},t.prototype.setTransform=function(){},t}(fr),On=new Mt,Rn=function(e){function t(t){e.call(this,t),this.clearColor=t._backgroundColorRgba,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new Mt,this.destinationFrame=new Mt}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.bind=function(e,t,r){void 0===e&&(e=null),this.current=e;var n,i=this.renderer;if(e){var o=e.baseTexture;n=o.resolution,r||(On.width=o.realWidth,On.height=o.realHeight,r=On),t||(t=r),this.renderer.framebuffer.bind(o.framebuffer,r),this.renderer.projection.update(r,t,n,!1),this.renderer.stencil.setMaskStack(o.stencilMaskStack)}else n=this.renderer.resolution,r||(On.width=i.width,On.height=i.height,r=On),t||(t=r),i.framebuffer.bind(null,r),this.renderer.projection.update(r,t,n,!0),this.renderer.stencil.setMaskStack(this.defaultMaskStack);this.sourceFrame.copyFrom(t),this.destinationFrame.x=r.x/n,this.destinationFrame.y=r.y/n,this.destinationFrame.width=r.width/n,this.destinationFrame.height=r.height/n,t===r&&this.sourceFrame.copyFrom(this.destinationFrame)},t.prototype.clear=function(e){e=this.current?e||this.current.baseTexture.clearColor:e||this.clearColor,this.renderer.framebuffer.clear(e[0],e[1],e[2],e[3])},t.prototype.resize=function(){this.bind(null)},t.prototype.reset=function(){this.bind(null)},t}(fr),Dn=function(e,t){this.program=e,this.uniformData=t,this.uniformGroups={}};Dn.prototype.destroy=function(){this.uniformData=null,this.uniformGroups=null,this.program=null};var kn=0,Ln=function(e){function t(t){e.call(this,t),this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this.id=kn++}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.systemCheck=function(){if(!function(){if("boolean"==typeof un)return un;try{var e=new Function("param1","param2","param3","return param1[param2] === param3;");un=!0===e({a:"b"},"a","b")}catch(e){un=!1}return un}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")},t.prototype.contextChange=function(e){this.gl=e,this.reset()},t.prototype.bind=function(e,t){e.uniforms.globals=this.renderer.globalUniforms;var r=e.program,n=r.glPrograms[this.renderer.CONTEXT_UID]||this.generateShader(e);return this.shader=e,this.program!==r&&(this.program=r,this.gl.useProgram(n.program)),t||this.syncUniformGroup(e.uniformGroup),n},t.prototype.setUniforms=function(e){var t=this.shader.program,r=t.glPrograms[this.renderer.CONTEXT_UID];t.syncUniforms(r.uniformData,e,this.renderer)},t.prototype.syncUniformGroup=function(e){var t=this.getglProgram();e.static&&e.dirtyId===t.uniformGroups[e.id]||(t.uniformGroups[e.id]=e.dirtyId,this.syncUniforms(e,t))},t.prototype.syncUniforms=function(e,t){(e.syncUniforms[this.shader.program.id]||this.createSyncGroups(e))(t.uniformData,e.uniforms,this.renderer)},t.prototype.createSyncGroups=function(e){var t=this.getSignature(e,this.shader.program.uniformData);return this.cache[t]||(this.cache[t]=function(e,t){var r=0,n="var v = null;\n    var cv = null\n    var gl = renderer.gl";for(var i in e.uniforms){var o=t[i];o?"float"===o.type&&1===o.size?n+="\n            if(uv."+i+" !== ud."+i+".value)\n            {\n                ud."+i+".value = uv."+i+"\n                gl.uniform1f(ud."+i+".location, uv."+i+")\n            }\n":"sampler2D"!==o.type&&"samplerCube"!==o.type&&"sampler2DArray"!==o.type||1!==o.size||o.isArray?"mat3"===o.type&&1===o.size?void 0!==e.uniforms[i].a?n+="\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+".toArray(true));\n                \n":n+="\n                gl.uniformMatrix3fv(ud."+i+".location, false, uv."+i+");\n                \n":"vec2"===o.type&&1===o.size?void 0!==e.uniforms[i].x?n+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud."+i+".location, v.x, v.y);\n                }\n":n+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud."+i+".location, v[0], v[1]);\n                }\n                \n":"vec4"===o.type&&1===o.size?void 0!==e.uniforms[i].width?n+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud."+i+".location, v.x, v.y, v.width, v.height)\n                }\n":n+="\n                cv = ud."+i+".value;\n                v = uv."+i+";\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud."+i+".location, v[0], v[1], v[2], v[3])\n                }\n                \n":n+="\n            cv = ud."+i+".value;\n            v = uv."+i+";\n            "+(1===o.size?hn:ln)[o.type].replace("location","ud."+i+".location")+";\n":(n+="\n            renderer.texture.bind(uv."+i+", "+r+");\n\n            if(ud."+i+".value !== "+r+")\n            {\n                ud."+i+".value = "+r+";\n                gl.uniform1i(ud."+i+".location, "+r+");\n; // eslint-disable-line max-len\n            }\n",r++):e.uniforms[i].group&&(n+="\n                    renderer.shader.syncUniformGroup(uv."+i+");\n                ")}return new Function("ud","uv","renderer",n)}(e,this.shader.program.uniformData)),e.syncUniforms[this.shader.program.id]=this.cache[t],e.syncUniforms[this.shader.program.id]},t.prototype.getSignature=function(e,t){var r=e.uniforms,n=[];for(var i in r)n.push(i),t[i]&&n.push(t[i].type);return n.join("-")},t.prototype.getglProgram=function(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null},t.prototype.generateShader=function(e){var t=this.gl,r=e.program,n={};for(var i in r.attributeData)n[i]=r.attributeData[i].location;var o=qr(t,r.vertexSrc,r.fragmentSrc,n),s={};for(var a in r.uniformData){var c=r.uniformData[a];s[a]={location:t.getUniformLocation(o,a),value:Kr(c.type,c.size)}}var u=new Dn(o,s);return r.glPrograms[this.renderer.CONTEXT_UID]=u,u},t.prototype.reset=function(){this.program=null,this.shader=null},t.prototype.destroy=function(){this.destroyed=!0},t}(fr),Bn=function(e){function t(t){e.call(this,t),this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=xe.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.checks=[],this.defaultState=new xn,this.defaultState.blend=!0,this.defaultState.depth=!0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contextChange=function(e){this.gl=e,this.blendModes=function(e,t){return void 0===t&&(t=[]),t[xe.NORMAL]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.ADD]=[e.ONE,e.ONE],t[xe.MULTIPLY]=[e.DST_COLOR,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.SCREEN]=[e.ONE,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.OVERLAY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.DARKEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.LIGHTEN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.COLOR_DODGE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.COLOR_BURN]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.HARD_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.SOFT_LIGHT]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.DIFFERENCE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.EXCLUSION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.HUE]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.SATURATION]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.COLOR]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.LUMINOSITY]=[e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.NONE]=[0,0],t[xe.NORMAL_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.ADD_NPM]=[e.SRC_ALPHA,e.ONE,e.ONE,e.ONE],t[xe.SCREEN_NPM]=[e.SRC_ALPHA,e.ONE_MINUS_SRC_COLOR,e.ONE,e.ONE_MINUS_SRC_ALPHA],t[xe.SRC_IN]=[e.DST_ALPHA,e.ZERO],t[xe.SRC_OUT]=[e.ONE_MINUS_DST_ALPHA,e.ZERO],t[xe.SRC_ATOP]=[e.DST_ALPHA,e.ONE_MINUS_SRC_ALPHA],t[xe.DST_OVER]=[e.ONE_MINUS_DST_ALPHA,e.ONE],t[xe.DST_IN]=[e.ZERO,e.SRC_ALPHA],t[xe.DST_OUT]=[e.ZERO,e.ONE_MINUS_SRC_ALPHA],t[xe.DST_ATOP]=[e.ONE_MINUS_DST_ALPHA,e.SRC_ALPHA],t[xe.SUBTRACT]=[e.ONE,e.ONE,e.ONE,e.ONE,e.FUNC_REVERSE_SUBTRACT,e.FUNC_ADD],t}(e),this.set(this.defaultState),this.reset()},t.prototype.set=function(e){if(e=e||this.defaultState,this.stateId!==e.data){for(var t=this.stateId^e.data,r=0;t;)1&t&&this.map[r].call(this,!!(e.data&1<<r)),t>>=1,r++;this.stateId=e.data}for(var n=0;n<this.checks.length;n++)this.checks[n](this,e)},t.prototype.forceState=function(e){e=e||this.defaultState;for(var t=0;t<this.map.length;t++)this.map[t].call(this,!!(e.data&1<<t));for(var r=0;r<this.checks.length;r++)this.checks[r](this,e);this.stateId=e.data},t.prototype.setBlend=function(e){this.updateCheck(t.checkBlendMode,e),this.gl[e?"enable":"disable"](this.gl.BLEND)},t.prototype.setOffset=function(e){this.updateCheck(t.checkPolygonOffset,e),this.gl[e?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)},t.prototype.setDepthTest=function(e){this.gl[e?"enable":"disable"](this.gl.DEPTH_TEST)},t.prototype.setCullFace=function(e){this.gl[e?"enable":"disable"](this.gl.CULL_FACE)},t.prototype.setFrontFace=function(e){this.gl.frontFace(this.gl[e?"CW":"CCW"])},t.prototype.setBlendMode=function(e){if(e!==this.blendMode){this.blendMode=e;var t=this.blendModes[e],r=this.gl;2===t.length?r.blendFunc(t[0],t[1]):r.blendFuncSeparate(t[0],t[1],t[2],t[3]),6===t.length?(this._blendEq=!0,r.blendEquationSeparate(t[4],t[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}},t.prototype.setPolygonOffset=function(e,t){this.gl.polygonOffset(e,t)},t.prototype.reset=function(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(0),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)},t.prototype.updateCheck=function(e,t){var r=this.checks.indexOf(e);t&&-1===r?this.checks.push(e):t||-1===r||this.checks.splice(r,1)},t.checkBlendMode=function(e,t){e.setBlendMode(t.blendMode)},t.checkPolygonOffset=function(e,t){e.setPolygonOffset(t.polygonOffset,0)},t}(fr),Fn=function(e){function t(t){e.call(this,t),this.count=0,this.checkCount=0,this.maxIdle=v.GC_MAX_IDLE,this.checkCountMax=v.GC_MAX_CHECK_COUNT,this.mode=v.GC_MODE}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.postrender=function(){this.count++,this.mode!==Ae.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run()))},t.prototype.run=function(){for(var e=this.renderer.texture,t=e.managedTextures,r=!1,n=0;n<t.length;n++){var i=t[n];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(e.destroyTexture(i,!0),t[n]=null,r=!0)}if(r){for(var o=0,s=0;s<t.length;s++)null!==t[s]&&(t[o++]=t[s]);t.length=o}},t.prototype.unload=function(e){var t=this.renderer.textureSystem;e._texture&&e._texture._glRenderTargets&&t.destroyTexture(e._texture);for(var r=e.children.length-1;r>=0;r--)this.unload(e.children[r])},t}(fr),Nn=function(e){this.texture=e,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=6408,this.internalFormat=5121},jn=function(e){function t(t){e.call(this,t),this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new sr}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contextChange=function(){var e=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion;var t=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=t;for(var r=0;r<t;r++)this.boundTextures[r]=null;this.emptyTextures={};var n=new Nn(e.createTexture());e.bindTexture(e.TEXTURE_2D,n.texture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[e.TEXTURE_2D]=n,this.emptyTextures[e.TEXTURE_CUBE_MAP]=new Nn(e.createTexture()),e.bindTexture(e.TEXTURE_CUBE_MAP,this.emptyTextures[e.TEXTURE_CUBE_MAP].texture);for(var i=0;i<6;i++)e.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,null);e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_CUBE_MAP,e.TEXTURE_MIN_FILTER,e.LINEAR);for(var o=0;o<this.boundTextures.length;o++)this.bind(null,o)},t.prototype.bind=function(e,t){void 0===t&&(t=0);var r=this.gl;if(e){if((e=e.baseTexture||e).valid){e.touched=this.renderer.textureGC.count;var n=e._glTextures[this.CONTEXT_UID]||this.initTexture(e);this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),this.boundTextures[t]!==e&&r.bindTexture(e.target,n.texture),n.dirtyId!==e.dirtyId&&this.updateTexture(e),this.boundTextures[t]=e}}else this.currentLocation!==t&&(this.currentLocation=t,r.activeTexture(r.TEXTURE0+t)),r.bindTexture(r.TEXTURE_2D,this.emptyTextures[r.TEXTURE_2D].texture),this.boundTextures[t]=null},t.prototype.reset=function(){this._unknownBoundTextures=!0,this.currentLocation=-1;for(var e=0;e<this.boundTextures.length;e++)this.boundTextures[e]=this.unknownTexture},t.prototype.unbind=function(e){var t=this.gl,r=this.boundTextures;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(var n=0;n<r.length;n++)r[n]===this.unknownTexture&&this.bind(null,n)}for(var i=0;i<r.length;i++)r[i]===e&&(this.currentLocation!==i&&(t.activeTexture(t.TEXTURE0+i),this.currentLocation=i),t.bindTexture(t.TEXTURE_2D,this.emptyTextures[e.target].texture),r[i]=null)},t.prototype.initTexture=function(e){var t=new Nn(this.gl.createTexture());return t.dirtyId=-1,e._glTextures[this.CONTEXT_UID]=t,this.managedTextures.push(e),e.on("dispose",this.destroyTexture,this),t},t.prototype.initTextureType=function(e,t){if(t.internalFormat=e.format,t.type=e.type,2===this.webGLVersion){var r=this.renderer.gl;e.type===r.FLOAT&&e.format===r.RGBA&&(t.internalFormat=r.RGBA32F),e.type===Ce.HALF_FLOAT&&(t.type=r.HALF_FLOAT),t.type===r.HALF_FLOAT&&e.format===r.RGBA&&(t.internalFormat=r.RGBA16F)}},t.prototype.updateTexture=function(e){var t=e._glTextures[this.CONTEXT_UID];if(t){var r=this.renderer;if(this.initTextureType(e,t),e.resource&&e.resource.upload(r,e,t));else{var n=e.realWidth,i=e.realHeight,o=r.gl;(t.width!==n||t.height!==i||t.dirtyId<0)&&(t.width=n,t.height=i,o.texImage2D(e.target,0,t.internalFormat,n,i,0,e.format,t.type,null))}e.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(e),t.dirtyId=e.dirtyId}},t.prototype.destroyTexture=function(e,t){var r=this.gl;if((e=e.baseTexture||e)._glTextures[this.CONTEXT_UID]&&(this.unbind(e),r.deleteTexture(e._glTextures[this.CONTEXT_UID].texture),e.off("dispose",this.destroyTexture,this),delete e._glTextures[this.CONTEXT_UID],!t)){var n=this.managedTextures.indexOf(e);-1!==n&&He(this.managedTextures,n,1)}},t.prototype.updateTextureStyle=function(e){var t=e._glTextures[this.CONTEXT_UID];t&&(e.mipmap!==Ie.POW2&&2===this.webGLVersion||e.isPowerOfTwo?(t.mipmap=e.mipmap>=1,t.wrapMode=e.wrapMode):(t.mipmap=0,t.wrapMode=Ee.CLAMP),e.resource&&e.resource.style(this.renderer,e,t)||this.setStyle(e,t),t.dirtyStyleId=e.dirtyStyleId)},t.prototype.setStyle=function(e,t){var r=this.gl;if(t.mipmap&&r.generateMipmap(e.target),r.texParameteri(e.target,r.TEXTURE_WRAP_S,t.wrapMode),r.texParameteri(e.target,r.TEXTURE_WRAP_T,t.wrapMode),t.mipmap){r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode?r.LINEAR_MIPMAP_LINEAR:r.NEAREST_MIPMAP_NEAREST);var n=this.renderer.context.extensions.anisotropicFiltering;if(n&&e.anisotropicLevel>0&&e.scaleMode===Pe.LINEAR){var i=Math.min(e.anisotropicLevel,r.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT));r.texParameterf(e.target,n.TEXTURE_MAX_ANISOTROPY_EXT,i)}}else r.texParameteri(e.target,r.TEXTURE_MIN_FILTER,e.scaleMode?r.LINEAR:r.NEAREST);r.texParameteri(e.target,r.TEXTURE_MAG_FILTER,e.scaleMode?r.LINEAR:r.NEAREST)},t}(fr),Un={FilterSystem:jr,BatchSystem:Gr,ContextSystem:Vr,FramebufferSystem:zr,GeometrySystem:Yr,MaskSystem:In,StencilSystem:An,ProjectionSystem:Mn,RenderTextureSystem:Rn,ShaderSystem:Ln,StateSystem:Bn,TextureGCSystem:Fn,TextureSystem:jn},Gn=new yt,Xn=function(e){function t(t,r){e.call(this),(r=Object.assign({},v.RENDER_OPTIONS,r)).roundPixels&&(v.ROUND_PIXELS=r.roundPixels,ut("5.0.0","Renderer roundPixels option is deprecated, please use PIXI.settings.ROUND_PIXELS",2)),this.options=r,this.type=be.UNKNOWN,this.screen=new Mt(0,0,r.width,r.height),this.view=r.view||document.createElement("canvas"),this.resolution=r.resolution||v.RESOLUTION,this.transparent=r.transparent,this.autoDensity=r.autoDensity||r.autoResize||!1,this.preserveDrawingBuffer=r.preserveDrawingBuffer,this.clearBeforeRender=r.clearBeforeRender,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,0],this._backgroundColorString="#000000",this.backgroundColor=r.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent=new Ut,this._lastObjectRendered=this._tempDisplayObjectParent,this.plugins={}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={width:{configurable:!0},height:{configurable:!0},backgroundColor:{configurable:!0}};return t.prototype.initPlugins=function(e){for(var t in e)this.plugins[t]=new e[t](this)},r.width.get=function(){return this.view.width},r.height.get=function(){return this.view.height},t.prototype.resize=function(e,t){this.screen.width=e,this.screen.height=t,this.view.width=e*this.resolution,this.view.height=t*this.resolution,this.autoDensity&&(this.view.style.width=e+"px",this.view.style.height=t+"px")},t.prototype.generateTexture=function(e,t,r,n){0===(n=n||e.getLocalBounds()).width&&(n.width=1),0===n.height&&(n.height=1);var i=Tr.create(0|n.width,0|n.height,t,r);return Gn.tx=-n.x,Gn.ty=-n.y,this.render(e,i,!1,Gn,!!e.parent),i},t.prototype.destroy=function(e){for(var t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null;e&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.plugins=null,this.type=be.UNKNOWN,this.view=null,this.screen=null,this.resolution=0,this.transparent=!1,this.autoDensity=!1,this.blendModes=null,this.options=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this._backgroundColor=0,this._backgroundColorRgba=null,this._backgroundColorString=null,this._tempDisplayObjectParent=null,this._lastObjectRendered=null},r.backgroundColor.get=function(){return this._backgroundColor},r.backgroundColor.set=function(e){this._backgroundColor=e,this._backgroundColorString=Be(e),Le(e,this._backgroundColorRgba)},Object.defineProperties(t.prototype,r),t}(g),Vn=function(e){function t(r){void 0===r&&(r={}),e.call(this,"WebGL",r),r=this.options,this.type=be.WEBGL,this.gl=null,this.CONTEXT_UID=0,this.runners={destroy:new zt("destroy"),contextChange:new zt("contextChange",1),reset:new zt("reset"),update:new zt("update"),postrender:new zt("postrender"),prerender:new zt("prerender"),resize:new zt("resize",2)},this.globalUniforms=new Fr({projectionMatrix:new yt},!0),this.addSystem(In,"mask").addSystem(Vr,"context").addSystem(Bn,"state").addSystem(Ln,"shader").addSystem(jn,"texture").addSystem(Yr,"geometry").addSystem(zr,"framebuffer").addSystem(An,"stencil").addSystem(Mn,"projection").addSystem(Fn,"textureGC").addSystem(jr,"filter").addSystem(Rn,"renderTexture").addSystem(Gr,"batch"),this.initPlugins(t.__plugins),r.context?this.context.initFromContext(r.context):this.context.initFromOptions({alpha:this.transparent,antialias:r.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:r.preserveDrawingBuffer,powerPreference:this.options.powerPreference}),this.renderingToScreen=!0,De(2===this.context.webGLVersion?"WebGL 2":"WebGL 1"),this.resize(this.options.width,this.options.height)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.create=function(e){if(ke())return new t(e);throw new Error('WebGL unsupported in this browser, use "pixi.js-legacy" for fallback canvas2d support.')},t.prototype.addSystem=function(e,t){t||(t=e.name);var r=new e(this);if(this[t])throw new Error('Whoops! The name "'+t+'" is already in use');for(var n in this[t]=r,this.runners)this.runners[n].add(r);return this},t.prototype.render=function(e,t,r,n,i){if(this.renderingToScreen=!t,this.runners.prerender.run(),this.emit("prerender"),this.projection.transform=n,!this.context.isLost){if(t||(this._lastObjectRendered=e),!i){var o=e.parent;e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=o}this.renderTexture.bind(t),this.batch.currentRenderer.start(),(void 0!==r?r:this.clearBeforeRender)&&this.renderTexture.clear(),e.render(this),this.batch.currentRenderer.flush(),t&&t.baseTexture.update(),this.runners.postrender.run(),this.projection.transform=null,this.emit("postrender")}},t.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this.runners.resize.run(t,r)},t.prototype.reset=function(){return this.runners.reset.run(),this},t.prototype.clear=function(){this.framebuffer.bind(),this.framebuffer.clear()},t.prototype.destroy=function(t){for(var r in this.runners.destroy.run(),this.runners)this.runners[r].destroy();e.prototype.destroy.call(this,t),this.gl=null},t.registerPlugin=function(e,r){t.__plugins=t.__plugins||{},t.__plugins[e]=r},t}(Xn);function zn(e){return Vn.create(e)}var Hn="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}",Wn="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n",Yn=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.from=function(e,r){return new t(new ur(e,r))},t}(sr),qn=function(){this.textures=[],this.ids=[],this.blend=0,this.textureCount=0,this.start=0,this.size=0,this.type=4},Jn=function(e){this.rawBinaryData=new ArrayBuffer(e),this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)},Kn={int8View:{configurable:!0},uint8View:{configurable:!0},int16View:{configurable:!0},uint16View:{configurable:!0},int32View:{configurable:!0}};Kn.int8View.get=function(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View},Kn.uint8View.get=function(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View},Kn.int16View.get=function(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View},Kn.uint16View.get=function(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View},Kn.int32View.get=function(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View},Jn.prototype.view=function(e){return this[e+"View"]},Jn.prototype.destroy=function(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null},Jn.sizeOf=function(e){switch(e){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(e+" isn't a valid view type")}},Object.defineProperties(Jn.prototype,Kn);var Zn=function(e){function t(t){e.call(this,t),this.shaderGenerator=null,this.geometryClass=null,this.vertexSize=null,this.state=xn.for2d(),this.size=8e3,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._drawCalls=[];for(var r=0;r<this.size/4;r++)this._drawCalls[r]=new qn;this._aBuffers={},this._iBuffers={},this.MAX_TEXTURES=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contextChange=function(){var e=this.renderer.gl;v.PREFER_ENV===_e.WEBGL_LEGACY?this.MAX_TEXTURES=1:(this.MAX_TEXTURES=Math.min(e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),v.SPRITE_MAX_TEXTURES),this.MAX_TEXTURES=pn(this.MAX_TEXTURES,e)),this._shader=this.shaderGenerator.generateShader(this.MAX_TEXTURES);for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]=new this.geometryClass},t.prototype.onPrerender=function(){this._flushId=0},t.prototype.render=function(e){e._texture.valid&&(this._vertexCount+e.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=e.vertexData.length/2,this._indexCount+=e.indices.length,this._bufferedElements[this._bufferSize++]=e)},t.prototype.flush=function(){if(0!==this._vertexCount){var e,t,r=this.getAttributeBuffer(this._vertexCount),n=this.getIndexBuffer(this._indexCount),i=this.renderer.gl,o=this._bufferedElements,s=this._drawCalls,a=this.MAX_TEXTURES,c=this._packedGeometries,u=this.vertexSize,h=this.renderer.textureGC.count,l=0,d=0,p=0,f=s[0],m=0,g=-1;f.textureCount=0,f.start=0,f.blend=g;var y,_=++sr._globalBatch;for(y=0;y<this._bufferSize;++y){var b=o[y];o[y]=null,e=b._texture.baseTexture;var x=je[e.premultiplyAlpha?1:0][b.blendMode];g!==x&&(g=x,t=null,p=a,_++),t!==e&&(t=e,e._batchEnabled!==_&&(p===a&&(_++,p=0,f.size=d-f.start,(f=s[m++]).textureCount=0,f.blend=g,f.start=d),e.touched=h,e._batchEnabled=_,e._id=p,f.textures[f.textureCount++]=e,p++)),this.packInterleavedGeometry(b,r,n,l,d),l+=b.vertexData.length/2*u,d+=b.indices.length}sr._globalBatch=_,f.size=d-f.start,v.CAN_UPLOAD_SAME_BUFFER?(c[this._flushId]._buffer.update(r.rawBinaryData,0),c[this._flushId]._indexBuffer.update(n,0),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,c[this._flushId]=new this.geometryClass),c[this._flushId]._buffer.update(r.rawBinaryData,0),c[this._flushId]._indexBuffer.update(n,0),this.renderer.geometry.bind(c[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++);var w=this.renderer.texture,T=this.renderer.state;for(y=0;y<m;y++){for(var S=s[y],C=S.textureCount,P=0;P<C;P++)w.bind(S.textures[P],P),S.textures[P]=null;T.setBlendMode(S.blend),i.drawElements(S.type,S.size,i.UNSIGNED_SHORT,2*S.start)}this._bufferSize=0,this._vertexCount=0,this._indexCount=0}},t.prototype.start=function(){this.renderer.state.set(this.state),this.renderer.shader.bind(this._shader),v.CAN_UPLOAD_SAME_BUFFER&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])},t.prototype.stop=function(){this.flush()},t.prototype.destroy=function(){for(var t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._drawCalls=null,this._shader&&(this._shader.destroy(),this._shader=null),e.prototype.destroy.call(this)},t.prototype.getAttributeBuffer=function(e){var t=Je(Math.ceil(e/8)),r=Ze(t),n=8*t;this._aBuffers.length<=r&&(this._iBuffers.length=r+1);var i=this._aBuffers[n];return i||(this._aBuffers[n]=i=new Jn(n*this.vertexSize*4)),i},t.prototype.getIndexBuffer=function(e){var t=Je(Math.ceil(e/12)),r=Ze(t),n=12*t;this._iBuffers.length<=r&&(this._iBuffers.length=r+1);var i=this._iBuffers[r];return i||(this._iBuffers[r]=i=new Uint16Array(n)),i},t.prototype.packInterleavedGeometry=function(e,t,r,n,i){for(var o=t.uint32View,s=t.float32View,a=n/this.vertexSize,c=e.uvs,u=e.indices,h=e.vertexData,l=e._texture.baseTexture._id,d=Math.min(e.worldAlpha,1),p=d<1&&e._texture.baseTexture.premultiplyAlpha?Xe(e._tintRGB,d):e._tintRGB+(255*d<<24),f=0;f<h.length;f+=2)s[n++]=h[f],s[n++]=h[f+1],s[n++]=c[f],s[n++]=c[f+1],o[n++]=p,s[n++]=l;for(var m=0;m<u.length;m++)r[i++]=a+u[m]},t}(Ur),Qn=function(e,t){if(this.vertexSrc=e,this.fragTemplate=t,this.programCache={},this.defaultGroupCache={},t.indexOf("%count%")<0)throw new Error('Fragment template must contain "%count%".');if(t.indexOf("%forloop%")<0)throw new Error('Fragment template must contain "%forloop%".')};Qn.prototype.generateShader=function(e){if(!this.programCache[e]){for(var t=new Int32Array(e),r=0;r<e;r++)t[r]=r;this.defaultGroupCache[e]=Fr.from({uSamplers:t},!0);var n=this.fragTemplate;n=(n=n.replace(/%count%/gi,""+e)).replace(/%forloop%/gi,this.generateSampleSrc(e)),this.programCache[e]=new gn(this.vertexSrc,n)}var i={tint:new Float32Array([1,1,1,1]),translationMatrix:new yt,default:this.defaultGroupCache[e]};return new _n(this.programCache[e],i)},Qn.prototype.generateSampleSrc=function(e){var t="";t+="\n",t+="\n";for(var r=0;r<e;r++)r>0&&(t+="\nelse "),r<e-1&&(t+="if(vTextureId < "+r+".5)"),t+="\n{",t+="\n\tcolor = texture2D(uSamplers["+r+"], vTextureCoord);",t+="\n}";return(t+="\n")+"\n"};var $n=function(e){function t(t){void 0===t&&(t=!1),e.call(this),this._buffer=new Er(null,t,!1),this._indexBuffer=new Er(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,Ce.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,Ce.FLOAT).addAttribute("aColor",this._buffer,4,!0,Ce.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,Ce.FLOAT).addIndex(this._indexBuffer)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Dr),ei="precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n",ti="varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n",ri=function(){},ni={defaultVertexSrc:{configurable:!0},defaultFragmentTemplate:{configurable:!0}};ri.create=function(e){var t=Object.assign({vertex:ei,fragment:ti,geometryClass:$n,vertexSize:6},e),r=t.vertex,n=t.fragment,i=t.vertexSize,o=t.geometryClass;return function(e){function t(t){e.call(this,t),this.shaderGenerator=new Qn(r,n),this.geometryClass=o,this.vertexSize=i}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Zn)},ni.defaultVertexSrc.get=function(){return ei},ni.defaultFragmentTemplate.get=function(){return ti},Object.defineProperties(ri,ni);var ii=ri.create(),oi=new Mt,si=function(e){this.renderer=e,e.extract=this};si.prototype.image=function(e,t,r){var n=new Image;return n.src=this.base64(e,t,r),n},si.prototype.base64=function(e,t,r){return this.canvas(e).toDataURL(t,r)},si.prototype.canvas=function(e){var t,r,n,i=this.renderer,o=!1,s=!1;e&&(e instanceof Tr?n=e:(n=this.renderer.generateTexture(e),s=!0)),n?(t=n.baseTexture.resolution,r=n.frame,o=!1,i.renderTexture.bind(n)):(t=this.renderer.resolution,o=!0,(r=oi).width=this.renderer.width,r.height=this.renderer.height,i.renderTexture.bind(null));var a=Math.floor(r.width*t),c=Math.floor(r.height*t),u=new rt(a,c,1),h=new Uint8Array(4*a*c),l=i.gl;l.readPixels(r.x*t,r.y*t,a,c,l.RGBA,l.UNSIGNED_BYTE,h);var d=u.context.getImageData(0,0,a,c);return si.arrayPostDivide(h,d.data),u.context.putImageData(d,0,0),o&&(u.context.scale(1,-1),u.context.drawImage(u.canvas,0,-c)),s&&n.destroy(!0),u.canvas},si.prototype.pixels=function(e){var t,r,n,i=this.renderer,o=!1;e&&(e instanceof Tr?n=e:(n=this.renderer.generateTexture(e),o=!0)),n?(t=n.baseTexture.resolution,r=n.frame,i.renderTexture.bind(n)):(t=i.resolution,(r=oi).width=i.width,r.height=i.height,i.renderTexture.bind(null));var s=r.width*t,a=r.height*t,c=new Uint8Array(4*s*a),u=i.gl;return u.readPixels(r.x*t,r.y*t,s,a,u.RGBA,u.UNSIGNED_BYTE,c),o&&n.destroy(!0),si.arrayPostDivide(c,c),c},si.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null},si.arrayPostDivide=function(e,t){for(var r=0;r<e.length;r+=4){var n=t[r+3]=e[r+3];0!==n?(t[r]=Math.round(Math.min(255*e[r]/n,255)),t[r+1]=Math.round(Math.min(255*e[r+1]/n,255)),t[r+2]=Math.round(Math.min(255*e[r+2]/n,255))):(t[r]=e[r],t[r+1]=e[r+1],t[r+2]=e[r+2])}};var ai={Extract:si},ci=function(){this.global=new lt,this.target=null,this.originalEvent=null,this.identifier=null,this.isPrimary=!1,this.button=0,this.buttons=0,this.width=0,this.height=0,this.tiltX=0,this.tiltY=0,this.pointerType=null,this.pressure=0,this.rotationAngle=0,this.twist=0,this.tangentialPressure=0},ui={pointerId:{configurable:!0}};ui.pointerId.get=function(){return this.identifier},ci.prototype.getLocalPosition=function(e,t,r){return e.worldTransform.applyInverse(r||this.global,t)},ci.prototype.copyEvent=function(e){e.isPrimary&&(this.isPrimary=!0),this.button=e.button,this.buttons=Number.isInteger(e.buttons)?e.buttons:e.which,this.width=e.width,this.height=e.height,this.tiltX=e.tiltX,this.tiltY=e.tiltY,this.pointerType=e.pointerType,this.pressure=e.pressure,this.rotationAngle=e.rotationAngle,this.twist=e.twist||0,this.tangentialPressure=e.tangentialPressure||0},ci.prototype.reset=function(){this.isPrimary=!1},Object.defineProperties(ci.prototype,ui);var hi=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.target=null,this.currentTarget=null,this.type=null,this.data=null};hi.prototype.stopPropagation=function(){this.stopped=!0,this.stopPropagationHint=!0,this.stopsPropagatingAt=this.currentTarget},hi.prototype.reset=function(){this.stopped=!1,this.stopsPropagatingAt=null,this.stopPropagationHint=!1,this.currentTarget=null,this.target=null};var li=function e(t){this._pointerId=t,this._flags=e.FLAGS.NONE},di={pointerId:{configurable:!0},flags:{configurable:!0},none:{configurable:!0},over:{configurable:!0},rightDown:{configurable:!0},leftDown:{configurable:!0}};li.prototype._doSet=function(e,t){this._flags=t?this._flags|e:this._flags&~e},di.pointerId.get=function(){return this._pointerId},di.flags.get=function(){return this._flags},di.flags.set=function(e){this._flags=e},di.none.get=function(){return this._flags===this.constructor.FLAGS.NONE},di.over.get=function(){return 0!=(this._flags&this.constructor.FLAGS.OVER)},di.over.set=function(e){this._doSet(this.constructor.FLAGS.OVER,e)},di.rightDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.RIGHT_DOWN)},di.rightDown.set=function(e){this._doSet(this.constructor.FLAGS.RIGHT_DOWN,e)},di.leftDown.get=function(){return 0!=(this._flags&this.constructor.FLAGS.LEFT_DOWN)},di.leftDown.set=function(e){this._doSet(this.constructor.FLAGS.LEFT_DOWN,e)},Object.defineProperties(li.prototype,di),li.FLAGS=Object.freeze({NONE:0,OVER:1,LEFT_DOWN:2,RIGHT_DOWN:4});var pi={interactive:!1,interactiveChildren:!0,hitArea:null,get buttonMode(){return"pointer"===this.cursor},set buttonMode(e){e?this.cursor="pointer":"pointer"===this.cursor&&(this.cursor=null)},cursor:null,get trackedPointers(){return void 0===this._trackedPointers&&(this._trackedPointers={}),this._trackedPointers},_trackedPointers:void 0};Nt.mixin(pi);var fi={target:null,data:{global:null}},mi=function(e){function t(t,r){e.call(this),r=r||{},this.renderer=t,this.autoPreventDefault=void 0===r.autoPreventDefault||r.autoPreventDefault,this.interactionFrequency=r.interactionFrequency||10,this.mouse=new ci,this.mouse.identifier=1,this.mouse.global.set(-999999),this.activeInteractionData={},this.activeInteractionData[1]=this.mouse,this.interactionDataPool=[],this.eventData=new hi,this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.mouseOverRenderer=!1,this.supportsTouchEvents="ontouchstart"in window,this.supportsPointerEvents=!!window.PointerEvent,this.onPointerUp=this.onPointerUp.bind(this),this.processPointerUp=this.processPointerUp.bind(this),this.onPointerCancel=this.onPointerCancel.bind(this),this.processPointerCancel=this.processPointerCancel.bind(this),this.onPointerDown=this.onPointerDown.bind(this),this.processPointerDown=this.processPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.processPointerMove=this.processPointerMove.bind(this),this.onPointerOut=this.onPointerOut.bind(this),this.processPointerOverOut=this.processPointerOverOut.bind(this),this.onPointerOver=this.onPointerOver.bind(this),this.cursorStyles={default:"inherit",pointer:"pointer"},this.currentCursorMode=null,this.cursor=null,this._tempPoint=new lt,this.resolution=1,this.delayedEvents=[],this.setTargetElement(this.renderer.view,this.renderer.resolution)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.hitTest=function(e,t){return fi.target=null,fi.data.global=e,t||(t=this.renderer._lastObjectRendered),this.processInteractive(fi,t,null,!0),fi.target},t.prototype.setTargetElement=function(e,t){void 0===t&&(t=1),this.removeEvents(),this.interactionDOMElement=e,this.resolution=t,this.addEvents()},t.prototype.addEvents=function(){this.interactionDOMElement&&(qt.system.add(this.update,this,Wt.INTERACTION),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]="none"),this.supportsPointerEvents?(window.document.addEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("pointerover",this.onPointerOver,!0),window.addEventListener("pointercancel",this.onPointerCancel,!0),window.addEventListener("pointerup",this.onPointerUp,!0)):(window.document.addEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.addEventListener("mouseover",this.onPointerOver,!0),window.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.addEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.addEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.addEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.addEventListener("touchmove",this.onPointerMove,!0)),this.eventsAdded=!0)},t.prototype.removeEvents=function(){this.interactionDOMElement&&(qt.system.remove(this.update,this),window.navigator.msPointerEnabled?(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""):this.supportsPointerEvents&&(this.interactionDOMElement.style["touch-action"]=""),this.supportsPointerEvents?(window.document.removeEventListener("pointermove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("pointerleave",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("pointerover",this.onPointerOver,!0),window.removeEventListener("pointercancel",this.onPointerCancel,!0),window.removeEventListener("pointerup",this.onPointerUp,!0)):(window.document.removeEventListener("mousemove",this.onPointerMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onPointerOut,!0),this.interactionDOMElement.removeEventListener("mouseover",this.onPointerOver,!0),window.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.interactionDOMElement.removeEventListener("touchstart",this.onPointerDown,!0),this.interactionDOMElement.removeEventListener("touchcancel",this.onPointerCancel,!0),this.interactionDOMElement.removeEventListener("touchend",this.onPointerUp,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.interactionDOMElement=null,this.eventsAdded=!1)},t.prototype.update=function(e){if(this._deltaTime+=e,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement))if(this.didMove)this.didMove=!1;else{for(var t in this.cursor=null,this.activeInteractionData)if(this.activeInteractionData.hasOwnProperty(t)){var r=this.activeInteractionData[t];if(r.originalEvent&&"touch"!==r.pointerType){var n=this.configureInteractionEventForDOMEvent(this.eventData,r.originalEvent,r);this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!0)}}this.setCursorMode(this.cursor)}},t.prototype.setCursorMode=function(e){if(e=e||"default",this.currentCursorMode!==e){this.currentCursorMode=e;var t=this.cursorStyles[e];if(t)switch(typeof t){case"string":this.interactionDOMElement.style.cursor=t;break;case"function":t(e);break;case"object":Object.assign(this.interactionDOMElement.style,t)}else"string"!=typeof e||Object.prototype.hasOwnProperty.call(this.cursorStyles,e)||(this.interactionDOMElement.style.cursor=e)}},t.prototype.dispatchEvent=function(e,t,r){r.stopPropagationHint&&e!==r.stopsPropagatingAt||(r.currentTarget=e,r.type=t,e.emit(t,r),e[t]&&e[t](r))},t.prototype.delayDispatchEvent=function(e,t,r){this.delayedEvents.push({displayObject:e,eventString:t,eventData:r})},t.prototype.mapPositionToPoint=function(e,t,r){var n;n=this.interactionDOMElement.parentElement?this.interactionDOMElement.getBoundingClientRect():{x:0,y:0,width:0,height:0};var i=1/this.resolution;e.x=(t-n.left)*(this.interactionDOMElement.width/n.width)*i,e.y=(r-n.top)*(this.interactionDOMElement.height/n.height)*i},t.prototype.processInteractive=function(e,t,r,n,i,o){if(!t||!t.visible)return!1;var s=e.data.global,a=!1,c=i=t.interactive||i,u=!0;if(t.hitArea?(n&&(t.worldTransform.applyInverse(s,this._tempPoint),t.hitArea.contains(this._tempPoint.x,this._tempPoint.y)?a=!0:(n=!1,u=!1)),c=!1):t._mask&&n&&(t._mask.containsPoint&&t._mask.containsPoint(s)||(n=!1)),u&&t.interactiveChildren&&t.children)for(var h=t.children,l=h.length-1;l>=0;l--){var d=h[l],p=this.processInteractive(e,d,r,n,c,!0);if(p){if(!d.parent)continue;c=!1,p&&(e.target&&(n=!1),a=!0)}}i&&(n&&!e.target&&!t.hitArea&&t.containsPoint&&t.containsPoint(s)&&(a=!0),t.interactive&&(a&&!e.target&&(e.target=t),r&&r(e,t,!!a)));var f=this.delayedEvents;if(f.length&&!o){e.stopPropagationHint=!1;var m=f.length;this.delayedEvents=[];for(var v=0;v<m;v++){var g=f[v],y=g.displayObject,_=g.eventString,b=g.eventData;b.stopsPropagatingAt===y&&(b.stopPropagationHint=!0),this.dispatchEvent(y,_,b)}}return a},t.prototype.onPointerDown=function(e){if(!this.supportsTouchEvents||"touch"!==e.pointerType){var t=this.normalizeToPointerData(e);this.autoPreventDefault&&t[0].isNormalized&&(e.cancelable||!("cancelable"in e))&&e.preventDefault();for(var r=t.length,n=0;n<r;n++){var i=t[n],o=this.getInteractionDataForPointerId(i),s=this.configureInteractionEventForDOMEvent(this.eventData,i,o);if(s.data.originalEvent=e,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerDown,!0),this.emit("pointerdown",s),"touch"===i.pointerType)this.emit("touchstart",s);else if("mouse"===i.pointerType||"pen"===i.pointerType){var a=2===i.button;this.emit(a?"rightdown":"mousedown",this.eventData)}}}},t.prototype.processPointerDown=function(e,t,r){var n=e.data,i=e.data.identifier;if(r)if(t.trackedPointers[i]||(t.trackedPointers[i]=new li(i)),this.dispatchEvent(t,"pointerdown",e),"touch"===n.pointerType)this.dispatchEvent(t,"touchstart",e);else if("mouse"===n.pointerType||"pen"===n.pointerType){var o=2===n.button;o?t.trackedPointers[i].rightDown=!0:t.trackedPointers[i].leftDown=!0,this.dispatchEvent(t,o?"rightdown":"mousedown",e)}},t.prototype.onPointerComplete=function(e,t,r){for(var n=this.normalizeToPointerData(e),i=n.length,o=e.target!==this.interactionDOMElement?"outside":"",s=0;s<i;s++){var a=n[s],c=this.getInteractionDataForPointerId(a),u=this.configureInteractionEventForDOMEvent(this.eventData,a,c);if(u.data.originalEvent=e,this.processInteractive(u,this.renderer._lastObjectRendered,r,t||!o),this.emit(t?"pointercancel":"pointerup"+o,u),"mouse"===a.pointerType||"pen"===a.pointerType){var h=2===a.button;this.emit(h?"rightup"+o:"mouseup"+o,u)}else"touch"===a.pointerType&&(this.emit(t?"touchcancel":"touchend"+o,u),this.releaseInteractionDataForPointerId(a.pointerId,c))}},t.prototype.onPointerCancel=function(e){this.supportsTouchEvents&&"touch"===e.pointerType||this.onPointerComplete(e,!0,this.processPointerCancel)},t.prototype.processPointerCancel=function(e,t){var r=e.data,n=e.data.identifier;void 0!==t.trackedPointers[n]&&(delete t.trackedPointers[n],this.dispatchEvent(t,"pointercancel",e),"touch"===r.pointerType&&this.dispatchEvent(t,"touchcancel",e))},t.prototype.onPointerUp=function(e){this.supportsTouchEvents&&"touch"===e.pointerType||this.onPointerComplete(e,!1,this.processPointerUp)},t.prototype.processPointerUp=function(e,t,r){var n=e.data,i=e.data.identifier,o=t.trackedPointers[i],s="touch"===n.pointerType,a="mouse"===n.pointerType||"pen"===n.pointerType,c=!1;if(a){var u=2===n.button,h=li.FLAGS,l=u?h.RIGHT_DOWN:h.LEFT_DOWN,d=void 0!==o&&o.flags&l;r?(this.dispatchEvent(t,u?"rightup":"mouseup",e),d&&(this.dispatchEvent(t,u?"rightclick":"click",e),c=!0)):d&&this.dispatchEvent(t,u?"rightupoutside":"mouseupoutside",e),o&&(u?o.rightDown=!1:o.leftDown=!1)}r?(this.dispatchEvent(t,"pointerup",e),s&&this.dispatchEvent(t,"touchend",e),o&&(a&&!c||this.dispatchEvent(t,"pointertap",e),s&&(this.dispatchEvent(t,"tap",e),o.over=!1))):o&&(this.dispatchEvent(t,"pointerupoutside",e),s&&this.dispatchEvent(t,"touchendoutside",e)),o&&o.none&&delete t.trackedPointers[i]},t.prototype.onPointerMove=function(e){if(!this.supportsTouchEvents||"touch"!==e.pointerType){var t=this.normalizeToPointerData(e);"mouse"!==t[0].pointerType&&"pen"!==t[0].pointerType||(this.didMove=!0,this.cursor=null);for(var r=t.length,n=0;n<r;n++){var i=t[n],o=this.getInteractionDataForPointerId(i),s=this.configureInteractionEventForDOMEvent(this.eventData,i,o);s.data.originalEvent=e,this.processInteractive(s,this.renderer._lastObjectRendered,this.processPointerMove,!0),this.emit("pointermove",s),"touch"===i.pointerType&&this.emit("touchmove",s),"mouse"!==i.pointerType&&"pen"!==i.pointerType||this.emit("mousemove",s)}"mouse"===t[0].pointerType&&this.setCursorMode(this.cursor)}},t.prototype.processPointerMove=function(e,t,r){var n=e.data,i="touch"===n.pointerType,o="mouse"===n.pointerType||"pen"===n.pointerType;o&&this.processPointerOverOut(e,t,r),this.moveWhenInside&&!r||(this.dispatchEvent(t,"pointermove",e),i&&this.dispatchEvent(t,"touchmove",e),o&&this.dispatchEvent(t,"mousemove",e))},t.prototype.onPointerOut=function(e){if(!this.supportsTouchEvents||"touch"!==e.pointerType){var t=this.normalizeToPointerData(e)[0];"mouse"===t.pointerType&&(this.mouseOverRenderer=!1,this.setCursorMode(null));var r=this.getInteractionDataForPointerId(t),n=this.configureInteractionEventForDOMEvent(this.eventData,t,r);n.data.originalEvent=t,this.processInteractive(n,this.renderer._lastObjectRendered,this.processPointerOverOut,!1),this.emit("pointerout",n),"mouse"===t.pointerType||"pen"===t.pointerType?this.emit("mouseout",n):this.releaseInteractionDataForPointerId(r.identifier)}},t.prototype.processPointerOverOut=function(e,t,r){var n=e.data,i=e.data.identifier,o="mouse"===n.pointerType||"pen"===n.pointerType,s=t.trackedPointers[i];r&&!s&&(s=t.trackedPointers[i]=new li(i)),void 0!==s&&(r&&this.mouseOverRenderer?(s.over||(s.over=!0,this.delayDispatchEvent(t,"pointerover",e),o&&this.delayDispatchEvent(t,"mouseover",e)),o&&null===this.cursor&&(this.cursor=t.cursor)):s.over&&(s.over=!1,this.dispatchEvent(t,"pointerout",this.eventData),o&&this.dispatchEvent(t,"mouseout",e),s.none&&delete t.trackedPointers[i]))},t.prototype.onPointerOver=function(e){var t=this.normalizeToPointerData(e)[0],r=this.getInteractionDataForPointerId(t),n=this.configureInteractionEventForDOMEvent(this.eventData,t,r);n.data.originalEvent=t,"mouse"===t.pointerType&&(this.mouseOverRenderer=!0),this.emit("pointerover",n),"mouse"!==t.pointerType&&"pen"!==t.pointerType||this.emit("mouseover",n)},t.prototype.getInteractionDataForPointerId=function(e){var t,r=e.pointerId;return 1===r||"mouse"===e.pointerType?t=this.mouse:this.activeInteractionData[r]?t=this.activeInteractionData[r]:((t=this.interactionDataPool.pop()||new ci).identifier=r,this.activeInteractionData[r]=t),t.copyEvent(e),t},t.prototype.releaseInteractionDataForPointerId=function(e){var t=this.activeInteractionData[e];t&&(delete this.activeInteractionData[e],t.reset(),this.interactionDataPool.push(t))},t.prototype.configureInteractionEventForDOMEvent=function(e,t,r){return e.data=r,this.mapPositionToPoint(r.global,t.clientX,t.clientY),"touch"===t.pointerType&&(t.globalX=r.global.x,t.globalY=r.global.y),r.originalEvent=t,e.reset(),e},t.prototype.normalizeToPointerData=function(e){var t=[];if(this.supportsTouchEvents&&e instanceof TouchEvent)for(var r=0,n=e.changedTouches.length;r<n;r++){var i=e.changedTouches[r];void 0===i.button&&(i.button=e.touches.length?1:0),void 0===i.buttons&&(i.buttons=e.touches.length?1:0),void 0===i.isPrimary&&(i.isPrimary=1===e.touches.length&&"touchstart"===e.type),void 0===i.width&&(i.width=i.radiusX||1),void 0===i.height&&(i.height=i.radiusY||1),void 0===i.tiltX&&(i.tiltX=0),void 0===i.tiltY&&(i.tiltY=0),void 0===i.pointerType&&(i.pointerType="touch"),void 0===i.pointerId&&(i.pointerId=i.identifier||0),void 0===i.pressure&&(i.pressure=i.force||.5),void 0===i.twist&&(i.twist=0),void 0===i.tangentialPressure&&(i.tangentialPressure=0),void 0===i.layerX&&(i.layerX=i.offsetX=i.clientX),void 0===i.layerY&&(i.layerY=i.offsetY=i.clientY),i.isNormalized=!0,t.push(i)}else!(e instanceof MouseEvent)||this.supportsPointerEvents&&e instanceof window.PointerEvent||(void 0===e.isPrimary&&(e.isPrimary=!0),void 0===e.width&&(e.width=1),void 0===e.height&&(e.height=1),void 0===e.tiltX&&(e.tiltX=0),void 0===e.tiltY&&(e.tiltY=0),void 0===e.pointerType&&(e.pointerType="mouse"),void 0===e.pointerId&&(e.pointerId=1),void 0===e.pressure&&(e.pressure=.5),void 0===e.twist&&(e.twist=0),void 0===e.tangentialPressure&&(e.tangentialPressure=0),e.isNormalized=!0),t.push(e);return t},t.prototype.destroy=function(){this.removeEvents(),this.removeAllListeners(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactionDOMElement=null,this.onPointerDown=null,this.processPointerDown=null,this.onPointerUp=null,this.processPointerUp=null,this.onPointerCancel=null,this.processPointerCancel=null,this.onPointerMove=null,this.processPointerMove=null,this.onPointerOut=null,this.processPointerOverOut=null,this.onPointerOver=null,this._tempPoint=null},t}(g),vi={InteractionData:ci,InteractionEvent:hi,InteractionManager:mi,InteractionTrackingData:li,interactiveTarget:pi},gi={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,_segmentsCount:function(e,t){if(void 0===t&&(t=20),!this.adaptive)return t;var r=Math.ceil(e/this.maxLength);return r<this.minSegments?r=this.minSegments:r>this.maxSegments&&(r=this.maxSegments),r}},yi=function(){this.reset()};yi.prototype.clone=function(){var e=new yi;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e},yi.prototype.reset=function(){this.color=16777215,this.alpha=1,this.texture=xr.WHITE,this.matrix=null,this.visible=!1},yi.prototype.destroy=function(){this.texture=null,this.matrix=null};var _i=function(e,t,r,n){void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=null),this.shape=e,this.lineStyle=r,this.fillStyle=t,this.matrix=n,this.type=e.type,this.points=[],this.holes=[]};_i.prototype.clone=function(){return new _i(this.shape,this.fillStyle,this.lineStyle,this.matrix)},_i.prototype.destroy=function(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null};var bi={build:function(e){var t,r,n=e.shape,i=e.points,o=n.x,s=n.y;if(i.length=0,e.type===gt.CIRC?(t=n.radius,r=n.radius):(t=n.width,r=n.height),0!==t&&0!==r){var a=Math.floor(30*Math.sqrt(n.radius))||Math.floor(15*Math.sqrt(n.width+n.height));a/=2.3;for(var c=2*Math.PI/a,u=0;u<a;u++)i.push(o+Math.sin(-c*u)*t,s+Math.cos(-c*u)*r);i.push(i[0],i[1])}},triangulate:function(e,t){var r=e.points,n=t.points,i=t.indices,o=n.length/2,s=o;n.push(e.shape.x,e.shape.y);for(var a=0;a<r.length;a+=2)n.push(r[a],r[a+1]),i.push(o++,s,o)}};function xi(e,t){e.lineStyle.native?function(e,t){var r=0,n=e.shape,i=e.points||n.points,o=n.type!==gt.POLY||n.closeStroke;if(0!==i.length){var s=t.points,a=t.indices,c=i.length/2,u=s.length/2,h=u;for(s.push(i[0],i[1]),r=1;r<c;r++)s.push(i[2*r],i[2*r+1]),a.push(h,h+1),h++;o&&a.push(h,u)}}(e,t):function(e,t){var r=e.shape,n=e.points||r.points.slice(),i=t.closePointEps;if(0!==n.length){var o=e.lineStyle,s=new lt(n[0],n[1]),a=new lt(n[n.length-2],n[n.length-1]),c=r.type!==gt.POLY||r.closeStroke,u=Math.abs(s.x-a.x)<i&&Math.abs(s.y-a.y)<i;if(c){n=n.slice(),u&&(n.pop(),n.pop(),a.set(n[n.length-2],n[n.length-1]));var h=a.x+.5*(s.x-a.x),l=a.y+.5*(s.y-a.y);n.unshift(h,l),n.push(h,l)}var d=t.points,p=n.length/2,f=n.length,m=d.length/2,v=o.width/2,g=n[0],y=n[1],_=n[2],b=n[3],x=0,w=0,T=-(y-b),S=g-_,C=0,P=0,E=0,I=0,A=Math.sqrt(T*T+S*S);T/=A,S/=A,T*=v,S*=v;var M=o.alignment,O=2*(1-M),R=2*M;d.push(g-T*O,y-S*O),d.push(g+T*R,y+S*R);for(var D=1;D<p-1;++D){g=n[2*(D-1)],y=n[2*(D-1)+1],_=n[2*D],b=n[2*D+1],x=n[2*(D+1)],w=n[2*(D+1)+1],T=-(y-b),S=g-_,T/=A=Math.sqrt(T*T+S*S),S/=A,T*=v,S*=v,C=-(b-w),P=_-x,C/=A=Math.sqrt(C*C+P*P),P/=A;var k=-S+y-(-S+b),L=-T+_-(-T+g),B=(-T+g)*(-S+b)-(-T+_)*(-S+y),F=-(P*=v)+w-(-P+b),N=-(C*=v)+_-(-C+x),j=(-C+x)*(-P+b)-(-C+_)*(-P+w),U=k*N-F*L;if(Math.abs(U)<.1)U+=10.1,d.push(_-T*O,b-S*O),d.push(_+T*R,b+S*R);else{var G=(L*j-N*B)/U,X=(F*B-k*j)/U;(G-_)*(G-_)+(X-b)*(X-b)>196*v*v?(E=T-C,I=S-P,E/=A=Math.sqrt(E*E+I*I),I/=A,E*=v,I*=v,d.push(_-E*O,b-I*O),d.push(_+E*R,b+I*R),d.push(_-E*R*O,b-I*O),f++):(d.push(_+(G-_)*O,b+(X-b)*O),d.push(_-(G-_)*R,b-(X-b)*R))}}g=n[2*(p-2)],y=n[2*(p-2)+1],_=n[2*(p-1)],T=-(y-(b=n[2*(p-1)+1])),S=g-_,T/=A=Math.sqrt(T*T+S*S),S/=A,T*=v,S*=v,d.push(_-T*O,b-S*O),d.push(_+T*R,b+S*R);for(var V=t.indices,z=0;z<f-2;++z)V.push(m,m+1,m+2),m++}}(e,t)}var wi={build:function(e){e.points=e.shape.points.slice()},triangulate:function(e,t){var r=e.points,n=e.holes,i=t.points,o=t.indices;if(r.length>=6){for(var s=[],a=0;a<n.length;a++){var c=n[a];s.push(r.length/2),r=r.concat(c.points)}var u=y(r,s,2);if(!u)return;for(var h=i.length/2,l=0;l<u.length;l+=3)o.push(u[l]+h),o.push(u[l+1]+h),o.push(u[l+2]+h);for(var d=0;d<r.length;d++)i.push(r[d])}}},Ti={build:function(e){var t=e.shape,r=e.points,n=t.x,i=t.y,o=t.width,s=t.height,a=t.radius;r.length=0,Ci(n,i+a,n,i,n+a,i,r),Ci(n+o-a,i,n+o,i,n+o,i+a,r),Ci(n+o,i+s-a,n+o,i+s,n+o-a,i+s,r),Ci(n+a,i+s,n,i+s,n,i+s-a,r)},triangulate:function(e,t){for(var r=e.points,n=t.points,i=t.indices,o=n.length/2,s=y(r,null,2),a=0,c=s.length;a<c;a+=3)i.push(s[a]+o),i.push(s[a+1]+o),i.push(s[a+2]+o);for(var u=0,h=r.length;u<h;u++)n.push(r[u],r[++u])}};function Si(e,t,r){return e+(t-e)*r}function Ci(e,t,r,n,i,o,s){void 0===s&&(s=[]);for(var a=s,c=0,u=0,h=0,l=0,d=0,p=0,f=0,m=0;f<=20;++f)c=Si(e,r,m=f/20),u=Si(t,n,m),h=Si(r,i,m),l=Si(n,o,m),d=Si(c,h,m),p=Si(u,l,m),a.push(d,p);return a}var Pi=[],Ei=[],Ii=new lt,Ai={};Ai[gt.POLY]=wi,Ai[gt.CIRC]=bi,Ai[gt.ELIP]=bi,Ai[gt.RECT]={build:function(e){var t=e.shape,r=t.x,n=t.y,i=t.width,o=t.height,s=e.points;s.length=0,s.push(r,n,r+i,n,r+i,n+o,r,n+o)},triangulate:function(e,t){var r=e.points,n=t.points,i=n.length/2;n.push(r[0],r[1],r[2],r[3],r[6],r[7],r[4],r[5]),t.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},Ai[gt.RREC]=Ti;var Mi=function(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0},Oi=function(e){function t(){e.call(this),this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.dirty=0,this.batchDirty=-1,this.cacheDirty=-1,this.clearDirty=0,this.drawCalls=[],this.batches=[],this.shapeIndex=0,this._bounds=new Ft,this.boundsDirty=-1,this.boundsPadding=0,this.batchable=!1,this.indicesUint16=null,this.uvsFloat32=null,this.closePointEps=1e-4}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={bounds:{configurable:!0}};return r.bounds.get=function(){return this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds},t.prototype.invalidate=function(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(var e=0;e<this.drawCalls.length;e++)this.drawCalls[e].textures.length=0,Ei.push(this.drawCalls[e]);this.drawCalls.length=0;for(var t=0;t<this.batches.length;t++){var r=this.batches[t];r.start=0,r.attribStart=0,r.style=null,Pi.push(r)}this.batches.length=0},t.prototype.clear=function(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this},t.prototype.drawShape=function(e,t,r,n){var i=new _i(e,t,r,n);return this.graphicsData.push(i),this.dirty++,this},t.prototype.drawHole=function(e,t){if(!this.graphicsData.length)return null;var r=new _i(e,null,null,t),n=this.graphicsData[this.graphicsData.length-1];return r.lineStyle=n.lineStyle,n.holes.push(r),this.dirty++,this},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t);for(var r=0;r<this.graphicsData.length;++r)this.graphicsData[r].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null},t.prototype.containsPoint=function(e){for(var t=this.graphicsData,r=0;r<t.length;++r){var n=t[r];if(n.fillStyle.visible&&n.shape&&(n.matrix?n.matrix.applyInverse(e,Ii):Ii.copyFrom(e),n.shape.contains(Ii.x,Ii.y))){if(n.holes)for(var i=0;i<n.holes.length;i++)if(n.holes[i].shape.contains(Ii.x,Ii.y))return!1;return!0}}return!1},t.prototype.updateBatches=function(){if(this.dirty!==this.cacheDirty)if(0!==this.graphicsData.length){if(this.dirty!==this.cacheDirty)for(var e=0;e<this.graphicsData.length;e++){var t=this.graphicsData[e];if(t.fillStyle&&!t.fillStyle.texture.baseTexture.valid)return;if(t.lineStyle&&!t.lineStyle.texture.baseTexture.valid)return}this.cacheDirty=this.dirty;var r=this.uvs,n=null,i=null,o=0,s=!1;if(this.batches.length>0){var a=(n=this.batches[this.batches.length-1]).style;i=a.texture.baseTexture,o=a.color+a.alpha,s=!!a.native}for(var c=this.shapeIndex;c<this.graphicsData.length;c++){this.shapeIndex++;var u=this.graphicsData[c],h=Ai[u.type],l=u.fillStyle,d=u.lineStyle;h.build(u),u.matrix&&this.transformPoints(u.points,u.matrix);for(var p=0;p<2;p++){var f=0===p?l:d;if(f.visible){var m=f.texture.baseTexture,v=this.indices.length,g=this.points.length/2;!n||i===m&&o===f.color+f.alpha&&s===!!f.native||(n.size=v-n.start,n.attribSize=g-n.attribStart,n.size>0&&(n=null)),n||(n=Pi.pop()||new Mi,this.batches.push(n),m.wrapMode=Ee.REPEAT,i=m,o=f.color+f.alpha,s=f.native,n.style=f,n.start=v,n.attribStart=g);var y=this.points.length/2;if(0===p)u.holes.length?(this.processHoles(u.holes),wi.triangulate(u,this)):h.triangulate(u,this);else{xi(u,this);for(var _=0;_<u.holes.length;_++)xi(u.holes[_],this)}var b=this.points.length/2-y;this.addUvs(this.points,r,f.texture,y,b,f.matrix)}}}var x=this.indices.length,w=this.points.length/2;if(n)if(n.size=x-n.start,n.attribSize=w-n.attribStart,this.indicesUint16=new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);for(var T=0;T<this.batches.length;T++)for(var S=this.batches[T],C=0;C<S.size;C++){var P=S.start+C;this.indicesUint16[P]=this.indicesUint16[P]-S.attribStart}}else this.buildDrawCalls();else this.batchable=!0}else this.batchable=!0},t.prototype.isBatchable=function(){for(var e=this.batches,r=0;r<e.length;r++)if(e[r].style.native)return!1;return this.points.length<2*t.BATCHABLE_SIZE},t.prototype.buildDrawCalls=function(){for(var e=++sr._globalBatch,t=0;t<this.drawCalls.length;t++)this.drawCalls[t].textures.length=0,Ei.push(this.drawCalls[t]);this.drawCalls.length=0;var r=this.uvs,n=this.colors,i=this.textureIds,o=Ei.pop()||new qn;o.textureCount=0,o.start=0,o.size=0,o.type=we.TRIANGLES;var s=0,a=null,c=0,u=!1,h=we.TRIANGLES,l=0;this.drawCalls.push(o);for(var d=0;d<this.batches.length;d++){var p=this.batches[d],f=p.style,m=f.texture.baseTexture;u!==!!f.native&&(h=(u=f.native)?we.LINES:we.TRIANGLES,a=null,s=8,e++),a!==m&&(a=m,m._batchEnabled!==e&&(8===s&&(e++,s=0,o.size>0&&(o=Ei.pop()||new qn,this.drawCalls.push(o)),o.start=l,o.size=0,o.textureCount=0,o.type=h),m.touched=1,m._batchEnabled=e,m._id=s,m.wrapMode=10497,o.textures[o.textureCount++]=m,s++)),o.size+=p.size,l+=p.size,c=m._id,this.addColors(n,f.color,f.alpha,p.attribSize),this.addTextureIds(i,c,p.attribSize)}sr._globalBatch=e;for(var v=this.points,g=new ArrayBuffer(3*v.length*4),y=new Float32Array(g),_=new Uint32Array(g),b=0,x=0;x<v.length/2;x++)y[b++]=v[2*x],y[b++]=v[2*x+1],y[b++]=r[2*x],y[b++]=r[2*x+1],_[b++]=n[x],y[b++]=i[x];this._buffer.update(g),this._indexBuffer.update(this.indicesUint16)},t.prototype.processHoles=function(e){for(var t=0;t<e.length;t++){var r=e[t];Ai[r.type].build(r),r.matrix&&this.transformPoints(r.points,r.matrix)}},t.prototype.calculateBounds=function(){var e=1/0,t=-1/0,r=1/0,n=-1/0;if(this.graphicsData.length)for(var i=null,o=0,s=0,a=0,c=0,u=0;u<this.graphicsData.length;u++){var h=this.graphicsData[u],l=h.type,d=h.lineStyle?h.lineStyle.width:0;if(i=h.shape,l===gt.RECT||l===gt.RREC)o=i.x-d/2,s=i.y-d/2,e=o<e?o:e,t=o+(a=i.width+d)>t?o+a:t,r=s<r?s:r,n=s+(c=i.height+d)>n?s+c:n;else if(l===gt.CIRC)o=i.x,s=i.y,e=o-(a=i.radius+d/2)<e?o-a:e,t=o+a>t?o+a:t,r=s-(c=i.radius+d/2)<r?s-c:r,n=s+c>n?s+c:n;else if(l===gt.ELIP)o=i.x,s=i.y,e=o-(a=i.width+d/2)<e?o-a:e,t=o+a>t?o+a:t,r=s-(c=i.height+d/2)<r?s-c:r,n=s+c>n?s+c:n;else for(var p=i.points,f=0,m=0,v=0,g=0,y=0,_=0,b=0,x=0,w=0;w+2<p.length;w+=2)o=p[w],s=p[w+1],f=p[w+2],m=p[w+3],v=Math.abs(f-o),g=Math.abs(m-s),c=d,(a=Math.sqrt(v*v+g*g))<1e-9||(e=(b=(f+o)/2)-(y=(c/a*g+v)/2)<e?b-y:e,t=b+y>t?b+y:t,r=(x=(m+s)/2)-(_=(c/a*v+g)/2)<r?x-_:r,n=x+_>n?x+_:n)}else e=0,t=0,r=0,n=0;var T=this.boundsPadding;this._bounds.minX=e-T,this._bounds.maxX=t+T,this._bounds.minY=r-T,this._bounds.maxY=n+T},t.prototype.transformPoints=function(e,t){for(var r=0;r<e.length/2;r++){var n=e[2*r],i=e[2*r+1];e[2*r]=t.a*n+t.c*i+t.tx,e[2*r+1]=t.b*n+t.d*i+t.ty}},t.prototype.addColors=function(e,t,r,n){for(var i=Xe((t>>16)+(65280&t)+((255&t)<<16),r);n-- >0;)e.push(i)},t.prototype.addTextureIds=function(e,t,r){for(;r-- >0;)e.push(t)},t.prototype.addUvs=function(e,t,r,n,i,o){for(var s=0,a=t.length,c=r.frame;s<i;){var u=e[2*(n+s)],h=e[2*(n+s)+1];if(o){var l=o.a*u+o.c*h+o.tx;h=o.b*u+o.d*h+o.ty,u=l}s++,t.push(u/c.width,h/c.height)}var d=r.baseTexture;(c.width<d.width||c.height<d.height)&&this.adjustUvs(t,r,a,i)},t.prototype.adjustUvs=function(e,t,r,n){for(var i=t.baseTexture,o=r+2*n,s=t.frame,a=s.width/i.width,c=s.height/i.height,u=s.x/s.width,h=s.y/s.height,l=Math.floor(e[r]+1e-6),d=Math.floor(e[r+1]+1e-6),p=r+2;p<o;p+=2)l=Math.min(l,Math.floor(e[p]+1e-6)),d=Math.min(d,Math.floor(e[p+1]+1e-6));u-=l,h-=d;for(var f=r;f<o;f+=2)e[f]=(e[f]+u)*a,e[f+1]=(e[f+1]+h)*c},Object.defineProperties(t.prototype,r),t}($n);Oi.BATCHABLE_SIZE=100;var Ri=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.clone=function(){var e=new t;return e.color=this.color,e.alpha=this.alpha,e.texture=this.texture,e.matrix=this.matrix,e.visible=this.visible,e.width=this.width,e.alignment=this.alignment,e.native=this.native,e},t.prototype.reset=function(){e.prototype.reset.call(this),this.color=0,this.width=0,this.alignment=.5,this.native=!1},t}(yi),Di=function(){};Di.curveLength=function(e,t,r,n,i,o,s,a){for(var c=0,u=0,h=0,l=0,d=0,p=0,f=0,m=0,v=0,g=0,y=0,_=e,b=t,x=1;x<=10;++x)g=_-(m=(f=(p=(d=1-(u=x/10))*d)*d)*e+3*p*u*r+3*d*(h=u*u)*i+(l=h*u)*s),y=b-(v=f*t+3*p*u*n+3*d*h*o+l*a),_=m,b=v,c+=Math.sqrt(g*g+y*y);return c},Di.curveTo=function(e,t,r,n,i,o,s){var a=s[s.length-2],c=s[s.length-1];s.length-=2;var u=gi._segmentsCount(Di.curveLength(a,c,e,t,r,n,i,o)),h=0,l=0,d=0,p=0,f=0;s.push(a,c);for(var m=1,v=0;m<=u;++m)d=(l=(h=1-(v=m/u))*h)*h,f=(p=v*v)*v,s.push(d*a+3*l*v*e+3*h*p*r+f*i,d*c+3*l*v*t+3*h*p*n+f*o)};var ki=function(){};ki.curveLength=function(e,t,r,n,i,o){var s=e-2*r+i,a=t-2*n+o,c=2*r-2*e,u=2*n-2*t,h=4*(s*s+a*a),l=4*(s*c+a*u),d=c*c+u*u,p=2*Math.sqrt(h+l+d),f=Math.sqrt(h),m=2*h*f,v=2*Math.sqrt(d),g=l/f;return(m*p+f*l*(p-v)+(4*d*h-l*l)*Math.log((2*f+g+p)/(g+v)))/(4*m)},ki.curveTo=function(e,t,r,n,i){for(var o=i[i.length-2],s=i[i.length-1],a=gi._segmentsCount(ki.curveLength(o,s,e,t,r,n)),c=0,u=0,h=1;h<=a;++h){var l=h/a;c=o+(e-o)*l,u=s+(t-s)*l,i.push(c+(e+(r-e)*l-c)*l,u+(t+(n-t)*l-u)*l)}};var Li=function(){};Li.curveTo=function(e,t,r,n,i,o){var s=o[o.length-2],a=o[o.length-1]-t,c=s-e,u=n-t,h=r-e,l=Math.abs(a*h-c*u);if(l<1e-8||0===i)return o[o.length-2]===e&&o[o.length-1]===t||o.push(e,t),null;var d=a*a+c*c,p=u*u+h*h,f=a*u+c*h,m=i*Math.sqrt(d)/l,v=i*Math.sqrt(p)/l,g=m*f/d,y=v*f/p,_=m*h+v*c,b=m*u+v*a,x=c*(v+g),w=a*(v+g),T=h*(m+y),S=u*(m+y);return{cx:_+e,cy:b+t,radius:i,startAngle:Math.atan2(w-b,x-_),endAngle:Math.atan2(S-b,T-_),anticlockwise:c*u>h*a}},Li.arc=function(e,t,r,n,i,o,s,a,c){for(var u=s-o,h=gi._segmentsCount(Math.abs(u)*i,40*Math.ceil(Math.abs(u)/ft)),l=u/(2*h),d=2*l,p=Math.cos(l),f=Math.sin(l),m=h-1,v=m%1/m,g=0;g<=m;++g){var y=l+o+d*(g+v*g),_=Math.cos(y),b=-Math.sin(y);c.push((p*_+f*b)*i+r,(p*-b+f*_)*i+n)}};var Bi=function(e){function t(t,r,n,i,o,s){o=o||i/2;for(var a=-1*Math.PI/2+s,c=2*n,u=ft/c,h=[],l=0;l<c;l++){var d=l%2?o:i,p=l*u+a;h.push(t+d*Math.cos(p),r+d*Math.sin(p))}e.call(this,h)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Lt),Fi=new Float32Array(3),Ni={},ji=function(e){function t(t){void 0===t&&(t=null),e.call(this),this.geometry=t||new Oi,this.geometry.refCount++,this.shader=null,this.state=xn.for2d(),this._fillStyle=new yi,this._lineStyle=new Ri,this._matrix=null,this._holeMode=!1,this.currentPath=null,this.batches=[],this.batchTint=-1,this.vertexData=null,this._transformID=-1,this.batchDirty=-1,this.pluginName="batch",this.tint=16777215,this.blendMode=xe.NORMAL}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={blendMode:{configurable:!0},tint:{configurable:!0},fill:{configurable:!0},line:{configurable:!0}};return t.prototype.clone=function(){return this.finishPoly(),new t(this.geometry)},r.blendMode.set=function(e){this.state.blendMode=e},r.blendMode.get=function(){return this.state.blendMode},r.tint.get=function(){return this._tint},r.tint.set=function(e){this._tint=e},r.fill.get=function(){return this._fillStyle},r.line.get=function(){return this._lineStyle},t.prototype.lineStyle=function(e,t,r,n,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=1),void 0===n&&(n=.5),void 0===i&&(i=!1),this.lineTextureStyle(e,xr.WHITE,t,r,null,n,i),this},t.prototype.lineTextureStyle=function(e,t,r,n,i,o,s){void 0===e&&(e=0),void 0===t&&(t=xr.WHITE),void 0===r&&(r=16777215),void 0===n&&(n=1),void 0===i&&(i=null),void 0===o&&(o=.5),void 0===s&&(s=!1),this.currentPath&&this.startPoly();var a=e>0&&n>0;return a?(i&&(i=i.clone()).invert(),Object.assign(this._lineStyle,{color:r,width:e,alpha:n,matrix:i,texture:t,alignment:o,native:s,visible:a})):this._lineStyle.reset(),this},t.prototype.startPoly=function(){if(this.currentPath){var e=this.currentPath.points,t=this.currentPath.points.length;t>2&&(this.drawShape(this.currentPath),this.currentPath=new Lt,this.currentPath.closeStroke=!1,this.currentPath.points.push(e[t-2],e[t-1]))}else this.currentPath=new Lt,this.currentPath.closeStroke=!1},t.prototype.finishPoly=function(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)},t.prototype.moveTo=function(e,t){return this.startPoly(),this.currentPath.points[0]=e,this.currentPath.points[1]=t,this},t.prototype.lineTo=function(e,t){this.currentPath||this.moveTo(0,0);var r=this.currentPath.points,n=r[r.length-2],i=r[r.length-1];return n===e&&i===t||r.push(e,t),this},t.prototype._initCurve=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[e,t]):this.moveTo(e,t)},t.prototype.quadraticCurveTo=function(e,t,r,n){this._initCurve();var i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),ki.curveTo(e,t,r,n,i),this},t.prototype.bezierCurveTo=function(e,t,r,n,i,o){return this._initCurve(),Di.curveTo(e,t,r,n,i,o,this.currentPath.points),this},t.prototype.arcTo=function(e,t,r,n,i){this._initCurve(e,t);var o=this.currentPath.points,s=Li.curveTo(e,t,r,n,i,o);if(s){var a=s.cx,c=s.cy,u=s.radius,h=s.startAngle,l=s.endAngle,d=s.anticlockwise;this.arc(a,c,u,h,l,d)}return this},t.prototype.arc=function(e,t,r,n,i,o){if(void 0===o&&(o=!1),n===i)return this;if(!o&&i<=n?i+=ft:o&&n<=i&&(n+=ft),0==i-n)return this;var s=e+Math.cos(n)*r,a=t+Math.sin(n)*r,c=this.geometry.closePointEps,u=this.currentPath?this.currentPath.points:null;if(u){var h=Math.abs(u[u.length-2]-s),l=Math.abs(u[u.length-1]-a);h<c&&l<c||u.push(s,a)}else this.moveTo(s,a),u=this.currentPath.points;return Li.arc(s,a,e,t,r,n,i,o,u),this},t.prototype.beginFill=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=1),this.beginTextureFill(xr.WHITE,e,t)},t.prototype.beginTextureFill=function(e,t,r,n){void 0===e&&(e=xr.WHITE),void 0===t&&(t=16777215),void 0===r&&(r=1),void 0===n&&(n=null),this.currentPath&&this.startPoly();var i=r>0;return i?(n&&(n=n.clone()).invert(),Object.assign(this._fillStyle,{color:t,alpha:r,texture:e,matrix:n,visible:i})):this._fillStyle.reset(),this},t.prototype.endFill=function(){return this.finishPoly(),this._fillStyle.reset(),this},t.prototype.drawRect=function(e,t,r,n){return this.drawShape(new Mt(e,t,r,n))},t.prototype.drawRoundedRect=function(e,t,r,n,i){return this.drawShape(new Bt(e,t,r,n,i))},t.prototype.drawCircle=function(e,t,r){return this.drawShape(new Dt(e,t,r))},t.prototype.drawEllipse=function(e,t,r,n){return this.drawShape(new kt(e,t,r,n))},t.prototype.drawPolygon=function(e){var t=arguments,r=e,n=!0;if(r.points&&(n=r.closeStroke,r=r.points),!Array.isArray(r)){r=new Array(arguments.length);for(var i=0;i<r.length;++i)r[i]=t[i]}var o=new Lt(r);return o.closeStroke=n,this.drawShape(o),this},t.prototype.drawShape=function(e){return this._holeMode?this.geometry.drawHole(e,this._matrix):this.geometry.drawShape(e,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this},t.prototype.drawStar=function(e,t,r,n,i,o){return void 0===o&&(o=0),this.drawPolygon(new Bi(e,t,r,n,i,o))},t.prototype.clear=function(){return this.geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._matrix=null,this._holeMode=!1,this.currentPath=null,this},t.prototype.isFastRect=function(){return!1},t.prototype._render=function(e){this.finishPoly();var t=this.geometry;t.updateBatches(),t.batchable?(this.batchDirty!==t.batchDirty&&this._populateBatches(),this._renderBatched(e)):(e.batch.flush(),this._renderDirect(e))},t.prototype._populateBatches=function(){var e=this.geometry,t=this.blendMode;this.batches=[],this.batchTint=-1,this._transformID=-1,this.batchDirty=e.batchDirty,this.vertexData=new Float32Array(e.points);for(var r=0,n=e.batches.length;r<n;r++){var i=e.batches[r],o=i.style.color,s=new Float32Array(this.vertexData.buffer,4*i.attribStart*2,2*i.attribSize),a=new Float32Array(e.uvsFloat32.buffer,4*i.attribStart*2,2*i.attribSize),c={vertexData:s,blendMode:t,indices:new Uint16Array(e.indicesUint16.buffer,2*i.start,i.size),uvs:a,_batchRGB:Le(o),_tintRGB:o,_texture:i.style.texture,alpha:i.style.alpha,worldAlpha:1};this.batches[r]=c}},t.prototype._renderBatched=function(e){if(this.batches.length){e.batch.setObjectRenderer(e.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(var t=0,r=this.batches.length;t<r;t++){var n=this.batches[t];n.worldAlpha=this.worldAlpha*n.alpha,e.plugins[this.pluginName].render(n)}}},t.prototype._renderDirect=function(e){var t=this._resolveDirectShader(e),r=this.geometry,n=this.tint,i=this.worldAlpha,o=t.uniforms,s=r.drawCalls;o.translationMatrix=this.transform.worldTransform,o.tint[0]=(n>>16&255)/255*i,o.tint[1]=(n>>8&255)/255*i,o.tint[2]=(255&n)/255*i,o.tint[3]=i,e.shader.bind(t),e.geometry.bind(r,t),e.state.set(this.state);for(var a=0,c=s.length;a<c;a++)this._renderDrawCallDirect(e,r.drawCalls[a])},t.prototype._renderDrawCallDirect=function(e,t){for(var r=t.textureCount,n=0;n<r;n++)e.texture.bind(t.textures[n],n);e.geometry.draw(t.type,t.size,t.start)},t.prototype._resolveDirectShader=function(e){var t=this.shader,r=this.pluginName;if(!t){if(!Ni[r]){for(var n=new Int32Array(16),i=0;i<16;i++)n[i]=i;var o={tint:new Float32Array([1,1,1,1]),translationMatrix:new yt,default:Fr.from({uSamplers:n},!0)},s=e.plugins[r]._shader.program;Ni[r]=new _n(s,o)}t=Ni[r]}return t},t.prototype._calculateBounds=function(){this.finishPoly();var e=this.geometry.bounds;this._bounds.addFrame(this.transform,e.minX,e.minY,e.maxX,e.maxY)},t.prototype.containsPoint=function(e){return this.worldTransform.applyInverse(e,t._TEMP_POINT),this.geometry.containsPoint(t._TEMP_POINT)},t.prototype.calculateTints=function(){if(this.batchTint!==this.tint){this.batchTint=this.tint;for(var e=Le(this.tint,Fi),t=0;t<this.batches.length;t++){var r=this.batches[t],n=r._batchRGB,i=(e[0]*n[0]*255<<16)+(e[1]*n[1]*255<<8)+(0|e[2]*n[2]*255);r._tintRGB=(i>>16)+(65280&i)+((255&i)<<16)}}},t.prototype.calculateVertices=function(){if(this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID;for(var e=this.transform.worldTransform,t=e.a,r=e.b,n=e.c,i=e.d,o=e.tx,s=e.ty,a=this.geometry.points,c=this.vertexData,u=0,h=0;h<a.length;h+=2){var l=a[h],d=a[h+1];c[u++]=t*l+n*d+o,c[u++]=i*d+r*l+s}}},t.prototype.closePath=function(){var e=this.currentPath;return e&&(e.closeStroke=!0),this},t.prototype.setMatrix=function(e){return this._matrix=e,this},t.prototype.beginHole=function(){return this.finishPoly(),this._holeMode=!0,this},t.prototype.endHole=function(){return this.finishPoly(),this._holeMode=!1,this},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this.geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,e.prototype.destroy.call(this,t)},Object.defineProperties(t.prototype,r),t}(Ut);ji._TEMP_POINT=new lt;var Ui=new lt,Gi=new Uint16Array([0,1,2,0,2,3]),Xi=function(e){function t(t){e.call(this),this._anchor=new dt(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=xe.NORMAL,this.shader=null,this._cachedTint=16777215,this.uvs=null,this.texture=t||xr.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Gi,this.size=4,this.start=0,this.pluginName="batch",this.isSprite=!0,this._roundPixels=v.ROUND_PIXELS}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={roundPixels:{configurable:!0},width:{configurable:!0},height:{configurable:!0},anchor:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return t.prototype._onTextureUpdate=function(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=qe(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=qe(this.scale.y)*this._height/this._texture.orig.height)},t.prototype._onAnchorUpdate=function(){this._transformID=-1,this._transformTrimmedID=-1},t.prototype.calculateVertices=function(){var e=this._texture;if(this._transformID!==this.transform._worldID||this._textureID!==e._updateID){this._textureID!==e._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=e._updateID;var t=this.transform.worldTransform,r=t.a,n=t.b,i=t.c,o=t.d,s=t.tx,a=t.ty,c=this.vertexData,u=e.trim,h=e.orig,l=this._anchor,d=0,p=0,f=0,m=0;if(u?(d=(p=u.x-l._x*h.width)+u.width,f=(m=u.y-l._y*h.height)+u.height):(d=(p=-l._x*h.width)+h.width,f=(m=-l._y*h.height)+h.height),c[0]=r*p+i*m+s,c[1]=o*m+n*p+a,c[2]=r*d+i*m+s,c[3]=o*m+n*d+a,c[4]=r*d+i*f+s,c[5]=o*f+n*d+a,c[6]=r*p+i*f+s,c[7]=o*f+n*p+a,this._roundPixels)for(var v=0;v<8;v++)c[v]=Math.round(c[v])}},t.prototype.calculateTrimmedVertices=function(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;var e=this._texture,t=this.vertexTrimmedData,r=e.orig,n=this._anchor,i=this.transform.worldTransform,o=i.a,s=i.b,a=i.c,c=i.d,u=i.tx,h=i.ty,l=-n._x*r.width,d=l+r.width,p=-n._y*r.height,f=p+r.height;t[0]=o*l+a*p+u,t[1]=c*p+s*l+h,t[2]=o*d+a*p+u,t[3]=c*p+s*d+h,t[4]=o*d+a*f+u,t[5]=c*f+s*d+h,t[6]=o*l+a*f+u,t[7]=c*f+s*l+h},t.prototype._render=function(e){this.calculateVertices(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this)},t.prototype._calculateBounds=function(){var e=this._texture.trim,t=this._texture.orig;!e||e.width===t.width&&e.height===t.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))},t.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._texture.orig.width*-this._anchor._x,this._bounds.minY=this._texture.orig.height*-this._anchor._y,this._bounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._bounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Mt),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,Ui);var t=this._texture.orig.width,r=this._texture.orig.height,n=-t*this.anchor.x,i=0;return Ui.x>=n&&Ui.x<n+t&&(i=-r*this.anchor.y,Ui.y>=i&&Ui.y<i+r)},t.prototype.destroy=function(t){if(e.prototype.destroy.call(this,t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null,"boolean"==typeof t?t:t&&t.texture){var r="boolean"==typeof t?t:t&&t.baseTexture;this._texture.destroy(!!r)}this._texture=null,this.shader=null},t.from=function(e,r){return new t(e instanceof xr?e:xr.from(e,r))},r.roundPixels.set=function(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e},r.roundPixels.get=function(){return this._roundPixels},r.width.get=function(){return Math.abs(this.scale.x)*this._texture.orig.width},r.width.set=function(e){var t=qe(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e},r.height.get=function(){return Math.abs(this.scale.y)*this._texture.orig.height},r.height.set=function(e){var t=qe(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e},r.anchor.get=function(){return this._anchor},r.anchor.set=function(e){this._anchor.copyFrom(e)},r.tint.get=function(){return this._tint},r.tint.set=function(e){this._tint=e,this._tintRGB=(e>>16)+(65280&e)+((255&e)<<16)},r.texture.get=function(){return this._texture},r.texture.set=function(e){this._texture!==e&&(this._texture=e||xr.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,e&&(e.baseTexture.valid?this._onTextureUpdate():e.once("update",this._onTextureUpdate,this)))},Object.defineProperties(t.prototype,r),t}(Ut),Vi={LINEAR_VERTICAL:0,LINEAR_HORIZONTAL:1},zi={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:Vi.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100,leading:0},Hi=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],Wi=function(e){this.styleID=0,this.reset(),Ki(this,e,e)},Yi={align:{configurable:!0},breakWords:{configurable:!0},dropShadow:{configurable:!0},dropShadowAlpha:{configurable:!0},dropShadowAngle:{configurable:!0},dropShadowBlur:{configurable:!0},dropShadowColor:{configurable:!0},dropShadowDistance:{configurable:!0},fill:{configurable:!0},fillGradientType:{configurable:!0},fillGradientStops:{configurable:!0},fontFamily:{configurable:!0},fontSize:{configurable:!0},fontStyle:{configurable:!0},fontVariant:{configurable:!0},fontWeight:{configurable:!0},letterSpacing:{configurable:!0},lineHeight:{configurable:!0},leading:{configurable:!0},lineJoin:{configurable:!0},miterLimit:{configurable:!0},padding:{configurable:!0},stroke:{configurable:!0},strokeThickness:{configurable:!0},textBaseline:{configurable:!0},trim:{configurable:!0},whiteSpace:{configurable:!0},wordWrap:{configurable:!0},wordWrapWidth:{configurable:!0}};function qi(e){return"number"==typeof e?Be(e):("string"==typeof e&&0===e.indexOf("0x")&&(e=e.replace("0x","#")),e)}function Ji(e){if(Array.isArray(e)){for(var t=0;t<e.length;++t)e[t]=qi(e[t]);return e}return qi(e)}function Ki(e,t,r){for(var n in r)Array.isArray(t[n])?e[n]=t[n].slice():e[n]=t[n]}Wi.prototype.clone=function(){var e={};return Ki(e,this,zi),new Wi(e)},Wi.prototype.reset=function(){Ki(this,zi,zi)},Yi.align.get=function(){return this._align},Yi.align.set=function(e){this._align!==e&&(this._align=e,this.styleID++)},Yi.breakWords.get=function(){return this._breakWords},Yi.breakWords.set=function(e){this._breakWords!==e&&(this._breakWords=e,this.styleID++)},Yi.dropShadow.get=function(){return this._dropShadow},Yi.dropShadow.set=function(e){this._dropShadow!==e&&(this._dropShadow=e,this.styleID++)},Yi.dropShadowAlpha.get=function(){return this._dropShadowAlpha},Yi.dropShadowAlpha.set=function(e){this._dropShadowAlpha!==e&&(this._dropShadowAlpha=e,this.styleID++)},Yi.dropShadowAngle.get=function(){return this._dropShadowAngle},Yi.dropShadowAngle.set=function(e){this._dropShadowAngle!==e&&(this._dropShadowAngle=e,this.styleID++)},Yi.dropShadowBlur.get=function(){return this._dropShadowBlur},Yi.dropShadowBlur.set=function(e){this._dropShadowBlur!==e&&(this._dropShadowBlur=e,this.styleID++)},Yi.dropShadowColor.get=function(){return this._dropShadowColor},Yi.dropShadowColor.set=function(e){var t=Ji(e);this._dropShadowColor!==t&&(this._dropShadowColor=t,this.styleID++)},Yi.dropShadowDistance.get=function(){return this._dropShadowDistance},Yi.dropShadowDistance.set=function(e){this._dropShadowDistance!==e&&(this._dropShadowDistance=e,this.styleID++)},Yi.fill.get=function(){return this._fill},Yi.fill.set=function(e){var t=Ji(e);this._fill!==t&&(this._fill=t,this.styleID++)},Yi.fillGradientType.get=function(){return this._fillGradientType},Yi.fillGradientType.set=function(e){this._fillGradientType!==e&&(this._fillGradientType=e,this.styleID++)},Yi.fillGradientStops.get=function(){return this._fillGradientStops},Yi.fillGradientStops.set=function(e){(function(e,t){if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0})(this._fillGradientStops,e)||(this._fillGradientStops=e,this.styleID++)},Yi.fontFamily.get=function(){return this._fontFamily},Yi.fontFamily.set=function(e){this.fontFamily!==e&&(this._fontFamily=e,this.styleID++)},Yi.fontSize.get=function(){return this._fontSize},Yi.fontSize.set=function(e){this._fontSize!==e&&(this._fontSize=e,this.styleID++)},Yi.fontStyle.get=function(){return this._fontStyle},Yi.fontStyle.set=function(e){this._fontStyle!==e&&(this._fontStyle=e,this.styleID++)},Yi.fontVariant.get=function(){return this._fontVariant},Yi.fontVariant.set=function(e){this._fontVariant!==e&&(this._fontVariant=e,this.styleID++)},Yi.fontWeight.get=function(){return this._fontWeight},Yi.fontWeight.set=function(e){this._fontWeight!==e&&(this._fontWeight=e,this.styleID++)},Yi.letterSpacing.get=function(){return this._letterSpacing},Yi.letterSpacing.set=function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.styleID++)},Yi.lineHeight.get=function(){return this._lineHeight},Yi.lineHeight.set=function(e){this._lineHeight!==e&&(this._lineHeight=e,this.styleID++)},Yi.leading.get=function(){return this._leading},Yi.leading.set=function(e){this._leading!==e&&(this._leading=e,this.styleID++)},Yi.lineJoin.get=function(){return this._lineJoin},Yi.lineJoin.set=function(e){this._lineJoin!==e&&(this._lineJoin=e,this.styleID++)},Yi.miterLimit.get=function(){return this._miterLimit},Yi.miterLimit.set=function(e){this._miterLimit!==e&&(this._miterLimit=e,this.styleID++)},Yi.padding.get=function(){return this._padding},Yi.padding.set=function(e){this._padding!==e&&(this._padding=e,this.styleID++)},Yi.stroke.get=function(){return this._stroke},Yi.stroke.set=function(e){var t=Ji(e);this._stroke!==t&&(this._stroke=t,this.styleID++)},Yi.strokeThickness.get=function(){return this._strokeThickness},Yi.strokeThickness.set=function(e){this._strokeThickness!==e&&(this._strokeThickness=e,this.styleID++)},Yi.textBaseline.get=function(){return this._textBaseline},Yi.textBaseline.set=function(e){this._textBaseline!==e&&(this._textBaseline=e,this.styleID++)},Yi.trim.get=function(){return this._trim},Yi.trim.set=function(e){this._trim!==e&&(this._trim=e,this.styleID++)},Yi.whiteSpace.get=function(){return this._whiteSpace},Yi.whiteSpace.set=function(e){this._whiteSpace!==e&&(this._whiteSpace=e,this.styleID++)},Yi.wordWrap.get=function(){return this._wordWrap},Yi.wordWrap.set=function(e){this._wordWrap!==e&&(this._wordWrap=e,this.styleID++)},Yi.wordWrapWidth.get=function(){return this._wordWrapWidth},Yi.wordWrapWidth.set=function(e){this._wordWrapWidth!==e&&(this._wordWrapWidth=e,this.styleID++)},Wi.prototype.toFontString=function(){var e="number"==typeof this.fontSize?this.fontSize+"px":this.fontSize,t=this.fontFamily;Array.isArray(this.fontFamily)||(t=this.fontFamily.split(","));for(var r=t.length-1;r>=0;r--){var n=t[r].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&Hi.indexOf(n)<0&&(n='"'+n+'"'),t[r]=n}return this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+e+" "+t.join(",")},Object.defineProperties(Wi.prototype,Yi);var Zi=function(e,t,r,n,i,o,s,a,c){this.text=e,this.style=t,this.width=r,this.height=n,this.lines=i,this.lineWidths=o,this.lineHeight=s,this.maxLineWidth=a,this.fontProperties=c};Zi.measureText=function(e,t,r,n){void 0===n&&(n=Zi._canvas),r=null==r?t.wordWrap:r;var i=t.toFontString(),o=Zi.measureFont(i);0===o.fontSize&&(o.fontSize=t.fontSize,o.ascent=t.fontSize);var s=n.getContext("2d");s.font=i;for(var a=(r?Zi.wordWrap(e,t,n):e).split(/(?:\r\n|\r|\n)/),c=new Array(a.length),u=0,h=0;h<a.length;h++){var l=s.measureText(a[h]).width+(a[h].length-1)*t.letterSpacing;c[h]=l,u=Math.max(u,l)}var d=u+t.strokeThickness;t.dropShadow&&(d+=t.dropShadowDistance);var p=t.lineHeight||o.fontSize+t.strokeThickness,f=Math.max(p,o.fontSize+t.strokeThickness)+(a.length-1)*(p+t.leading);return t.dropShadow&&(f+=t.dropShadowDistance),new Zi(e,t,d,f,a,c,p+t.leading,u,o)},Zi.wordWrap=function(e,t,r){void 0===r&&(r=Zi._canvas);for(var n=r.getContext("2d"),i=0,o="",s="",a={},c=t.letterSpacing,u=t.whiteSpace,h=Zi.collapseSpaces(u),l=Zi.collapseNewlines(u),d=!h,p=t.wordWrapWidth+c,f=Zi.tokenize(e),m=0;m<f.length;m++){var v=f[m];if(Zi.isNewline(v)){if(!l){s+=Zi.addLine(o),d=!h,o="",i=0;continue}v=" "}if(h){var g=Zi.isBreakingSpace(v),y=Zi.isBreakingSpace(o[o.length-1]);if(g&&y)continue}var _=Zi.getFromCache(v,c,a,n);if(_>p)if(""!==o&&(s+=Zi.addLine(o),o="",i=0),Zi.canBreakWords(v,t.breakWords))for(var b=v.split(""),x=0;x<b.length;x++){for(var w=b[x],T=1;b[x+T];){var S=b[x+T],C=w[w.length-1];if(Zi.canBreakChars(C,S,v,x,t.breakWords))break;w+=S,T++}x+=w.length-1;var P=Zi.getFromCache(w,c,a,n);P+i>p&&(s+=Zi.addLine(o),d=!1,o="",i=0),o+=w,i+=P}else{o.length>0&&(s+=Zi.addLine(o),o="",i=0);var E=m===f.length-1;s+=Zi.addLine(v,!E),d=!1,o="",i=0}else _+i>p&&(d=!1,s+=Zi.addLine(o),o="",i=0),(o.length>0||!Zi.isBreakingSpace(v)||d)&&(o+=v,i+=_)}return s+Zi.addLine(o,!1)},Zi.addLine=function(e,t){return void 0===t&&(t=!0),e=Zi.trimRight(e),t?e+"\n":e},Zi.getFromCache=function(e,t,r,n){var i=r[e];if(void 0===i){var o=e.length*t;i=n.measureText(e).width+o,r[e]=i}return i},Zi.collapseSpaces=function(e){return"normal"===e||"pre-line"===e},Zi.collapseNewlines=function(e){return"normal"===e},Zi.trimRight=function(e){if("string"!=typeof e)return"";for(var t=e.length-1;t>=0;t--){var r=e[t];if(!Zi.isBreakingSpace(r))break;e=e.slice(0,-1)}return e},Zi.isNewline=function(e){return"string"==typeof e&&Zi._newlines.indexOf(e.charCodeAt(0))>=0},Zi.isBreakingSpace=function(e){return"string"==typeof e&&Zi._breakingSpaces.indexOf(e.charCodeAt(0))>=0},Zi.tokenize=function(e){var t=[],r="";if("string"!=typeof e)return t;for(var n=0;n<e.length;n++){var i=e[n];Zi.isBreakingSpace(i)||Zi.isNewline(i)?(""!==r&&(t.push(r),r=""),t.push(i)):r+=i}return""!==r&&t.push(r),t},Zi.canBreakWords=function(e,t){return t},Zi.canBreakChars=function(e,t,r,n,i){return!0},Zi.measureFont=function(e){if(Zi._fonts[e])return Zi._fonts[e];var t={},r=Zi._canvas,n=Zi._context;n.font=e;var i=Zi.METRICS_STRING+Zi.BASELINE_SYMBOL,o=Math.ceil(n.measureText(i).width),s=Math.ceil(n.measureText(Zi.BASELINE_SYMBOL).width),a=2*s;s=s*Zi.BASELINE_MULTIPLIER|0,r.width=o,r.height=a,n.fillStyle="#f00",n.fillRect(0,0,o,a),n.font=e,n.textBaseline="alphabetic",n.fillStyle="#000",n.fillText(i,0,s);var c=n.getImageData(0,0,o,a).data,u=c.length,h=4*o,l=0,d=0,p=!1;for(l=0;l<s;++l){for(var f=0;f<h;f+=4)if(255!==c[d+f]){p=!0;break}if(p)break;d+=h}for(t.ascent=s-l,d=u-h,p=!1,l=a;l>s;--l){for(var m=0;m<h;m+=4)if(255!==c[d+m]){p=!0;break}if(p)break;d-=h}return t.descent=l-s,t.fontSize=t.ascent+t.descent,Zi._fonts[e]=t,t},Zi.clearMetrics=function(e){void 0===e&&(e=""),e?delete Zi._fonts[e]:Zi._fonts={}};var Qi=function(){try{var e=new OffscreenCanvas(0,0);return e.getContext("2d")?e:document.createElement("canvas")}catch(e){return document.createElement("canvas")}}();Qi.width=Qi.height=10,Zi._canvas=Qi,Zi._context=Qi.getContext("2d"),Zi._fonts={},Zi.METRICS_STRING="|Ã‰qÃ…",Zi.BASELINE_SYMBOL="M",Zi.BASELINE_MULTIPLIER=1.4,Zi._newlines=[10,13],Zi._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];var $i={texture:!0,children:!1,baseTexture:!0},eo=function(e){function t(t,r,n){(n=n||document.createElement("canvas")).width=3,n.height=3;var i=xr.from(n);i.orig=new Mt,i.trim=new Mt,e.call(this,i),this.canvas=n,this.context=this.canvas.getContext("2d"),this._resolution=v.RESOLUTION,this._autoResolution=!0,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=r,this.localStyleID=-1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={width:{configurable:!0},height:{configurable:!0},style:{configurable:!0},text:{configurable:!0},resolution:{configurable:!0}};return t.prototype.updateText=function(e){var t=this._style;if(this.localStyleID!==t.styleID&&(this.dirty=!0,this.localStyleID=t.styleID),this.dirty||!e){this._font=this._style.toFontString();var r,n,i=this.context,o=Zi.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),s=o.width,a=o.height,c=o.lines,u=o.lineHeight,h=o.lineWidths,l=o.maxLineWidth,d=o.fontProperties;this.canvas.width=Math.ceil((Math.max(1,s)+2*t.padding)*this._resolution),this.canvas.height=Math.ceil((Math.max(1,a)+2*t.padding)*this._resolution),i.scale(this._resolution,this._resolution),i.clearRect(0,0,this.canvas.width,this.canvas.height),i.font=this._font,i.lineWidth=t.strokeThickness,i.textBaseline=t.textBaseline,i.lineJoin=t.lineJoin,i.miterLimit=t.miterLimit;for(var p=t.dropShadow?2:1,f=0;f<p;++f){var m=t.dropShadow&&0===f,v=m?2*a:0,g=v*this.resolution;if(m){i.fillStyle="black",i.strokeStyle="black";var y=t.dropShadowColor,_=Le("number"==typeof y?y:Fe(y));i.shadowColor="rgba("+255*_[0]+","+255*_[1]+","+255*_[2]+","+t.dropShadowAlpha+")",i.shadowBlur=t.dropShadowBlur,i.shadowOffsetX=Math.cos(t.dropShadowAngle)*t.dropShadowDistance,i.shadowOffsetY=Math.sin(t.dropShadowAngle)*t.dropShadowDistance+g}else i.fillStyle=this._generateFillStyle(t,c),i.strokeStyle=t.stroke,i.shadowColor=0,i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0;for(var b=0;b<c.length;b++)r=t.strokeThickness/2,n=t.strokeThickness/2+b*u+d.ascent,"right"===t.align?r+=l-h[b]:"center"===t.align&&(r+=(l-h[b])/2),t.stroke&&t.strokeThickness&&this.drawLetterSpacing(c[b],r+t.padding,n+t.padding-v,!0),t.fill&&this.drawLetterSpacing(c[b],r+t.padding,n+t.padding-v)}this.updateTexture()}},t.prototype.drawLetterSpacing=function(e,t,r,n){void 0===n&&(n=!1);var i=this._style.letterSpacing;if(0!==i)for(var o=t,s=Array.from?Array.from(e):e.split(""),a=this.context.measureText(e).width,c=0,u=0;u<s.length;++u){var h=s[u];n?this.context.strokeText(h,o,r):this.context.fillText(h,o,r),o+=a-(c=this.context.measureText(e.substring(u+1)).width)+i,a=c}else n?this.context.strokeText(e,t,r):this.context.fillText(e,t,r)},t.prototype.updateTexture=function(){var e=this.canvas;if(this._style.trim){var t=tt(e);t.data&&(e.width=t.width,e.height=t.height,this.context.putImageData(t.data,0,0))}var r=this._texture,n=this._style,i=n.trim?0:n.padding,o=r.baseTexture;r.trim.width=r._frame.width=Math.ceil(e.width/this._resolution),r.trim.height=r._frame.height=Math.ceil(e.height/this._resolution),r.trim.x=-i,r.trim.y=-i,r.orig.width=r._frame.width-2*i,r.orig.height=r._frame.height-2*i,this._onTextureUpdate(),o.setRealSize(e.width,e.height,this._resolution),this.dirty=!1},t.prototype._render=function(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),e.prototype._render.call(this,t)},t.prototype.getLocalBounds=function(t){return this.updateText(!0),e.prototype.getLocalBounds.call(this,t)},t.prototype._calculateBounds=function(){this.updateText(!0),this.calculateVertices(),this._bounds.addQuad(this.vertexData)},t.prototype._onStyleChange=function(){this.dirty=!0},t.prototype._generateFillStyle=function(e,t){if(!Array.isArray(e.fill))return e.fill;if(1===e.fill.length)return e.fill[0];var r,n,i,o,s=Math.ceil(this.canvas.width/this._resolution),a=Math.ceil(this.canvas.height/this._resolution),c=e.fill.slice(),u=e.fillGradientStops.slice();if(!u.length)for(var h=c.length+1,l=1;l<h;++l)u.push(l/h);if(c.unshift(e.fill[0]),u.unshift(0),c.push(e.fill[e.fill.length-1]),u.push(1),e.fillGradientType===Vi.LINEAR_VERTICAL){r=this.context.createLinearGradient(s/2,0,s/2,a),n=(c.length+1)*t.length,i=0;for(var d=0;d<t.length;d++){i+=1;for(var p=0;p<c.length;p++)o="number"==typeof u[p]?u[p]/t.length+d/t.length:i/n,r.addColorStop(o,c[p]),i++}}else{r=this.context.createLinearGradient(0,a/2,s,a/2),n=c.length+1,i=1;for(var f=0;f<c.length;f++)o="number"==typeof u[f]?u[f]:i/n,r.addColorStop(o,c[f]),i++}return r},t.prototype.destroy=function(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},$i,t),e.prototype.destroy.call(this,t),this.context=null,this.canvas=null,this._style=null},r.width.get=function(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width},r.width.set=function(e){this.updateText(!0);var t=qe(this.scale.x)||1;this.scale.x=t*e/this._texture.orig.width,this._width=e},r.height.get=function(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height},r.height.set=function(e){this.updateText(!0);var t=qe(this.scale.y)||1;this.scale.y=t*e/this._texture.orig.height,this._height=e},r.style.get=function(){return this._style},r.style.set=function(e){e=e||{},this._style=e instanceof Wi?e:new Wi(e),this.localStyleID=-1,this.dirty=!0},r.text.get=function(){return this._text},r.text.set=function(e){e=String(null==e?"":e),this._text!==e&&(this._text=e,this.dirty=!0)},r.resolution.get=function(){return this._resolution},r.resolution.set=function(e){this._autoResolution=!1,this._resolution!==e&&(this._resolution=e,this.dirty=!0)},Object.defineProperties(t.prototype,r),t}(Xi);v.UPLOADS_PER_FRAME=4;var to=function(e){this.maxItemsPerFrame=e,this.itemsLeft=0};to.prototype.beginFrame=function(){this.itemsLeft=this.maxItemsPerFrame},to.prototype.allowedToUpload=function(){return this.itemsLeft-- >0};var ro=function(e){var t=this;this.limiter=new to(v.UPLOADS_PER_FRAME),this.renderer=e,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=function(){t.queue&&t.prepareItems()},this.registerFindHook(co),this.registerFindHook(uo),this.registerFindHook(no),this.registerFindHook(io),this.registerFindHook(oo),this.registerUploadHook(so),this.registerUploadHook(ao)};function no(e,t){var r=!1;if(e&&e._textures&&e._textures.length)for(var n=0;n<e._textures.length;n++)if(e._textures[n]instanceof xr){var i=e._textures[n].baseTexture;-1===t.indexOf(i)&&(t.push(i),r=!0)}return r}function io(e,t){return e instanceof sr&&(-1===t.indexOf(e)&&t.push(e),!0)}function oo(e,t){if(e._texture&&e._texture instanceof xr){var r=e._texture.baseTexture;return-1===t.indexOf(r)&&t.push(r),!0}return!1}function so(e,t){return t instanceof eo&&(t.updateText(!0),!0)}function ao(e,t){if(t instanceof Wi){var r=t.toFontString();return Zi.measureFont(r),!0}return!1}function co(e,t){if(e instanceof eo){-1===t.indexOf(e.style)&&t.push(e.style),-1===t.indexOf(e)&&t.push(e);var r=e._texture.baseTexture;return-1===t.indexOf(r)&&t.push(r),!0}return!1}function uo(e,t){return e instanceof Wi&&(-1===t.indexOf(e)&&t.push(e),!0)}ro.prototype.upload=function(e,t){"function"==typeof e&&(t=e,e=null),e&&this.add(e),this.queue.length?(t&&this.completes.push(t),this.ticking||(this.ticking=!0,qt.system.addOnce(this.tick,this,Wt.UTILITY))):t&&t()},ro.prototype.tick=function(){setTimeout(this.delayedTick,0)},ro.prototype.prepareItems=function(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){var e=this.queue[0],t=!1;if(e&&!e._destroyed)for(var r=0,n=this.uploadHooks.length;r<n;r++)if(this.uploadHooks[r](this.uploadHookHelper,e)){this.queue.shift(),t=!0;break}t||this.queue.shift()}if(this.queue.length)qt.system.addOnce(this.tick,this,Wt.UTILITY);else{this.ticking=!1;var i=this.completes.slice(0);this.completes.length=0;for(var o=0,s=i.length;o<s;o++)i[o]()}},ro.prototype.registerFindHook=function(e){return e&&this.addHooks.push(e),this},ro.prototype.registerUploadHook=function(e){return e&&this.uploadHooks.push(e),this},ro.prototype.add=function(e){for(var t=0,r=this.addHooks.length;t<r&&!this.addHooks[t](e,this.queue);t++);if(e instanceof Ut)for(var n=e.children.length-1;n>=0;n--)this.add(e.children[n]);return this},ro.prototype.destroy=function(){this.ticking&&qt.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null};var ho=function(e){function t(t){e.call(this,t),this.uploadHookHelper=this.renderer,this.registerFindHook(fo),this.registerUploadHook(lo),this.registerUploadHook(po)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(ro);function lo(e,t){return t instanceof sr&&(t._glTextures[e.CONTEXT_UID]||e.texture.bind(t),!0)}function po(e,t){return t instanceof ji&&((t.dirty||t.clearDirty||!t._webGL[e.plugins.graphics.CONTEXT_UID])&&e.plugins.graphics.updateGraphics(t),!0)}function fo(e,t){return e instanceof ji&&(t.push(e),!0)}var mo=function(e){this.maxMilliseconds=e,this.frameStart=0};mo.prototype.beginFrame=function(){this.frameStart=Date.now()},mo.prototype.allowedToUpload=function(){return Date.now()-this.frameStart<this.maxMilliseconds};var vo={BasePrepare:ro,CountLimiter:to,Prepare:ho,TimeLimiter:mo},go=function e(t){var r=this;t=Object.assign({forceCanvas:!1},t),this.renderer=zn(t),this.stage=new Ut,e._plugins.forEach((function(e){e.init.call(r,t)}))},yo={view:{configurable:!0},screen:{configurable:!0}};go.registerPlugin=function(e){go._plugins.push(e)},go.prototype.render=function(){this.renderer.render(this.stage)},yo.view.get=function(){return this.renderer.view},yo.screen.get=function(){return this.renderer.screen},go.prototype.destroy=function(e,t){var r=this,n=go._plugins.slice(0);n.reverse(),n.forEach((function(e){e.destroy.call(r)})),this.stage.destroy(t),this.stage=null,this.renderer.destroy(e),this.renderer=null,this._options=null},Object.defineProperties(go.prototype,yo),go._plugins=[];var _o=function(){};_o.init=function(e){var t=this;Object.defineProperty(this,"resizeTo",{set:function(e){window.removeEventListener("resize",this.resize),this._resizeTo=e,e&&(window.addEventListener("resize",this.resize),this.resize())},get:function(){return this._resizeTo}}),this.resize=function(){t._resizeTo&&(t._resizeTo===window?t.renderer.resize(window.innerWidth,window.innerHeight):t.renderer.resize(t._resizeTo.clientWidth,t._resizeTo.clientHeight))},this._resizeTo=null,this.resizeTo=e.resizeTo||null},_o.destroy=function(){this.resizeTo=null,this.resize=null},go.registerPlugin(_o);var bo=function(e,t){t=t||{};for(var r={key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[t.strictMode?"strict":"loose"].exec(e),i={},o=14;o--;)i[r.key[o]]=n[o]||"";return i[r.q.name]={},i[r.key[12]].replace(r.q.parser,(function(e,t,n){t&&(i[r.q.name][t]=n)})),i},xo=function(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}(r((function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(t,r,i){void 0===r&&(r=!1),n(this,e),this._fn=t,this._once=r,this._thisArg=i,this._next=this._prev=this._owner=null}return r(e,[{key:"detach",value:function(){return null!==this._owner&&(this._owner.detach(this),!0)}}]),e}();function o(e,t){return e._head?(e._tail._next=t,t._prev=e._tail,e._tail=t):(e._head=t,e._tail=t),t._owner=e,t}var s=function(){function e(){n(this,e),this._head=this._tail=void 0}return r(e,[{key:"handlers",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0],t=this._head;if(e)return!!t;for(var r=[];t;)r.push(t),t=t._next;return r}},{key:"has",value:function(e){if(!(e instanceof i))throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");return e._owner===this}},{key:"dispatch",value:function(){var e=arguments,t=this._head;if(!t)return!1;for(;t;)t._once&&this.detach(t),t._fn.apply(t._thisArg,e),t=t._next;return!0}},{key:"add",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof e)throw new Error("MiniSignal#add(): First arg must be a Function.");return o(this,new i(e,!1,t))}},{key:"once",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if("function"!=typeof e)throw new Error("MiniSignal#once(): First arg must be a Function.");return o(this,new i(e,!0,t))}},{key:"detach",value:function(e){if(!(e instanceof i))throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");return e._owner!==this||(e._prev&&(e._prev._next=e._next),e._next&&(e._next._prev=e._prev),e===this._head?(this._head=e._next,null===e._next&&(this._tail=null)):e===this._tail&&(this._tail=e._prev,this._tail._next=null),e._owner=null),this}},{key:"detachAll",value:function(){var e=this._head;if(!e)return this;for(this._head=this._tail=null;e;)e._owner=null,e=e._next;return this}}]),e}();s.MiniSignalBinding=i,t.default=s,e.exports=t.default})));function wo(){}function To(e,t,r,n){var i=0,o=e.length;!function s(a){a||i===o?r&&r(a):n?setTimeout((function(){t(e[i++],s)}),1):t(e[i++],s)}()}function So(e){return function(){if(null===e)throw new Error("Callback was already called.");var t=e;e=null,t.apply(this,arguments)}}var Co={};function Po(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Eo(e,t,r){return t&&Po(e.prototype,t),r&&Po(e,r),e}var Io=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),Ao=null;function Mo(){}var Oo=function(){function e(t,r,n){if("string"!=typeof t||"string"!=typeof r)throw new Error("Both name and url are required for constructing a resource.");n=n||{},this._flags=0,this._setFlag(e.STATUS_FLAGS.DATA_URL,0===r.indexOf("data:")),this.name=t,this.url=r,this.extension=this._getExtension(),this.data=null,this.crossOrigin=!0===n.crossOrigin?"anonymous":n.crossOrigin,this.timeout=n.timeout||0,this.loadType=n.loadType||this._determineLoadType(),this.xhrType=n.xhrType,this.metadata=n.metadata||{},this.error=null,this.xhr=null,this.children=[],this.type=e.TYPE.UNKNOWN,this.progressChunk=0,this._dequeue=Mo,this._onLoadBinding=null,this._elementTimer=0,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundOnTimeout=this._onTimeout.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnTimeout=this._xhrOnTimeout.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this.onStart=new xo,this.onProgress=new xo,this.onComplete=new xo,this.onAfterMiddleware=new xo}e.setExtensionLoadType=function(t,r){Ro(e._loadTypeMap,t,r)},e.setExtensionXhrType=function(t,r){Ro(e._xhrTypeMap,t,r)};var t=e.prototype;return t.complete=function(){this._clearEvents(),this._finish()},t.abort=function(t){if(!this.error){if(this.error=new Error(t),this._clearEvents(),this.xhr)this.xhr.abort();else if(this.xdr)this.xdr.abort();else if(this.data)if(this.data.src)this.data.src=e.EMPTY_GIF;else for(;this.data.firstChild;)this.data.removeChild(this.data.firstChild);this._finish()}},t.load=function(t){var r=this;if(!this.isLoading)if(this.isComplete)t&&setTimeout((function(){return t(r)}),1);else switch(t&&this.onComplete.once(t),this._setFlag(e.STATUS_FLAGS.LOADING,!0),this.onStart.dispatch(this),!1!==this.crossOrigin&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case e.LOAD_TYPE.IMAGE:this.type=e.TYPE.IMAGE,this._loadElement("image");break;case e.LOAD_TYPE.AUDIO:this.type=e.TYPE.AUDIO,this._loadSourceElement("audio");break;case e.LOAD_TYPE.VIDEO:this.type=e.TYPE.VIDEO,this._loadSourceElement("video");break;case e.LOAD_TYPE.XHR:default:Io&&this.crossOrigin?this._loadXdr():this._loadXhr()}},t._hasFlag=function(e){return 0!=(this._flags&e)},t._setFlag=function(e,t){this._flags=t?this._flags|e:this._flags&~e},t._clearEvents=function(){clearTimeout(this._elementTimer),this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError,!1),this.data.removeEventListener("load",this._boundComplete,!1),this.data.removeEventListener("progress",this._boundOnProgress,!1),this.data.removeEventListener("canplaythrough",this._boundComplete,!1)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError,!1),this.xhr.removeEventListener("timeout",this._boundXhrOnTimeout,!1),this.xhr.removeEventListener("abort",this._boundXhrOnAbort,!1),this.xhr.removeEventListener("progress",this._boundOnProgress,!1),this.xhr.removeEventListener("load",this._boundXhrOnLoad,!1)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null))},t._finish=function(){if(this.isComplete)throw new Error("Complete called again for an already completed resource.");this._setFlag(e.STATUS_FLAGS.COMPLETE,!0),this._setFlag(e.STATUS_FLAGS.LOADING,!1),this.onComplete.dispatch(this)},t._loadElement=function(e){this.metadata.loadElement?this.data=this.metadata.loadElement:"image"===e&&void 0!==window.Image?this.data=new Image:this.data=document.createElement(e),this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.metadata.skipSource||(this.data.src=this.url),this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))},t._loadSourceElement=function(e){if(this.metadata.loadElement?this.data=this.metadata.loadElement:"audio"===e&&void 0!==window.Audio?this.data=new Audio:this.data=document.createElement(e),null!==this.data){if(this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),!this.metadata.skipSource)if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var t=this.metadata.mimeType,r=0;r<this.url.length;++r)this.data.appendChild(this._createSource(e,this.url[r],Array.isArray(t)?t[r]:t));else{var n=this.metadata.mimeType;this.data.appendChild(this._createSource(e,this.url,Array.isArray(n)?n[0]:n))}this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load(),this.timeout&&(this._elementTimer=setTimeout(this._boundOnTimeout,this.timeout))}else this.abort("Unsupported element: "+e)},t._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var t=this.xhr=new XMLHttpRequest;t.open("GET",this.url,!0),t.timeout=this.timeout,this.xhrType===e.XHR_RESPONSE_TYPE.JSON||this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT?t.responseType=e.XHR_RESPONSE_TYPE.TEXT:t.responseType=this.xhrType,t.addEventListener("error",this._boundXhrOnError,!1),t.addEventListener("timeout",this._boundXhrOnTimeout,!1),t.addEventListener("abort",this._boundXhrOnAbort,!1),t.addEventListener("progress",this._boundOnProgress,!1),t.addEventListener("load",this._boundXhrOnLoad,!1),t.send()},t._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var e=this.xhr=new XDomainRequest;e.timeout=this.timeout||5e3,e.onerror=this._boundXhrOnError,e.ontimeout=this._boundXhrOnTimeout,e.onprogress=this._boundOnProgress,e.onload=this._boundXhrOnLoad,e.open("GET",this.url,!0),setTimeout((function(){return e.send()}),1)},t._createSource=function(e,t,r){r||(r=e+"/"+this._getExtension(t));var n=document.createElement("source");return n.src=t,n.type=r,n},t._onError=function(e){this.abort("Failed to load element using: "+e.target.nodeName)},t._onProgress=function(e){e&&e.lengthComputable&&this.onProgress.dispatch(this,e.loaded/e.total)},t._onTimeout=function(){this.abort("Load timed out.")},t._xhrOnError=function(){var e=this.xhr;this.abort(Do(e)+" Request failed. Status: "+e.status+', text: "'+e.statusText+'"')},t._xhrOnTimeout=function(){var e=this.xhr;this.abort(Do(e)+" Request timed out.")},t._xhrOnAbort=function(){var e=this.xhr;this.abort(Do(e)+" Request was aborted by the user.")},t._xhrOnLoad=function(){var t=this.xhr,r="",n=void 0===t.status?200:t.status;if(""!==t.responseType&&"text"!==t.responseType&&void 0!==t.responseType||(r=t.responseText),0===n&&(r.length>0||t.responseType===e.XHR_RESPONSE_TYPE.BUFFER)?n=200:1223===n&&(n=204),2==(n/100|0)){if(this.xhrType===e.XHR_RESPONSE_TYPE.TEXT)this.data=r,this.type=e.TYPE.TEXT;else if(this.xhrType===e.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(r),this.type=e.TYPE.JSON}catch(e){return void this.abort("Error trying to parse loaded json: "+e)}else if(this.xhrType===e.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var i=new DOMParser;this.data=i.parseFromString(r,"text/xml")}else{var o=document.createElement("div");o.innerHTML=r,this.data=o}this.type=e.TYPE.XML}catch(e){return void this.abort("Error trying to parse loaded xml: "+e)}else this.data=t.response||r;this.complete()}else this.abort("["+t.status+"] "+t.statusText+": "+t.responseURL)},t._determineCrossOrigin=function(e,t){if(0===e.indexOf("data:"))return"";if(window.origin!==window.location.origin)return"anonymous";t=t||window.location,Ao||(Ao=document.createElement("a")),Ao.href=e;var r=!(e=bo(Ao.href,{strictMode:!0})).port&&""===t.port||e.port===t.port,n=e.protocol?e.protocol+":":"";return e.host===t.hostname&&r&&n===t.protocol?"":"anonymous"},t._determineXhrType=function(){return e._xhrTypeMap[this.extension]||e.XHR_RESPONSE_TYPE.TEXT},t._determineLoadType=function(){return e._loadTypeMap[this.extension]||e.LOAD_TYPE.XHR},t._getExtension=function(){var e=this.url,t="";if(this.isDataUrl){var r=e.indexOf("/");t=e.substring(r+1,e.indexOf(";",r))}else{var n=e.indexOf("?"),i=e.indexOf("#"),o=Math.min(n>-1?n:e.length,i>-1?i:e.length);t=(e=e.substring(0,o)).substring(e.lastIndexOf(".")+1)}return t.toLowerCase()},t._getMimeFromXhrType=function(t){switch(t){case e.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case e.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case e.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case e.XHR_RESPONSE_TYPE.JSON:return"application/json";case e.XHR_RESPONSE_TYPE.DEFAULT:case e.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},Eo(e,[{key:"isDataUrl",get:function(){return this._hasFlag(e.STATUS_FLAGS.DATA_URL)}},{key:"isComplete",get:function(){return this._hasFlag(e.STATUS_FLAGS.COMPLETE)}},{key:"isLoading",get:function(){return this._hasFlag(e.STATUS_FLAGS.LOADING)}}]),e}();function Ro(e,t,r){t&&0===t.indexOf(".")&&(t=t.substring(1)),t&&(e[t]=r)}function Do(e){return e.toString().replace("object ","")}Oo.STATUS_FLAGS={NONE:0,DATA_URL:1,COMPLETE:2,LOADING:4},Oo.TYPE={UNKNOWN:0,JSON:1,XML:2,IMAGE:3,AUDIO:4,VIDEO:5,TEXT:6},Oo.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},Oo.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},Oo._loadTypeMap={gif:Oo.LOAD_TYPE.IMAGE,png:Oo.LOAD_TYPE.IMAGE,bmp:Oo.LOAD_TYPE.IMAGE,jpg:Oo.LOAD_TYPE.IMAGE,jpeg:Oo.LOAD_TYPE.IMAGE,tif:Oo.LOAD_TYPE.IMAGE,tiff:Oo.LOAD_TYPE.IMAGE,webp:Oo.LOAD_TYPE.IMAGE,tga:Oo.LOAD_TYPE.IMAGE,svg:Oo.LOAD_TYPE.IMAGE,"svg+xml":Oo.LOAD_TYPE.IMAGE,mp3:Oo.LOAD_TYPE.AUDIO,ogg:Oo.LOAD_TYPE.AUDIO,wav:Oo.LOAD_TYPE.AUDIO,mp4:Oo.LOAD_TYPE.VIDEO,webm:Oo.LOAD_TYPE.VIDEO},Oo._xhrTypeMap={xhtml:Oo.XHR_RESPONSE_TYPE.DOCUMENT,html:Oo.XHR_RESPONSE_TYPE.DOCUMENT,htm:Oo.XHR_RESPONSE_TYPE.DOCUMENT,xml:Oo.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Oo.XHR_RESPONSE_TYPE.DOCUMENT,svg:Oo.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Oo.XHR_RESPONSE_TYPE.DOCUMENT,gif:Oo.XHR_RESPONSE_TYPE.BLOB,png:Oo.XHR_RESPONSE_TYPE.BLOB,bmp:Oo.XHR_RESPONSE_TYPE.BLOB,jpg:Oo.XHR_RESPONSE_TYPE.BLOB,jpeg:Oo.XHR_RESPONSE_TYPE.BLOB,tif:Oo.XHR_RESPONSE_TYPE.BLOB,tiff:Oo.XHR_RESPONSE_TYPE.BLOB,webp:Oo.XHR_RESPONSE_TYPE.BLOB,tga:Oo.XHR_RESPONSE_TYPE.BLOB,json:Oo.XHR_RESPONSE_TYPE.JSON,text:Oo.XHR_RESPONSE_TYPE.TEXT,txt:Oo.XHR_RESPONSE_TYPE.TEXT,ttf:Oo.XHR_RESPONSE_TYPE.BUFFER,otf:Oo.XHR_RESPONSE_TYPE.BUFFER},Oo.EMPTY_GIF="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";var ko=window.URL||window.webkitURL,Lo={caching:function(e,t){var r=this;Co[e.url]?(e.data=Co[e.url],e.complete()):e.onComplete.once((function(){return Co[r.url]=r.data})),t()},parsing:function(e,t){if(e.data){if(e.xhr&&e.xhrType===Oo.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof e.data){if(0===e.data.type.indexOf("image")){var r=ko.createObjectURL(e.data);return e.blob=e.data,e.data=new Image,e.data.src=r,e.type=Oo.TYPE.IMAGE,void(e.data.onload=function(){ko.revokeObjectURL(r),e.data.onload=null,t()})}}else{var n=e.xhr.getResponseHeader("content-type");if(n&&0===n.indexOf("image"))return e.data=new Image,e.data.src="data:"+n+";base64,"+function(e){for(var t="",r=0;r<e.length;){for(var n=[0,0,0],i=[0,0,0,0],o=0;o<n.length;++o)r<e.length?n[o]=255&e.charCodeAt(r++):n[o]=0;switch(i[0]=n[0]>>2,i[1]=(3&n[0])<<4|n[1]>>4,i[2]=(15&n[1])<<2|n[2]>>6,i[3]=63&n[2],r-(e.length-1)){case 2:i[3]=64,i[2]=64;break;case 1:i[3]=64}for(var s=0;s<i.length;++s)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(i[s])}return t}(e.xhr.responseText),e.type=Oo.TYPE.IMAGE,void(e.data.onload=function(){e.data.onload=null,t()})}t()}else t()}},Bo=/(#[\w-]+)?$/,Fo=function(){function e(t,r){var n=this;void 0===t&&(t=""),void 0===r&&(r=10),this.baseUrl=t,this.progress=0,this.loading=!1,this.defaultQueryString="",this._beforeMiddleware=[],this._afterMiddleware=[],this._resourcesParsing=[],this._boundLoadResource=function(e,t){return n._loadResource(e,t)},this._queue=function(e,t){if(null==t)t=1;else if(0===t)throw new Error("Concurrency must not be zero");var r=0,n={_tasks:[],concurrency:t,saturated:wo,unsaturated:wo,buffer:t/4,empty:wo,drain:wo,error:wo,started:!1,paused:!1,push:function(e,t){i(e,!1,t)},kill:function(){r=0,n.drain=wo,n.started=!1,n._tasks=[]},unshift:function(e,t){i(e,!0,t)},process:function(){for(;!n.paused&&r<n.concurrency&&n._tasks.length;){var t=n._tasks.shift();0===n._tasks.length&&n.empty(),(r+=1)===n.concurrency&&n.saturated(),e(t.data,So(o(t)))}},length:function(){return n._tasks.length},running:function(){return r},idle:function(){return n._tasks.length+r===0},pause:function(){!0!==n.paused&&(n.paused=!0)},resume:function(){if(!1!==n.paused){n.paused=!1;for(var e=1;e<=n.concurrency;e++)n.process()}}};function i(e,t,r){if(null!=r&&"function"!=typeof r)throw new Error("task callback must be a function");if(n.started=!0,null==e&&n.idle())setTimeout((function(){return n.drain()}),1);else{var i={data:e,callback:"function"==typeof r?r:wo};t?n._tasks.unshift(i):n._tasks.push(i),setTimeout((function(){return n.process()}),1)}}function o(e){return function(){r-=1,e.callback.apply(e,arguments),null!=arguments[0]&&n.error(arguments[0],e.data),r<=n.concurrency-n.buffer&&n.unsaturated(),n.idle()&&n.drain(),n.process()}}return n}(this._boundLoadResource,r),this._queue.pause(),this.resources={},this.onProgress=new xo,this.onError=new xo,this.onLoad=new xo,this.onStart=new xo,this.onComplete=new xo;for(var i=0;i<e._defaultBeforeMiddleware.length;++i)this.pre(e._defaultBeforeMiddleware[i]);for(var o=0;o<e._defaultAfterMiddleware.length;++o)this.use(e._defaultAfterMiddleware[o])}var t=e.prototype;return t.add=function(e,t,r,n){if(Array.isArray(e)){for(var i=0;i<e.length;++i)this.add(e[i]);return this}if("object"==typeof e&&(n=t||e.callback||e.onComplete,r=e,t=e.url,e=e.name||e.key||e.url),"string"!=typeof t&&(n=r,r=t,t=e),"string"!=typeof t)throw new Error("No url passed to add resource to loader.");if("function"==typeof r&&(n=r,r=null),this.loading&&(!r||!r.parentResource))throw new Error("Cannot add resources while the loader is running.");if(this.resources[e])throw new Error('Resource named "'+e+'" already exists.');if(t=this._prepareUrl(t),this.resources[e]=new Oo(e,t,r),"function"==typeof n&&this.resources[e].onAfterMiddleware.once(n),this.loading){for(var o=r.parentResource,s=[],a=0;a<o.children.length;++a)o.children[a].isComplete||s.push(o.children[a]);var c=o.progressChunk*(s.length+1)/(s.length+2);o.children.push(this.resources[e]),o.progressChunk=c;for(var u=0;u<s.length;++u)s[u].progressChunk=c;this.resources[e].progressChunk=c}return this._queue.push(this.resources[e]),this},t.pre=function(e){return this._beforeMiddleware.push(e),this},t.use=function(e){return this._afterMiddleware.push(e),this},t.reset=function(){for(var e in this.progress=0,this.loading=!1,this._queue.kill(),this._queue.pause(),this.resources){var t=this.resources[e];t._onLoadBinding&&t._onLoadBinding.detach(),t.isLoading&&t.abort()}return this.resources={},this},t.load=function(e){if("function"==typeof e&&this.onComplete.once(e),this.loading)return this;if(this._queue.idle())this._onStart(),this._onComplete();else{for(var t=100/this._queue._tasks.length,r=0;r<this._queue._tasks.length;++r)this._queue._tasks[r].data.progressChunk=t;this._onStart(),this._queue.resume()}return this},t._prepareUrl=function(e){var t,r=bo(e,{strictMode:!0});if(t=r.protocol||!r.path||0===e.indexOf("//")?e:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==e.charAt(0)?this.baseUrl+"/"+e:this.baseUrl+e,this.defaultQueryString){var n=Bo.exec(t)[0];-1!==(t=t.substr(0,t.length-n.length)).indexOf("?")?t+="&"+this.defaultQueryString:t+="?"+this.defaultQueryString,t+=n}return t},t._loadResource=function(e,t){var r=this;e._dequeue=t,To(this._beforeMiddleware,(function(t,n){t.call(r,e,(function(){n(e.isComplete?{}:null)}))}),(function(){e.isComplete?r._onLoad(e):(e._onLoadBinding=e.onComplete.once(r._onLoad,r),e.load())}),!0)},t._onStart=function(){this.progress=0,this.loading=!0,this.onStart.dispatch(this)},t._onComplete=function(){this.progress=100,this.loading=!1,this.onComplete.dispatch(this,this.resources)},t._onLoad=function(e){var t=this;e._onLoadBinding=null,this._resourcesParsing.push(e),e._dequeue(),To(this._afterMiddleware,(function(r,n){r.call(t,e,n)}),(function(){e.onAfterMiddleware.dispatch(e),t.progress=Math.min(100,t.progress+e.progressChunk),t.onProgress.dispatch(t,e),e.error?t.onError.dispatch(e.error,t,e):t.onLoad.dispatch(t,e),t._resourcesParsing.splice(t._resourcesParsing.indexOf(e),1),t._queue.idle()&&0===t._resourcesParsing.length&&t._onComplete()}),!0)},Eo(e,[{key:"concurrency",get:function(){return this._queue.concurrency},set:function(e){this._queue.concurrency=e}}]),e}();Fo._defaultBeforeMiddleware=[],Fo._defaultAfterMiddleware=[],Fo.pre=function(e){return Fo._defaultBeforeMiddleware.push(e),Fo},Fo.use=function(e){return Fo._defaultAfterMiddleware.push(e),Fo};var No=function(){};No.use=function(e,t){e.data&&e.type===Oo.TYPE.IMAGE&&(e.texture=xr.fromLoader(e.data,e.url,e.name)),t()};var jo=function(e){function t(r,n){var i=this;e.call(this,r,n),g.call(this);for(var o=0;o<t._plugins.length;++o){var s=t._plugins[o],a=s.pre,c=s.use;a&&this.pre(a),c&&this.use(c)}this.onStart.add((function(e){return i.emit("start",e)})),this.onProgress.add((function(e,t){return i.emit("progress",e,t)})),this.onError.add((function(e,t,r){return i.emit("error",e,t,r)})),this.onLoad.add((function(e,t){return i.emit("load",e,t)})),this.onComplete.add((function(e,t){return i.emit("complete",e,t)})),this._protected=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={shared:{configurable:!0}};return t.prototype.destroy=function(){this._protected||(this.removeAllListeners(),this.reset())},r.shared.get=function(){var e=t._shared;return e||((e=new t)._protected=!0,t._shared=e),e},Object.defineProperties(t,r),t}(Fo);Object.assign(jo.prototype,g.prototype),jo._plugins=[],jo.registerPlugin=function(e){return jo._plugins.push(e),e.add&&e.add(),jo},jo.registerPlugin({use:Lo.parsing}),jo.registerPlugin(No);var Uo=function(){};Uo.init=function(e){e=Object.assign({sharedLoader:!1},e),this.loader=e.sharedLoader?jo.shared:new jo},Uo.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)};var Go=Oo,Xo=function(e){function t(t,r,n,i){void 0===t&&(t=1500),void 0===n&&(n=16384),void 0===i&&(i=!1),e.call(this),n>16384&&(n=16384),this._properties=[!1,!0,!1,!1,!1],this._maxSize=t,this._batchSize=n,this._buffers=null,this._bufferUpdateIDs=[],this._updateID=0,this.interactiveChildren=!1,this.blendMode=xe.NORMAL,this.autoResize=i,this.roundPixels=!0,this.baseTexture=null,this.setProperties(r),this._tint=0,this.tintRgb=new Float32Array(4),this.tint=16777215}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={tint:{configurable:!0}};return t.prototype.setProperties=function(e){e&&(this._properties[0]="vertices"in e||"scale"in e?!!e.vertices||!!e.scale:this._properties[0],this._properties[1]="position"in e?!!e.position:this._properties[1],this._properties[2]="rotation"in e?!!e.rotation:this._properties[2],this._properties[3]="uvs"in e?!!e.uvs:this._properties[3],this._properties[4]="tint"in e||"alpha"in e?!!e.tint||!!e.alpha:this._properties[4])},t.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},r.tint.get=function(){return this._tint},r.tint.set=function(e){this._tint=e,Le(e,this.tintRgb)},t.prototype.render=function(e){var t=this;this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(this.baseTexture||(this.baseTexture=this.children[0]._texture.baseTexture,this.baseTexture.valid||this.baseTexture.once("update",(function(){return t.onChildrenChange(0)}))),e.batch.setObjectRenderer(e.plugins.particle),e.plugins.particle.render(this))},t.prototype.onChildrenChange=function(e){for(var t=Math.floor(e/this._batchSize);this._bufferUpdateIDs.length<t;)this._bufferUpdateIDs.push(0);this._bufferUpdateIDs[t]=++this._updateID},t.prototype.dispose=function(){if(this._buffers){for(var e=0;e<this._buffers.length;++e)this._buffers[e].destroy();this._buffers=null}},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.dispose(),this._properties=null,this._buffers=null,this._bufferUpdateIDs=null},Object.defineProperties(t.prototype,r),t}(Ut),Vo=function(e,t,r){this.geometry=new Dr,this.indexBuffer=null,this.size=r,this.dynamicProperties=[],this.staticProperties=[];for(var n=0;n<e.length;++n){var i=e[n];i={attributeName:i.attributeName,size:i.size,uploadFunction:i.uploadFunction,type:i.type||Ce.FLOAT,offset:i.offset},t[n]?this.dynamicProperties.push(i):this.staticProperties.push(i)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()};Vo.prototype.initBuffers=function(){var e=this.geometry,t=0;this.indexBuffer=new Er(ze(this.size),!0,!0),e.addIndex(this.indexBuffer),this.dynamicStride=0;for(var r=0;r<this.dynamicProperties.length;++r){var n=this.dynamicProperties[r];n.offset=t,t+=n.size,this.dynamicStride+=n.size}var i=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(i),this.dynamicDataUint32=new Uint32Array(i),this.dynamicBuffer=new Er(this.dynamicData,!1,!1);var o=0;this.staticStride=0;for(var s=0;s<this.staticProperties.length;++s){var a=this.staticProperties[s];a.offset=o,o+=a.size,this.staticStride+=a.size}var c=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(c),this.staticDataUint32=new Uint32Array(c),this.staticBuffer=new Er(this.staticData,!0,!1);for(var u=0;u<this.dynamicProperties.length;++u){var h=this.dynamicProperties[u];e.addAttribute(h.attributeName,this.dynamicBuffer,0,h.type===Ce.UNSIGNED_BYTE,h.type,4*this.dynamicStride,4*h.offset)}for(var l=0;l<this.staticProperties.length;++l){var d=this.staticProperties[l];e.addAttribute(d.attributeName,this.staticBuffer,0,d.type===Ce.UNSIGNED_BYTE,d.type,4*this.staticStride,4*d.offset)}},Vo.prototype.uploadDynamic=function(e,t,r){for(var n=0;n<this.dynamicProperties.length;n++){var i=this.dynamicProperties[n];i.uploadFunction(e,t,r,i.type===Ce.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++},Vo.prototype.uploadStatic=function(e,t,r){for(var n=0;n<this.staticProperties.length;n++){var i=this.staticProperties[n];i.uploadFunction(e,t,r,i.type===Ce.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++},Vo.prototype.destroy=function(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()};var zo=function(e){function t(t){e.call(this,t),this.shader=null,this.properties=null,this.tempMatrix=new yt,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:Ce.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=_n.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{})}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(e){var t=e.children,r=e._maxSize,n=e._batchSize,i=this.renderer,o=t.length;if(0!==o){o>r&&!e.autoResize&&(o=r);var s=e._buffers;s||(s=e._buffers=this.generateBuffers(e));var a=t[0]._texture.baseTexture;this.renderer.state.setBlendMode(Ue(e.blendMode,a.premultiplyAlpha));var c=i.gl,u=e.worldTransform.copyTo(this.tempMatrix);u.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=u.toArray(!0),this.shader.uniforms.uColor=Ge(e.tintRgb,e.worldAlpha,this.shader.uniforms.uColor,a.premultiplyAlpha),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);for(var h=!1,l=0,d=0;l<o;l+=n,d+=1){var p=o-l;p>n&&(p=n),d>=s.length&&s.push(this._generateOneMoreBuffer(e));var f=s[d];f.uploadDynamic(t,l,p);var m=e._bufferUpdateIDs[d]||0;(h=h||f._updateID<m)&&(f._updateID=e._updateID,f.uploadStatic(t,l,p)),i.geometry.bind(f.geometry),c.drawElements(c.TRIANGLES,6*p,c.UNSIGNED_SHORT,0)}}},t.prototype.generateBuffers=function(e){for(var t=[],r=e._maxSize,n=e._batchSize,i=e._properties,o=0;o<r;o+=n)t.push(new Vo(this.properties,i,n));return t},t.prototype._generateOneMoreBuffer=function(e){var t=e._batchSize,r=e._properties;return new Vo(this.properties,r,t)},t.prototype.uploadVertices=function(e,t,r,n,i,o){for(var s=0,a=0,c=0,u=0,h=0;h<r;++h){var l=e[t+h],d=l._texture,p=l.scale.x,f=l.scale.y,m=d.trim,v=d.orig;m?(s=(a=m.x-l.anchor.x*v.width)+m.width,c=(u=m.y-l.anchor.y*v.height)+m.height):(s=v.width*(1-l.anchor.x),a=v.width*-l.anchor.x,c=v.height*(1-l.anchor.y),u=v.height*-l.anchor.y),n[o]=a*p,n[o+1]=u*f,n[o+i]=s*p,n[o+i+1]=u*f,n[o+2*i]=s*p,n[o+2*i+1]=c*f,n[o+3*i]=a*p,n[o+3*i+1]=c*f,o+=4*i}},t.prototype.uploadPosition=function(e,t,r,n,i,o){for(var s=0;s<r;s++){var a=e[t+s].position;n[o]=a.x,n[o+1]=a.y,n[o+i]=a.x,n[o+i+1]=a.y,n[o+2*i]=a.x,n[o+2*i+1]=a.y,n[o+3*i]=a.x,n[o+3*i+1]=a.y,o+=4*i}},t.prototype.uploadRotation=function(e,t,r,n,i,o){for(var s=0;s<r;s++){var a=e[t+s].rotation;n[o]=a,n[o+i]=a,n[o+2*i]=a,n[o+3*i]=a,o+=4*i}},t.prototype.uploadUvs=function(e,t,r,n,i,o){for(var s=0;s<r;++s){var a=e[t+s]._texture._uvs;a?(n[o]=a.x0,n[o+1]=a.y0,n[o+i]=a.x1,n[o+i+1]=a.y1,n[o+2*i]=a.x2,n[o+2*i+1]=a.y2,n[o+3*i]=a.x3,n[o+3*i+1]=a.y3,o+=4*i):(n[o]=0,n[o+1]=0,n[o+i]=0,n[o+i+1]=0,n[o+2*i]=0,n[o+2*i+1]=0,n[o+3*i]=0,n[o+3*i+1]=0,o+=4*i)}},t.prototype.uploadTint=function(e,t,r,n,i,o){for(var s=0;s<r;++s){var a=e[t+s],c=a._texture.baseTexture.premultiplyAlpha,u=a.alpha,h=u<1&&c?Xe(a._tintRGB,u):a._tintRGB+(255*u<<24);n[o]=h,n[o+i]=h,n[o+2*i]=h,n[o+3*i]=h,o+=4*i}},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null},t}(Ur),Ho=function(e,t,r){void 0===r&&(r=null),this.baseTexture=e,this.textures={},this.animations={},this.data=t,this.resolution=this._updateResolution(r||(this.baseTexture.resource?this.baseTexture.resource.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null},Wo={BATCH_SIZE:{configurable:!0}};Wo.BATCH_SIZE.get=function(){return 1e3},Ho.prototype._updateResolution=function(e){var t=this.data.meta.scale,r=at(e,null);return null===r&&(r=void 0!==t?parseFloat(t):1),1!==r&&this.baseTexture.setResolution(r),r},Ho.prototype.parse=function(e){this._batchIndex=0,this._callback=e,this._frameKeys.length<=Ho.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()},Ho.prototype._processFrames=function(e){for(var t=e,r=Ho.BATCH_SIZE;t-e<r&&t<this._frameKeys.length;){var n=this._frameKeys[t],i=this._frames[n],o=i.frame;if(o){var s,a=null,c=!1!==i.trimmed&&i.sourceSize?i.sourceSize:i.frame,u=new Mt(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);s=i.rotated?new Mt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):new Mt(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),!1!==i.trimmed&&i.spriteSourceSize&&(a=new Mt(Math.floor(i.spriteSourceSize.x)/this.resolution,Math.floor(i.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new xr(this.baseTexture,s,u,a,i.rotated?2:0,i.anchor),xr.addToCache(this.textures[n],n)}t++}},Ho.prototype._processAnimations=function(){var e=this.data.animations||{};for(var t in e){this.animations[t]=[];for(var r=0;r<e[t].length;r++){var n=e[t][r];this.animations[t].push(this.textures[n])}}},Ho.prototype._parseComplete=function(){var e=this._callback;this._callback=null,this._batchIndex=0,e.call(this,this.textures)},Ho.prototype._nextBatch=function(){var e=this;this._processFrames(this._batchIndex*Ho.BATCH_SIZE),this._batchIndex++,setTimeout((function(){e._batchIndex*Ho.BATCH_SIZE<e._frameKeys.length?e._nextBatch():(e._processAnimations(),e._parseComplete())}),0)},Ho.prototype.destroy=function(e){for(var t in void 0===e&&(e=!1),this.textures)this.textures[t].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,e&&this.baseTexture.destroy(),this.baseTexture=null},Object.defineProperties(Ho,Wo);var Yo=function(){};Yo.use=function(e,t){var r=e.name+"_image";if(e.data&&e.type===Go.TYPE.JSON&&e.data.frames&&!this.resources[r]){var n={crossOrigin:e.crossOrigin,metadata:e.metadata.imageMetadata,parentResource:e},i=Yo.getResourcePath(e,this.baseUrl);this.add(r,i,n,(function(r){if(r.error)t(r.error);else{var n=new Ho(r.texture.baseTexture,e.data,e.url);n.parse((function(){e.spritesheet=n,e.textures=n.textures,t()}))}}))}else t()},Yo.getResourcePath=function(e,t){return e.isDataUrl?e.data.meta.image:ye.resolve(e.url.replace(t,""),e.data.meta.image)};var qo=new lt,Jo=function(e){function t(t,r,n){void 0===r&&(r=100),void 0===n&&(n=100),e.call(this,t),this.tileTransform=new It,this._width=r,this._height=n,this._canvasPattern=null,this.uvMatrix=t.uvMatrix||new Cn(t),this.pluginName="tilingSprite",this.uvRespectAnchor=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={clampMargin:{configurable:!0},tileScale:{configurable:!0},tilePosition:{configurable:!0},width:{configurable:!0},height:{configurable:!0}};return r.clampMargin.get=function(){return this.uvMatrix.clampMargin},r.clampMargin.set=function(e){this.uvMatrix.clampMargin=e,this.uvMatrix.update(!0)},r.tileScale.get=function(){return this.tileTransform.scale},r.tileScale.set=function(e){this.tileTransform.scale.copyFrom(e)},r.tilePosition.get=function(){return this.tileTransform.position},r.tilePosition.set=function(e){this.tileTransform.position.copyFrom(e)},t.prototype._onTextureUpdate=function(){this.uvMatrix&&(this.uvMatrix.texture=this._texture),this._cachedTint=16777215},t.prototype._render=function(e){var t=this._texture;t&&t.valid&&(this.tileTransform.updateLocalTransform(),this.uvMatrix.update(),e.batch.setObjectRenderer(e.plugins[this.pluginName]),e.plugins[this.pluginName].render(this))},t.prototype._calculateBounds=function(){var e=this._width*-this._anchor._x,t=this._height*-this._anchor._y,r=this._width*(1-this._anchor._x),n=this._height*(1-this._anchor._y);this._bounds.addFrame(this.transform,e,t,r,n)},t.prototype.getLocalBounds=function(t){return 0===this.children.length?(this._bounds.minX=this._width*-this._anchor._x,this._bounds.minY=this._height*-this._anchor._y,this._bounds.maxX=this._width*(1-this._anchor._x),this._bounds.maxY=this._height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new Mt),t=this._localBoundsRect),this._bounds.getRectangle(t)):e.prototype.getLocalBounds.call(this,t)},t.prototype.containsPoint=function(e){this.worldTransform.applyInverse(e,qo);var t=this._width,r=this._height,n=-t*this.anchor._x;if(qo.x>=n&&qo.x<n+t){var i=-r*this.anchor._y;if(qo.y>=i&&qo.y<i+r)return!0}return!1},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.tileTransform=null,this.uvMatrix=null},t.from=function(e,r,n){return new t(xr.from(e),r,n)},t.fromFrame=function(e,r,n){var i=$e[e];if(!i)throw new Error('The frameId "'+e+'" does not exist in the texture cache '+this);return new t(i,r,n)},t.fromImage=function(e,r,n,i){return i&&"object"!=typeof i&&(i={scaleMode:arguments[4],resourceOptions:{crossorigin:arguments[3]}}),new t(xr.from(e,i),r,n)},r.width.get=function(){return this._width},r.width.set=function(e){this._width=e},r.height.get=function(){return this._height},r.height.set=function(e){this._height=e},Object.defineProperties(t.prototype,r),t}(Xi),Ko="attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n",Zo=new yt,Qo=function(e){function t(t){e.call(this,t);var r={globals:this.renderer.globalUniforms};this.shader=_n.from(Ko,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n",r),this.simpleShader=_n.from(Ko,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n",r),this.quad=new Lr}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(e){var t=this.renderer,r=this.quad,n=r.vertices;n[0]=n[6]=e._width*-e.anchor.x,n[1]=n[3]=e._height*-e.anchor.y,n[2]=n[4]=e._width*(1-e.anchor.x),n[5]=n[7]=e._height*(1-e.anchor.y),e.uvRespectAnchor&&((n=r.uvs)[0]=n[6]=-e.anchor.x,n[1]=n[3]=-e.anchor.y,n[2]=n[4]=1-e.anchor.x,n[5]=n[7]=1-e.anchor.y),r.invalidate();var i=e._texture,o=i.baseTexture,s=e.tileTransform.localTransform,a=e.uvMatrix,c=o.isPowerOfTwo&&i.frame.width===o.width&&i.frame.height===o.height;c&&(o._glTextures[t.CONTEXT_UID]?c=o.wrapMode!==Ee.CLAMP:o.wrapMode===Ee.CLAMP&&(o.wrapMode=Ee.REPEAT));var u=c?this.simpleShader:this.shader,h=i.width,l=i.height,d=e._width,p=e._height;Zo.set(s.a*h/d,s.b*h/p,s.c*l/d,s.d*l/p,s.tx/d,s.ty/p),Zo.invert(),c?Zo.prepend(a.mapCoord):(u.uniforms.uMapCoord=a.mapCoord.toArray(!0),u.uniforms.uClampFrame=a.uClampFrame,u.uniforms.uClampOffset=a.uClampOffset),u.uniforms.uTransform=Zo.toArray(!0),u.uniforms.uColor=Ve(e.tint,e.worldAlpha,u.uniforms.uColor,o.premultiplyAlpha),u.uniforms.translationMatrix=e.transform.worldTransform.toArray(!0),u.uniforms.uSampler=i,t.shader.bind(u),t.geometry.bind(r),t.state.setBlendMode(Ue(e.blendMode,o.premultiplyAlpha)),t.geometry.draw(this.renderer.gl.TRIANGLES,6,0)},t}(Ur),$o=function(e){function t(t,r){var n=this;void 0===r&&(r={}),e.call(this),this._textWidth=0,this._textHeight=0,this._glyphs=[],this._font={tint:void 0!==r.tint?r.tint:16777215,align:r.align||"left",name:null,size:0},this.font=r.font,this._text=t,this._maxWidth=0,this._maxLineHeight=0,this._letterSpacing=0,this._anchor=new dt((function(){n.dirty=!0}),this,0,0),this.dirty=!1,this.roundPixels=v.ROUND_PIXELS,this.updateText()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={tint:{configurable:!0},align:{configurable:!0},anchor:{configurable:!0},font:{configurable:!0},text:{configurable:!0},maxWidth:{configurable:!0},maxLineHeight:{configurable:!0},textWidth:{configurable:!0},letterSpacing:{configurable:!0},textHeight:{configurable:!0}};return t.prototype.updateText=function(){for(var e=t.fonts[this._font.name],r=this._font.size/e.size,n=new lt,i=[],o=[],s=this._text.replace(/(?:\r\n|\r)/g,"\n")||" ",a=s.length,c=this._maxWidth*e.size/this._font.size,u=null,h=0,l=0,d=0,p=-1,f=0,m=0,v=0,g=0;g<a;g++){var y=s.charCodeAt(g),_=s.charAt(g);if(/(?:\s)/.test(_)&&(p=g,f=h),"\r"!==_&&"\n"!==_){var b=e.chars[y];b&&(u&&b.kerning[u]&&(n.x+=b.kerning[u]),i.push({texture:b.texture,line:d,charCode:y,position:new lt(n.x+b.xOffset+this._letterSpacing/2,n.y+b.yOffset)}),n.x+=b.xAdvance+this._letterSpacing,h=n.x,v=Math.max(v,b.yOffset+b.texture.height),u=y,-1!==p&&c>0&&n.x>c&&(He(i,1+p-++m,1+g-p),g=p,p=-1,o.push(f),l=Math.max(l,f),d++,n.x=0,n.y+=e.lineHeight,u=null))}else o.push(h),l=Math.max(l,h),++d,++m,n.x=0,n.y+=e.lineHeight,u=null}var x=s.charAt(s.length-1);"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(h=f),o.push(h),l=Math.max(l,h));for(var w=[],T=0;T<=d;T++){var S=0;"right"===this._font.align?S=l-o[T]:"center"===this._font.align&&(S=(l-o[T])/2),w.push(S)}for(var C=i.length,P=this.tint,E=0;E<C;E++){var I=this._glyphs[E];I?I.texture=i[E].texture:((I=new Xi(i[E].texture)).roundPixels=this.roundPixels,this._glyphs.push(I)),I.position.x=(i[E].position.x+w[i[E].line])*r,I.position.y=i[E].position.y*r,I.scale.x=I.scale.y=r,I.tint=P,I.parent||this.addChild(I)}for(var A=C;A<this._glyphs.length;++A)this.removeChild(this._glyphs[A]);if(this._textWidth=l*r,this._textHeight=(n.y+e.lineHeight)*r,0!==this.anchor.x||0!==this.anchor.y)for(var M=0;M<C;M++)this._glyphs[M].x-=this._textWidth*this.anchor.x,this._glyphs[M].y-=this._textHeight*this.anchor.y;this._maxLineHeight=v*r},t.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},t.prototype.getLocalBounds=function(){return this.validate(),e.prototype.getLocalBounds.call(this)},t.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},r.tint.get=function(){return this._font.tint},r.tint.set=function(e){this._font.tint="number"==typeof e&&e>=0?e:16777215,this.dirty=!0},r.align.get=function(){return this._font.align},r.align.set=function(e){this._font.align=e||"left",this.dirty=!0},r.anchor.get=function(){return this._anchor},r.anchor.set=function(e){"number"==typeof e?this._anchor.set(e):this._anchor.copyFrom(e)},r.font.get=function(){return this._font},r.font.set=function(e){e&&("string"==typeof e?(e=e.split(" "),this._font.name=1===e.length?e[0]:e.slice(1).join(" "),this._font.size=e.length>=2?parseInt(e[0],10):t.fonts[this._font.name].size):(this._font.name=e.name,this._font.size="number"==typeof e.size?e.size:parseInt(e.size,10)),this.dirty=!0)},r.text.get=function(){return this._text},r.text.set=function(e){e=String(null==e?"":e),this._text!==e&&(this._text=e,this.dirty=!0)},r.maxWidth.get=function(){return this._maxWidth},r.maxWidth.set=function(e){this._maxWidth!==e&&(this._maxWidth=e,this.dirty=!0)},r.maxLineHeight.get=function(){return this.validate(),this._maxLineHeight},r.textWidth.get=function(){return this.validate(),this._textWidth},r.letterSpacing.get=function(){return this._letterSpacing},r.letterSpacing.set=function(e){this._letterSpacing!==e&&(this._letterSpacing=e,this.dirty=!0)},r.textHeight.get=function(){return this.validate(),this._textHeight},t.registerFont=function(e,r){var n={},i=e.getElementsByTagName("info")[0],o=e.getElementsByTagName("common")[0],s=e.getElementsByTagName("page"),a=at(s[0].getAttribute("file"),v.RESOLUTION),c={};n.font=i.getAttribute("face"),n.size=parseInt(i.getAttribute("size"),10),n.lineHeight=parseInt(o.getAttribute("lineHeight"),10)/a,n.chars={},r instanceof xr&&(r=[r]);for(var u=0;u<s.length;u++){var h=s[u].getAttribute("id"),l=s[u].getAttribute("file");c[h]=r instanceof Array?r[u]:r[l]}for(var d=e.getElementsByTagName("char"),p=0;p<d.length;p++){var f=d[p],m=parseInt(f.getAttribute("id"),10),g=f.getAttribute("page")||0,y=new Mt(parseInt(f.getAttribute("x"),10)/a+c[g].frame.x/a,parseInt(f.getAttribute("y"),10)/a+c[g].frame.y/a,parseInt(f.getAttribute("width"),10)/a,parseInt(f.getAttribute("height"),10)/a);n.chars[m]={xOffset:parseInt(f.getAttribute("xoffset"),10)/a,yOffset:parseInt(f.getAttribute("yoffset"),10)/a,xAdvance:parseInt(f.getAttribute("xadvance"),10)/a,kerning:{},texture:new xr(c[g].baseTexture,y),page:g}}for(var _=e.getElementsByTagName("kerning"),b=0;b<_.length;b++){var x=_[b],w=parseInt(x.getAttribute("first"),10)/a,T=parseInt(x.getAttribute("second"),10)/a,S=parseInt(x.getAttribute("amount"),10)/a;n.chars[T]&&(n.chars[T].kerning[w]=S)}return t.fonts[n.font]=n,n},Object.defineProperties(t.prototype,r),t}(Ut);$o.fonts={};var es=function(){};es.parse=function(e,t){e.bitmapFont=$o.registerFont(e.data,t)},es.add=function(){Go.setExtensionXhrType("fnt",Go.XHR_RESPONSE_TYPE.DOCUMENT)},es.dirname=function(e){var t=e.replace(/\/$/,"").replace(/\/[^\/]*$/,"");return t===e?".":""===t?"/":t},es.use=function(e,t){if(e.data&&e.type===Go.TYPE.XML)if(0!==e.data.getElementsByTagName("page").length&&0!==e.data.getElementsByTagName("info").length&&null!==e.data.getElementsByTagName("info")[0].getAttribute("face")){var r=e.isDataUrl?"":es.dirname(e.url);e.isDataUrl&&("."===r&&(r=""),this.baseUrl&&r&&"/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(r+="/")),(r=r.replace(this.baseUrl,""))&&"/"!==r.charAt(r.length-1)&&(r+="/");for(var n=e.data.getElementsByTagName("page"),i={},o=function(r){i[r.metadata.pageFile]=r.texture,Object.keys(i).length===n.length&&(es.parse(e,i),t())},s=0;s<n.length;++s){var a=n[s].getAttribute("file"),c=r+a,u=!1;for(var h in this.resources){var l=this.resources[h];if(l.url===c){l.metadata.pageFile=a,l.texture?o(l):l.onAfterMiddleware.add(o),u=!0;break}}if(!u){var d={crossOrigin:e.crossOrigin,loadType:Go.LOAD_TYPE.IMAGE,metadata:Object.assign({pageFile:a},e.metadata.imageMetadata),parentResource:e};this.add(c,d,o)}}}else t();else t()};var ts=function(e){function t(t){void 0===t&&(t=1),e.call(this,Hn,"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={alpha:{configurable:!0}};return r.alpha.get=function(){return this.uniforms.uAlpha},r.alpha.set=function(e){this.uniforms.uAlpha=e},Object.defineProperties(t.prototype,r),t}(Tn),rs={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},ns=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n"),is=function(e){function t(t,r,n,i,o){var s=function(e,t){var r,n=Math.ceil(e/2),i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n    \n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n    \n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n    \n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",o="";r=t?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(var s=0;s<e;s++){var a=r.replace("%index%",s);o+=a=a.replace("%sampleIndex%",s-(n-1)+".0"),o+="\n"}return(i=i.replace("%blur%",o)).replace("%size%",e)}(o=o||5,t),a=function(e){for(var t,r=rs[e],n=r.length,i=ns,o="",s=0;s<e;s++){var a="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",s);t=s,s>=n&&(t=e-s-1),o+=a=a.replace("%value%",r[t]),o+="\n"}return(i=i.replace("%blur%",o)).replace("%size%",e)}(o);e.call(this,s,a),this.horizontal=t,this.resolution=i||v.RESOLUTION,this._quality=0,this.quality=n||4,this.blur=r||8}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={blur:{configurable:!0},quality:{configurable:!0}};return t.prototype.apply=function(e,t,r,n){if(r?this.horizontal?this.uniforms.strength=1/r.width*(r.width/t.width):this.uniforms.strength=1/r.height*(r.height/t.height):this.horizontal?this.uniforms.strength=1/e.renderer.width*(e.renderer.width/t.width):this.uniforms.strength=1/e.renderer.height*(e.renderer.height/t.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)e.applyFilter(this,t,r,n);else{var i=e.getFilterTexture(),o=e.renderer,s=t,a=i;this.state.blend=!1,e.applyFilter(this,s,a,!1);for(var c=1;c<this.passes-1;c++){o.renderTexture.bind(s,s.filterFrame),this.uniforms.uSampler=a;var u=a;a=s,s=u,o.shader.bind(this),o.geometry.draw(5)}this.state.blend=!0,e.applyFilter(this,a,r,n),e.returnFilterTexture(i)}},r.blur.get=function(){return this.strength},r.blur.set=function(e){this.padding=1+2*Math.abs(e),this.strength=e},r.quality.get=function(){return this._quality},r.quality.set=function(e){this._quality=e,this.passes=e},Object.defineProperties(t.prototype,r),t}(Tn),os=function(e){function t(t,r,n,i){e.call(this),this.blurXFilter=new is(!0,t,r,n,i),this.blurYFilter=new is(!1,t,r,n,i),this.resolution=n||v.RESOLUTION,this.quality=r||4,this.blur=t||8,this.repeatEdgePixels=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={blur:{configurable:!0},quality:{configurable:!0},blurX:{configurable:!0},blurY:{configurable:!0},blendMode:{configurable:!0},repeatEdgePixels:{configurable:!0}};return t.prototype.apply=function(e,t,r,n){var i=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(i&&o){var s=e.getFilterTexture();this.blurXFilter.apply(e,t,s,!0),this.blurYFilter.apply(e,s,r,n),e.returnFilterTexture(s)}else o?this.blurYFilter.apply(e,t,r,n):this.blurXFilter.apply(e,t,r,n)},t.prototype.updatePadding=function(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))},r.blur.get=function(){return this.blurXFilter.blur},r.blur.set=function(e){this.blurXFilter.blur=this.blurYFilter.blur=e,this.updatePadding()},r.quality.get=function(){return this.blurXFilter.quality},r.quality.set=function(e){this.blurXFilter.quality=this.blurYFilter.quality=e},r.blurX.get=function(){return this.blurXFilter.blur},r.blurX.set=function(e){this.blurXFilter.blur=e,this.updatePadding()},r.blurY.get=function(){return this.blurYFilter.blur},r.blurY.set=function(e){this.blurYFilter.blur=e,this.updatePadding()},r.blendMode.get=function(){return this.blurYFilter.blendMode},r.blendMode.set=function(e){this.blurYFilter.blendMode=e},r.repeatEdgePixels.get=function(){return this._repeatEdgePixels},r.repeatEdgePixels.set=function(e){this._repeatEdgePixels=e,this.updatePadding()},Object.defineProperties(t.prototype,r),t}(Tn),ss=function(e){function t(){var t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};e.call(this,Wn,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={matrix:{configurable:!0},alpha:{configurable:!0}};return t.prototype._loadMatrix=function(e,t){void 0===t&&(t=!1);var r=e;t&&(this._multiply(r,this.uniforms.m,e),r=this._colorMatrix(r)),this.uniforms.m=r},t.prototype._multiply=function(e,t,r){return e[0]=t[0]*r[0]+t[1]*r[5]+t[2]*r[10]+t[3]*r[15],e[1]=t[0]*r[1]+t[1]*r[6]+t[2]*r[11]+t[3]*r[16],e[2]=t[0]*r[2]+t[1]*r[7]+t[2]*r[12]+t[3]*r[17],e[3]=t[0]*r[3]+t[1]*r[8]+t[2]*r[13]+t[3]*r[18],e[4]=t[0]*r[4]+t[1]*r[9]+t[2]*r[14]+t[3]*r[19]+t[4],e[5]=t[5]*r[0]+t[6]*r[5]+t[7]*r[10]+t[8]*r[15],e[6]=t[5]*r[1]+t[6]*r[6]+t[7]*r[11]+t[8]*r[16],e[7]=t[5]*r[2]+t[6]*r[7]+t[7]*r[12]+t[8]*r[17],e[8]=t[5]*r[3]+t[6]*r[8]+t[7]*r[13]+t[8]*r[18],e[9]=t[5]*r[4]+t[6]*r[9]+t[7]*r[14]+t[8]*r[19]+t[9],e[10]=t[10]*r[0]+t[11]*r[5]+t[12]*r[10]+t[13]*r[15],e[11]=t[10]*r[1]+t[11]*r[6]+t[12]*r[11]+t[13]*r[16],e[12]=t[10]*r[2]+t[11]*r[7]+t[12]*r[12]+t[13]*r[17],e[13]=t[10]*r[3]+t[11]*r[8]+t[12]*r[13]+t[13]*r[18],e[14]=t[10]*r[4]+t[11]*r[9]+t[12]*r[14]+t[13]*r[19]+t[14],e[15]=t[15]*r[0]+t[16]*r[5]+t[17]*r[10]+t[18]*r[15],e[16]=t[15]*r[1]+t[16]*r[6]+t[17]*r[11]+t[18]*r[16],e[17]=t[15]*r[2]+t[16]*r[7]+t[17]*r[12]+t[18]*r[17],e[18]=t[15]*r[3]+t[16]*r[8]+t[17]*r[13]+t[18]*r[18],e[19]=t[15]*r[4]+t[16]*r[9]+t[17]*r[14]+t[18]*r[19]+t[19],e},t.prototype._colorMatrix=function(e){var t=new Float32Array(e);return t[4]/=255,t[9]/=255,t[14]/=255,t[19]/=255,t},t.prototype.brightness=function(e,t){var r=[e,0,0,0,0,0,e,0,0,0,0,0,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)},t.prototype.greyscale=function(e,t){var r=[e,e,e,0,0,e,e,e,0,0,e,e,e,0,0,0,0,0,1,0];this._loadMatrix(r,t)},t.prototype.blackAndWhite=function(e){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],e)},t.prototype.hue=function(e,t){e=(e||0)/180*Math.PI;var r=Math.cos(e),n=Math.sin(e),i=1/3,o=(0,Math.sqrt)(i),s=[r+(1-r)*i,i*(1-r)-o*n,i*(1-r)+o*n,0,0,i*(1-r)+o*n,r+i*(1-r),i*(1-r)-o*n,0,0,i*(1-r)-o*n,i*(1-r)+o*n,r+i*(1-r),0,0,0,0,0,1,0];this._loadMatrix(s,t)},t.prototype.contrast=function(e,t){var r=(e||0)+1,n=-.5*(r-1),i=[r,0,0,0,n,0,r,0,0,n,0,0,r,0,n,0,0,0,1,0];this._loadMatrix(i,t)},t.prototype.saturate=function(e,t){void 0===e&&(e=0);var r=2*e/3+1,n=-.5*(r-1),i=[r,n,n,0,0,n,r,n,0,0,n,n,r,0,0,0,0,0,1,0];this._loadMatrix(i,t)},t.prototype.desaturate=function(){this.saturate(-1)},t.prototype.negative=function(e){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],e)},t.prototype.sepia=function(e){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],e)},t.prototype.technicolor=function(e){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],e)},t.prototype.polaroid=function(e){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],e)},t.prototype.toBGR=function(e){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],e)},t.prototype.kodachrome=function(e){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],e)},t.prototype.browni=function(e){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],e)},t.prototype.vintage=function(e){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],e)},t.prototype.colorTone=function(e,t,r,n,i){var o=((r=r||16770432)>>16&255)/255,s=(r>>8&255)/255,a=(255&r)/255,c=((n=n||3375104)>>16&255)/255,u=(n>>8&255)/255,h=(255&n)/255,l=[.3,.59,.11,0,0,o,s,a,e=e||.2,0,c,u,h,t=t||.15,0,o-c,s-u,a-h,0,0];this._loadMatrix(l,i)},t.prototype.night=function(e,t){var r=[-2*(e=e||.1),-e,0,0,0,-e,0,e,0,0,0,e,2*e,0,0,0,0,0,1,0];this._loadMatrix(r,t)},t.prototype.predator=function(e,t){var r=[11.224130630493164*e,-4.794486999511719*e,-2.8746118545532227*e,0*e,.40342438220977783*e,-3.6330697536468506*e,9.193157196044922*e,-2.951810836791992*e,0*e,-1.316135048866272*e,-3.2184197902679443*e,-4.2375030517578125*e,7.476448059082031*e,0*e,.8044459223747253*e,0,0,0,1,0];this._loadMatrix(r,t)},t.prototype.lsd=function(e){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],e)},t.prototype.reset=function(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)},r.matrix.get=function(){return this.uniforms.m},r.matrix.set=function(e){this.uniforms.m=e},r.alpha.get=function(){return this.uniforms.uAlpha},r.alpha.set=function(e){this.uniforms.uAlpha=e},Object.defineProperties(t.prototype,r),t}(Tn);ss.prototype.grayscale=ss.prototype.greyscale;var as=function(e){function t(t,r){var n=new yt;t.renderable=!1,e.call(this,"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,null==r&&(r=20),this.scale=new lt(r,r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={map:{configurable:!0}};return t.prototype.apply=function(e,t,r,n){this.uniforms.filterMatrix=e.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;var i=this.maskSprite.transform.worldTransform,o=Math.sqrt(i.a*i.a+i.b*i.b),s=Math.sqrt(i.c*i.c+i.d*i.d);0!==o&&0!==s&&(this.uniforms.rotation[0]=i.a/o,this.uniforms.rotation[1]=i.b/o,this.uniforms.rotation[2]=i.c/s,this.uniforms.rotation[3]=i.d/s),e.applyFilter(this,t,r,n)},r.map.get=function(){return this.uniforms.mapSampler},r.map.set=function(e){this.uniforms.mapSampler=e},Object.defineProperties(t.prototype,r),t}(Tn),cs=function(e){function t(){e.call(this,"\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputPixel;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputPixel;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputPixel.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Tn),us=function(e){function t(t,r){void 0===t&&(t=.5),void 0===r&&(r=Math.random()),e.call(this,Wn,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=r}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={noise:{configurable:!0},seed:{configurable:!0}};return r.noise.get=function(){return this.uniforms.uNoise},r.noise.set=function(e){this.uniforms.uNoise=e},r.seed.get=function(){return this.uniforms.uSeed},r.seed.set=function(e){this.uniforms.uSeed=e},Object.defineProperties(t.prototype,r),t}(Tn),hs=new yt;Nt.prototype._cacheAsBitmap=!1,Nt.prototype._cacheData=!1,Object.defineProperties(Nt.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(e){var t;this._cacheAsBitmap!==e&&(this._cacheAsBitmap=e,e?(this._cacheData||(this._cacheData=new function(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalHitTest=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.sprite=null}),(t=this._cacheData).originalRender=this.render,t.originalRenderCanvas=this.renderCanvas,t.originalUpdateTransform=this.updateTransform,t.originalCalculateBounds=this.calculateBounds,t.originalGetLocalBounds=this.getLocalBounds,t.originalDestroy=this.destroy,t.originalContainsPoint=this.containsPoint,t.originalMask=this._mask,t.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):((t=this._cacheData).sprite&&this._destroyCachedDisplayObject(),this.render=t.originalRender,this.renderCanvas=t.originalRenderCanvas,this.calculateBounds=t.originalCalculateBounds,this.getLocalBounds=t.originalGetLocalBounds,this.destroy=t.originalDestroy,this.updateTransform=t.originalUpdateTransform,this.containsPoint=t.originalContainsPoint,this._mask=t.originalMask,this.filterArea=t.originalFilterArea))}}}),Nt.prototype._renderCached=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(e),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(e))},Nt.prototype._initCachedDisplayObject=function(e){if(!this._cacheData||!this._cacheData.sprite){var t=this.alpha;this.alpha=1,e.batch.flush();var r=this.getLocalBounds().clone();if(this.filters){var n=this.filters[0].padding;r.pad(n)}r.ceil(v.RESOLUTION);var i=e.renderTexture.current,o=e.renderTexture.sourceFrame,s=e.projection.transform,a=Tr.create(r.width,r.height),c="cacheAsBitmap_"+Ye();this._cacheData.textureCacheId=c,sr.addToCache(a.baseTexture,c),xr.addToCache(a,c);var u=hs;u.tx=-r.x,u.ty=-r.y,this.transform.worldTransform.identity(),this.render=this._cacheData.originalRender,e.render(this,a,!0,u,!0),e.projection.transform=s,e.renderTexture.bind(i,o),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var h=new Xi(a);h.transform.worldTransform=this.transform.worldTransform,h.anchor.x=-r.x/r.width,h.anchor.y=-r.y/r.height,h.alpha=t,h._bounds=this._bounds,this._cacheData.sprite=h,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=h.containsPoint.bind(h)}},Nt.prototype._renderCachedCanvas=function(e){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(e),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(e))},Nt.prototype._initCachedDisplayObjectCanvas=function(e){if(!this._cacheData||!this._cacheData.sprite){var t=this.getLocalBounds(),r=this.alpha;this.alpha=1;var n=e.context;t.ceil(v.RESOLUTION);var i=Tr.create(t.width,t.height),o="cacheAsBitmap_"+Ye();this._cacheData.textureCacheId=o,sr.addToCache(i.baseTexture,o),xr.addToCache(i,o);var s=hs;this.transform.localTransform.copyTo(s),s.invert(),s.tx-=t.x,s.ty-=t.y,this.renderCanvas=this._cacheData.originalRenderCanvas,e.render(this,i,!0,s,!1),e.context=n,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null;var a=new Xi(i);a.transform.worldTransform=this.transform.worldTransform,a.anchor.x=-t.x/t.width,a.anchor.y=-t.y/t.height,a.alpha=r,a._bounds=this._bounds,this._cacheData.sprite=a,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=e._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=a.containsPoint.bind(a)}},Nt.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._lastBoundsID=this._boundsID},Nt.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds()},Nt.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,sr.removeFromCache(this._cacheData.textureCacheId),xr.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Nt.prototype._cacheAsBitmapDestroy=function(e){this.cacheAsBitmap=!1,this.destroy(e)},Nt.prototype.name=null,Ut.prototype.getChildByName=function(e){for(var t=0;t<this.children.length;t++)if(this.children[t].name===e)return this.children[t];return null},Nt.prototype.getGlobalPosition=function(e,t){return void 0===e&&(e=new lt),void 0===t&&(t=!1),this.parent?this.parent.toGlobal(this.position,e,t):(e.x=this.position.x,e.y=this.position.y),e};var ls=function(e,t){this.uvBuffer=e,this.uvMatrix=t,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0};ls.prototype.update=function(e){if(e||this._bufferUpdateId!==this.uvBuffer._updateID||this._textureUpdateId!==this.uvMatrix._updateID){this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;var t=this.uvBuffer.data;this.data&&this.data.length===t.length||(this.data=new Float32Array(t.length)),this.uvMatrix.multiplyUvs(t,this.data),this._updateID++}};var ds=new lt,ps=new Lt,fs=function(e){function t(t,r,n,i){void 0===i&&(i=we.TRIANGLES),e.call(this),this.geometry=t,t.refCount++,this.shader=r,this.state=n||xn.for2d(),this.drawMode=i,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=0,this._transformID=-1,this.tint=16777215,this.blendMode=xe.NORMAL,this._roundPixels=v.ROUND_PIXELS,this.batchUvs=null}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={uvBuffer:{configurable:!0},verticesBuffer:{configurable:!0},material:{configurable:!0},blendMode:{configurable:!0},roundPixels:{configurable:!0},tint:{configurable:!0},texture:{configurable:!0}};return r.uvBuffer.get=function(){return this.geometry.buffers[1]},r.verticesBuffer.get=function(){return this.geometry.buffers[0]},r.material.set=function(e){this.shader=e},r.material.get=function(){return this.shader},r.blendMode.set=function(e){this.state.blendMode=e},r.blendMode.get=function(){return this.state.blendMode},r.roundPixels.set=function(e){this._roundPixels!==e&&(this._transformID=-1),this._roundPixels=e},r.roundPixels.get=function(){return this._roundPixels},r.tint.get=function(){return this.shader.tint},r.tint.set=function(e){this.shader.tint=e},r.texture.get=function(){return this.shader.texture},r.texture.set=function(e){this.shader.texture=e},t.prototype._render=function(e){var r=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===we.TRIANGLES&&r.length<2*t.BATCHABLE_SIZE?this._renderToBatch(e):this._renderDefault(e)},t.prototype._renderDefault=function(e){var t=this.shader;t.alpha=this.worldAlpha,t.update&&t.update(),e.batch.flush(),t.program.uniformData.translationMatrix&&(t.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0)),e.shader.bind(t),e.state.set(this.state),e.geometry.bind(this.geometry,t),e.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)},t.prototype._renderToBatch=function(e){var t=this.geometry;this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=t.indexBuffer.data,this._tintRGB=this.shader._tintRGB,this._texture=this.shader.texture;var r=this.material.pluginName;e.batch.setObjectRenderer(e.plugins[r]),e.plugins[r].render(this)},t.prototype.calculateVertices=function(){var e=this.geometry,t=e.buffers[0].data;if(e.vertexDirtyId!==this.vertexDirty||this._transformID!==this.transform._worldID){this._transformID=this.transform._worldID,this.vertexData.length!==t.length&&(this.vertexData=new Float32Array(t.length));for(var r=this.transform.worldTransform,n=r.a,i=r.b,o=r.c,s=r.d,a=r.tx,c=r.ty,u=this.vertexData,h=0;h<u.length/2;h++){var l=t[2*h],d=t[2*h+1];u[2*h]=n*l+o*d+a,u[2*h+1]=i*l+s*d+c}if(this._roundPixels)for(var p=0;p<u.length;p++)u[p]=Math.round(u[p]);this.vertexDirty=e.vertexDirtyId}},t.prototype.calculateUvs=function(){var e=this.geometry.buffers[1];this.shader.uvMatrix.isSimple?this.uvs=e.data:(this.batchUvs||(this.batchUvs=new ls(e,this.shader.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)},t.prototype._calculateBounds=function(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)},t.prototype.containsPoint=function(e){if(!this.getBounds().contains(e.x,e.y))return!1;this.worldTransform.applyInverse(e,ds);for(var t=this.geometry.getBuffer("aVertexPosition").data,r=ps.points,n=this.geometry.getIndex().data,i=n.length,o=4===this.drawMode?3:1,s=0;s+2<i;s+=o){var a=2*n[s],c=2*n[s+1],u=2*n[s+2];if(r[0]=t[a],r[1]=t[a+1],r[2]=t[c],r[3]=t[c+1],r[4]=t[u],r[5]=t[u+1],ps.contains(ds.x,ds.y))return!0}return!1},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.geometry.refCount--,0===this.geometry.refCount&&this.geometry.dispose(),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null},Object.defineProperties(t.prototype,r),t}(Ut);fs.BATCHABLE_SIZE=100;var ms=function(e){function t(t,r){var n={uSampler:t,alpha:1,uTextureMatrix:yt.IDENTITY,uColor:new Float32Array([1,1,1,1])};(r=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},r)).uniforms&&Object.assign(n,r.uniforms),e.call(this,r.program||gn.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n),this._colorDirty=!1,this.uvMatrix=new Cn(t),this.batchable=void 0===r.program,this.pluginName=r.pluginName,this.tint=r.tint,this.alpha=r.alpha}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={texture:{configurable:!0},alpha:{configurable:!0},tint:{configurable:!0}};return r.texture.get=function(){return this.uniforms.uSampler},r.texture.set=function(e){this.uniforms.uSampler!==e&&(this.uniforms.uSampler=e,this.uvMatrix.texture=e)},r.alpha.set=function(e){e!==this._alpha&&(this._alpha=e,this._colorDirty=!0)},r.alpha.get=function(){return this._alpha},r.tint.set=function(e){e!==this._tint&&(this._tint=e,this._tintRGB=(e>>16)+(65280&e)+((255&e)<<16),this._colorDirty=!0)},r.tint.get=function(){return this._tint},t.prototype.update=function(){if(this._colorDirty){this._colorDirty=!1;var e=this.texture.baseTexture;Ve(this._tint,this._alpha,this.uniforms.uColor,e.premultiplyAlpha)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)},Object.defineProperties(t.prototype,r),t}(_n),vs=function(e){function t(t,r,n){e.call(this);var i=new Er(t),o=new Er(r,!0),s=new Er(n,!0,!0);this.addAttribute("aVertexPosition",i,2,!1,Ce.FLOAT).addAttribute("aTextureCoord",o,2,!1,Ce.FLOAT).addIndex(s),this._updateId=-1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={vertexDirtyId:{configurable:!0}};return r.vertexDirtyId.get=function(){return this.buffers[0]._updateID},Object.defineProperties(t.prototype,r),t}(Dr),gs=function(e){function t(t,r,n,i){void 0===t&&(t=100),void 0===r&&(r=100),void 0===n&&(n=10),void 0===i&&(i=10),e.call(this),this.segWidth=n,this.segHeight=i,this.width=t,this.height=r,this.build()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.build=function(){for(var e=this.segWidth*this.segHeight,t=[],r=[],n=[],i=this.segWidth-1,o=this.segHeight-1,s=this.width/i,a=this.height/o,c=0;c<e;c++){var u=c%this.segWidth,h=c/this.segWidth|0;t.push(u*s,h*a),r.push(u/i,h/o)}for(var l=i*o,d=0;d<l;d++){var p=d%i,f=d/i|0,m=f*this.segWidth+p,v=f*this.segWidth+p+1,g=(f+1)*this.segWidth+p,y=(f+1)*this.segWidth+p+1;n.push(m,v,g,v,y,g)}this.buffers[0].data=new Float32Array(t),this.buffers[1].data=new Float32Array(r),this.indexBuffer.data=new Uint16Array(n),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()},t}(vs),ys=function(e){function t(t,r){void 0===t&&(t=200),e.call(this,new Float32Array(4*r.length),new Float32Array(4*r.length),new Uint16Array(6*(r.length-1))),this.points=r,this.width=t,this.build()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.build=function(){var e=this.points;if(e){var t=this.getBuffer("aVertexPosition"),r=this.getBuffer("aTextureCoord"),n=this.getIndex();if(!(e.length<1)){t.data.length/4!==e.length&&(t.data=new Float32Array(4*e.length),r.data=new Float32Array(4*e.length),n.data=new Uint16Array(6*(e.length-1)));var i=r.data,o=n.data;i[0]=0,i[1]=0,i[2]=0,i[3]=1;for(var s=e.length,a=0;a<s;a++){var c=4*a,u=a/(s-1);i[c]=u,i[c+1]=0,i[c+2]=u,i[c+3]=1}for(var h=0,l=0;l<s-1;l++){var d=2*l;o[h++]=d,o[h++]=d+1,o[h++]=d+2,o[h++]=d+2,o[h++]=d+1,o[h++]=d+3}r.update(),n.update(),this.updateVertices()}}},t.prototype.updateVertices=function(){var e=this.points;if(!(e.length<1)){for(var t,r=e[0],n=0,i=0,o=this.buffers[0].data,s=e.length,a=0;a<s;a++){var c=e[a],u=4*a;i=-((t=a<e.length-1?e[a+1]:c).x-r.x),n=t.y-r.y;var h=Math.sqrt(n*n+i*i),l=this.width/2;n/=h,i/=h,n*=l,i*=l,o[u]=c.x+n,o[u+1]=c.y+i,o[u+2]=c.x-n,o[u+3]=c.y-i,r=c}this.buffers[0].update()}},t.prototype.update=function(){this.updateVertices()},t}(vs),_s=function(e){function t(t,r){var n=new ys(t.height,r),i=new ms(t);e.call(this,n,i),this.autoUpdate=!0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype._render=function(t){(this.autoUpdate||this.geometry.width!==this.shader.texture.height)&&(this.geometry.width=this.shader.texture.height,this.geometry.update()),e.prototype._render.call(this,t)},t}(fs),bs=function(e){function t(t,r,n){var i=new gs(t.width,t.height,r,n),o=new ms(xr.WHITE);e.call(this,i,o),this.texture=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={texture:{configurable:!0}};return t.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this.geometry.width=this.shader.texture.width,this.geometry.height=this.shader.texture.height,this.geometry.build()},r.texture.set=function(e){this.shader.texture!==e&&(this.shader.texture=e,this._textureID=-1,e.baseTexture.valid?this.textureUpdated():e.once("update",this.textureUpdated,this))},r.texture.get=function(){return this.shader.texture},t.prototype._render=function(t){this._textureID!==this.shader.texture._updateID&&this.textureUpdated(),e.prototype._render.call(this,t)},Object.defineProperties(t.prototype,r),t}(fs),xs=function(e){function t(t,r,n,i,o){void 0===t&&(t=xr.EMPTY);var s=new vs(r,n,i);s.getBuffer("aVertexPosition").static=!1;var a=new ms(t);e.call(this,s,a,null,o),this.autoUpdate=!0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={vertices:{configurable:!0}};return r.vertices.get=function(){return this.geometry.getBuffer("aVertexPosition").data},r.vertices.set=function(e){this.geometry.getBuffer("aVertexPosition").data=e},t.prototype._render=function(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),e.prototype._render.call(this,t)},Object.defineProperties(t.prototype,r),t}(fs),ws=function(e){function t(t,r,n,i,o){e.call(this,xr.WHITE,4,4),this._origWidth=t.orig.width,this._origHeight=t.orig.height,this._width=this._origWidth,this._height=this._origHeight,this._leftWidth=void 0!==r?r:10,this._rightWidth=void 0!==i?i:10,this._topHeight=void 0!==n?n:10,this._bottomHeight=void 0!==o?o:10,this.texture=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={vertices:{configurable:!0},width:{configurable:!0},height:{configurable:!0},leftWidth:{configurable:!0},rightWidth:{configurable:!0},topHeight:{configurable:!0},bottomHeight:{configurable:!0}};return t.prototype.textureUpdated=function(){this._textureID=this.shader.texture._updateID,this._refresh()},r.vertices.get=function(){return this.geometry.getBuffer("aVertexPosition").data},r.vertices.set=function(e){this.geometry.getBuffer("aVertexPosition").data=e},t.prototype.updateHorizontalVertices=function(){var e=this.vertices,t=this._topHeight+this._bottomHeight,r=this._height>t?1:this._height/t;e[9]=e[11]=e[13]=e[15]=this._topHeight*r,e[17]=e[19]=e[21]=e[23]=this._height-this._bottomHeight*r,e[25]=e[27]=e[29]=e[31]=this._height},t.prototype.updateVerticalVertices=function(){var e=this.vertices,t=this._leftWidth+this._rightWidth,r=this._width>t?1:this._width/t;e[2]=e[10]=e[18]=e[26]=this._leftWidth*r,e[4]=e[12]=e[20]=e[28]=this._width-this._rightWidth*r,e[6]=e[14]=e[22]=e[30]=this._width},r.width.get=function(){return this._width},r.width.set=function(e){this._width=e,this._refresh()},r.height.get=function(){return this._height},r.height.set=function(e){this._height=e,this._refresh()},r.leftWidth.get=function(){return this._leftWidth},r.leftWidth.set=function(e){this._leftWidth=e,this._refresh()},r.rightWidth.get=function(){return this._rightWidth},r.rightWidth.set=function(e){this._rightWidth=e,this._refresh()},r.topHeight.get=function(){return this._topHeight},r.topHeight.set=function(e){this._topHeight=e,this._refresh()},r.bottomHeight.get=function(){return this._bottomHeight},r.bottomHeight.set=function(e){this._bottomHeight=e,this._refresh()},t.prototype._refresh=function(){var e=this.texture,t=this.geometry.buffers[1].data;this._origWidth=e.orig.width,this._origHeight=e.orig.height;var r=1/this._origWidth,n=1/this._origHeight;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1,t[2]=t[10]=t[18]=t[26]=r*this._leftWidth,t[4]=t[12]=t[20]=t[28]=1-r*this._rightWidth,t[9]=t[11]=t[13]=t[15]=n*this._topHeight,t[17]=t[19]=t[21]=t[23]=1-n*this._bottomHeight,this.updateHorizontalVertices(),this.updateVerticalVertices(),this.geometry.buffers[0].update(),this.geometry.buffers[1].update()},Object.defineProperties(t.prototype,r),t}(bs),Ts=function(e){function t(t,r){e.call(this,t[0]instanceof xr?t[0]:t[0].texture),this._textures=null,this._durations=null,this.textures=t,this._autoUpdate=!1!==r,this.animationSpeed=1,this.loop=!0,this.updateAnchor=!1,this.onComplete=null,this.onFrameChange=null,this.onLoop=null,this._currentTime=0,this.playing=!1}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var r={totalFrames:{configurable:!0},textures:{configurable:!0},currentFrame:{configurable:!0}};return t.prototype.stop=function(){this.playing&&(this.playing=!1,this._autoUpdate&&qt.shared.remove(this.update,this))},t.prototype.play=function(){this.playing||(this.playing=!0,this._autoUpdate&&qt.shared.add(this.update,this,Wt.HIGH))},t.prototype.gotoAndStop=function(e){this.stop();var t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture()},t.prototype.gotoAndPlay=function(e){var t=this.currentFrame;this._currentTime=e,t!==this.currentFrame&&this.updateTexture(),this.play()},t.prototype.update=function(e){var t=this.animationSpeed*e,r=this.currentFrame;if(null!==this._durations){var n=this._currentTime%1*this._durations[this.currentFrame];for(n+=t/60*1e3;n<0;)this._currentTime--,n+=this._durations[this.currentFrame];var i=Math.sign(this.animationSpeed*e);for(this._currentTime=Math.floor(this._currentTime);n>=this._durations[this.currentFrame];)n-=this._durations[this.currentFrame]*i,this._currentTime+=i;this._currentTime+=n/this._durations[this.currentFrame]}else this._currentTime+=t;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):r!==this.currentFrame&&(this.loop&&this.onLoop&&(this.animationSpeed>0&&this.currentFrame<r||this.animationSpeed<0&&this.currentFrame>r)&&this.onLoop(),this.updateTexture())},t.prototype.updateTexture=function(){this._texture=this._textures[this.currentFrame],this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this.uvs=this._texture._uvs.uvsFloat32,this.updateAnchor&&this._anchor.copyFrom(this._texture.defaultAnchor),this.onFrameChange&&this.onFrameChange(this.currentFrame)},t.prototype.destroy=function(t){this.stop(),e.prototype.destroy.call(this,t),this.onComplete=null,this.onFrameChange=null,this.onLoop=null},t.fromFrames=function(e){for(var r=[],n=0;n<e.length;++n)r.push(xr.from(e[n]));return new t(r)},t.fromImages=function(e){for(var r=[],n=0;n<e.length;++n)r.push(xr.from(e[n]));return new t(r)},r.totalFrames.get=function(){return this._textures.length},r.textures.get=function(){return this._textures},r.textures.set=function(e){if(e[0]instanceof xr)this._textures=e,this._durations=null;else{this._textures=[],this._durations=[];for(var t=0;t<e.length;t++)this._textures.push(e[t].texture),this._durations.push(e[t].time)}this.gotoAndStop(0),this.updateTexture()},r.currentFrame.get=function(){var e=Math.floor(this._currentTime)%this._textures.length;return e<0&&(e+=this._textures.length),e},Object.defineProperties(t.prototype,r),t}(Xi),Ss="5.0.0";Vn.registerPlugin("accessibility",Xt),Vn.registerPlugin("extract",si),Vn.registerPlugin("interaction",mi),Vn.registerPlugin("particle",zo),Vn.registerPlugin("prepare",ho),Vn.registerPlugin("batch",ii),Vn.registerPlugin("tilingSprite",Qo),jo.registerPlugin(es),jo.registerPlugin(Yo),go.registerPlugin(Zt),go.registerPlugin(Uo);var Cs={AlphaFilter:ts,BlurFilter:os,BlurFilterPass:is,ColorMatrixFilter:ss,DisplacementFilter:as,FXAAFilter:cs,NoiseFilter:us},Ps=function(e){this.renderer=e};function Es(e){var t=document.createElement("canvas");t.width=6,t.height=1;var r=t.getContext("2d");return r.fillStyle=e,r.fillRect(0,0,6,1),t}function Is(){if("undefined"==typeof document)return!1;var e=Es("#ff00ff"),t=Es("#ffff00"),r=document.createElement("canvas");r.width=6,r.height=1;var n=r.getContext("2d");n.globalCompositeOperation="multiply",n.drawImage(e,0,0),n.drawImage(t,2,0);var i=n.getImageData(2,0,1,1);if(!i)return!1;var o=i.data;return 255===o[0]&&0===o[1]&&0===o[2]}Ps.prototype.pushMask=function(e){var t=this.renderer;t.context.save();var r=e.alpha,n=e.transform.worldTransform,i=t.resolution;t.context.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*i,n.ty*i),e._texture||(this.renderGraphicsShape(e),t.context.clip()),e.worldAlpha=r},Ps.prototype.renderGraphicsShape=function(e){var t=this.renderer.context,r=e.geometry.graphicsData,n=r.length;if(0!==n){t.beginPath();for(var i=0;i<n;i++){var o=r[i],s=o.shape;if(o.type===gt.POLY){var a=s.points;t.moveTo(a[0],a[1]);for(var c=1;c<a.length/2;c++)t.lineTo(a[2*c],a[2*c+1]);a[0]===a[a.length-2]&&a[1]===a[a.length-1]&&t.closePath()}else if(o.type===gt.RECT)t.rect(s.x,s.y,s.width,s.height),t.closePath();else if(o.type===gt.CIRC)t.arc(s.x,s.y,s.radius,0,2*Math.PI),t.closePath();else if(o.type===gt.ELIP){var u=2*s.width,h=2*s.height,l=s.x-u/2,d=s.y-h/2,p=u/2*.5522848,f=h/2*.5522848,m=l+u,v=d+h,g=l+u/2,y=d+h/2;t.moveTo(l,y),t.bezierCurveTo(l,y-f,g-p,d,g,d),t.bezierCurveTo(g+p,d,m,y-f,m,y),t.bezierCurveTo(m,y+f,g+p,v,g,v),t.bezierCurveTo(g-p,v,l,y+f,l,y),t.closePath()}else if(o.type===gt.RREC){var _=s.x,b=s.y,x=s.width,w=s.height,T=s.radius,S=Math.min(x,w)/2|0;T=T>S?S:T,t.moveTo(_,b+T),t.lineTo(_,b+w-T),t.quadraticCurveTo(_,b+w,_+T,b+w),t.lineTo(_+x-T,b+w),t.quadraticCurveTo(_+x,b+w,_+x,b+w-T),t.lineTo(_+x,b+T),t.quadraticCurveTo(_+x,b,_+x-T,b),t.lineTo(_+T,b),t.quadraticCurveTo(_,b,_,b+T),t.closePath()}}}},Ps.prototype.popMask=function(e){e.context.restore(),e.invalidateBlendMode()},Ps.prototype.destroy=function(){};var As=function(e){function t(r,n,i){var o;e.call(this,"Canvas",r,n,i),this.type=be.CANVAS,this.rootContext=this.view.getContext("2d",{alpha:this.transparent}),this.context=this.rootContext,this.refresh=!0,this.maskManager=new Ps(this),this.smoothProperty="imageSmoothingEnabled",this.rootContext.imageSmoothingEnabled||(this.rootContext.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.rootContext.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.rootContext.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.rootContext.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")),this.initPlugins(t.__plugins),this.blendModes=(void 0===o&&(o=[]),Is()?(o[xe.NORMAL]="source-over",o[xe.ADD]="lighter",o[xe.MULTIPLY]="multiply",o[xe.SCREEN]="screen",o[xe.OVERLAY]="overlay",o[xe.DARKEN]="darken",o[xe.LIGHTEN]="lighten",o[xe.COLOR_DODGE]="color-dodge",o[xe.COLOR_BURN]="color-burn",o[xe.HARD_LIGHT]="hard-light",o[xe.SOFT_LIGHT]="soft-light",o[xe.DIFFERENCE]="difference",o[xe.EXCLUSION]="exclusion",o[xe.HUE]="hue",o[xe.SATURATION]="saturate",o[xe.COLOR]="color",o[xe.LUMINOSITY]="luminosity"):(o[xe.NORMAL]="source-over",o[xe.ADD]="lighter",o[xe.MULTIPLY]="source-over",o[xe.SCREEN]="source-over",o[xe.OVERLAY]="source-over",o[xe.DARKEN]="source-over",o[xe.LIGHTEN]="source-over",o[xe.COLOR_DODGE]="source-over",o[xe.COLOR_BURN]="source-over",o[xe.HARD_LIGHT]="source-over",o[xe.SOFT_LIGHT]="source-over",o[xe.DIFFERENCE]="source-over",o[xe.EXCLUSION]="source-over",o[xe.HUE]="source-over",o[xe.SATURATION]="source-over",o[xe.COLOR]="source-over",o[xe.LUMINOSITY]="source-over"),o[xe.NORMAL_NPM]=o[xe.NORMAL],o[xe.ADD_NPM]=o[xe.ADD],o[xe.SCREEN_NPM]=o[xe.SCREEN],o[xe.SRC_IN]="source-in",o[xe.SRC_OUT]="source-out",o[xe.SRC_ATOP]="source-atop",o[xe.DST_OVER]="destination-over",o[xe.DST_IN]="destination-in",o[xe.DST_OUT]="destination-out",o[xe.DST_ATOP]="destination-atop",o[xe.SUBTRACT]="source-over",o),this._activeBlendMode=null,this._outerBlend=!1,this.renderingToScreen=!1,De("Canvas"),this.resize(this.options.width,this.options.height)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(e,t,r,n,i){if(this.view){this.renderingToScreen=!t,this.emit("prerender");var o=this.resolution;t?((t=t.baseTexture||t)._canvasRenderTarget||(t._canvasRenderTarget=new rt(t.width,t.height,t.resolution),t.resource=new pr.CanvasResource(t._canvasRenderTarget.canvas),t.valid=!0),this.context=t._canvasRenderTarget.context,this.resolution=t._canvasRenderTarget.resolution):this.context=this.rootContext;var s=this.context;if(t||(this._lastObjectRendered=e),!i){var a=e.parent,c=this._tempDisplayObjectParent.transform.worldTransform;n?(n.copyTo(c),this._tempDisplayObjectParent.transform._worldID=-1):c.identity(),e.parent=this._tempDisplayObjectParent,e.updateTransform(),e.parent=a}s.save(),s.setTransform(1,0,0,1,0,0),s.globalAlpha=1,this._activeBlendMode=xe.NORMAL,this._outerBlend=!1,s.globalCompositeOperation=this.blendModes[xe.NORMAL],(void 0!==r?r:this.clearBeforeRender)&&this.renderingToScreen&&(this.transparent?s.clearRect(0,0,this.width,this.height):(s.fillStyle=this._backgroundColorString,s.fillRect(0,0,this.width,this.height)));var u=this.context;this.context=s,e.renderCanvas(this),this.context=u,s.restore(),this.resolution=o,this.emit("postrender")}},t.prototype.clear=function(e){var t=this.context;e=e||this._backgroundColorString,!this.transparent&&e?(t.fillStyle=e,t.fillRect(0,0,this.width,this.height)):t.clearRect(0,0,this.width,this.height)},t.prototype.setBlendMode=function(e,t){var r=e===xe.SRC_IN||e===xe.SRC_OUT||e===xe.DST_IN||e===xe.DST_ATOP;!t&&r&&(e=xe.NORMAL),this._activeBlendMode!==e&&(this._activeBlendMode=e,this._outerBlend=r,this.context.globalCompositeOperation=this.blendModes[e])},t.prototype.destroy=function(t){e.prototype.destroy.call(this,t),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},t.prototype.resize=function(t,r){e.prototype.resize.call(this,t,r),this.smoothProperty&&(this.rootContext[this.smoothProperty]=v.SCALE_MODE===Pe.LINEAR)},t.prototype.invalidateBlendMode=function(){this._activeBlendMode=this.blendModes.indexOf(this.context.globalCompositeOperation)},t.registerPlugin=function(e,r){t.__plugins=t.__plugins||{},t.__plugins[e]=r},t}(Xn),Ms={getTintedCanvas:function(e,t){var r=e.texture,n="#"+("00000"+(0|(t=Ms.roundColor(t))).toString(16)).substr(-6);r.tintCache=r.tintCache||{};var i,o=r.tintCache[n];if(o){if(o.tintId===r._updateID)return r.tintCache[n];i=r.tintCache[n]}else i=Ms.canvas||document.createElement("canvas");if(Ms.tintMethod(r,t,i),i.tintId=r._updateID,Ms.convertTintToImage){var s=new Image;s.src=i.toDataURL(),r.tintCache[n]=s}else r.tintCache[n]=i,Ms.canvas=null;return i},tintWithMultiply:function(e,t,r){var n=r.getContext("2d"),i=e._frame.clone(),o=e.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),n.fillRect(0,0,i.width,i.height),n.globalCompositeOperation="multiply";var s=e.baseTexture.getDrawableSource();n.drawImage(s,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.globalCompositeOperation="destination-atop",n.drawImage(s,i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore()},tintWithOverlay:function(e,t,r){var n=r.getContext("2d"),i=e._frame.clone(),o=e.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.globalCompositeOperation="copy",n.fillStyle="#"+("00000"+(0|t).toString(16)).substr(-6),n.fillRect(0,0,i.width,i.height),n.globalCompositeOperation="destination-atop",n.drawImage(e.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore()},tintWithPerPixel:function(e,t,r){var n=r.getContext("2d"),i=e._frame.clone(),o=e.baseTexture.resolution;i.x*=o,i.y*=o,i.width*=o,i.height*=o,r.width=Math.ceil(i.width),r.height=Math.ceil(i.height),n.save(),n.globalCompositeOperation="copy",n.drawImage(e.baseTexture.getDrawableSource(),i.x,i.y,i.width,i.height,0,0,i.width,i.height),n.restore();for(var s=Le(t),a=s[0],c=s[1],u=s[2],h=n.getImageData(0,0,i.width,i.height),l=h.data,d=0;d<l.length;d+=4)l[d+0]*=a,l[d+1]*=c,l[d+2]*=u;n.putImageData(h,0,0)},roundColor:function(e){var t=Ms.cacheStepsPerColorChannel,r=Le(e);return r[0]=Math.min(255,r[0]/t*t),r[1]=Math.min(255,r[1]/t*t),r[2]=Math.min(255,r[2]/t*t),Ne(r)},cacheStepsPerColorChannel:8,convertTintToImage:!1,canUseMultiply:Is(),tintMethod:function(){}};Ms.tintMethod=Ms.canUseMultiply?Ms.tintWithMultiply:Ms.tintWithPerPixel;var Os=Vn.create;Vn.create=function(e){if(!e||!e.forceCanvas)try{return Os(e)}catch(e){}return new As(e)},sr.prototype.getDrawableSource=function(){var e=this.resource;return e?e.bitmap||e.source:this.source};var Rs=function(e){this.renderer=e};Rs.prototype.render=function(e){var t=this.renderer,r=t.context,n=e.worldTransform,i=t.resolution;e.roundPixels?r.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*i|0,n.ty*i|0):r.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*i,n.ty*i),t.context.globalAlpha=e.worldAlpha,t.setBlendMode(e.blendMode),e.drawMode!==we.TRIANGLES?this._renderTriangleMesh(e):this._renderTriangles(e)},Rs.prototype._renderTriangleMesh=function(e){for(var t=e.geometry.buffers[0].data.length,r=0;r<t-2;r++){var n=2*r;this._renderDrawTriangle(e,n,n+2,n+4)}},Rs.prototype._renderTriangles=function(e){for(var t=e.geometry.getIndex().data,r=t.length,n=0;n<r;n+=3){var i=2*t[n],o=2*t[n+1],s=2*t[n+2];this._renderDrawTriangle(e,i,o,s)}},Rs.prototype._renderDrawTriangle=function(e,t,r,n){var i=this.renderer.context,o=e.geometry.buffers[0].data,s=e.uvs,a=e.texture;if(a.valid){var c=a.baseTexture,u=c.getDrawableSource(),h=c.width,l=c.height,d=s[t]*c.width,p=s[r]*c.width,f=s[n]*c.width,m=s[t+1]*c.height,v=s[r+1]*c.height,g=s[n+1]*c.height,y=o[t],_=o[r],b=o[n],x=o[t+1],w=o[r+1],T=o[n+1],S=e.canvasPadding/this.renderer.resolution;if(S>0){var C=S/Math.abs(e.worldTransform.a),P=S/Math.abs(e.worldTransform.d),E=(y+_+b)/3,I=(x+w+T)/3,A=y-E,M=x-I,O=Math.sqrt(A*A+M*M);y=E+A/O*(O+C),x=I+M/O*(O+P),M=w-I,_=E+(A=_-E)/(O=Math.sqrt(A*A+M*M))*(O+C),w=I+M/O*(O+P),M=T-I,b=E+(A=b-E)/(O=Math.sqrt(A*A+M*M))*(O+C),T=I+M/O*(O+P)}i.save(),i.beginPath(),i.moveTo(y,x),i.lineTo(_,w),i.lineTo(b,T),i.closePath(),i.clip();var R=d*v+m*f+p*g-v*f-m*p-d*g,D=y*v+m*b+_*g-v*b-m*_-y*g,k=d*_+y*f+p*b-_*f-y*p-d*b,L=d*v*b+m*_*f+y*p*g-y*v*f-m*p*b-d*_*g,B=x*v+m*T+w*g-v*T-m*w-x*g,F=d*w+x*f+p*T-w*f-x*p-d*T,N=d*v*T+m*w*f+x*p*g-x*v*f-m*p*T-d*w*g;i.transform(D/R,B/R,k/R,F/R,L/R,N/R),i.drawImage(u,0,0,h*c.resolution,l*c.resolution,0,0,h,l),i.restore(),this.renderer.invalidateBlendMode()}},Rs.prototype.renderMeshFlat=function(e){var t=this.renderer.context,r=e.geometry.getBuffer("aVertexPosition").data,n=r.length/2;t.beginPath();for(var i=1;i<n-2;++i){var o=2*i,s=r[o],a=r[o+1],c=r[o+2],u=r[o+3],h=r[o+4],l=r[o+5];t.moveTo(s,a),t.lineTo(c,u),t.lineTo(h,l)}t.fillStyle="#FF0000",t.fill(),t.closePath()},Rs.prototype.destroy=function(){this.renderer=null},v.MESH_CANVAS_PADDING=0,ms.prototype._renderCanvas=function(e,t){e.plugins.mesh.render(t)},ws.prototype._cachedTint=16777215,ws.prototype._tintedCanvas=null,ws.prototype._canvasUvs=null,ws.prototype._renderCanvas=function(e){var t=e.context,r=this.worldTransform,n=e.resolution,i=16777215!==this.tint,o=this.texture;i&&this._cachedTint!==this.tint&&(this._cachedTint=this.tint,this._tintedCanvas=Ms.getTintedCanvas(this,this.tint));var s=i?this._tintedCanvas:o.baseTexture.source;this._canvasUvs||(this._canvasUvs=[0,0,0,0,0,0,0,0]);var a=this.vertices,c=this._canvasUvs,u=i?0:o.frame.x,h=i?0:o.frame.y,l=u+o.frame.width,d=h+o.frame.height;c[0]=u,c[1]=u+this._leftWidth,c[2]=l-this._rightWidth,c[3]=l,c[4]=h,c[5]=h+this._topHeight,c[6]=d-this._bottomHeight,c[7]=d;for(var p=0;p<8;p++)c[p]*=o.baseTexture.resolution;t.globalAlpha=this.worldAlpha,e.setBlendMode(this.blendMode),this.roundPixels?t.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n|0,r.ty*n|0):t.setTransform(r.a*n,r.b*n,r.c*n,r.d*n,r.tx*n,r.ty*n);for(var f=0;f<3;f++)for(var m=0;m<3;m++){var v=2*m+8*f,g=Math.max(1,c[m+1]-c[m]),y=Math.max(1,c[f+5]-c[f+4]),_=Math.max(1,a[v+10]-a[v]),b=Math.max(1,a[v+11]-a[v+1]);t.drawImage(s,c[m],c[f+4],g,y,a[v],a[v+1],_,b)}},fs.prototype._renderCanvas=function(e){this.shader.uvMatrix&&(this.shader.uvMatrix.update(),this.calculateUvs()),this.material._renderCanvas(e,this)},fs.prototype._canvasPadding=null,Object.defineProperty(fs.prototype,"canvasPadding",{get:function(){return null!==this._canvasPadding?this._canvasPadding:v.MESH_CANVAS_PADDING},set:function(e){this._canvasPadding=e}}),xs.prototype._renderCanvas=function(e){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(e,this)},_s.prototype._renderCanvas=function(e){(this.autoUpdate||this.geometry.width!==this.shader.texture.height)&&(this.geometry.width=this.shader.texture.height,this.geometry.update()),this.shader.update&&this.shader.update(),this.calculateUvs(),this.material._renderCanvas(e,this)};var Ds,ks=function(e){this.renderer=e};ks.prototype.render=function(e){var t=this.renderer,r=t.context,n=e.worldAlpha,i=e.transform.worldTransform,o=t.resolution;r.setTransform(i.a*o,i.b*o,i.c*o,i.d*o,i.tx*o,i.ty*o),e.canvasTintDirty===e.geometry.dirty&&e._prevTint===e.tint||this.updateGraphicsTint(e),t.setBlendMode(e.blendMode);for(var s=e.geometry.graphicsData,a=0;a<s.length;a++){var c=s[a],u=c.shape,h=c.fillStyle,l=c.lineStyle,d=c._fillTint,p=c._lineTint;if(r.lineWidth=l.width,c.type===gt.POLY){r.beginPath();var f=u.points,m=c.holes,v=void 0,g=void 0,y=void 0,_=void 0;r.moveTo(f[0],f[1]);for(var b=2;b<f.length;b+=2)r.lineTo(f[b],f[b+1]);if(u.closeStroke&&r.closePath(),m.length>0){v=0,y=f[0],_=f[1];for(var x=2;x+2<f.length;x+=2)v+=(f[x]-y)*(f[x+3]-_)-(f[x+2]-y)*(f[x+1]-_);for(var w=0;w<m.length;w++)if(f=m[w].shape.points){g=0,y=f[0],_=f[1];for(var T=2;T+2<f.length;T+=2)g+=(f[T]-y)*(f[T+3]-_)-(f[T+2]-y)*(f[T+1]-_);if(g*v<0){r.moveTo(f[0],f[1]);for(var S=2;S<f.length;S+=2)r.lineTo(f[S],f[S+1])}else{r.moveTo(f[f.length-2],f[f.length-1]);for(var C=f.length-4;C>=0;C-=2)r.lineTo(f[C],f[C+1])}m[w].shape.closeStroke&&r.closePath()}}h.visible&&(r.globalAlpha=h.alpha*n,r.fillStyle="#"+("00000"+(0|d).toString(16)).substr(-6),r.fill()),l.visible&&(r.globalAlpha=l.alpha*n,r.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),r.stroke())}else if(c.type===gt.RECT)h.visible&&(r.globalAlpha=h.alpha*n,r.fillStyle="#"+("00000"+(0|d).toString(16)).substr(-6),r.fillRect(u.x,u.y,u.width,u.height)),l.visible&&(r.globalAlpha=l.alpha*n,r.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),r.strokeRect(u.x,u.y,u.width,u.height));else if(c.type===gt.CIRC)r.beginPath(),r.arc(u.x,u.y,u.radius,0,2*Math.PI),r.closePath(),h.visible&&(r.globalAlpha=h.alpha*n,r.fillStyle="#"+("00000"+(0|d).toString(16)).substr(-6),r.fill()),l.visible&&(r.globalAlpha=l.alpha*n,r.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),r.stroke());else if(c.type===gt.ELIP){var P=2*u.width,E=2*u.height,I=u.x-P/2,A=u.y-E/2;r.beginPath();var M=P/2*.5522848,O=E/2*.5522848,R=I+P,D=A+E,k=I+P/2,L=A+E/2;r.moveTo(I,L),r.bezierCurveTo(I,L-O,k-M,A,k,A),r.bezierCurveTo(k+M,A,R,L-O,R,L),r.bezierCurveTo(R,L+O,k+M,D,k,D),r.bezierCurveTo(k-M,D,I,L+O,I,L),r.closePath(),h.visible&&(r.globalAlpha=h.alpha*n,r.fillStyle="#"+("00000"+(0|d).toString(16)).substr(-6),r.fill()),l.visible&&(r.globalAlpha=l.alpha*n,r.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),r.stroke())}else if(c.type===gt.RREC){var B=u.x,F=u.y,N=u.width,j=u.height,U=u.radius,G=Math.min(N,j)/2|0;U=U>G?G:U,r.beginPath(),r.moveTo(B,F+U),r.lineTo(B,F+j-U),r.quadraticCurveTo(B,F+j,B+U,F+j),r.lineTo(B+N-U,F+j),r.quadraticCurveTo(B+N,F+j,B+N,F+j-U),r.lineTo(B+N,F+U),r.quadraticCurveTo(B+N,F,B+N-U,F),r.lineTo(B+U,F),r.quadraticCurveTo(B,F,B,F+U),r.closePath(),h.visible&&(r.globalAlpha=h.alpha*n,r.fillStyle="#"+("00000"+(0|d).toString(16)).substr(-6),r.fill()),l.visible&&(r.globalAlpha=l.alpha*n,r.strokeStyle="#"+("00000"+(0|p).toString(16)).substr(-6),r.stroke())}}},ks.prototype.updateGraphicsTint=function(e){e._prevTint=e.tint,e.canvasTintDirty=e.geometry.dirty;for(var t=(e.tint>>16&255)/255,r=(e.tint>>8&255)/255,n=(255&e.tint)/255,i=e.geometry.graphicsData,o=0;o<i.length;++o){var s=i[o],a=0|s.fillStyle.color,c=0|s.lineStyle.color;s._fillTint=((a>>16&255)/255*t*255<<16)+((a>>8&255)/255*r*255<<8)+(255&a)/255*n*255,s._lineTint=((c>>16&255)/255*t*255<<16)+((c>>8&255)/255*r*255<<8)+(255&c)/255*n*255}},ks.prototype.destroy=function(){this.renderer=null};var Ls=new yt;ji.prototype.generateCanvasTexture=function(e,t){void 0===t&&(t=1);var r=this.getLocalBounds(),n=Tr.create(r.width,r.height,e,t);Ds||(Ds=new As),this.transform.updateLocalTransform(),this.transform.localTransform.copyTo(Ls),Ls.invert(),Ls.tx-=r.x,Ls.ty-=r.y,Ds.render(this,n,!0,Ls);var i=xr.from(n.baseTexture._canvasRenderTarget.canvas,{scaleMode:e});return i.baseTexture.resolution=t,i.baseTexture.update(),i},ji.prototype.cachedGraphicsData=[],ji.prototype._renderCanvas=function(e){!0!==this.isMask&&(this.finishPoly(),e.plugins.graphics.render(this))};var Bs=new yt,Fs=function(e){this.renderer=e};Fs.prototype.render=function(e){var t=e._texture,r=this.renderer,n=r.context,i=t._frame.width,o=t._frame.height,s=e.transform.worldTransform,a=0,c=0,u=t.baseTexture.getDrawableSource();if(!(t.orig.width<=0||t.orig.height<=0)&&u&&t.valid){r.setBlendMode(e.blendMode,!0),r.context.globalAlpha=e.worldAlpha;var h=t.baseTexture.scaleMode===Pe.LINEAR;r.smoothProperty&&r.context[r.smoothProperty]!==h&&(n[r.smoothProperty]=h),t.trim?(a=t.trim.width/2+t.trim.x-e.anchor.x*t.orig.width,c=t.trim.height/2+t.trim.y-e.anchor.y*t.orig.height):(a=(.5-e.anchor.x)*t.orig.width,c=(.5-e.anchor.y)*t.orig.height),t.rotate&&(s.copyTo(Bs),s=Bs,Et.matrixAppendRotationInv(s,t.rotate,a,c),a=0,c=0),a-=i/2,c-=o/2,e.roundPixels?(r.context.setTransform(s.a,s.b,s.c,s.d,s.tx*r.resolution|0,s.ty*r.resolution|0),a|=0,c|=0):r.context.setTransform(s.a,s.b,s.c,s.d,s.tx*r.resolution,s.ty*r.resolution);var l=t.baseTexture.resolution,d=r._outerBlend;d&&(n.save(),n.beginPath(),n.rect(a*r.resolution,c*r.resolution,i*r.resolution,o*r.resolution),n.clip()),16777215!==e.tint?(e._cachedTint===e.tint&&e._tintedCanvas.tintId===e._texture._updateID||(e._cachedTint=e.tint,e._tintedCanvas=Ms.getTintedCanvas(e,e.tint)),n.drawImage(e._tintedCanvas,0,0,Math.floor(i*l),Math.floor(o*l),Math.floor(a*r.resolution),Math.floor(c*r.resolution),Math.floor(i*r.resolution),Math.floor(o*r.resolution))):n.drawImage(u,t._frame.x*l,t._frame.y*l,Math.floor(i*l),Math.floor(o*l),Math.floor(a*r.resolution),Math.floor(c*r.resolution),Math.floor(i*r.resolution),Math.floor(o*r.resolution)),d&&n.restore(),r.setBlendMode(xe.NORMAL)}},Fs.prototype.destroy=function(){this.renderer=null},Xi.prototype._tintedCanvas=null,Xi.prototype._renderCanvas=function(e){e.plugins.sprite.render(this)};var Ns=new Mt,js=function(e){this.renderer=e,e.extract=this};js.prototype.image=function(e,t,r){var n=new Image;return n.src=this.base64(e,t,r),n},js.prototype.base64=function(e,t,r){return this.canvas(e).toDataURL(t,r)},js.prototype.canvas=function(e){var t,r,n,i,o=this.renderer;e&&(i=e instanceof Tr?e:o.generateTexture(e)),i?(t=i.baseTexture._canvasRenderTarget.context,r=i.baseTexture._canvasRenderTarget.resolution,n=i.frame):(t=o.rootContext,r=o.resolution,(n=Ns).width=this.renderer.width,n.height=this.renderer.height);var s=Math.floor(n.width*r),a=Math.floor(n.height*r),c=new rt(s,a,1),u=t.getImageData(n.x*r,n.y*r,s,a);return c.context.putImageData(u,0,0),c.canvas},js.prototype.pixels=function(e){var t,r,n,i,o=this.renderer;return e&&(i=e instanceof Tr?e:o.generateTexture(e)),i?(t=i.baseTexture._canvasRenderTarget.context,r=i.baseTexture._canvasRenderTarget.resolution,n=i.frame):(t=o.rootContext,(n=Ns).width=o.width,n.height=o.height),t.getImageData(0,0,n.width*r,n.height*r).data},js.prototype.destroy=function(){this.renderer.extract=null,this.renderer=null};var Us={CanvasExtract:js},Gs=function(e){function t(t){e.call(this,t),this.uploadHookHelper=this,this.canvas=document.createElement("canvas"),this.canvas.width=16,this.canvas.height=16,this.ctx=this.canvas.getContext("2d"),this.registerUploadHook(Xs)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.destroy=function(){e.prototype.destroy.call(this),this.ctx=null,this.canvas=null},t}(ro);function Xs(e,t){if(t instanceof sr){var r=t.source,n=0===r.width?e.canvas.width:Math.min(e.canvas.width,r.width),i=0===r.height?e.canvas.height:Math.min(e.canvas.height,r.height);return e.ctx.drawImage(r,0,0,n,i,0,0,e.canvas.width,e.canvas.height),!0}return!1}var Vs={CanvasPrepare:Gs};return Jo.prototype._renderCanvas=function(e){var t=this._texture;if(t.baseTexture.valid){var r=e.context,n=this.worldTransform,i=e.resolution,o=t.baseTexture,s=o.getDrawableSource(),a=o.resolution,c=this.tilePosition.x/this.tileScale.x%t._frame.width*a,u=this.tilePosition.y/this.tileScale.y%t._frame.height*a;if(this._textureID!==this._texture._updateID||this._cachedTint!==this.tint){this._textureID=this._texture._updateID;var h=new rt(t._frame.width,t._frame.height,a);16777215!==this.tint?(this._tintedCanvas=Ms.getTintedCanvas(this,this.tint),h.context.drawImage(this._tintedCanvas,0,0)):h.context.drawImage(s,-t._frame.x*a,-t._frame.y*a),this._cachedTint=this.tint,this._canvasPattern=h.context.createPattern(h.canvas,"repeat")}r.globalAlpha=this.worldAlpha,r.setTransform(n.a*i,n.b*i,n.c*i,n.d*i,n.tx*i,n.ty*i),e.setBlendMode(this.blendMode),r.fillStyle=this._canvasPattern,r.scale(this.tileScale.x/a,this.tileScale.y/a);var l=this.anchor.x*-this._width,d=this.anchor.y*-this._height;this.uvRespectAnchor?(r.translate(c,u),r.fillRect(-c+l,-u+d,this._width/this.tileScale.x*a,this._height/this.tileScale.y*a)):(r.translate(c+l,u+d),r.fillRect(-c,-u,this._width/this.tileScale.x*a,this._height/this.tileScale.y*a))}},Xo.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var t=e.context,r=this.worldTransform,n=!0,i=0,o=0,s=0,a=0;e.setBlendMode(this.blendMode),t.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var c=0;c<this.children.length;++c){var u=this.children[c];if(u.visible){var h=u._texture.frame;if(t.globalAlpha=this.worldAlpha*u.alpha,u.rotation%(2*Math.PI)==0)n&&(t.setTransform(r.a,r.b,r.c,r.d,r.tx*e.resolution,r.ty*e.resolution),n=!1),i=u.anchor.x*(-h.width*u.scale.x)+u.position.x+.5,o=u.anchor.y*(-h.height*u.scale.y)+u.position.y+.5,s=h.width*u.scale.x,a=h.height*u.scale.y;else{n||(n=!0),u.displayObjectUpdateTransform();var l=u.worldTransform;this.roundPixels?t.setTransform(l.a,l.b,l.c,l.d,l.tx*e.resolution|0,l.ty*e.resolution|0):t.setTransform(l.a,l.b,l.c,l.d,l.tx*e.resolution,l.ty*e.resolution),i=u.anchor.x*-h.width+.5,o=u.anchor.y*-h.height+.5,s=h.width,a=h.height}var d=u._texture.baseTexture.resolution;t.drawImage(u._texture.baseTexture.source,h.x*d,h.y*d,h.width*d,h.height*d,i*e.resolution,o*e.resolution,s*e.resolution,a*e.resolution)}}}},Ut.prototype._renderCanvas=function(e){},Ut.prototype.renderCanvas=function(e){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){this._mask&&e.maskManager.pushMask(this._mask),this._renderCanvas(e);for(var t=0,r=this.children.length;t<r;++t)this.children[t].renderCanvas(e);this._mask&&e.maskManager.popMask(e)}},Nt.prototype.renderCanvas=function(e){},eo.prototype._renderCanvas=function(e){this._autoResolution&&this._resolution!==e.resolution&&(this._resolution=e.resolution,this.dirty=!0),this.updateText(!0),Xi.prototype._renderCanvas.call(this,e)},As.registerPlugin("accessibility",Xt),As.registerPlugin("extract",js),As.registerPlugin("graphics",ks),As.registerPlugin("interaction",mi),As.registerPlugin("mesh",Rs),As.registerPlugin("prepare",Gs),As.registerPlugin("sprite",Fs),Object.assign(vo,Vs),Object.assign(ai,Us),e.AbstractBatchRenderer=Zn,e.AbstractRenderer=Xn,e.AnimatedSprite=Ts,e.AppLoaderPlugin=Uo,e.Application=go,e.Attribute=Cr,e.BLEND_MODES=xe,e.BaseRenderTexture=yr,e.BaseTexture=sr,e.BatchDrawCall=qn,e.BatchGeometry=$n,e.BatchPluginFactory=ri,e.BatchRenderer=ii,e.BatchShaderGenerator=Qn,e.BitmapFontLoader=es,e.BitmapText=$o,e.Bounds=Ft,e.Buffer=Er,e.CanvasGraphicsRenderer=ks,e.CanvasMeshRenderer=Rs,e.CanvasRenderer=As,e.CanvasSpriteRenderer=Fs,e.CanvasTinter=Ms,e.Circle=Dt,e.Container=Ut,e.CubeTexture=Yn,e.DEG_TO_RAD=vt,e.DRAW_MODES=we,e.DisplayObject=Nt,e.ENV=_e,e.Ellipse=kt,e.FORMATS=Te,e.FillStyle=yi,e.Filter=Tn,e.Framebuffer=vr,e.GC_MODES=Ae,e.GLProgram=Dn,e.GLTexture=sr,e.GRAPHICS_CURVES=gi,e.Geometry=Dr,e.Graphics=ji,e.GraphicsData=_i,e.GraphicsGeometry=Oi,e.GroupD8=Et,e.LineStyle=Ri,e.Loader=jo,e.LoaderResource=Go,e.MIPMAP_MODES=Ie,e.Matrix=yt,e.Mesh=fs,e.MeshBatchUvs=ls,e.MeshGeometry=vs,e.MeshMaterial=ms,e.NineSlicePlane=ws,e.ObjectRenderer=Ur,e.ObservablePoint=dt,e.PI_2=ft,e.PRECISION=Me,e.ParticleContainer=Xo,e.ParticleRenderer=zo,e.PlaneGeometry=gs,e.Point=lt,e.Polygon=Lt,e.Program=gn,e.Quad=kr,e.QuadUv=Lr,e.RAD_TO_DEG=mt,e.RENDERER_TYPE=be,e.Rectangle=Mt,e.RenderTexture=Tr,e.RenderTexturePool=Sr,e.Renderer=Vn,e.RopeGeometry=ys,e.RoundedRectangle=Bt,e.Runner=zt,e.SCALE_MODES=Pe,e.SHAPES=gt,e.Shader=_n,e.SimpleMesh=xs,e.SimplePlane=bs,e.SimpleRope=_s,e.Sprite=Xi,e.SpriteMaskFilter=En,e.Spritesheet=Ho,e.SpritesheetLoader=Yo,e.State=xn,e.System=fr,e.TARGETS=Se,e.TEXT_GRADIENT=Vi,e.TYPES=Ce,e.Text=eo,e.TextMetrics=Zi,e.TextStyle=Wi,e.Texture=xr,e.TextureLoader=No,e.TextureMatrix=Cn,e.TextureUvs=_r,e.Ticker=qt,e.TickerPlugin=Zt,e.TilingSprite=Jo,e.TilingSpriteRenderer=Qo,e.Transform=It,e.UPDATE_PRIORITY=Wt,e.UniformGroup=Fr,e.VERSION="5.1.5",e.ViewableBuffer=Jn,e.WRAP_MODES=Ee,e.accessibility=Vt,e.autoDetectRenderer=zn,e.checkMaxIfStatementsInShader=pn,e.defaultFilterVertex=Wn,e.defaultVertex=Hn,e.extract=ai,e.filters=Cs,e.interaction=vi,e.isMobile=m,e.prepare=vo,e.resources=pr,e.settings=v,e.systems=Un,e.useDeprecated=function(){var e=this;Object.defineProperties(e,{SVG_SIZE:{get:function(){return ut(Ss,"PIXI.utils.SVG_SIZE property has moved to PIXI.resources.SVGResource.SVG_SIZE"),e.SVGResource.SVG_SIZE}},TransformStatic:{get:function(){return ut(Ss,"PIXI.TransformStatic class has been removed, use PIXI.Transform"),e.Transform}},TransformBase:{get:function(){return ut(Ss,"PIXI.TransformBase class has been removed, use PIXI.Transform"),e.Transform}},TRANSFORM_MODE:{get:function(){return ut(Ss,"PIXI.TRANSFORM_MODE property has been removed"),{STATIC:0,DYNAMIC:1}}},WebGLRenderer:{get:function(){return ut(Ss,"PIXI.WebGLRenderer class has moved to PIXI.Renderer"),e.Renderer}},CanvasRenderTarget:{get:function(){return ut(Ss,"PIXI.CanvasRenderTarget class has moved to PIXI.utils.CanvasRenderTarget"),e.utils.CanvasRenderTarget}},loader:{get:function(){return ut(Ss,"PIXI.loader instance has moved to PIXI.Loader.shared"),e.Loader.shared}},FilterManager:{get:function(){return ut(Ss,"PIXI.FilterManager class has moved to PIXI.systems.FilterSystem"),e.systems.FilterSystem}}}),e.extras={},Object.defineProperties(e.extras,{TilingSprite:{get:function(){return ut(Ss,"PIXI.extras.TilingSprite class has moved to PIXI.TilingSprite"),e.TilingSprite}},TilingSpriteRenderer:{get:function(){return ut(Ss,"PIXI.extras.TilingSpriteRenderer class has moved to PIXI.TilingSpriteRenderer"),e.TilingSpriteRenderer}},AnimatedSprite:{get:function(){return ut(Ss,"PIXI.extras.AnimatedSprite class has moved to PIXI.AnimatedSprite"),e.AnimatedSprite}},BitmapText:{get:function(){return ut(Ss,"PIXI.extras.BitmapText class has moved to PIXI.BitmapText"),e.BitmapText}}}),Object.defineProperties(e.utils,{getSvgSize:{get:function(){return ut(Ss,"PIXI.utils.getSvgSize function has moved to PIXI.resources.SVGResource.getSize"),e.SVGResource.getSize}}}),e.mesh={},Object.defineProperties(e.mesh,{Mesh:{get:function(){return ut(Ss,"PIXI.mesh.Mesh class has moved to PIXI.SimpleMesh"),e.SimpleMesh}},NineSlicePlane:{get:function(){return ut(Ss,"PIXI.mesh.NineSlicePlane class has moved to PIXI.NineSlicePlane"),e.NineSlicePlane}},Plane:{get:function(){return ut(Ss,"PIXI.mesh.Plane class has moved to PIXI.SimplePlane"),e.SimplePlane}},Rope:{get:function(){return ut(Ss,"PIXI.mesh.Rope class has moved to PIXI.SimpleRope"),e.SimpleRope}},RawMesh:{get:function(){return ut(Ss,"PIXI.mesh.RawMesh class has moved to PIXI.Mesh"),e.Mesh}},CanvasMeshRenderer:{get:function(){return ut(Ss,"PIXI.mesh.CanvasMeshRenderer class has moved to PIXI.CanvasMeshRenderer"),e.CanvasMeshRenderer}},MeshRenderer:{get:function(){return ut(Ss,"PIXI.mesh.MeshRenderer class has moved to PIXI.MeshRenderer"),e.MeshRenderer}}}),e.particles={},Object.defineProperties(e.particles,{ParticleContainer:{get:function(){return ut(Ss,"PIXI.particles.ParticleContainer class has moved to PIXI.ParticleContainer"),e.ParticleContainer}},ParticleRenderer:{get:function(){return ut(Ss,"PIXI.particles.ParticleRenderer class has moved to PIXI.ParticleRenderer"),e.ParticleRenderer}}}),e.ticker={},Object.defineProperties(e.ticker,{Ticker:{get:function(){return ut(Ss,"PIXI.ticker.Ticker class has moved to PIXI.Ticker"),e.Ticker}},shared:{get:function(){return ut(Ss,"PIXI.ticker.shared instance has moved to PIXI.Ticker.shared"),e.Ticker.shared}}}),e.loaders={},Object.defineProperties(e.loaders,{Loader:{get:function(){return ut(Ss,"PIXI.loaders.Loader class has moved to PIXI.Loader"),e.Loader}},Resource:{get:function(){return ut(Ss,"PIXI.loaders.Resource class has moved to PIXI.LoaderResource"),e.LoaderResource}},bitmapFontParser:{get:function(){return ut(Ss,"PIXI.loaders.bitmapFontParser function has moved to PIXI.BitmapFontLoader.use"),e.BitmapFontLoader.use}},parseBitmapFontData:{get:function(){return ut(Ss,"PIXI.loaders.parseBitmapFontData function has moved to PIXI.BitmapFontLoader.parse"),e.BitmapFontLoader.parse}},spritesheetParser:{get:function(){return ut(Ss,"PIXI.loaders.spritesheetParser function has moved to PIXI.SpritesheetLoader.use"),e.SpritesheetLoader.use}},getResourcePath:{get:function(){return ut(Ss,"PIXI.loaders.getResourcePath property has moved to PIXI.SpritesheetLoader.getResourcePath"),e.SpritesheetLoader.getResourcePath}}}),e.Loader.addPixiMiddleware=function(t){return ut(Ss,"PIXI.loaders.Loader.addPixiMiddleware function is deprecated, use PIXI.loaders.Loader.registerPlugin"),e.loaders.Loader.registerPlugin({use:t()})},Object.defineProperty(e.extract,"WebGLExtract",{get:function(){return ut(Ss,"PIXI.extract.WebGLExtract method has moved to PIXI.extract.Extract"),e.extract.Extract}}),Object.defineProperty(e.prepare,"WebGLPrepare",{get:function(){return ut(Ss,"PIXI.prepare.WebGLPrepare class has moved to PIXI.prepare.Prepare"),e.prepare.Prepare}}),e.Container.prototype._renderWebGL=function(e){ut(Ss,"PIXI.Container._renderWebGL method has moved to PIXI.Container._render"),this._render(e)},e.Container.prototype.renderWebGL=function(e){ut(Ss,"PIXI.Container.renderWebGL method has moved to PIXI.Container.render"),this.render(e)},e.DisplayObject.prototype.renderWebGL=function(e){ut(Ss,"PIXI.DisplayObject.renderWebGL method has moved to PIXI.DisplayObject.render"),this.render(e)},e.Container.prototype.renderAdvancedWebGL=function(e){ut(Ss,"PIXI.Container.renderAdvancedWebGL method has moved to PIXI.Container.renderAdvanced"),this.renderAdvanced(e)},Object.defineProperties(e.settings,{TRANSFORM_MODE:{get:function(){return ut(Ss,"PIXI.settings.TRANSFORM_MODE property has been removed"),0},set:function(){ut(Ss,"PIXI.settings.TRANSFORM_MODE property has been removed")}}});var t=e.BaseTexture;t.prototype.loadSource=function(t){ut(Ss,"PIXI.BaseTexture.loadSource method has been deprecated");var r=e.resources.autoDetectResource(t);r.internal=!0,this.setResource(r),this.update()},Object.defineProperties(t.prototype,{hasLoaded:{get:function(){return ut(Ss,"PIXI.BaseTexture.hasLoaded property has been removed, use PIXI.BaseTexture.valid"),this.valid}},imageUrl:{get:function(){return ut(Ss,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&this.resource.url},set:function(e){ut(Ss,"PIXI.BaseTexture.imageUrl property has been removed, use PIXI.BaseTexture.resource.url"),this.resource&&(this.resource.url=e)}},source:{get:function(){return ut(Ss,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source`"),this.resource&&this.resource.source},set:function(e){ut(Ss,"PIXI.BaseTexture.source property has been moved, use `PIXI.BaseTexture.resource.source` if you want to set HTMLCanvasElement. Otherwise, create new BaseTexture."),this.resource&&(this.resource.source=e)}}}),t.fromImage=function(e,r,n,i){ut(Ss,"PIXI.BaseTexture.fromImage method has been replaced with PIXI.BaseTexture.from");var o={scale:i,crossorigin:r};return t.from(e,{scaleMode:n,resourceOptions:o})},t.fromCanvas=function(e,r){return ut(Ss,"PIXI.BaseTexture.fromCanvas method has been replaced with PIXI.BaseTexture.from"),t.from(e,{scaleMode:r})},t.fromSVG=function(e,r,n,i){ut(Ss,"PIXI.BaseTexture.fromSVG method has been replaced with PIXI.BaseTexture.from");var o={scale:i,crossorigin:r};return t.from(e,{scaleMode:n,resourceOptions:o})},e.Point.prototype.copy=function(e){return ut(Ss,"PIXI.Point.copy method has been replaced with PIXI.Point.copyFrom"),this.copyFrom(e)},e.ObservablePoint.prototype.copy=function(e){return ut(Ss,"PIXI.ObservablePoint.copy method has been replaced with PIXI.ObservablePoint.copyFrom"),this.copyFrom(e)},e.Rectangle.prototype.copy=function(e){return ut(Ss,"PIXI.Rectangle.copy method has been replaced with PIXI.Rectangle.copyFrom"),this.copyFrom(e)},e.Matrix.prototype.copy=function(e){return ut(Ss,"PIXI.Matrix.copy method has been replaced with PIXI.Matrix.copyTo"),this.copyTo(e)},e.systems.StateSystem.prototype.setState=function(e){return ut("v5.1.0","StateSystem.setState has been renamed to StateSystem.set"),this.set(e)},Object.assign(e.systems.FilterSystem.prototype,{getRenderTarget:function(e,t){return ut(Ss,"PIXI.FilterManager.getRenderTarget method has been replaced with PIXI.systems.FilterSystem#getFilterTexture"),this.getFilterTexture(t)},returnRenderTarget:function(e){ut(Ss,"PIXI.FilterManager.returnRenderTarget method has been replaced with PIXI.systems.FilterSystem.returnFilterTexture"),this.returnFilterTexture(e)},calculateScreenSpaceMatrix:function(e){ut(Ss,"PIXI.systems.FilterSystem.calculateScreenSpaceMatrix method is removed, use `(vTextureCoord * inputSize.xy) + outputFrame.xy` instead");var t=e.identity(),r=this.activeState,n=r.sourceFrame,i=r.destinationFrame;return t.translate(n.x/i.width,n.y/i.height),t.scale(i.width,i.height),t},calculateNormalizedScreenSpaceMatrix:function(e){ut(Ss,"PIXI.systems.FilterManager.calculateNormalizedScreenSpaceMatrix method is removed, use `((vTextureCoord * inputSize.xy) + outputFrame.xy) / outputFrame.zw` instead.");var t=this.activeState,r=t.sourceFrame,n=t.destinationFrame,i=e.identity();i.translate(r.x/n.width,r.y/n.height);var o=n.width/r.width,s=n.height/r.height;return i.scale(o,s),i}}),Object.defineProperties(e.RenderTexture.prototype,{sourceFrame:{get:function(){return ut(Ss,"PIXI.RenderTexture.sourceFrame property has been removed"),this.filterFrame}},size:{get:function(){return ut(Ss,"PIXI.RenderTexture.size property has been removed"),this._frame}}});var r=function(e){function t(t,r,n,i){ut(Ss,"PIXI.filters.BlurXFilter class is deprecated, use PIXI.filters.BlurFilterPass"),e.call(this,!0,t,r,n,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(e.filters.BlurFilterPass),n=function(e){function t(t,r,n,i){ut(Ss,"PIXI.filters.BlurYFilter class is deprecated, use PIXI.filters.BlurFilterPass"),e.call(this,!1,t,r,n,i)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(e.filters.BlurFilterPass);Object.assign(e.filters,{BlurXFilter:r,BlurYFilter:n});var i=e.Sprite,o=e.Texture,s=e.Graphics;function a(e,t,r,n){return ut(Ss,"PIXI.Sprite."+e+" method is deprecated, use PIXI.Sprite.from"),i.from(t,{resourceOptions:{scale:n,crossorigin:r}})}function c(e,t,r,n){return ut(Ss,"PIXI.Texture."+e+" method is deprecated, use PIXI.Texture.from"),o.from(t,{resourceOptions:{scale:n,crossorigin:r}})}s.prototype.generateCanvasTexture||(s.prototype.generateCanvasTexture=function(){ut(Ss,'PIXI.Graphics.generateCanvasTexture method is only available in "pixi.js-legacy"')}),Object.defineProperty(e.Graphics.prototype,"graphicsData",{get:function(){return ut(Ss,"PIXI.Graphics.graphicsData property is deprecated, use PIXI.Graphics.geometry.graphicsData"),this.geometry.graphicsData}}),i.fromImage=a.bind(null,"fromImage"),i.fromSVG=a.bind(null,"fromSVG"),i.fromCanvas=a.bind(null,"fromCanvas"),i.fromVideo=a.bind(null,"fromVideo"),i.fromFrame=a.bind(null,"fromFrame"),o.fromImage=c.bind(null,"fromImage"),o.fromSVG=c.bind(null,"fromSVG"),o.fromCanvas=c.bind(null,"fromCanvas"),o.fromVideo=c.bind(null,"fromVideo"),o.fromFrame=c.bind(null,"fromFrame"),Object.defineProperty(e.AbstractRenderer.prototype,"autoResize",{get:function(){return ut(Ss,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity},set:function(e){ut(Ss,"PIXI.AbstractRenderer.autoResize property is deprecated, use PIXI.AbstractRenderer.autoDensity"),this.autoDensity=e}}),Object.defineProperty(e.Renderer.prototype,"textureManager",{get:function(){return ut(Ss,"PIXI.Renderer.textureManager property is deprecated, use PIXI.Renderer.texture"),this.texture}}),e.utils.mixins={mixin:function(){ut(Ss,"PIXI.utils.mixins.mixin function is no longer available")},delayMixin:function(){ut(Ss,"PIXI.utils.mixins.delayMixin function is no longer available")},performMixins:function(){ut(Ss,"PIXI.utils.mixins.performMixins function is no longer available")}}},e.utils=ht,e}({});n.useDeprecated(),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).__pixiSound=t()}(this,(function(){"use strict";if(void 0===n)throw"PixiJS required";var e=setTimeout;function t(){}function r(e){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function i(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,r._immediateFn((function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(e){return void s(t.promise,e)}o(t.promise,n)}else(1===e._state?o:s)(t.promise,e._value)}))):e._deferreds.push(t)}function o(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof r)return e._state=3,e._value=t,void a(e);if("function"==typeof n)return void c((i=n,o=t,function(){i.apply(o,arguments)}),e)}e._state=1,e._value=t,a(e)}catch(t){s(e,t)}var i,o}function s(e,t){e._state=2,e._value=t,a(e)}function a(e){2===e._state&&0===e._deferreds.length&&r._immediateFn((function(){e._handled||r._unhandledRejectionFn(e._value)}));for(var t=0,n=e._deferreds.length;t<n;t++)i(e,e._deferreds[t]);e._deferreds=null}function c(e,t){var r=!1;try{e((function(e){r||(r=!0,o(t,e))}),(function(e){r||(r=!0,s(t,e))}))}catch(e){if(r)return;r=!0,s(t,e)}}r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,r){var n=new this.constructor(t);return i(this,new function(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}(e,r,n)),n},r.prototype.finally=function(e){var t=this.constructor;return this.then((function(r){return t.resolve(e()).then((function(){return r}))}),(function(r){return t.resolve(e()).then((function(){return t.reject(r)}))}))},r.all=function(e){return new r((function(t,r){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var n=Array.prototype.slice.call(e);if(0===n.length)return t([]);var i=n.length;function o(e,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var a=s.then;if("function"==typeof a)return void a.call(s,(function(t){o(e,t)}),r)}n[e]=s,0==--i&&t(n)}catch(e){r(e)}}for(var s=0;s<n.length;s++)o(s,n[s])}))},r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r((function(t){t(e)}))},r.reject=function(e){return new r((function(t,r){r(e)}))},r.race=function(e){return new r((function(t,r){for(var n=0,i=e.length;n<i;n++)e[n].then(t,r)}))},r._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(t){e(t,0)},r._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console};var u=function(){function e(e,t){this._output=t,this._input=e}return Object.defineProperty(e.prototype,"destination",{get:function(){return this._input},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return this._filters},set:function(e){var t=this;if(this._filters&&(this._filters.forEach((function(e){e&&e.disconnect()})),this._filters=null,this._input.connect(this._output)),e&&e.length){this._filters=e.slice(0),this._input.disconnect();var r=null;e.forEach((function(e){null===r?t._input.connect(e.destination):r.connect(e.destination),r=e})),r.connect(this._output)}},enumerable:!0,configurable:!0}),e.prototype.destroy=function(){this.filters=null,this._input=null,this._output=null},e}(),h=function(){function e(e,t){this.init(e,t)}return e.prototype.init=function(e,t){this.destination=e,this.source=t||e},e.prototype.connect=function(e){this.source.connect(e)},e.prototype.disconnect=function(){this.source.disconnect()},e.prototype.destroy=function(){this.disconnect(),this.destination=null,this.source=null},e}(),l=function(e,t){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function d(e,t){function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var p,f=function(){return(f=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function m(){return p}var v,g,y,_,b=function(){function e(){}return e.setParamValue=function(e,t){if(e.setValueAtTime){var r=m().context;e.setValueAtTime(t,r.audioContext.currentTime)}else e.value=t;return t},e}(),x=0,w=function(e){function t(t){var r=e.call(this)||this;return r.id=x++,r._media=null,r._paused=!1,r._muted=!1,r._elapsed=0,r._updateListener=r._update.bind(r),r.init(t),r}return d(t,e),t.prototype.stop=function(){this._source&&(this._internalStop(),this.emit("stop"))},Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh(),this._update(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!0,configurable:!0}),t.prototype.refresh=function(){if(this._source){var e=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;var r=e.volume*(e.muted?0:1),n=t.volume*(t.muted?0:1),i=this._volume*(this._muted?0:1);b.setParamValue(this._gain.gain,i*n*r),b.setParamValue(this._source.playbackRate,this._speed*t.speed*e.speed)}},t.prototype.refreshPaused=function(){var e=this._media.context,t=this._media.parent,r=this._paused||t.paused||e.paused;r!==this._pausedReal&&(this._pausedReal=r,r?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._elapsed%this._duration,end:this._end,speed:this._speed,loop:this._loop,volume:this._volume})),this.emit("pause",r))},t.prototype.play=function(e){var t=e.start,r=e.end,n=e.speed,i=e.loop,o=e.volume,s=e.muted;this._paused=!1;var a=this._media.nodes.cloneBufferSource(),c=a.source,u=a.gain;this._source=c,this._gain=u,this._speed=n,this._volume=o,this._loop=!!i,this._muted=s,this.refresh();var h=this._source.buffer.duration;this._duration=h,this._end=r,this._lastUpdate=this._now(),this._elapsed=t,this._source.onended=this._onComplete.bind(this),this._loop?(this._source.loopEnd=r,this._source.loopStart=t,this._source.start(0,t)):r?this._source.start(0,t,r-t):this._source.start(0,t),this.emit("start"),this._update(!0),this._enabled=!0},t.prototype._toSec=function(e){return e>10&&(e/=1e3),e||0},Object.defineProperty(t.prototype,"_enabled",{set:function(e){var t=this._media.nodes.script;t.removeEventListener("audioprocess",this._updateListener),e&&t.addEventListener("audioprocess",this._updateListener)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"progress",{get:function(){return this._progress},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.removeAllListeners(),this._internalStop(),this._source&&(this._source.disconnect(),this._source=null),this._gain&&(this._gain.disconnect(),this._gain=null),this._media&&(this._media.context.events.off("refresh",this.refresh,this),this._media.context.events.off("refreshPaused",this.refreshPaused,this),this._media=null),this._end=null,this._speed=1,this._volume=1,this._loop=!1,this._elapsed=0,this._duration=0,this._paused=!1,this._muted=!1,this._pausedReal=!1},t.prototype.toString=function(){return"[WebAudioInstance id="+this.id+"]"},t.prototype._now=function(){return this._media.context.audioContext.currentTime},t.prototype._update=function(e){if(void 0===e&&(e=!1),this._source){var t=this._now(),r=t-this._lastUpdate;if(r>0||e){var n=this._source.playbackRate.value;this._elapsed+=r*n,this._lastUpdate=t;var i=this._duration,o=void 0;if(this._source.loopStart){var s=this._source.loopEnd-this._source.loopStart;o=(this._source.loopStart+this._elapsed%s)/i}else o=this._elapsed%i/i;this._progress=o,this.emit("progress",this._progress,i)}}},t.prototype.init=function(e){this._media=e,e.context.events.on("refresh",this.refresh,this),e.context.events.on("refreshPaused",this.refreshPaused,this)},t.prototype._internalStop=function(){this._source&&(this._enabled=!1,this._source.onended=null,this._source.stop(0),this._source=null)},t.prototype._onComplete=function(){this._source&&(this._enabled=!1,this._source.onended=null),this._source=null,this._progress=1,this.emit("progress",1,this._duration),this.emit("end",this)},t}(n.utils.EventEmitter),T=function(e){function t(r){var n=this,i=r.audioContext,o=i.createBufferSource(),s=i.createScriptProcessor(t.BUFFER_SIZE),a=i.createGain(),c=i.createAnalyser();return o.connect(c),c.connect(a),a.connect(r.destination),s.connect(r.destination),(n=e.call(this,c,a)||this).context=r,n.bufferSource=o,n.script=s,n.gain=a,n.analyser=c,n}return d(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.bufferSource.disconnect(),this.script.disconnect(),this.gain.disconnect(),this.analyser.disconnect(),this.bufferSource=null,this.script=null,this.gain=null,this.analyser=null,this.context=null},t.prototype.cloneBufferSource=function(){var e=this.bufferSource,t=this.context.audioContext.createBufferSource();t.buffer=e.buffer,b.setParamValue(t.playbackRate,e.playbackRate.value),t.loop=e.loop;var r=this.context.audioContext.createGain();return t.connect(r),r.connect(this.destination),{source:t,gain:r}},t.BUFFER_SIZE=256,t}(u),S=function(){function e(){}return e.prototype.init=function(e){this.parent=e,this._nodes=new T(this.context),this._source=this._nodes.bufferSource,this.source=e.options.source},e.prototype.destroy=function(){this.parent=null,this._nodes.destroy(),this._nodes=null,this._source=null,this.source=null},e.prototype.create=function(){return new w(this)},Object.defineProperty(e.prototype,"context",{get:function(){return this.parent.context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isPlayable",{get:function(){return!!this._source&&!!this._source.buffer},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return this._nodes.filters},set:function(e){this._nodes.filters=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._source.buffer.duration},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buffer",{get:function(){return this._source.buffer},set:function(e){this._source.buffer=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nodes",{get:function(){return this._nodes},enumerable:!0,configurable:!0}),e.prototype.load=function(e){this.source?this._decode(this.source,e):this.parent.url?this._loadUrl(e):e&&e(new Error("sound.url or sound.source must be set"))},e.prototype._loadUrl=function(e){var t=this,r=new XMLHttpRequest,n=this.parent.url;r.open("GET",n,!0),r.responseType="arraybuffer",r.onload=function(){t.source=r.response,t._decode(r.response,e)},r.send()},e.prototype._decode=function(e,t){var r=this;this.parent.context.decode(e,(function(e,n){if(e)t&&t(e);else{r.parent.isLoaded=!0,r.buffer=n;var i=r.parent.autoPlayStart();t&&t(null,r.parent,i)}}))},e}(),C=function(e){function t(){var r=this,i=window,o=new t.AudioContext,s=o.createDynamicsCompressor(),a=o.createAnalyser();return a.connect(s),s.connect(o.destination),(r=e.call(this,a,s)||this)._ctx=o,r._offlineCtx=new t.OfflineAudioContext(1,2,i.OfflineAudioContext?o.sampleRate:44100),r._unlocked=!1,r.compressor=s,r.analyser=a,r.events=new n.utils.EventEmitter,r.volume=1,r.speed=1,r.muted=!1,r.paused=!1,"running"!==o.state&&(r._unlock(),r._unlock=r._unlock.bind(r),document.addEventListener("mousedown",r._unlock,!0),document.addEventListener("touchstart",r._unlock,!0),document.addEventListener("touchend",r._unlock,!0)),r}return d(t,e),t.prototype._unlock=function(){this._unlocked||(this.playEmptySound(),"running"===this._ctx.state&&(document.removeEventListener("mousedown",this._unlock,!0),document.removeEventListener("touchend",this._unlock,!0),document.removeEventListener("touchstart",this._unlock,!0),this._unlocked=!0))},t.prototype.playEmptySound=function(){var e=this._ctx.createBufferSource();e.buffer=this._ctx.createBuffer(1,1,22050),e.connect(this._ctx.destination),e.start(0,0,0),"suspended"===e.context.state&&e.context.resume()},Object.defineProperty(t,"AudioContext",{get:function(){var e=window;return e.AudioContext||e.webkitAudioContext||null},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OfflineAudioContext",{get:function(){var e=window;return e.OfflineAudioContext||e.webkitOfflineAudioContext||null},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this._ctx;void 0!==t.close&&t.close(),this.events.removeAllListeners(),this.analyser.disconnect(),this.compressor.disconnect(),this.analyser=null,this.compressor=null,this.events=null,this._offlineCtx=null,this._ctx=null},Object.defineProperty(t.prototype,"audioContext",{get:function(){return this._ctx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offlineContext",{get:function(){return this._offlineCtx},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){e&&"running"===this._ctx.state?this._ctx.suspend():e||"suspended"!==this._ctx.state||this._ctx.resume(),this._paused=e},enumerable:!0,configurable:!0}),t.prototype.refresh=function(){this.events.emit("refresh")},t.prototype.refreshPaused=function(){this.events.emit("refreshPaused")},t.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},t.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this._paused},t.prototype.decode=function(e,t){this._offlineCtx.decodeAudioData(e,(function(e){t(null,e)}),(function(e){t(new Error(e.message||"Unable to decode file"))}))},t}(u),P=Object.freeze({WebAudioMedia:S,WebAudioInstance:w,WebAudioNodes:T,WebAudioContext:C,WebAudioUtils:b}),E=function(e){function t(r,n,i,o,s,a,c,u,h,l){void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===a&&(a=0),void 0===c&&(c=0),void 0===u&&(u=0),void 0===h&&(h=0),void 0===l&&(l=0);var d=this;if(!m().useLegacy){var p=[{f:t.F32,type:"lowshelf",gain:r},{f:t.F64,type:"peaking",gain:n},{f:t.F125,type:"peaking",gain:i},{f:t.F250,type:"peaking",gain:o},{f:t.F500,type:"peaking",gain:s},{f:t.F1K,type:"peaking",gain:a},{f:t.F2K,type:"peaking",gain:c},{f:t.F4K,type:"peaking",gain:u},{f:t.F8K,type:"peaking",gain:h},{f:t.F16K,type:"highshelf",gain:l}].map((function(e){var t=m().context.audioContext.createBiquadFilter();return t.type=e.type,b.setParamValue(t.Q,1),t.frequency.value=e.f,b.setParamValue(t.gain,e.gain),t}));(d=e.call(this,p[0],p[p.length-1])||this).bands=p,d.bandsMap={};for(var f=0;f<d.bands.length;f++){var v=d.bands[f];f>0&&d.bands[f-1].connect(v),d.bandsMap[v.frequency.value]=v}return d}d=e.call(this,null)||this}return d(t,e),t.prototype.setGain=function(e,t){if(void 0===t&&(t=0),!this.bandsMap[e])throw new Error("No band found for frequency "+e);b.setParamValue(this.bandsMap[e].gain,t)},t.prototype.getGain=function(e){if(!this.bandsMap[e])throw new Error("No band found for frequency "+e);return this.bandsMap[e].gain.value},Object.defineProperty(t.prototype,"f32",{get:function(){return this.getGain(t.F32)},set:function(e){this.setGain(t.F32,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f64",{get:function(){return this.getGain(t.F64)},set:function(e){this.setGain(t.F64,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f125",{get:function(){return this.getGain(t.F125)},set:function(e){this.setGain(t.F125,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f250",{get:function(){return this.getGain(t.F250)},set:function(e){this.setGain(t.F250,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f500",{get:function(){return this.getGain(t.F500)},set:function(e){this.setGain(t.F500,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f1k",{get:function(){return this.getGain(t.F1K)},set:function(e){this.setGain(t.F1K,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f2k",{get:function(){return this.getGain(t.F2K)},set:function(e){this.setGain(t.F2K,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f4k",{get:function(){return this.getGain(t.F4K)},set:function(e){this.setGain(t.F4K,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f8k",{get:function(){return this.getGain(t.F8K)},set:function(e){this.setGain(t.F8K,e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"f16k",{get:function(){return this.getGain(t.F16K)},set:function(e){this.setGain(t.F16K,e)},enumerable:!0,configurable:!0}),t.prototype.reset=function(){this.bands.forEach((function(e){b.setParamValue(e.gain,0)}))},t.prototype.destroy=function(){this.bands.forEach((function(e){e.disconnect()})),this.bands=null,this.bandsMap=null},t.F32=32,t.F64=64,t.F125=125,t.F250=250,t.F500=500,t.F1K=1e3,t.F2K=2e3,t.F4K=4e3,t.F8K=8e3,t.F16K=16e3,t}(h),I=function(e){function t(t){void 0===t&&(t=0);var r=this;if(!m().useLegacy){var n=m().context.audioContext.createWaveShaper();return(r=e.call(this,n)||this)._distortion=n,r.amount=t,r}r=e.call(this,null)||this}return d(t,e),Object.defineProperty(t.prototype,"amount",{get:function(){return this._amount},set:function(e){e*=1e3,this._amount=e;for(var t,r=new Float32Array(44100),n=Math.PI/180,i=0;i<44100;++i)t=2*i/44100-1,r[i]=(3+e)*t*20*n/(Math.PI+e*Math.abs(t));this._distortion.curve=r,this._distortion.oversample="4x"},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this._distortion=null,e.prototype.destroy.call(this)},t}(h),A=function(e){function t(t){void 0===t&&(t=0);var r=this;if(!m().useLegacy){var n,i,o,s=m().context.audioContext;return s.createStereoPanner?o=n=s.createStereoPanner():((i=s.createPanner()).panningModel="equalpower",o=i),(r=e.call(this,o)||this)._stereo=n,r._panner=i,r.pan=t,r}r=e.call(this,null)||this}return d(t,e),Object.defineProperty(t.prototype,"pan",{get:function(){return this._pan},set:function(e){this._pan=e,this._stereo?b.setParamValue(this._stereo.pan,e):this._panner.setPosition(e,0,1-Math.abs(e))},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){e.prototype.destroy.call(this),this._stereo=null,this._panner=null},t}(h),M=function(e){function t(t,r,n){void 0===t&&(t=3),void 0===r&&(r=2),void 0===n&&(n=!1);var i=this;if(!m().useLegacy)return(i=e.call(this,null)||this)._seconds=i._clamp(t,1,50),i._decay=i._clamp(r,0,100),i._reverse=n,i._rebuild(),i;i=e.call(this,null)||this}return d(t,e),t.prototype._clamp=function(e,t,r){return Math.min(r,Math.max(t,e))},Object.defineProperty(t.prototype,"seconds",{get:function(){return this._seconds},set:function(e){this._seconds=this._clamp(e,1,50),this._rebuild()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"decay",{get:function(){return this._decay},set:function(e){this._decay=this._clamp(e,0,100),this._rebuild()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"reverse",{get:function(){return this._reverse},set:function(e){this._reverse=e,this._rebuild()},enumerable:!0,configurable:!0}),t.prototype._rebuild=function(){for(var e,t=m().context.audioContext,r=t.sampleRate,n=r*this._seconds,i=t.createBuffer(2,n,r),o=i.getChannelData(0),s=i.getChannelData(1),a=0;a<n;a++)e=this._reverse?n-a:a,o[a]=(2*Math.random()-1)*Math.pow(1-e/n,this._decay),s[a]=(2*Math.random()-1)*Math.pow(1-e/n,this._decay);var c=m().context.audioContext.createConvolver();c.buffer=i,this.init(c)},t}(h),O=function(e){function t(){var t=this;if(!m().useLegacy){var r=m().context.audioContext,n=r.createChannelSplitter(),i=r.createChannelMerger();return i.connect(n),(t=e.call(this,i,n)||this)._merger=i,t}t=e.call(this,null)||this}return d(t,e),t.prototype.destroy=function(){this._merger.disconnect(),this._merger=null,e.prototype.destroy.call(this)},t}(h),R=function(e){function t(){if(!m().useLegacy){var t=m().context.audioContext,r=t.createBiquadFilter(),n=t.createBiquadFilter(),i=t.createBiquadFilter(),o=t.createBiquadFilter();return r.type="lowpass",b.setParamValue(r.frequency,2e3),n.type="lowpass",b.setParamValue(n.frequency,2e3),i.type="highpass",b.setParamValue(i.frequency,500),o.type="highpass",b.setParamValue(o.frequency,500),r.connect(n),n.connect(i),i.connect(o),e.call(this,r,o)||this}e.call(this,null)}return d(t,e),t}(h),D=Object.freeze({Filter:h,EqualizerFilter:E,DistortionFilter:I,StereoFilter:A,ReverbFilter:M,MonoFilter:O,TelephoneFilter:R}),k=0,L=function(e){function t(t){var r=e.call(this)||this;return r.id=k++,r.init(t),r}return d(t,e),Object.defineProperty(t.prototype,"progress",{get:function(){return this._source.currentTime/this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!0,configurable:!0}),t.prototype._onPlay=function(){this._playing=!0},t.prototype._onPause=function(){this._playing=!1},t.prototype.init=function(e){this._playing=!1,this._duration=e.source.duration;var t=this._source=e.source.cloneNode(!1);t.src=e.parent.url,t.onplay=this._onPlay.bind(this),t.onpause=this._onPause.bind(this),e.context.on("refresh",this.refresh,this),e.context.on("refreshPaused",this.refreshPaused,this),this._media=e},t.prototype._internalStop=function(){this._source&&this._playing&&(this._source.onended=null,this._source.pause())},t.prototype.stop=function(){this._internalStop(),this._source&&this.emit("stop")},Object.defineProperty(t.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!0,configurable:!0}),t.prototype.refresh=function(){var e=this._media.context,t=this._media.parent;this._source.loop=this._loop||t.loop;var r=e.volume*(e.muted?0:1),n=t.volume*(t.muted?0:1),i=this._volume*(this._muted?0:1);this._source.volume=i*r*n,this._source.playbackRate=this._speed*e.speed*t.speed},t.prototype.refreshPaused=function(){var e=this._media.context,t=this._media.parent,r=this._paused||t.paused||e.paused;r!==this._pausedReal&&(this._pausedReal=r,r?(this._internalStop(),this.emit("paused")):(this.emit("resumed"),this.play({start:this._source.currentTime,end:this._end,volume:this._volume,speed:this._speed,loop:this._loop})),this.emit("pause",r))},t.prototype.play=function(e){var r=this,i=e.start,o=e.end,s=e.speed,a=e.loop,c=e.volume,u=e.muted;this._speed=s,this._volume=c,this._loop=!!a,this._muted=u,this.refresh(),this.loop&&null!==o&&(this.loop=!1),this._start=i,this._end=o||this._duration,this._start=Math.max(0,this._start-t.PADDING),this._end=Math.min(this._end+t.PADDING,this._duration),this._source.onloadedmetadata=function(){r._source&&(r._source.currentTime=i,r._source.onloadedmetadata=null,r.emit("progress",i,r._duration),n.ticker.shared.add(r._onUpdate,r))},this._source.onended=this._onComplete.bind(this),this._source.play(),this.emit("start")},t.prototype._onUpdate=function(){this.emit("progress",this.progress,this._duration),this._source.currentTime>=this._end&&!this._source.loop&&this._onComplete()},t.prototype._onComplete=function(){n.ticker.shared.remove(this._onUpdate,this),this._internalStop(),this.emit("progress",1,this._duration),this.emit("end",this)},t.prototype.destroy=function(){n.ticker.shared.remove(this._onUpdate,this),this.removeAllListeners();var e=this._source;e&&(e.onended=null,e.onplay=null,e.onpause=null,this._internalStop()),this._source=null,this._speed=1,this._volume=1,this._loop=!1,this._end=null,this._start=0,this._duration=0,this._playing=!1,this._pausedReal=!1,this._paused=!1,this._muted=!1,this._media&&(this._media.context.off("refresh",this.refresh,this),this._media.context.off("refreshPaused",this.refreshPaused,this),this._media=null)},t.prototype.toString=function(){return"[HTMLAudioInstance id="+this.id+"]"},t.PADDING=.1,t}(n.utils.EventEmitter),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return d(t,e),t.prototype.init=function(e){this.parent=e,this._source=e.options.source||new Audio,e.url&&(this._source.src=e.url)},t.prototype.create=function(){return new L(this)},Object.defineProperty(t.prototype,"isPlayable",{get:function(){return!!this._source&&4===this._source.readyState},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){return this._source.duration},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"context",{get:function(){return this.parent.context},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filters",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.removeAllListeners(),this.parent=null,this._source&&(this._source.src="",this._source.load(),this._source=null)},Object.defineProperty(t.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),t.prototype.load=function(e){var t=this._source,r=this.parent;if(4!==t.readyState){if(!r.url)return e(new Error("sound.url or sound.source must be set"));t.src=r.url;var n=function(){t.removeEventListener("canplaythrough",i),t.removeEventListener("load",i),t.removeEventListener("abort",o),t.removeEventListener("error",s)},i=function(){n(),r.isLoaded=!0;var t=r.autoPlayStart();e&&e(null,r,t)},o=function(){n(),e&&e(new Error("Sound loading has been aborted"))},s=function(){n();var r="Failed to load audio element (code: "+t.error.code+")";e&&e(new Error(r))};t.addEventListener("canplaythrough",i,!1),t.addEventListener("load",i,!1),t.addEventListener("abort",o,!1),t.addEventListener("error",s,!1),t.load()}else{r.isLoaded=!0;var a=r.autoPlayStart();e&&setTimeout((function(){e(null,r,a)}),0)}},t}(n.utils.EventEmitter),F=function(e){function t(){var t=e.call(this)||this;return t.speed=1,t.volume=1,t.muted=!1,t.paused=!1,t}return d(t,e),t.prototype.refresh=function(){this.emit("refresh")},t.prototype.refreshPaused=function(){this.emit("refreshPaused")},Object.defineProperty(t.prototype,"filters",{get:function(){return null},set:function(e){},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"audioContext",{get:function(){return null},enumerable:!0,configurable:!0}),t.prototype.toggleMute=function(){return this.muted=!this.muted,this.refresh(),this.muted},t.prototype.togglePause=function(){return this.paused=!this.paused,this.refreshPaused(),this.paused},t.prototype.destroy=function(){this.removeAllListeners()},t}(n.utils.EventEmitter),N=Object.freeze({HTMLAudioMedia:B,HTMLAudioInstance:L,HTMLAudioContext:F}),j=["mp3","ogg","oga","opus","mpeg","wav","m4a","mp4","aiff","wma","mid"],U=(v={m4a:"mp4",oga:"ogg"},g=document.createElement("audio"),y={},_=/^no$/,j.forEach((function(e){var t=v[e]||e,r=g.canPlayType("audio/"+e).replace(_,""),n=g.canPlayType("audio/"+t).replace(_,"");y[e]=!!r||!!n})),Object.freeze(y)),G=/\.(\{([^\}]+)\})(\?.*)?$/;function X(e){var t=G,r="string"==typeof e?e:e.url;if(t.test(r)){for(var n=t.exec(r),i=n[2].split(","),o=i[i.length-1],s=0,a=i.length;s<a;s++){var c=i[s];if(U[c]){o=c;break}}var u=r.replace(n[1],o);return"string"!=typeof e&&(e.extension=o,e.url=u),u}return r}var V=function(){function e(){}return e.add=function(){e.legacy=m().useLegacy},Object.defineProperty(e,"legacy",{set:function(e){var t=n.loaders.Resource,r=j;e?r.forEach((function(e){t.setExtensionXhrType(e,t.XHR_RESPONSE_TYPE.DEFAULT),t.setExtensionLoadType(e,t.LOAD_TYPE.AUDIO)})):r.forEach((function(e){t.setExtensionXhrType(e,t.XHR_RESPONSE_TYPE.BUFFER),t.setExtensionLoadType(e,t.LOAD_TYPE.XHR)}))},enumerable:!0,configurable:!0}),e.pre=function(e,t){X(e),t()},e.use=function(e,t){e.data&&j.indexOf(e.extension)>-1?e.sound=m().add(e.name,{loaded:t,preload:!0,url:e.url,source:e.data}):t()},e}(),z=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.use(V.use),n.pre(V.pre),n}return d(t,e),t.addPixiMiddleware=function(t){e.addPixiMiddleware.call(this,t)},t}(n.loaders.Loader),H=function(){function e(e,t){this.parent=e,Object.assign(this,t),this.duration=this.end-this.start}return e.prototype.play=function(e){return this.parent.play({complete:e,speed:this.speed||this.parent.speed,end:this.end,start:this.start,loop:this.loop})},e.prototype.destroy=function(){this.parent=null},e}(),W=function(){function e(e,t){this.media=e,this.options=t,this._instances=[],this._sprites={},this.media.init(this);var r=t.complete;this._autoPlayOptions=r?{complete:r}:null,this.isLoaded=!1,this.isPlaying=!1,this.autoPlay=t.autoPlay,this.singleInstance=t.singleInstance,this.preload=t.preload||this.autoPlay,this.url=t.url,this.speed=t.speed,this.volume=t.volume,this.loop=t.loop,t.sprites&&this.addSprites(t.sprites),this.preload&&this._preload(t.loaded)}return e.from=function(t){var r={};return"string"==typeof t?r.url=t:t instanceof ArrayBuffer||t instanceof HTMLAudioElement?r.source=t:r=t,(r=f({autoPlay:!1,singleInstance:!1,url:null,source:null,preload:!1,volume:1,speed:1,complete:null,loaded:null,loop:!1},r)).url&&(r.url=X(r.url)),Object.freeze(r),new e(m().useLegacy?new B:new S,r)},Object.defineProperty(e.prototype,"context",{get:function(){return m().context},enumerable:!0,configurable:!0}),e.prototype.pause=function(){return this.isPlaying=!1,this.paused=!0,this},e.prototype.resume=function(){return this.isPlaying=this._instances.length>0,this.paused=!1,this},Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(e){this._paused=e,this.refreshPaused()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speed",{get:function(){return this._speed},set:function(e){this._speed=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filters",{get:function(){return this.media.filters},set:function(e){this.media.filters=e},enumerable:!0,configurable:!0}),e.prototype.addSprites=function(e,t){if("object"==typeof e){var r={};for(var n in e)r[n]=this.addSprites(n,e[n]);return r}if("string"==typeof e){var i=new H(this,t);return this._sprites[e]=i,i}},e.prototype.destroy=function(){this._removeInstances(),this.removeSprites(),this.media.destroy(),this.media=null,this._sprites=null,this._instances=null},e.prototype.removeSprites=function(e){if(e){var t=this._sprites[e];void 0!==t&&(t.destroy(),delete this._sprites[e])}else for(var r in this._sprites)this.removeSprites(r);return this},Object.defineProperty(e.prototype,"isPlayable",{get:function(){return this.isLoaded&&this.media&&this.media.isPlayable},enumerable:!0,configurable:!0}),e.prototype.stop=function(){if(!this.isPlayable)return this.autoPlay=!1,this._autoPlayOptions=null,this;this.isPlaying=!1;for(var e=this._instances.length-1;e>=0;e--)this._instances[e].stop();return this},e.prototype.play=function(e,t){var r,n=this;if("string"==typeof e?r={sprite:o=e,loop:this.loop,complete:t}:"function"==typeof e?(r={}).complete=e:r=e,(r=f({complete:null,loaded:null,sprite:null,end:null,start:0,volume:1,speed:1,muted:!1,loop:!1},r||{})).sprite){var i=r.sprite,o=this._sprites[i];r.start=o.start,r.end=o.end,r.speed=o.speed||1,r.loop=o.loop||r.loop,delete r.sprite}if(r.offset&&(r.start=r.offset),!this.isLoaded)return new Promise((function(e,t){n.autoPlay=!0,n._autoPlayOptions=r,n._preload((function(n,i,o){n?t(n):(r.loaded&&r.loaded(n,i,o),e(o))}))}));this.singleInstance&&this._removeInstances();var s=this._createInstance();return this._instances.push(s),this.isPlaying=!0,s.once("end",(function(){r.complete&&r.complete(n),n._onComplete(s)})),s.once("stop",(function(){n._onComplete(s)})),s.play(r),s},e.prototype.refresh=function(){for(var e=this._instances.length,t=0;t<e;t++)this._instances[t].refresh()},e.prototype.refreshPaused=function(){for(var e=this._instances.length,t=0;t<e;t++)this._instances[t].refreshPaused()},Object.defineProperty(e.prototype,"volume",{get:function(){return this._volume},set:function(e){this._volume=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._muted},set:function(e){this._muted=e,this.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loop",{get:function(){return this._loop},set:function(e){this._loop=e,this.refresh()},enumerable:!0,configurable:!0}),e.prototype._preload=function(e){this.media.load(e)},Object.defineProperty(e.prototype,"instances",{get:function(){return this._instances},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sprites",{get:function(){return this._sprites},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this.media.duration},enumerable:!0,configurable:!0}),e.prototype.autoPlayStart=function(){var e;return this.autoPlay&&(e=this.play(this._autoPlayOptions)),e},e.prototype._removeInstances=function(){for(var e=this._instances.length-1;e>=0;e--)this._poolInstance(this._instances[e]);this._instances.length=0},e.prototype._onComplete=function(e){if(this._instances){var t=this._instances.indexOf(e);t>-1&&this._instances.splice(t,1),this.isPlaying=this._instances.length>0}this._poolInstance(e)},e.prototype._createInstance=function(){if(e._pool.length>0){var t=e._pool.pop();return t.init(this.media),t}return this.media.create()},e.prototype._poolInstance=function(t){t.destroy(),e._pool.indexOf(t)<0&&e._pool.push(t)},e._pool=[],e}(),Y=function(){function e(){this.init()}return e.prototype.init=function(){return this.supported&&(this._webAudioContext=new C),this._htmlAudioContext=new F,this._sounds={},this.useLegacy=!this.supported,this},Object.defineProperty(e.prototype,"context",{get:function(){return this._context},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filtersAll",{get:function(){return this.useLegacy?[]:this._context.filters},set:function(e){this.useLegacy||(this._context.filters=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"supported",{get:function(){return null!==C.AudioContext},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t){if("object"==typeof e){var r={};for(var n in e){var i=this._getOptions(e[n],t);r[n]=this.add(n,i)}return r}if("string"==typeof e){if(t instanceof W)return this._sounds[e]=t,t;i=this._getOptions(t);var o=W.from(i);return this._sounds[e]=o,o}},e.prototype._getOptions=function(e,t){var r;return r="string"==typeof e?{url:e}:e instanceof ArrayBuffer||e instanceof HTMLAudioElement?{source:e}:e,f({},r,t||{})},Object.defineProperty(e.prototype,"useLegacy",{get:function(){return this._useLegacy},set:function(e){V.legacy=e,this._useLegacy=e,this._context=!e&&this.supported?this._webAudioContext:this._htmlAudioContext},enumerable:!0,configurable:!0}),e.prototype.remove=function(e){return this.exists(e,!0),this._sounds[e].destroy(),delete this._sounds[e],this},Object.defineProperty(e.prototype,"volumeAll",{get:function(){return this._context.volume},set:function(e){this._context.volume=e,this._context.refresh()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"speedAll",{get:function(){return this._context.speed},set:function(e){this._context.speed=e,this._context.refresh()},enumerable:!0,configurable:!0}),e.prototype.togglePauseAll=function(){return this._context.togglePause()},e.prototype.pauseAll=function(){return this._context.paused=!0,this._context.refresh(),this},e.prototype.resumeAll=function(){return this._context.paused=!1,this._context.refresh(),this},e.prototype.toggleMuteAll=function(){return this._context.toggleMute()},e.prototype.muteAll=function(){return this._context.muted=!0,this._context.refresh(),this},e.prototype.unmuteAll=function(){return this._context.muted=!1,this._context.refresh(),this},e.prototype.removeAll=function(){for(var e in this._sounds)this._sounds[e].destroy(),delete this._sounds[e];return this},e.prototype.stopAll=function(){for(var e in this._sounds)this._sounds[e].stop();return this},e.prototype.exists=function(e,t){return void 0===t&&(t=!1),!!this._sounds[e]},e.prototype.find=function(e){return this.exists(e,!0),this._sounds[e]},e.prototype.play=function(e,t){return this.find(e).play(t)},e.prototype.stop=function(e){return this.find(e).stop()},e.prototype.pause=function(e){return this.find(e).pause()},e.prototype.resume=function(e){return this.find(e).resume()},e.prototype.volume=function(e,t){var r=this.find(e);return void 0!==t&&(r.volume=t),r.volume},e.prototype.speed=function(e,t){var r=this.find(e);return void 0!==t&&(r.speed=t),r.speed},e.prototype.duration=function(e){return this.find(e).duration},e.prototype.close=function(){return this.removeAll(),this._sounds=null,this._webAudioContext&&(this._webAudioContext.destroy(),this._webAudioContext=null),this._htmlAudioContext&&(this._htmlAudioContext.destroy(),this._htmlAudioContext=null),this._context=null,this},e}(),q=0,J=Object.freeze({get PLAY_ID(){return q},playOnce:function(e,t){var r="alias"+q++;return m().add(r,{url:e,preload:!0,autoPlay:!0,loaded:function(e){e&&(m().remove(r),t&&t(e))},complete:function(){m().remove(r),t&&t(null)}}),r},render:function(e,t){var r=document.createElement("canvas");t=f({width:512,height:128,fill:"black"},t||{}),r.width=t.width,r.height=t.height;var i=n.BaseTexture.fromCanvas(r);if(!(e.media instanceof S))return i;var o=e.media,s=r.getContext("2d");s.fillStyle=t.fill;for(var a=o.buffer.getChannelData(0),c=Math.ceil(a.length/t.width),u=t.height/2,h=0;h<t.width;h++){for(var l=1,d=-1,p=0;p<c;p++){var m=a[h*c+p];m<l&&(l=m),m>d&&(d=m)}s.fillRect(h,(1+l)*u,1,Math.max(1,(d-l)*u))}return i},resolveUrl:X,sineTone:function(e,t){void 0===e&&(e=200),void 0===t&&(t=1);var r=W.from({singleInstance:!0});if(!(r.media instanceof S))return r;for(var n=r.media,i=r.context.audioContext.createBuffer(1,48e3*t,48e3),o=i.getChannelData(0),s=0;s<o.length;s++){var a=e*(s/i.sampleRate)*Math.PI;o[s]=2*Math.sin(a)}return n.buffer=i,r.isLoaded=!0,r},extensions:j,supported:U}),K=function(e){return p=e,e}(new Y),Z=window,Q=n;if("undefined"==typeof Promise&&(Z.Promise=r),void 0!==n.loaders){var $=parseInt(n.VERSION.split(".")[0],10);4===$?(n.loaders.Loader=z,V.add(),n.loader.use(V.use),n.loader.pre(V.pre)):$>=5&&Q.Loader.registerPlugin(V)}return void 0===Z.__pixiSound&&delete Z.__pixiSound,Q.sound||(Object.defineProperty(Q,"sound",{get:function(){return K}}),Object.defineProperties(K,{Filterable:{get:function(){return u}},filters:{get:function(){return D}},htmlaudio:{get:function(){return N}},Sound:{get:function(){return W}},SoundLibrary:{get:function(){return Y}},SoundSprite:{get:function(){return H}},utils:{get:function(){return J}},webaudio:{get:function(){return P}},sound:{get:function(){return K}}})),K})),function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=r[s]={exports:{}};t[s][0].call(h.exports,(function(e){return i(t[s][1][e]||e)}),h,h.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){var n=e("tmi.js"),i={global:{},users:{}},o="",s=null,a=!0,c=0,u={isDebug:!1,chatModes:{},version:function(){return"1.0.13"},onCommand:function(e,t,r,n,i){u.isDebug&&console.log("onCommand default handler")},onChat:function(e,t,r,n,i){u.isDebug&&console.log("onChat default handler")},onWhisper:function(e,t,r,n,i){u.isDebug&&console.log("onWhisper default handler")},onMessageDeleted:function(e,t){u.isDebug&&console.log("onMessageDeleted default handler")},onJoin:function(e,t){u.isDebug&&console.log("onJoin default handler")},onPart:function(e,t){u.isDebug&&console.log("onPart default handler")},onHosted:function(e,t,r){u.isDebug&&console.log("onHosted default handler")},onRaid:function(e,t){u.isDebug&&console.log("onRaid default handler")},onSub:function(e,t,r,n){u.isDebug&&console.log("onSub default handler")},onResub:function(e,t,r,n,i,o){u.isDebug&&console.log("onResub default handler")},onSubGift:function(e,t,r,n,i,o){u.isDebug&&console.log("onSubGift default handler")},onSubMysteryGift:function(e,t,r,n,i){u.isDebug&&console.log("onSubMysteryGift default handler")},onGiftSubContinue:function(e,t,r){u.isDebug&&console.log("onGiftSubContinue default handler")},onCheer:function(e,t,r){u.isDebug&&console.log("onCheer default handler")},onChatMode:function(e,t){u.isDebug&&console.log("onChatMode default handler")},onConnected:function(e,t,r){},onReconnect:function(e){},Say:function(e,t){return!!s&&(t||(t=o),s.say(t,e).catch((function(e){console.log("Error:",e)})),!0)},Whisper:function(e,t){return!!s&&(s.whisper(t,e).catch((function(e){console.log("Error:",e)})),!0)},DeleteMessage:function(e,t){return!!s&&(t||(t=o),s.deletemessage(t,e).catch((function(e){console.log("Error:",e)})),!0)},GetClient:function(){return s},Init:function(e,t,r,h){if(("string"==typeof(r=r||[e])||r instanceof String)&&(r=[r]),!Array.isArray(r))throw new Error("Channels is not an array");u.isDebug=h,o=r[0];var l={options:{debug:h},connection:{reconnect:!0,secure:!0},channels:r};t&&(l.identity={username:e,password:t}),(s=new n.client(l)).on("roomstate",(function(e,t){try{var r=e.replace("#","");u.chatModes[r]=u.chatModes[r]||{},"emote-only"in t&&(u.chatModes[r].emoteOnly=t["emote-only"]),"followers-only"in t&&(u.chatModes[r].followerOnly=0<=t["followers-only"]),"subs-only"in t&&(u.chatModes[r].subOnly=t["subs-only"]),"r9k"in t&&(u.chatModes[r].r9kMode=t.r9k),"slow"in t&&(u.chatModes[r].slowMode=t.slow),u.onChatMode(u.chatModes[r],r)}catch(e){console.log("Error:",e)}})),s.on("message",(function(t,r,n,o){try{var s=r["display-name"]||r.username||e,a="#"+r.username===t,c=r.mod,h=r.badges&&"0"===r.badges.founder,l=h||r.badges&&void 0!==r.badges.subscriber||r.subscriber,d=r.badges&&"1"===r.badges.vip||!1,p="highlighted-message"===r["msg-id"],f=r["user-id"],m=r.id,v=r["room-id"],g=r.badges,y=r.color,_=r.emotes,b=r["emote-only"]||!1,x=r["message-type"],w=r["custom-reward-id"]||null,T={broadcaster:a,mod:c,founder:h,subscriber:l,vip:d,highlighted:p,customReward:!!w},S={id:m,channel:t.replace("#",""),roomId:v,messageType:x,messageEmotes:_,isEmoteOnly:b,userId:f,username:r.username,displayName:r["display-name"],userColor:y,userBadges:g,customRewardId:w};if(o||"!"!==n[0])"action"===x||"chat"===x?u.onChat(s,n,T,o,S):"whisper"===x&&u.onWhisper(s,n,T,o,S);else{var C=n.split(/ (.*)/),P=C[0].slice(1).toLowerCase(),E=C[1]||"";S.sinceLastCommand=function(e,t){if(!e)return{any:null,user:null};var r=new Date,n={};return i.global[e]?n.any=r-i.global[e]:n.any=0,i.global[e]=r,t?(i.users[t]||(i.users[t]={}),i.users[t][e]?n.user=r-i.users[t][e]:n.user=0,i.users[t][e]=r):n.user=null,n}(P,f),u.onCommand(s,P,E,T,S)}}catch(t){console.log("Error:",t)}})),s.on("messagedeleted",(function(e,t,r,n){try{var i=n["target-msg-id"],o={id:i,roomId:n["room-id"],username:t,message:r};u.onMessageDeleted(i,o)}catch(e){console.log("Error:",e)}})),s.on("join",(function(e,t,r){u.onJoin(t,r)})),s.on("part",(function(e,t,r){u.onPart(t,r)})),s.on("hosted",(function(e,t,r,n){u.onHosted(t,r,n)})),s.on("raided",(function(e,t,r){u.onRaid(t,r)})),s.on("cheer",(function(e,t,r){var n=~~t.bits,i={id:t.id,username:t.login,userColor:t.color,userBadges:t.badges,displayName:t["display-name"],messageEmotes:t.emotes,subscriber:t.subscriber};u.onCheer(r,n,i)})),s.on("subscription",(function(e,t,r,n,i){var o={id:i.id,roomId:i["room-id"],messageType:i["message-type"],messageEmotes:i.emotes,userId:i["user-id"],username:i.login,displayName:i["display-name"],userColor:i.color,userBadges:i.badges};u.onSub(t,n,r,o)})),s.on("resub",(function(e,t,r,n,i,o){var s=~~i["msg-param-cumulative-months"],a={id:i.id,roomId:i["room-id"],messageType:i["message-type"],messageEmotes:i.emotes,userId:i["user-id"],username:i.login,displayName:i["display-name"],userColor:i.color,userBadges:i.badges};u.onResub(t,n,r,s,o,a)})),s.on("subgift",(function(e,t,r,n,i,o){var s=~~o["msg-param-sender-count"],a={id:o.id,roomId:o["room-id"],messageType:o["message-type"],messageEmotes:o.emotes,userId:o["user-id"],username:o.login,displayName:o["display-name"],userColor:o.color,userBadges:o.badges,recipientDisplayName:o["msg-param-recipient-display-name"],recipientUsername:o["msg-param-recipient-user-name"],recipientId:o["msg-param-recipient-id"]};u.onSubGift(t,r,n,s,i,a)})),s.on("submysterygift",(function(e,t,r,n,i){var o=~~i["msg-param-sender-count"],s={id:i.id,roomId:i["room-id"],messageType:i["message-type"],messageEmotes:i.emotes,userId:i["user-id"],username:i.login,displayName:i["display-name"],userColor:i.color,userBadges:i.badges,recipientDisplayName:i["msg-param-recipient-display-name"],recipientUsername:i["msg-param-recipient-user-name"],recipientId:i["msg-param-recipient-id"],userMassGiftCount:~~i["msg-param-mass-gift-count"]};u.onSubMysteryGift(t,r,o,n,s)})),s.on("giftpaidupgrade",(function(e,t,r,n){var i={id:n.id,roomId:n["room-id"],messageType:n["message-type"],messageEmotes:n.emotes,userId:n["user-id"],username:n.login,displayName:n["display-name"],userColor:n.color,userBadges:n.badges,gifterUsername:n["msg-param-sender-login"],gifterDisplayName:n["msg-param-sender-name"]};u.onGiftSubContinue(t,r,i)})),s.on("connected",(function(e,t){console.log("Connected:"+e+":"+t),u.onConnected(e,t,a),a=!1})),s.on("reconnect",(function(){console.log("Reconnecting"),c++,u.onReconnect(c)})),s.connect().catch((function(e){console.log("Error:",e)}))}};void 0!==t&&t.exports&&(t.exports=u),"undefined"!=typeof window&&(window.ComfyJS=u,n=window.tmi)},{"tmi.js":2}],2:[function(e,t,r){(function(t){!function t(r,n,i){function o(a,c){if(!n[a]){if(!r[a]){var u="function"==typeof e&&e;if(!c&&u)return u(a,!0);if(s)return s(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=n[a]={exports:{}};r[a][0].call(l.exports,(function(e){return o(r[a][1][e]||e)}),l,l.exports,t,r,n,i)}return n[a].exports}for(var s="function"==typeof e&&e,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,r){"use strict";t.exports={client:e("./lib/client"),Client:e("./lib/client")}},{"./lib/client":3}],2:[function(e,t,r){"use strict";var n=e("request"),i=e("./utils");t.exports=function(e,t){var r=null===i.get(e.url,null)?i.get(e.uri,null):i.get(e.url,null);if(i.isURL(r)||(r="https://api.twitch.tv/kraken"+("/"===r[0]?r:"/"+r)),i.isNode())n(i.merge({method:"GET",json:!0},e,{url:r}),t);else if(i.isExtension()){e=i.merge({url:r,method:"GET",headers:{}},e);var o=new XMLHttpRequest;for(var s in o.open(e.method,e.url,!0),e.headers)o.setRequestHeader(s,e.headers[s]);o.responseType="json",o.addEventListener("load",(function(e){4==o.readyState&&(200!=o.status?t(o.status,null,null):t(null,null,o.response))})),o.send()}else{var a="jsonp_callback_"+Math.round(1e5*Math.random());window[a]=function(e){delete window[a],document.body.removeChild(c),t(null,null,e)};var c=document.createElement("script");c.src=r+(r.includes("?")?"&":"?")+"callback="+a,document.body.appendChild(c)}}},{"./utils":10,request:11}],3:[function(e,r,n){(function(t){"use strict";var n=e("./api"),i=e("./commands"),o=e("./events").EventEmitter,s=e("./logger"),a=e("./parser"),c=e("./timer"),u=e("./extra-utils"),h=t.WebSocket||t.MozWebSocket||e("ws"),l=e("./utils"),d=function e(t){if(this instanceof e==0)return new e(t);this.setMaxListeners(0),this.opts=l.get(t,{}),this.opts.channels=this.opts.channels||[],this.opts.connection=this.opts.connection||{},this.opts.identity=this.opts.identity||{},this.opts.options=this.opts.options||{},this.clientId=l.get(this.opts.options.clientId,null),this.maxReconnectAttempts=l.get(this.opts.connection.maxReconnectAttempts,1/0),this.maxReconnectInterval=l.get(this.opts.connection.maxReconnectInterval,3e4),this.reconnect=l.get(this.opts.connection.reconnect,!1),this.reconnectDecay=l.get(this.opts.connection.reconnectDecay,1.5),this.reconnectInterval=l.get(this.opts.connection.reconnectInterval,1e3),this.reconnecting=!1,this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.secure=l.get(this.opts.connection.secure,!1),this.emotes="",this.emotesets={},this.channels=[],this.currentLatency=0,this.globaluserstate={},this.lastJoined="",this.latency=new Date,this.moderators={},this.pingLoop=null,this.pingTimeout=null,this.reason="",this.username="",this.userstate={},this.wasCloseCalled=!1,this.ws=null;var r="error";this.opts.options.debug&&(r="info"),this.log=this.opts.logger||s;try{s.setLevel(r)}catch(e){}this.opts.channels.forEach((function(e,t,r){r[t]=l.channel(e)})),o.call(this)};for(var p in l.inherits(d,o),d.prototype.api=n,i)d.prototype[p]=i[p];d.prototype.handleMessage=function(e){var t=this;if(!l.isNull(e)){this.emit("raw_message",JSON.parse(JSON.stringify(e)),e);var r=l.channel(l.get(e.params[0],null)),n=l.get(e.params[1],null),i=l.get(e.tags["msg-id"],null);if(e.tags=a.badges(a.emotes(e.tags)),e.tags)for(var o in e.tags)"emote-sets"!==o&&"ban-duration"!==o&&"bits"!==o&&(l.isBoolean(e.tags[o])?e.tags[o]=null:"1"===e.tags[o]?e.tags[o]=!0:"0"===e.tags[o]&&(e.tags[o]=!1));if(l.isNull(e.prefix))switch(e.command){case"PING":this.emit("ping"),l.isNull(this.ws)||2===this.ws.readyState||3===this.ws.readyState||this.ws.send("PONG");break;case"PONG":var s=new Date;this.currentLatency=(s.getTime()-this.latency.getTime())/1e3,this.emits(["pong","_promisePing"],[[this.currentLatency]]),clearTimeout(this.pingTimeout);break;default:this.log.warn("Could not parse message with no prefix:\n"+JSON.stringify(e,null,4))}else if("tmi.twitch.tv"===e.prefix)switch(e.command){case"002":case"003":case"004":case"375":case"376":case"CAP":break;case"001":this.username=e.params[0];break;case"372":this.log.info("Connected to server."),this.userstate["#tmijs"]={},this.emits(["connected","_promiseConnect"],[[this.server,this.port],[null]]),this.reconnections=0,this.reconnectTimer=this.reconnectInterval,this.pingLoop=setInterval((function(){l.isNull(t.ws)||2===t.ws.readyState||3===t.ws.readyState||t.ws.send("PING"),t.latency=new Date,t.pingTimeout=setTimeout((function(){l.isNull(t.ws)||(t.wasCloseCalled=!1,t.log.error("Ping timeout."),t.ws.close(),clearInterval(t.pingLoop),clearTimeout(t.pingTimeout))}),l.get(t.opts.connection.timeout,9999))}),6e4);var u=new c.queue(2e3),h=l.union(this.opts.channels,this.channels);this.channels=[];for(var d=0;d<h.length;d++){var p=this;u.add(function(e){l.isNull(p.ws)||2===p.ws.readyState||3===p.ws.readyState||p.ws.send("JOIN "+l.channel(h[e]))}.bind(this,d))}u.run();break;case"NOTICE":var f=[null],m=[r,i,n],v=[r,!0],g=[r,!1],y=[m,f],_=[m,[i]],b="["+r+"] "+n;switch(i){case"subs_on":this.log.info("["+r+"] This room is now in subscribers-only mode."),this.emits(["subscriber","subscribers","_promiseSubscribers"],[v,v,f]);break;case"subs_off":this.log.info("["+r+"] This room is no longer in subscribers-only mode."),this.emits(["subscriber","subscribers","_promiseSubscribersoff"],[g,g,f]);break;case"emote_only_on":this.log.info("["+r+"] This room is now in emote-only mode."),this.emits(["emoteonly","_promiseEmoteonly"],[v,f]);break;case"emote_only_off":this.log.info("["+r+"] This room is no longer in emote-only mode."),this.emits(["emoteonly","_promiseEmoteonlyoff"],[g,f]);break;case"slow_on":case"slow_off":break;case"followers_on_zero":case"followers_on":case"followers_off":break;case"r9k_on":this.log.info("["+r+"] This room is now in r9k mode."),this.emits(["r9kmode","r9kbeta","_promiseR9kbeta"],[v,v,f]);break;case"r9k_off":this.log.info("["+r+"] This room is no longer in r9k mode."),this.emits(["r9kmode","r9kbeta","_promiseR9kbetaoff"],[g,g,f]);break;case"room_mods":var x=n.split(": ")[1].toLowerCase().split(", ").filter((function(e){return e}));this.emits(["_promiseMods","mods"],[[null,x],[r,x]]);break;case"no_mods":this.emits(["_promiseMods","mods"],[[null,[]],[r,[]]]);break;case"vips_success":n.endsWith(".")&&(n=n.slice(0,-1));var w=n.split(": ")[1].toLowerCase().split(", ").filter((function(e){return e}));this.emits(["_promiseVips","vips"],[[null,w],[r,w]]);break;case"no_vips":this.emits(["_promiseVips","vips"],[[null,[]],[r,[]]]);break;case"already_banned":case"bad_ban_admin":case"bad_ban_broadcaster":case"bad_ban_global_mod":case"bad_ban_self":case"bad_ban_staff":case"usage_ban":this.log.info(b),this.emits(["notice","_promiseBan"],_);break;case"ban_success":this.log.info(b),this.emits(["notice","_promiseBan"],y);break;case"usage_clear":this.log.info(b),this.emits(["notice","_promiseClear"],_);break;case"usage_mods":this.log.info(b),this.emits(["notice","_promiseMods"],[m,[i,[]]]);break;case"mod_success":this.log.info(b),this.emits(["notice","_promiseMod"],y);break;case"usage_vips":this.log.info(b),this.emits(["notice","_promiseVips"],[m,[i,[]]]);break;case"usage_vip":case"bad_vip_grantee_banned":case"bad_vip_grantee_already_vip":this.log.info(b),this.emits(["notice","_promiseVip"],[m,[i,[]]]);break;case"vip_success":this.log.info(b),this.emits(["notice","_promiseVip"],y);break;case"usage_mod":case"bad_mod_banned":case"bad_mod_mod":this.log.info(b),this.emits(["notice","_promiseMod"],_);break;case"unmod_success":this.log.info(b),this.emits(["notice","_promiseUnmod"],y);break;case"unvip_success":this.log.info(b),this.emits(["notice","_promiseUnvip"],y);break;case"usage_unmod":case"bad_unmod_mod":this.log.info(b),this.emits(["notice","_promiseUnmod"],_);break;case"usage_unvip":case"bad_unvip_grantee_not_vip":this.log.info(b),this.emits(["notice","_promiseUnvip"],_);break;case"color_changed":this.log.info(b),this.emits(["notice","_promiseColor"],y);break;case"usage_color":case"turbo_only_color":this.log.info(b),this.emits(["notice","_promiseColor"],_);break;case"commercial_success":this.log.info(b),this.emits(["notice","_promiseCommercial"],y);break;case"usage_commercial":case"bad_commercial_error":this.log.info(b),this.emits(["notice","_promiseCommercial"],_);break;case"hosts_remaining":this.log.info(b);var T=isNaN(n[0])?0:parseInt(n[0]);this.emits(["notice","_promiseHost"],[m,[null,~~T]]);break;case"bad_host_hosting":case"bad_host_rate_exceeded":case"bad_host_error":case"usage_host":this.log.info(b),this.emits(["notice","_promiseHost"],[m,[i,null]]);break;case"already_r9k_on":case"usage_r9k_on":this.log.info(b),this.emits(["notice","_promiseR9kbeta"],_);break;case"already_r9k_off":case"usage_r9k_off":this.log.info(b),this.emits(["notice","_promiseR9kbetaoff"],_);break;case"timeout_success":this.log.info(b),this.emits(["notice","_promiseTimeout"],y);break;case"delete_message_success":this.log.info("["+r+" "+n+"]"),this.emits(["notice","_promiseDeletemessage"],y);case"already_subs_off":case"usage_subs_off":this.log.info(b),this.emits(["notice","_promiseSubscribersoff"],_);break;case"already_subs_on":case"usage_subs_on":this.log.info(b),this.emits(["notice","_promiseSubscribers"],_);break;case"already_emote_only_off":case"usage_emote_only_off":this.log.info(b),this.emits(["notice","_promiseEmoteonlyoff"],_);break;case"already_emote_only_on":case"usage_emote_only_on":this.log.info(b),this.emits(["notice","_promiseEmoteonly"],_);break;case"usage_slow_on":this.log.info(b),this.emits(["notice","_promiseSlow"],_);break;case"usage_slow_off":this.log.info(b),this.emits(["notice","_promiseSlowoff"],_);break;case"usage_timeout":case"bad_timeout_admin":case"bad_timeout_broadcaster":case"bad_timeout_duration":case"bad_timeout_global_mod":case"bad_timeout_self":case"bad_timeout_staff":this.log.info(b),this.emits(["notice","_promiseTimeout"],_);break;case"untimeout_success":case"unban_success":this.log.info(b),this.emits(["notice","_promiseUnban"],y);break;case"usage_unban":case"bad_unban_no_ban":this.log.info(b),this.emits(["notice","_promiseUnban"],_);break;case"usage_delete":case"bad_delete_message_error":case"bad_delete_message_broadcaster":case"bad_delete_message_mod":this.log.info(b),this.emits(["notice","_promiseDeletemessage"],_);break;case"usage_unhost":case"not_hosting":this.log.info(b),this.emits(["notice","_promiseUnhost"],_);break;case"whisper_invalid_login":case"whisper_invalid_self":case"whisper_limit_per_min":case"whisper_limit_per_sec":case"whisper_restricted_recipient":this.log.info(b),this.emits(["notice","_promiseWhisper"],_);break;case"no_permission":case"msg_banned":case"msg_room_not_found":case"msg_channel_suspended":case"tos_ban":this.log.info(b),this.emits(["notice","_promiseBan","_promiseClear","_promiseUnban","_promiseTimeout","_promiseDeletemessage","_promiseMods","_promiseMod","_promiseUnmod","_promiseVips","_promiseVip","_promiseUnvip","_promiseCommercial","_promiseHost","_promiseUnhost","_promiseJoin","_promisePart","_promiseR9kbeta","_promiseR9kbetaoff","_promiseSlow","_promiseSlowoff","_promiseFollowers","_promiseFollowersoff","_promiseSubscribers","_promiseSubscribersoff","_promiseEmoteonly","_promiseEmoteonlyoff"],_);break;case"unrecognized_cmd":this.log.info(b),this.emit("notice",r,i,n),"/w"===n.split(" ").splice(-1)[0]&&this.log.warn("You must be connected to a group server to send or receive whispers.");break;case"cmds_available":case"host_target_went_offline":case"msg_censored_broadcaster":case"msg_duplicate":case"msg_emoteonly":case"msg_verified_email":case"msg_ratelimit":case"msg_subsonly":case"msg_timedout":case"msg_bad_characters":case"msg_channel_blocked":case"msg_facebook":case"msg_followersonly":case"msg_followersonly_followed":case"msg_followersonly_zero":case"msg_rejected":case"msg_slowmode":case"msg_suspended":case"no_help":case"usage_disconnect":case"usage_help":case"usage_me":this.log.info(b),this.emit("notice",r,i,n);break;case"host_on":case"host_off":break;default:n.includes("Login unsuccessful")||n.includes("Login authentication failed")||n.includes("Error logging in")||n.includes("Improperly formatted auth")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason=n,this.log.error(this.reason),this.ws.close()):n.includes("Invalid NICK")?(this.wasCloseCalled=!1,this.reconnect=!1,this.reason="Invalid NICK.",this.log.error(this.reason),this.ws.close()):this.log.warn("Could not parse NOTICE from tmi.twitch.tv:\n"+JSON.stringify(e,null,4))}break;case"USERNOTICE":var S=e.tags["display-name"]||e.tags.login,C=e.tags["msg-param-sub-plan"]||"",P=l.unescapeIRC(l.get(e.tags["msg-param-sub-plan-name"],""))||null,E=C.includes("Prime"),I=e.tags,A=~~(e.tags["msg-param-streak-months"]||0),M=e.tags["msg-param-recipient-display-name"]||e.tags["msg-param-recipient-user-name"],O=~~e.tags["msg-param-mass-gift-count"],R={prime:E,plan:C,planName:P};switch(I["message-type"]=i){case"resub":this.emits(["resub","subanniversary"],[[r,S,A,n,I,R]]);break;case"sub":this.emit("subscription",r,S,R,n,I);break;case"subgift":this.emit("subgift",r,S,A,M,R,I);break;case"anonsubgift":this.emit("anonsubgift",r,A,M,R,I);break;case"submysterygift":this.emit("submysterygift",r,S,O,R,I);break;case"anonsubmysterygift":this.emit("anonsubmysterygift",r,O,R,I);break;case"giftpaidupgrade":var D=e.tags["msg-param-sender-name"]||e.tags["msg-param-sender-login"];this.emit("giftpaidupgrade",r,S,D,I);break;case"anongiftpaidupgrade":this.emit("anongiftpaidupgrade",r,S,I);break;case"raid":S=e.tags["msg-param-displayName"]||e.tags["msg-param-login"];var k=e.tags["msg-param-viewerCount"];this.emit("raided",r,S,k)}break;case"HOSTTARGET":var L=n.split(" ");k=~~L[1]||0,"-"===L[0]?(this.log.info("["+r+"] Exited host mode."),this.emits(["unhost","_promiseUnhost"],[[r,k],[null]])):(this.log.info("["+r+"] Now hosting "+L[0]+" for "+k+" viewer(s)."),this.emit("hosting",r,L[0],k));break;case"CLEARCHAT":if(1<e.params.length){var B=l.get(e.tags["ban-duration"],null);l.isNull(B)?(this.log.info("["+r+"] "+n+" has been banned."),this.emit("ban",r,n,null,e.tags)):(this.log.info("["+r+"] "+n+" has been timed out for "+B+" seconds."),this.emit("timeout",r,n,null,~~B,e.tags))}else this.log.info("["+r+"] Chat was cleared by a moderator."),this.emits(["clearchat","_promiseClear"],[[r],[null]]);break;case"CLEARMSG":if(1<e.params.length){S=e.tags.login;var F=n;(I=e.tags)["message-type"]="messagedeleted",this.log.info("["+r+"] "+S+"'s message has been deleted."),this.emit("messagedeleted",r,S,F,I)}break;case"RECONNECT":this.log.info("Received RECONNECT request from Twitch.."),this.log.info("Disconnecting and reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.disconnect(),setTimeout((function(){t.connect()}),this.reconnectTimer);break;case"SERVERCHANGE":break;case"USERSTATE":e.tags.username=this.username,"mod"===e.tags["user-type"]&&(this.moderators[this.lastJoined]||(this.moderators[this.lastJoined]=[]),this.moderators[this.lastJoined].includes(this.username)||this.moderators[this.lastJoined].push(this.username)),l.isJustinfan(this.getUsername())||this.userstate[r]||(this.userstate[r]=e.tags,this.lastJoined=r,this.channels.push(r),this.log.info("Joined "+r),this.emit("join",r,l.username(this.getUsername()),!0)),e.tags["emote-sets"]!==this.emotes&&this._updateEmoteset(e.tags["emote-sets"]),this.userstate[r]=e.tags;break;case"GLOBALUSERSTATE":this.globaluserstate=e.tags,void 0!==e.tags["emote-sets"]&&this._updateEmoteset(e.tags["emote-sets"]);break;case"ROOMSTATE":if(l.channel(this.lastJoined)===l.channel(e.params[0])&&this.emit("_promiseJoin",null),e.tags.channel=l.channel(e.params[0]),this.emit("roomstate",l.channel(e.params[0]),e.tags),!e.tags.hasOwnProperty("subs-only")){if(e.tags.hasOwnProperty("slow"))if("boolean"!=typeof e.tags.slow||e.tags.slow){var N=~~e.tags.slow;this.log.info("["+r+"] This room is now in slow mode."),this.emits(["slow","slowmode","_promiseSlow"],[[r,!0,N],[r,!0,N],[null]])}else this.log.info("["+r+"] This room is no longer in slow mode."),this.emits(["slow","slowmode","_promiseSlowoff"],[[r,!1,0],[r,!1,0],[null]]);e.tags.hasOwnProperty("followers-only")&&("-1"===e.tags["followers-only"]?(this.log.info("["+r+"] This room is no longer in followers-only mode."),this.emits(["followersonly","followersmode","_promiseFollowersoff"],[[r,!1,0],[r,!1,0],[null]])):(N=~~e.tags["followers-only"],this.log.info("["+r+"] This room is now in follower-only mode."),this.emits(["followersonly","followersmode","_promiseFollowers"],[[r,!0,N],[r,!0,N],[null]])))}break;default:this.log.warn("Could not parse message from tmi.twitch.tv:\n"+JSON.stringify(e,null,4))}else if("jtv"===e.prefix)switch(e.command){case"MODE":"+o"===n?(this.moderators[r]||(this.moderators[r]=[]),this.moderators[r].includes(e.params[2])||this.moderators[r].push(e.params[2]),this.emit("mod",r,e.params[2])):"-o"===n&&(this.moderators[r]||(this.moderators[r]=[]),this.moderators[r].filter((function(t){return t!=e.params[2]})),this.emit("unmod",r,e.params[2]));break;default:this.log.warn("Could not parse message from jtv:\n"+JSON.stringify(e,null,4))}else switch(e.command){case"353":this.emit("names",e.params[2],e.params[3].split(" "));break;case"366":break;case"JOIN":var j=e.prefix.split("!")[0];l.isJustinfan(this.getUsername())&&this.username===j&&(this.lastJoined=r,this.channels.push(r),this.log.info("Joined "+r),this.emit("join",r,j,!0)),this.username!==j&&this.emit("join",r,j,!1);break;case"PART":var U,G=!1;j=e.prefix.split("!")[0],this.username===j&&(G=!0,this.userstate[r]&&delete this.userstate[r],-1!==(U=this.channels.indexOf(r))&&this.channels.splice(U,1),-1!==(U=this.opts.channels.indexOf(r))&&this.opts.channels.splice(U,1),this.log.info("Left "+r),this.emit("_promisePart",null)),this.emit("part",r,j,G);break;case"WHISPER":j=e.prefix.split("!")[0],this.log.info("[WHISPER] <"+j+">: "+n),e.tags.hasOwnProperty("username")||(e.tags.username=j),e.tags["message-type"]="whisper";var X=l.channel(e.tags.username);this.emits(["whisper","message"],[[X,e.tags,n,!1]]);break;case"PRIVMSG":if(e.tags.username=e.prefix.split("!")[0],"jtv"===e.tags.username){var V=l.username(n.split(" ")[0]),z=n.includes("auto");if(n.includes("hosting you for")){var H=l.extractNumber(n);this.emit("hosted",r,V,H,z)}else n.includes("hosting you")&&this.emit("hosted",r,V,0,z)}else{var W=l.actionMessage(n);W?(e.tags["message-type"]="action",this.log.info("["+r+"] *<"+e.tags.username+">: "+W[1]),this.emits(["action","message"],[[r,e.tags,W[1],!1]])):e.tags.hasOwnProperty("bits")?this.emit("cheer",r,e.tags,n):(e.tags["message-type"]="chat",this.log.info("["+r+"] <"+e.tags.username+">: "+n),this.emits(["chat","message"],[[r,e.tags,n,!1]]))}break;default:this.log.warn("Could not parse message:\n"+JSON.stringify(e,null,4))}}},d.prototype.connect=function(){var e=this;return new Promise((function(t,r){e.server=l.get(e.opts.connection.server,"irc-ws.chat.twitch.tv"),e.port=l.get(e.opts.connection.port,80),e.secure&&(e.port=443),443===e.port&&(e.secure=!0),e.reconnectTimer=e.reconnectTimer*e.reconnectDecay,e.reconnectTimer>=e.maxReconnectInterval&&(e.reconnectTimer=e.maxReconnectInterval),e._openConnection(),e.once("_promiseConnect",(function(n){n?r(n):t([e.server,~~e.port])}))}))},d.prototype._openConnection=function(){this.ws=new h((this.secure?"wss":"ws")+"://"+this.server+":"+this.port+"/","irc"),this.ws.onmessage=this._onMessage.bind(this),this.ws.onerror=this._onError.bind(this),this.ws.onclose=this._onClose.bind(this),this.ws.onopen=this._onOpen.bind(this)},d.prototype._onOpen=function(){l.isNull(this.ws)||1!==this.ws.readyState||(this.log.info("Connecting to "+this.server+" on port "+this.port+".."),this.emit("connecting",this.server,~~this.port),this.username=l.get(this.opts.identity.username,l.justinfan()),this.password=l.password(l.get(this.opts.identity.password,"SCHMOOPIIE")),this.log.info("Sending authentication to server.."),this.emit("logon"),this.ws.send("CAP REQ :twitch.tv/tags twitch.tv/commands twitch.tv/membership"),this.ws.send("PASS "+this.password),this.ws.send("NICK "+this.username),this.ws.send("USER "+this.username+" 8 * :"+this.username))},d.prototype._onMessage=function(e){var t=this;e.data.split("\r\n").forEach((function(e){l.isNull(e)||t.handleMessage(a.msg(e))}))},d.prototype._onError=function(){var e=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.reason=l.isNull(this.ws)?"Connection closed.":"Unable to connect.",this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.emit("reconnect"),setTimeout((function(){e.reconnecting=!1,e.connect()}),this.reconnectTimer)),this.ws=null},d.prototype._onClose=function(){var e=this;this.moderators={},this.userstate={},this.globaluserstate={},clearInterval(this.pingLoop),clearTimeout(this.pingTimeout),this.wasCloseCalled?(this.wasCloseCalled=!1,this.reason="Connection closed.",this.log.info(this.reason),this.emits(["_promiseConnect","_promiseDisconnect","disconnected"],[[this.reason],[null],[this.reason]])):(this.emits(["_promiseConnect","disconnected"],[[this.reason]]),this.reconnect&&this.reconnections===this.maxReconnectAttempts&&(this.emit("maxreconnect"),this.log.error("Maximum reconnection attempts reached.")),this.reconnect&&!this.reconnecting&&this.reconnections<=this.maxReconnectAttempts-1&&(this.reconnecting=!0,this.reconnections=this.reconnections+1,this.log.error("Could not connect to server. Reconnecting in "+Math.round(this.reconnectTimer/1e3)+" seconds.."),this.emit("reconnect"),setTimeout((function(){e.reconnecting=!1,e.connect()}),this.reconnectTimer))),this.ws=null},d.prototype._getPromiseDelay=function(){return this.currentLatency<=600?600:this.currentLatency+100},d.prototype._sendCommand=function(e,t,r,n){var i=this;return new Promise((function(o,s){if(l.promiseDelay(e).then((function(){s("No response from Twitch.")})),l.isNull(i.ws)||2===i.ws.readyState||3===i.ws.readyState)s("Not connected to server.");else{if(l.isNull(t))i.log.info("Executing command: "+r),i.ws.send(r);else{var a=l.channel(t);i.log.info("["+a+"] Executing command: "+r),i.ws.send("PRIVMSG "+a+" :"+r)}n(o,s)}}))},d.prototype._sendMessage=function(e,t,r,n){var i=this;return new Promise((function(o,s){if(l.isNull(i.ws)||2===i.ws.readyState||3===i.ws.readyState||l.isJustinfan(i.getUsername()))s("Not connected to server.");else{var c=l.channel(t);if(i.userstate[c]||(i.userstate[c]={}),500<=r.length){var u=l.splitLine(r,500);r=u[0],setTimeout((function(){i._sendMessage(e,t,u[1],(function(){}))}),350)}i.ws.send("PRIVMSG "+c+" :"+r);var h={};Object.keys(i.emotesets).forEach((function(e){i.emotesets[e].forEach((function(e){return l.isRegex(e.code)?a.emoteRegex(r,e.code,e.id,h):void a.emoteString(r,e.code,e.id,h)}))}));var d=l.merge(i.userstate[c],a.emotes({emotes:a.transformEmotes(h)||null})),p=l.actionMessage(r);p?(d["message-type"]="action",i.log.info("["+c+"] *<"+i.getUsername()+">: "+p[1]),i.emits(["action","message"],[[c,d,p[1],!0]])):(d["message-type"]="chat",i.log.info("["+c+"] <"+i.getUsername()+">: "+r),i.emits(["chat","message"],[[c,d,r,!0]])),n(o,s)}}))},d.prototype._updateEmoteset=function(e){var t=this;this.emotes=e,this.api({url:"/chat/emoticon_images?emotesets="+e,headers:{Authorization:"OAuth "+l.password(l.get(this.opts.identity.password,"")).replace("oauth:",""),"Client-ID":this.clientId}},(function(r,n,i){return r?void setTimeout((function(){t._updateEmoteset(e)}),6e4):(t.emotesets=i.emoticon_sets||{},t.emit("emotesets",e,t.emotesets))}))},d.prototype.getUsername=function(){return this.username},d.prototype.getOptions=function(){return this.opts},d.prototype.getChannels=function(){return this.channels},d.prototype.isMod=function(e,t){var r=l.channel(e);return this.moderators[r]||(this.moderators[r]=[]),this.moderators[r].includes(l.username(t))},d.prototype.readyState=function(){return l.isNull(this.ws)?"CLOSED":["CONNECTING","OPEN","CLOSING","CLOSED"][this.ws.readyState]},d.prototype.disconnect=function(){var e=this;return new Promise((function(t,r){l.isNull(e.ws)||3===e.ws.readyState?(e.log.error("Cannot disconnect from server. Socket is not opened or connection is already closing."),r("Cannot disconnect from server. Socket is not opened or connection is already closing.")):(e.wasCloseCalled=!0,e.log.info("Disconnecting from server.."),e.ws.close(),e.once("_promiseDisconnect",(function(){t([e.server,~~e.port])})))}))},d.prototype.utils=u,void 0!==r&&r.exports&&(r.exports=d),"undefined"!=typeof window&&(window.tmi={},window.tmi.client=d,window.tmi.Client=d)}).call(this,void 0!==t?t:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./api":2,"./commands":4,"./events":5,"./extra-utils":6,"./logger":7,"./parser":8,"./timer":9,"./utils":10,ws:11}],4:[function(e,t,r){"use strict";function n(e,t){var r=this;return e=h.channel(e),t=h.get(t,30),this._sendCommand(this._getPromiseDelay(),e,"/followers "+t,(function(n,i){r.once("_promiseFollowers",(function(r){r?i(r):n([e,~~t])}))}))}function i(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/followersoff",(function(r,n){t.once("_promiseFollowersoff",(function(t){t?n(t):r([e])}))}))}function o(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),null,"PART "+e,(function(r,n){t.once("_promisePart",(function(t){t?n(t):r([e])}))}))}function s(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/r9kbeta",(function(r,n){t.once("_promiseR9kbeta",(function(t){t?n(t):r([e])}))}))}function a(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/r9kbetaoff",(function(r,n){t.once("_promiseR9kbetaoff",(function(t){t?n(t):r([e])}))}))}function c(e,t){var r=this;return e=h.channel(e),t=h.get(t,300),this._sendCommand(this._getPromiseDelay(),e,"/slow "+t,(function(n,i){r.once("_promiseSlow",(function(r){r?i(r):n([e,~~t])}))}))}function u(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/slowoff",(function(r,n){t.once("_promiseSlowoff",(function(t){t?n(t):r([e])}))}))}var h=e("./utils");t.exports={action:function(e,t){return e=h.channel(e),t="ACTION "+t+"",this._sendMessage(this._getPromiseDelay(),e,t,(function(r,n){r([e,t])}))},ban:function(e,t,r){var n=this;return e=h.channel(e),t=h.username(t),r=h.get(r,""),this._sendCommand(this._getPromiseDelay(),e,"/ban "+t+" "+r,(function(i,o){n.once("_promiseBan",(function(n){n?o(n):i([e,t,r])}))}))},clear:function(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/clear",(function(r,n){t.once("_promiseClear",(function(t){t?n(t):r([e])}))}))},color:function(e,t){var r=this;return t=h.get(t,e),this._sendCommand(this._getPromiseDelay(),"#tmijs","/color "+t,(function(e,n){r.once("_promiseColor",(function(r){r?n(r):e([t])}))}))},commercial:function(e,t){var r=this;return e=h.channel(e),t=h.get(t,30),this._sendCommand(this._getPromiseDelay(),e,"/commercial "+t,(function(n,i){r.once("_promiseCommercial",(function(r){r?i(r):n([e,~~t])}))}))},deletemessage:function(e,t){var r=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/delete "+t,(function(t,n){r.once("_promiseDeletemessage",(function(r){r?n(r):t([e])}))}))},emoteonly:function(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/emoteonly",(function(r,n){t.once("_promiseEmoteonly",(function(t){t?n(t):r([e])}))}))},emoteonlyoff:function(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/emoteonlyoff",(function(r,n){t.once("_promiseEmoteonlyoff",(function(t){t?n(t):r([e])}))}))},followersonly:n,followersmode:n,followersonlyoff:i,followersmodeoff:i,host:function(e,t){var r=this;return e=h.channel(e),t=h.username(t),this._sendCommand(2e3,e,"/host "+t,(function(n,i){r.once("_promiseHost",(function(r,o){r?i(r):n([e,t,~~o])}))}))},join:function(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),null,"JOIN "+e,(function(r,n){t.once("_promiseJoin",(function(t){t?n(t):r([e])}))}))},mod:function(e,t){var r=this;return e=h.channel(e),t=h.username(t),this._sendCommand(this._getPromiseDelay(),e,"/mod "+t,(function(n,i){r.once("_promiseMod",(function(r){r?i(r):n([e,t])}))}))},mods:function(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/mods",(function(r,n){t.once("_promiseMods",(function(i,o){i?n(i):(o.forEach((function(r){t.moderators[e]||(t.moderators[e]=[]),t.moderators[e].includes(r)||t.moderators[e].push(r)})),r(o))}))}))},part:o,leave:o,ping:function(){var e=this;return this._sendCommand(this._getPromiseDelay(),null,"PING",(function(t,r){e.latency=new Date,e.pingTimeout=setTimeout((function(){null!==e.ws&&(e.wasCloseCalled=!1,e.log.error("Ping timeout."),e.ws.close(),clearInterval(e.pingLoop),clearTimeout(e.pingTimeout))}),h.get(e.opts.connection.timeout,9999)),e.once("_promisePing",(function(e){t([parseFloat(e)])}))}))},r9kbeta:s,r9kmode:s,r9kbetaoff:a,r9kmodeoff:a,raw:function(e){return this._sendCommand(this._getPromiseDelay(),null,e,(function(t,r){t([e])}))},say:function(e,t){return e=h.channel(e),t.startsWith(".")&&!t.startsWith("..")||t.startsWith("/")||t.startsWith("\\")?"me "===t.substr(1,3)?this.action(e,t.substr(4)):this._sendCommand(this._getPromiseDelay(),e,t,(function(r,n){r([e,t])})):this._sendMessage(this._getPromiseDelay(),e,t,(function(r,n){r([e,t])}))},slow:c,slowmode:c,slowoff:u,slowmodeoff:u,subscribers:function(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/subscribers",(function(r,n){t.once("_promiseSubscribers",(function(t){t?n(t):r([e])}))}))},subscribersoff:function(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/subscribersoff",(function(r,n){t.once("_promiseSubscribersoff",(function(t){t?n(t):r([e])}))}))},timeout:function(e,t,r,n){var i=this;return e=h.channel(e),t=h.username(t),h.isNull(r)||h.isInteger(r)||(n=r,r=300),r=h.get(r,300),n=h.get(n,""),this._sendCommand(this._getPromiseDelay(),e,"/timeout "+t+" "+r+" "+n,(function(o,s){i.once("_promiseTimeout",(function(i){i?s(i):o([e,t,~~r,n])}))}))},unban:function(e,t){var r=this;return e=h.channel(e),t=h.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unban "+t,(function(n,i){r.once("_promiseUnban",(function(r){r?i(r):n([e,t])}))}))},unhost:function(e){var t=this;return e=h.channel(e),this._sendCommand(2e3,e,"/unhost",(function(r,n){t.once("_promiseUnhost",(function(t){t?n(t):r([e])}))}))},unmod:function(e,t){var r=this;return e=h.channel(e),t=h.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unmod "+t,(function(n,i){r.once("_promiseUnmod",(function(r){r?i(r):n([e,t])}))}))},unvip:function(e,t){var r=this;return e=h.channel(e),t=h.username(t),this._sendCommand(this._getPromiseDelay(),e,"/unvip "+t,(function(n,i){r.once("_promiseUnvip",(function(r){r?i(r):n([e,t])}))}))},vip:function(e,t){var r=this;return e=h.channel(e),t=h.username(t),this._sendCommand(this._getPromiseDelay(),e,"/vip "+t,(function(n,i){r.once("_promiseVip",(function(r){r?i(r):n([e,t])}))}))},vips:function(e){var t=this;return e=h.channel(e),this._sendCommand(this._getPromiseDelay(),e,"/vips",(function(e,r){t.once("_promiseVips",(function(t,n){t?r(t):e(n)}))}))},whisper:function(e,t){var r=this;return(e=h.username(e))===this.getUsername()?Promise.reject("Cannot send a whisper to the same account."):this._sendCommand(this._getPromiseDelay(),"#tmijs","/w "+e+" "+t,(function(n,i){var o=h.channel(e),s=h.merge({"message-type":"whisper","message-id":null,"thread-id":null,username:r.getUsername()},r.globaluserstate);r.emits(["whisper","message"],[[o,s,t,!0],[o,s,t,!0]]),n([e,t])}))}}},{"./utils":10}],5:[function(e,t,r){"use strict";function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"object"===(void 0===e?"undefined":a(e))&&null!==e}function s(e){return void 0===e}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),((t.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emits=function(e,t){for(var r=0;r<e.length;r++){var n=r<t.length?t[r]:t[t.length-1];this.emit.apply(this,[e[r]].concat(n))}},n.prototype.emit=function(e){var t,r,n,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(s(r=this._events[e]))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(o(r))for(a=Array.prototype.slice.call(arguments,1),n=(u=r.slice()).length,c=0;c<n;c++)u[c].apply(this,a);return!0},n.prototype.on=n.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.once=function(e,t){function r(){"_"!==e.charAt(0)||isNaN(e.substr(e.length-1))||(e=e.substring(0,e.length-1)),this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;if(this._events.hasOwnProperty(e)&&"_"===e.charAt(0)){var o=1,s=e;for(var a in this._events)this._events.hasOwnProperty(a)&&a.startsWith(s)&&o++;e+=o}return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,s,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(s=(r=this._events[e]).length,n=-1,r===t||i(r.listener)&&r.listener===t){if(delete this._events[e],this._events.hasOwnProperty(e+"2")&&"_"===e.charAt(0)){var c=e;for(var u in this._events)this._events.hasOwnProperty(u)&&u.startsWith(c)&&(isNaN(parseInt(u.substr(u.length-1)))||(this._events[e+parseInt(u.substr(u.length-1)-1)]=this._events[u],delete this._events[u]));this._events[e]=this._events[e+"1"],delete this._events[e+"1"]}this._events.removeListener&&this.emit("removeListener",e,t)}else if(o(r)){for(a=s;0<a--;)if(r[a]===t||r[a].listener&&r[a].listener===t){n=a;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(r=this._events[e]))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],6:[function(e,t,r){"use strict";var n=e("./utils");t.exports={levenshtein:function(e,t,r){if((r=n.get(r,!1))||(e=e.toLowerCase(),t=t.toLowerCase()),e==t)return 0;var i=e.length,o=t.length;if(0===i)return 1*o;if(0===o)return 1*i;var s=!1;try{s=!"0"[0]}catch(e){s=!0}s&&(e=e.split(""),t=t.split(""));var a,c,u,h,l,d,p=new Array(o+1),f=new Array(o+1);for(c=0;c<=o;c++)p[c]=1*c;for(a=0;a<i;a++){for(f[0]=p[0]+1,c=0;c<o;c++)u=p[c]+(e[a]==t[c]?0:1),(h=p[c+1]+1)<u&&(u=h),(l=f[c]+1)<u&&(u=l),f[c+1]=u;d=p,p=f,f=d}return p[o]},raffle:{init:function(e){this.raffleChannels||(this.raffleChannels={}),this.raffleChannels[n.channel(e)]||(this.raffleChannels[n.channel(e)]=[])},enter:function(e,t){this.init(e),this.raffleChannels[n.channel(e)].push(t.toLowerCase())},leave:function(e,t){this.init(e);var r=this.raffleChannels[n.channel(e)].indexOf(n.username(t));return 0<=r&&(this.raffleChannels[n.channel(e)].splice(r,1),!0)},pick:function(e){this.init(e);var t=this.raffleChannels[n.channel(e)].length;return 1<=t?this.raffleChannels[n.channel(e)][Math.floor(Math.random()*t)]:null},reset:function(e){this.init(e),this.raffleChannels[n.channel(e)]=[]},count:function(e){return this.init(e),this.raffleChannels[n.channel(e)]?this.raffleChannels[n.channel(e)].length:0},isParticipating:function(e,t){return this.init(e),this.raffleChannels[n.channel(e)].includes(n.username(t))}},symbols:function(e){for(var t=0,r=0;r<e.length;r++){var n=e.substring(r,r+1).charCodeAt(0);(n<=30||127<=n||65533===n)&&t++}return Math.ceil(t/e.length*100)/100},uppercase:function(e){var t=e.length,r=e.match(/[A-Z]/g);return n.isNull(r)?0:r.length/t}}},{"./utils":10}],7:[function(e,t,r){"use strict";function n(e){return function(t){s[o]<=s[e]&&console.log("["+i.formatDate(new Date)+"] "+e+": "+t)}}var i=e("./utils"),o="info",s={trace:0,debug:1,info:2,warn:3,error:4,fatal:5};t.exports={setLevel:function(e){o=e},trace:n("trace"),debug:n("debug"),info:n("info"),warn:n("warn"),error:n("error"),fatal:n("fatal")}},{"./utils":10}],8:[function(e,t,r){"use strict";var n=e("./utils");t.exports={badges:function(e){if(n.isString(e.badges)){for(var t={},r=e.badges.split(","),i=0;i<r.length;i++){var o=r[i].split("/");if(!o[1])return;t[o[0]]=o[1]}e["badges-raw"]=e.badges,e.badges=t}return n.isBoolean(e.badges)&&(e["badges-raw"]=null),e},emotes:function(e){if(n.isString(e.emotes)){for(var t=e.emotes.split("/"),r={},i=0;i<t.length;i++){var o=t[i].split(":");if(!o[1])return;r[o[0]]=o[1].split(",")}e["emotes-raw"]=e.emotes,e.emotes=r}return n.isBoolean(e.emotes)&&(e["emotes-raw"]=null),e},emoteRegex:function(e,t,r,i){for(var o,s=/\S+/g,a=new RegExp("(\\b|^|s)"+n.unescapeHtml(t)+"(\\b|$|s)");null!==(o=s.exec(e));)a.test(o[0])&&(i[r]=i[r]||[],i[r].push([o.index,s.lastIndex-1]))},emoteString:function(e,t,r,i){for(var o,s=/\S+/g;null!==(o=s.exec(e));)o[0]===n.unescapeHtml(t)&&(i[r]=i[r]||[],i[r].push([o.index,s.lastIndex-1]))},transformEmotes:function(e){var t="";return Object.keys(e).forEach((function(r){t=t+r+":",e[r].forEach((function(e){t=t+e.join("-")+","})),t=t.slice(0,-1)+"/"})),t.slice(0,-1)},msg:function(e){var t={raw:e,tags:{},prefix:null,command:null,params:[]},r=0,n=0;if(64===e.charCodeAt(0)){if(-1===(n=e.indexOf(" ")))return null;for(var i=e.slice(1,n).split(";"),o=0;o<i.length;o++){var s=i[o],a=s.split("=");t.tags[a[0]]=s.substring(s.indexOf("=")+1)||!0}r=n+1}for(;32===e.charCodeAt(r);)r++;if(58===e.charCodeAt(r)){if(-1===(n=e.indexOf(" ",r)))return null;for(t.prefix=e.slice(r+1,n),r=n+1;32===e.charCodeAt(r);)r++}if(-1===(n=e.indexOf(" ",r)))return e.length>r?(t.command=e.slice(r),t):null;for(t.command=e.slice(r,n),r=n+1;32===e.charCodeAt(r);)r++;for(;r<e.length;){if(n=e.indexOf(" ",r),58===e.charCodeAt(r)){t.params.push(e.slice(r+1));break}if(-1===n){if(-1===n){t.params.push(e.slice(r));break}}else for(t.params.push(e.slice(r,n)),r=n+1;32===e.charCodeAt(r);)r++}return t}}},{"./utils":10}],9:[function(e,t,r){"use strict";function n(e){this.queue=[],this.index=0,this.defaultDelay=e||3e3}n.prototype.add=function(e,t){this.queue.push({fn:e,delay:t})},n.prototype.run=function(e){(e||0===e)&&(this.index=e),this.next()},n.prototype.next=function(){var e=this,t=this.index++,r=this.queue[t],n=this.queue[this.index];r&&(r.fn(),n&&setTimeout((function(){e.next()}),n.delay||this.defaultDelay))},n.prototype.reset=function(){this.index=0},n.prototype.clear=function(){this.index=0,this.queue=[]},r.queue=n},{}],10:[function(e,t,r){(function(e){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=/^\u0001ACTION ([^\u0001]+)\u0001$/,i=/^(justinfan)(\d+$)/,o=/\\([sn:r\\])/g,s={s:" ",n:"",":":";",r:""},a=t.exports={get:function(e,t){return void 0===e?t:e},isBoolean:function(e){return"boolean"==typeof e},isFinite:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isFinite(e)&&!isNaN(parseFloat(e))})),isInteger:function(e){return!isNaN(a.toNumber(e,0))},isJustinfan:function(e){return i.test(e)},isNull:function(e){return null===e},isRegex:function(e){return/[\|\\\^\$\*\+\?\:\#]/.test(e)},isString:function(e){return"string"==typeof e},isURL:function(e){return RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i").test(e)},justinfan:function(){return"justinfan"+Math.floor(8e4*Math.random()+1e3)},password:function(e){return["SCHMOOPIIE","",null].includes(e)?"SCHMOOPIIE":"oauth:"+e.toLowerCase().replace("oauth:","")},promiseDelay:function(e){return new Promise((function(t){setTimeout(t,e)}))},replaceAll:function(e,t){if(null==e)return null;for(var r in t)e=e.replace(new RegExp(r,"g"),t[r]);return e},unescapeHtml:function(e){return e.replace(/\\&amp\\;/g,"&").replace(/\\&lt\\;/g,"<").replace(/\\&gt\\;/g,">").replace(/\\&quot\\;/g,'"').replace(/\\&#039\\;/g,"'")},unescapeIRC:function(e){return e&&e.includes("\\")?e.replace(o,(function(e,t){return t in s?s[t]:t})):e},actionMessage:function(e){return e.match(n)},addWord:function(e,t){return e.length?e+" "+t:e+t},channel:function(e){var t=(e||"").toLowerCase();return"#"===t[0]?t:"#"+t},extractNumber:function(e){for(var t=e.split(" "),r=0;r<t.length;r++)if(a.isInteger(t[r]))return~~t[r];return 0},formatDate:function(e){var t=e.getHours(),r=e.getMinutes();return(t=(t<10?"0":"")+t)+":"+(r<10?"0":"")+r},inherits:function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e},isNode:function(){try{return t.exports="object"===(void 0===e?"undefined":r(e))&&"[object process]"===Object.prototype.toString.call(e)}catch(e){return!1}},isExtension:function(){try{return!!(window.chrome&&chrome.runtime&&chrome.runtime.id)}catch(e){return!1}},merge:Object.assign,splitLine:function(e,t){var r=e.substring(0,t).lastIndexOf(" ");return-1===r&&(r=t-1),[e.substring(0,r),e.substring(r+1)]},toNumber:function(e,t){if(null===e)return 0;var r=Math.pow(10,a.isFinite(t)?t:0);return Math.round(e*r)/r},union:function(e,t){for(var r={},n=[],i=0;i<e.length;i++)r[o=e[i]]||(r[o]=!0,n.push(o));for(i=0;i<t.length;i++){var o;r[o=t[i]]||(r[o]=!0,n.push(o))}return n},username:function(e){var t=(e||"").toLowerCase();return"#"===t[0]?t.slice(1):t}}}).call(this,e("_process"))},{_process:12}],11:[function(e,t,r){},{}],12:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(h===setTimeout)return setTimeout(e,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function s(){m&&p&&(m=!1,p.length?f=p.concat(f):v=-1,f.length&&a())}function a(){if(!m){var e=o(s);m=!0;for(var t=f.length;t;){for(p=f,f=[];++v<t;)p&&p[v].run();v=-1,t=f.length}p=null,m=!1,function(e){if(l===clearTimeout)return clearTimeout(e);if((l===i||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(e);try{l(e)}catch(t){try{return l.call(null,e)}catch(t){return l.call(this,e)}}}(e)}}function c(e,t){this.fun=e,this.array=t}function u(){}var h,l,d=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(e){h=n}try{l="function"==typeof clearTimeout?clearTimeout:i}catch(e){l=i}}();var p,f=[],m=!1,v=-1;d.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];f.push(new c(e,t)),1!==f.length||m||o(a)},c.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(e){return[]},d.binding=function(e){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(e){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},{}]},{},[1])}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);var i={},o={},s={},a={},c={},u=null,h={},l={},d={},p={},f={};function m(e,t){try{if(e){if("object"==typeof e)return Object.keys(e).map(t=>m(t,e[t]));if(Array.isArray(t))throw new Error("Composite Objects Not Supported");var r=null;switch(t.type.toLowerCase()){case"circle":r=Matter.Bodies.circle(t.x,t.y,t.radius);break;case"rectangle":r=Matter.Bodies.rectangle(t.x,t.y,t.width,t.height);break;default:throw new Error("Unsupported Object Type",t.type)}if(r.angle=t.angle||0,r.density=t.density||.001,r.force=t.force||{x:0,y:0},r.friction=t.friction||.1,r.frictionAir=t.frictionAir||.01,r.frictionStatic=t.frictionStatic||.5,r.isStatic=t.isStatic||!1,r.restitution=t.bounce||0,r.torque=t.torque||0,r.label=e,t.isDetector&&(r.isSensor=!0,r.isStatic=!0),t.onEnter&&(d[e]=t.onEnter),t.onExit&&(p[e]=t.onExit),t.animations){for(var o in t.animations){(u=new n.AnimatedSprite(t.animations[o].frames.map(e=>i[e]))).animationSpeed=t.animations[o].framerate||10/60,u.loop=t.animations[o].loop,u.onComplete=t.animations[o].onComplete,u.visible=!1,u.anchor.set(.5),u.x=r.position.x,u.y=r.position.y,u.rotation=r.angle,a[r.id]||(a[r.id]=[]),a[r.id].push(u),t.z&&(u.zIndex=t.z),t.scale&&(u.scale.x=t.scale.x,u.scale.y=t.scale.y),x.addChild(u);var c=!1;t.onPress instanceof Function&&(c=!0,u.on("pointerdown",t.onPress)),t.onRelease instanceof Function&&(c=!0,u.on("pointerup",t.onRelease),u.on("pointerupoutside",t.onRelease)),t.onHover instanceof Function&&(c=!0,u.on("pointerover",t.onHover)),t.onLeave instanceof Function&&(c=!0,u.on("pointerout",t.onLeave)),t.onMove instanceof Function&&(c=!0,u.on("pointermove",t.onMove)),c&&(u.interactive=!0,u.buttonMode=!0),r.animations||(r.animations={}),r.animations[o]=u}r.currentAnimation=Object.keys(r.animations)[0],r.animations[r.currentAnimation].visible=!0,r.animations[r.currentAnimation].gotoAndPlay(0)}else if(t.sprite)(u=new n.Sprite(i[t.sprite])).anchor.set(.5),u.x=r.position.x,u.y=r.position.y,u.rotation=r.angle,a[r.id]=u,t.z&&(u.zIndex=t.z),t.scale&&(u.scale.x=t.scale.x,u.scale.y=t.scale.y),x.addChild(u),c=!1,t.onPress instanceof Function&&(c=!0,u.on("pointerdown",t.onPress)),t.onRelease instanceof Function&&(c=!0,u.on("pointerup",t.onRelease),u.on("pointerupoutside",t.onRelease)),t.onHover instanceof Function&&(c=!0,u.on("pointerover",t.onHover)),t.onLeave instanceof Function&&(c=!0,u.on("pointerout",t.onLeave)),t.onMove instanceof Function&&(c=!0,u.on("pointermove",t.onMove)),c&&(u.interactive=!0,u.buttonMode=!0),r.sprite=u;else if(!t.isDetector){var u;switch((u=new n.Graphics).lineStyle(2,16777215,t.outlineThickness||1),t.color?(("string"==typeof t.color||t.color instanceof String)&&(t.color=n.utils.string2hex(t.color)),u.beginFill(t.color)):u.beginFill(n.utils.string2hex(function(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e}())),t.type.toLowerCase()){case"circle":u.drawCircle(0,0,t.radius);break;case"rectangle":u.drawRect(-t.width/2,-t.height/2,t.width,t.height);break;default:throw new Error("Unsupported Object Type",t.type)}u.endFill(),u.x=r.position.x,u.y=r.position.y,u.rotation=r.angle,a[r.id]=u,t.z&&(u.zIndex=t.z),t.scale&&(u.scale.x=t.scale.x,u.scale.y=t.scale.y),x.addChild(u),c=!1,t.onPress instanceof Function&&(c=!0,u.on("pointerdown",t.onPress)),t.onRelease instanceof Function&&(c=!0,u.on("pointerup",t.onRelease),u.on("pointerupoutside",t.onRelease)),t.onHover instanceof Function&&(c=!0,u.on("pointerover",t.onHover)),t.onLeave instanceof Function&&(c=!0,u.on("pointerout",t.onLeave)),t.onMove instanceof Function&&(c=!0,u.on("pointermove",t.onMove)),c&&(u.interactive=!0,u.buttonMode=!0),r.sprite=u}return s[e]=r,Matter.World.add(T.world,[r]),r}}catch(e){console.log("Failed to add overlay",e)}return null}function v(e){s[e]&&(Array.isArray(a[s[e].id])?a[s[e].id].forEach(e=>{x.removeChild(e)}):x.removeChild(a[s[e].id]),delete a[s[e].id],x.removeChild(s[e]),Matter.Composite.remove(T.world,s[e]),delete s[e],delete d[e],delete p[e])}function g(e,t,r){try{for(var i=n.utils.hex2rgb(e),o=n.utils.hex2rgb(t),s=[0,0,0],a=0;a<3;a++)s[a]=i[a]+(o[a]-i[a])*r;return n.utils.rgb2hex(s)}catch(e){console.log(e)}}var y=void 0,_=void 0,b=void 0,x=void 0,w=void 0,T=void 0;var S=-1;function C(e){try{S<0&&(S=e),T.world.bodies.forEach(e=>{var t=a[e.id];t&&(Array.isArray(t)?t.forEach(t=>{t.x=e.position.x,t.y=e.position.y,t.rotation=e.angle}):(t.x=e.position.x,t.y=e.position.y,t.rotation=e.angle))});var t=e-S;for(var r in Object.keys(h).forEach(e=>{h[e].time>0&&(h[e].time-=t,h[e].time<=0&&h[e].callback())}),c)if(c[r].isDeleted&&c[r].points.length<=0)delete c[r];else for(var n=0;n<c[r].points.length;n++){var i=c[r].points[n];if(i.life-=t,i.life<=0)c[r].points.splice(n,1),b.removeChild(i.image),n--;else{i.vX+=i.gravityX/1e4*t,i.vY+=i.gravityY/1e4*t,i.x+=i.vX*t,i.y+=i.vY*t,i.image.x=i.x,i.image.y=i.y;var o=i.life/i.maxLife,s=1-o;i.fadeOut&&(i.image.alpha=o),i.growOverTime?i.image.scale={x:s,y:s}:i.image.scale={x:o,y:o},i.image.tint=g(i.startColor,i.endColor,s)}}w.update(e,e-S),S=e,window.requestAnimationFrame(C)}catch(e){console.log("Update Error",e)}}window.Unicorn={Create:function(e,t){try{if(w=t,n.utils.skipHello(),y=new n.Application({width:w.width,height:w.height,antialias:!0,transparent:"transparent"===w.background,backgroundColor:"transparent"===w.background?null:w.background,resolution:1}),e instanceof Element||e instanceof HTMLDocument)e.appendChild(y.view);else{if(!("string"==typeof e||e instanceof String))throw new Error("Invalid Element Type");document.getElementById(e).appendChild(y.view)}(_=new n.Container).sortableChildren=!0,y.stage.addChild(_),(x=new n.Container).sortableChildren=!0,y.stage.addChild(x),(b=new n.Container).sortableChildren=!0,y.stage.addChild(b),w.channel&&(w.username&&w.password?ComfyJS.Init(w.username,w.password,[w.channel]):ComfyJS.Init(w.channel),ComfyJS.onCommand=w.onCommand,ComfyJS.onChat=w.onChat),(T=Matter.Engine.create()).world.gravity.x=w.gravity?w.gravity.x:0,T.world.gravity.y=w.gravity?w.gravity.y:1;var r=!1,i=!1,o=!1,s=!1;return w.screenWalls?r=i=o=s=!0:void 0===w.screenWalls&&(w.wallTop||w.wallBottom||w.wallLeft||w.wallRight?(r=w.wallTop,i=w.wallBottom,o=w.wallLeft,s=w.wallRight):r=i=o=s=!0),r&&Matter.World.add(T.world,[Matter.Bodies.rectangle(w.width/2,-50,2*w.width,100,{isStatic:!0})]),i&&Matter.World.add(T.world,[Matter.Bodies.rectangle(w.width/2,w.height+50,2*w.width,100,{isStatic:!0})]),o&&Matter.World.add(T.world,[Matter.Bodies.rectangle(-50,w.height/2,100,2*w.height,{isStatic:!0})]),s&&Matter.World.add(T.world,[Matter.Bodies.rectangle(w.width+50,w.height/2,100,2*w.height,{isStatic:!0})]),Matter.Events.on(T,"collisionStart",(function(e){for(var t=e.pairs,r=0,n=t.length;r!=n;++r){var i=t[r];i.bodyA.isSensor?d[i.bodyA.label]&&d[i.bodyA.label](i.bodyB.label,i.bodyB):(i.bodyB.isSensor||d[i.bodyA.label]&&d[i.bodyA.label](i.bodyB.label,i.bodyB),d[i.bodyB.label]&&d[i.bodyB.label](i.bodyA.label,i.bodyA))}})),Matter.Events.on(T,"collisionEnd",(function(e){for(var t=e.pairs,r=0,n=t.length;r!=n;++r){var i=t[r];i.bodyA.isSensor?p[i.bodyA.label]&&p[i.bodyA.label](i.bodyB.label,i.bodyB):(i.bodyB.isSensor||p[i.bodyA.label]&&p[i.bodyA.label](i.bodyB.label,i.bodyB),p[i.bodyB.label]&&p[i.bodyB.label](i.bodyA.label,i.bodyA))}})),Matter.Engine.run(T),u="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsCAQAAAC0jZKKAAACPElEQVR4AbXXcW/TMBAF8EtCypa1LCDB9/98ILG1dKNNCOZZT8h6N4562eZTzH8/ni6dfWns4kqtvbMOT2tmv+0XasG/F1aTLFxd5lDcCS8o0tyX58K9bVA9WZe40LNNqLkevrJr1HvrC1vgQoM820/UqQZubQBKWDKjDJjP+wg41/J/eAOQsGb2rWDlvKzMTyEMaJvBIHNpBdswOfhoZ4VL2h3Irc+srSiJPYv9B1Mr3IHcCS2ZJTFf2+RZ1NEWD5PF7mmQ/nfs85I9klb4KrNCa2YkZitcXmVZpwL3zFtwpYH6l3cWtqDMPP+Fb+zWPthW6BvUIJmZuOTN7APqKOjB9vZAuAM6ArvFE9CSeI5Y1B7PPfAFMPKMKMWVZmbCzKusoveoKcODjQDzgx3c6GnUFnADOAFGV5V16B7PI2BkBRjgmf4IWBbYu8I6lPuhSa2w4xP8k7CF/l5Q7HuiZW9ST+wpjgKLvP9ed6gAJXztWcG/2CaAJ/tKlJSnm7RTTHHATQAnwAFKWCn/H3y2eH2L2ZfDIf06rXD8m768l//cAvzN/kBe709a8cPFQ4jXFA8hHpvVh1D9scmrqfbYrD/oO0s5caYrDvraqwlwW3811V6mvXUrLtOq6x+NYCt0vIqv/2hgcUPWqoFFRixlB9tEIxZHWKHJLmuGQraifijUMTbIq63QzDLGrh+8wVYO3rI6nzdohc+81H3cDHiijxvNfAJ9Wv855hJL5nnlB2Tw8ojzC7UelrXqk/cPn233eGpGsfAAAAAASUVORK5CYII=",w.init(),window.requestAnimationFrame(C),!0}catch(e){return console.log("Init Error",e),!1}},Load:function e(t,r){if("object"==typeof t)return Object.keys(t).map(r=>e(r,t[r]));var o=r.split(".").pop();switch(o){case"jpg":case"png":case"svg":case"jpeg":case"gif":case"mp4":return i[t]=n.Texture.from(r);case"wav":case"mp3":return i[t]=n.sound.Sound.from(r);default:if(r.startsWith("http://")||r.startsWith("https://"))return i[t]=n.Texture.from(r);throw new Error("Unsupported File Format: "+o)}},LoadCustom:function(e,t,r,o){switch(r){case"texture":return i[e]=n.Texture.from(t,o);case"sound":return i[e]=n.sound.Sound.from(t);default:throw new Error("Unsupported Asset Type: "+r)}},Crop:function(e,t,r,o,s,a){return i[e]=new n.Texture(i[t],new n.Rectangle(r,o,s,a))},AddBacklay:function e(t,r,s,a,c){try{if(t){if("object"==typeof t)return Object.keys(t).map(r=>e(r,t[r].asset,t[r].x,t[r].y,t[r].options));var u=new n.Sprite(i[r]);if(u.x=s,u.y=a,_.addChild(u),o[t]=u,c){c.z&&(u.zIndex=c.z),c.scale&&(u.scale.x=c.scale.x,u.scale.y=c.scale.y);var h=!1;c.onPress instanceof Function&&(h=!0,u.on("pointerdown",c.onPress)),c.onRelease instanceof Function&&(h=!0,u.on("pointerup",c.onRelease),u.on("pointerupoutside",c.onRelease)),c.onHover instanceof Function&&(h=!0,u.on("pointerover",c.onHover)),c.onLeave instanceof Function&&(h=!0,u.on("pointerout",c.onLeave)),c.onMove instanceof Function&&(h=!0,u.on("pointermove",c.onMove)),h&&(u.interactive=!0,u.buttonMode=!0)}return u}}catch(t){console.log("Failed to add overlay",t)}return null},RemoveBacklay:function(e){o[e]&&(_.removeChild(o[e]),delete o[e])},AddOverlay:function e(t,r,s,a,c){try{if(t){if("object"==typeof t)return Object.keys(t).map(r=>e(r,t[r].asset,t[r].x,t[r].y,t[r].options));var u=new n.Sprite(i[r]);if(u.x=s,u.y=a,b.addChild(u),o[t]=u,c){c.z&&(u.zIndex=c.z),c.scale&&(u.scale.x=c.scale.x,u.scale.y=c.scale.y);var h=!1;c.onPress instanceof Function&&(h=!0,u.on("pointerdown",c.onPress)),c.onRelease instanceof Function&&(h=!0,u.on("pointerup",c.onRelease),u.on("pointerupoutside",c.onRelease)),c.onHover instanceof Function&&(h=!0,u.on("pointerover",c.onHover)),c.onLeave instanceof Function&&(h=!0,u.on("pointerout",c.onLeave)),c.onMove instanceof Function&&(h=!0,u.on("pointermove",c.onMove)),h&&(u.interactive=!0,u.buttonMode=!0)}return u}}catch(t){console.log("Failed to add overlay",t)}return null},RemoveOverlay:function(e){o[e]&&(b.removeChild(o[e]),delete o[e])},AddObject:m,RemoveObject:v,ConnectObjects:function(e,t,r,n,i){var o={pointA:n||{x:0,y:0},pointB:i||{x:0,y:0},damping:(r=r||{}).damping||0,length:r.length,stiffness:r.stiffness||1},a=e+"_"+t;s[e]&&(o.bodyA=s[e]),s[t]&&(o.bodyB=s[t]),f[a]=Matter.Constraint.create(o),Matter.Composite.add(T.world,f[a])},DisconnectObjects:function(e,t){f[e+"_"+t]?(Matter.Composite.remove(T.world,f[e+"_"+t]),delete f[e+"_"+t]):f[t+"_"+e]&&(Matter.Composite.remove(T.world,f[t+"_"+e]),delete f[t+"_"+e])},PlayObjectAnimation:function(e,t,r=0){s[e]&&s[e].animations&&s[e].animations[t]&&(s[e].animations[s[e].currentAnimation].visible=!1,s[e].animations[s[e].currentAnimation].stop(),s[e].currentAnimation=t,s[e].animations[s[e].currentAnimation].visible=!0,s[e].animations[s[e].currentAnimation].gotoAndPlay(r))},StopObjectAnimation:function(e){s[e]&&s[e].animations&&s[e].animations[s[e].currentAnimation].stop()},AddText:function e(t,r,i,o,s){try{if(t){if("object"==typeof t)return Object.keys(t).map(r=>e(r,t[r].asset,t[r].x,t[r].y,t[r].options));var a=new n.Text(r,new n.TextStyle(s));return a.x=i,a.y=o,b.addChild(a),l[t]=a,s&&(s.z&&(a.zIndex=s.z),s.scale&&(a.scale.x=s.scale.x,a.scale.y=s.scale.y)),a}}catch(t){console.log("Failed to add text",t)}return null},RemoveText:function(e){l[e]&&(b.removeChild(l[e]),delete l[e])},AddDetector:function e(t,r,n,i){return"object"==typeof t?Object.keys(t).map(r=>e(r,t[r].options,t[r].onEnter,t[r].onExit)):(r=Object.assign(r,{isDetector:!0,onEnter:n,onExit:i}),m(t,r))},RemoveDetector:function(e){v(e)},AddParticles:function(e,t,r,i){try{if(e){let o=setInterval((function(){var o=n.Texture.fromImage(t.image||u);t.flySpeed&&(i-=1e3*t.flySpeed/t.intensity);for(var s=0;s<10;s++){var a=new n.Sprite(o);a.anchor.set(.5),a.x=r,a.y=i,a.blendMode=t.blendMode||n.BLEND_MODES.ADD,("string"==typeof t.startColor||t.startColor instanceof String)&&(t.startColor=n.utils.string2hex(t.startColor)),("string"==typeof t.endColor||t.endColor instanceof String)&&(t.endColor=n.utils.string2hex(t.endColor)),t.angle=t.angle||0,t.spread=t.spread||0,t.lineDirection=t.lineDirection||0,t.length=t.length||y.view.width,t.gravityX=t.gravityX||0,t.gravityY=t.gravityY||0,t.timeInterval=1e3/t.intensity,a.tint=t.startColor;var h=Math.random()*t.decay*1e3,l=Math.random()*(t.maxSpeed-t.minSpeed)+t.minSpeed,d={image:a,x:r,y:i,vX:0,vY:0,growOverTime:t.growOverTime||!1,fadeOut:t.fadeOut||!1,startColor:t.startColor,endColor:t.endColor,velocity:l,gravityX:t.gravityX,gravityY:t.gravityY,maxLife:h,life:h};switch(t.shape){case"circle":d.angle=Math.random()*Math.PI*2;break;case"cone":d.angle=t.angle+Math.random()*t.spread-t.spread/2;break;case"line":d.x+=Math.cos(t.lineDirection)*Math.random()*t.length,d.y+=Math.sin(t.lineDirection)*Math.random()*t.length,d.angle=t.angle+Math.random()*t.spread-t.spread/2;break;default:d.angle=t.angle}d.vX=Math.cos(d.angle)*l,d.vY=Math.sin(d.angle)*l,a.x=d.x,a.y=d.y;var p=d.life/d.maxLife;d.image.scale={x:p,y:p},b.addChild(a),c[e].points.push(d)}}),1e3/t.intensity);return c[e]={name:e,timer:o,options:t,points:[]},c[e]}}catch(e){console.log("Failed to add particles",e)}return null},RemoveParticles:function(e,t,r,n){c[e]&&(clearInterval(c[e].timer),c[e].isDeleted=!0)},AddTimer:function(e,t,r){try{if(e)return h[e]={time:t,callback:r},h[e]}catch(e){console.log("Failed to add timer",e)}return null},ResetTimer:function(e,t){h[e]&&(h[e].time=t)},RemoveTimer:function(e){h[e]&&delete h[e]},SetPosition:function(e,t,r){s[e]&&Matter.Body.setPosition(s[e],{x:t,y:r})},SetVelocity:function(e,t,r){s[e]&&Matter.Body.setVelocity(s[e],{x:t,y:r})},PlaySound:function(e,t){i[e]&&(i[e].volume=t.volume||1,i[e].play())},Raycast:function(e,t){return Matter.Query.ray(Matter.Composite.allBodies(T.world),e,t)},Assets:i,Overlays:o,Objects:s},parcelRequire=function(e,t,r,n){var i,o="function"==typeof parcelRequire&&parcelRequire,s="function"==typeof require&&require;function a(r,n){if(!t[r]){if(!e[r]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(r,!0);if(o)return o(r,!0);if(s&&"string"==typeof r)return s(r);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}h.resolve=function(t){return e[r][1][t]||t},h.cache={};var u=t[r]=new a.Module(r);e[r][0].call(u.exports,h,u,u.exports,this)}return t[r].exports;function h(e){return a(h.resolve(e))}}a.isParcelRequire=!0,a.Module=function(e){this.id=e,this.bundle=a,this.exports={}},a.modules=e,a.cache=t,a.parent=o,a.register=function(t,r){e[t]=[function(e,t){t.exports=r},{}]};for(var c=0;c<r.length;c++)try{a(r[c])}catch(e){i||(i=e)}if(r.length){var u=a(r[r.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=u:"function"==typeof define&&define.amd&&define((function(){return u}))}if(parcelRequire=a,i)throw i;return a}({EgBh:[function(e,t,r){var n={};n.useBlobBuilder=function(){try{return new Blob([]),!1}catch(e){return!0}}(),n.useArrayBufferView=!n.useBlobBuilder&&function(){try{return 0===new Blob([new Uint8Array([])]).size}catch(e){return!0}}(),t.exports.binaryFeatures=n;var i=t.exports.BlobBuilder;function o(){this._pieces=[],this._parts=[]}"undefined"!=typeof window&&(i=t.exports.BlobBuilder=window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder||window.BlobBuilder),o.prototype.append=function(e){"number"==typeof e?this._pieces.push(e):(this.flush(),this._parts.push(e))},o.prototype.flush=function(){if(this._pieces.length>0){var e=new Uint8Array(this._pieces);n.useArrayBufferView||(e=e.buffer),this._parts.push(e),this._pieces=[]}},o.prototype.getBuffer=function(){if(this.flush(),n.useBlobBuilder){for(var e=new i,t=0,r=this._parts.length;t<r;t++)e.append(this._parts[t]);return e.getBlob()}return new Blob(this._parts)},t.exports.BufferBuilder=o},{}],kdPp:[function(e,t,r){var n=e("./bufferbuilder").BufferBuilder,i=e("./bufferbuilder").binaryFeatures,o={unpack:function(e){return new s(e).unpack()},pack:function(e){var t=new a;return t.pack(e),t.getBuffer()}};function s(e){this.index=0,this.dataBuffer=e,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}function a(){this.bufferBuilder=new n}function c(e){var t=e.charCodeAt(0);return t<=2047?"00":t<=65535?"000":t<=2097151?"0000":t<=67108863?"00000":"000000"}t.exports=o,s.prototype.unpack=function(){var e,t=this.unpack_uint8();if(t<128)return t;if((224^t)<32)return(224^t)-32;if((e=160^t)<=15)return this.unpack_raw(e);if((e=176^t)<=15)return this.unpack_string(e);if((e=144^t)<=15)return this.unpack_array(e);if((e=128^t)<=15)return this.unpack_map(e);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:case 213:case 214:case 215:return;case 216:return e=this.unpack_uint16(),this.unpack_string(e);case 217:return e=this.unpack_uint32(),this.unpack_string(e);case 218:return e=this.unpack_uint16(),this.unpack_raw(e);case 219:return e=this.unpack_uint32(),this.unpack_raw(e);case 220:return e=this.unpack_uint16(),this.unpack_array(e);case 221:return e=this.unpack_uint32(),this.unpack_array(e);case 222:return e=this.unpack_uint16(),this.unpack_map(e);case 223:return e=this.unpack_uint32(),this.unpack_map(e)}},s.prototype.unpack_uint8=function(){var e=255&this.dataView[this.index];return this.index++,e},s.prototype.unpack_uint16=function(){var e=this.read(2),t=256*(255&e[0])+(255&e[1]);return this.index+=2,t},s.prototype.unpack_uint32=function(){var e=this.read(4),t=256*(256*(256*e[0]+e[1])+e[2])+e[3];return this.index+=4,t},s.prototype.unpack_uint64=function(){var e=this.read(8),t=256*(256*(256*(256*(256*(256*(256*e[0]+e[1])+e[2])+e[3])+e[4])+e[5])+e[6])+e[7];return this.index+=8,t},s.prototype.unpack_int8=function(){var e=this.unpack_uint8();return e<128?e:e-256},s.prototype.unpack_int16=function(){var e=this.unpack_uint16();return e<32768?e:e-65536},s.prototype.unpack_int32=function(){var e=this.unpack_uint32();return e<Math.pow(2,31)?e:e-Math.pow(2,32)},s.prototype.unpack_int64=function(){var e=this.unpack_uint64();return e<Math.pow(2,63)?e:e-Math.pow(2,64)},s.prototype.unpack_raw=function(e){if(this.length<this.index+e)throw new Error("BinaryPackFailure: index is out of range "+this.index+" "+e+" "+this.length);var t=this.dataBuffer.slice(this.index,this.index+e);return this.index+=e,t},s.prototype.unpack_string=function(e){for(var t,r,n=this.read(e),i=0,o="";i<e;)(t=n[i])<128?(o+=String.fromCharCode(t),i++):(192^t)<32?(r=(192^t)<<6|63&n[i+1],o+=String.fromCharCode(r),i+=2):(r=(15&t)<<12|(63&n[i+1])<<6|63&n[i+2],o+=String.fromCharCode(r),i+=3);return this.index+=e,o},s.prototype.unpack_array=function(e){for(var t=new Array(e),r=0;r<e;r++)t[r]=this.unpack();return t},s.prototype.unpack_map=function(e){for(var t={},r=0;r<e;r++){var n=this.unpack(),i=this.unpack();t[n]=i}return t},s.prototype.unpack_float=function(){var e=this.unpack_uint32(),t=(e>>23&255)-127;return(0==e>>31?1:-1)*(8388607&e|8388608)*Math.pow(2,t-23)},s.prototype.unpack_double=function(){var e=this.unpack_uint32(),t=this.unpack_uint32(),r=(e>>20&2047)-1023;return(0==e>>31?1:-1)*((1048575&e|1048576)*Math.pow(2,r-20)+t*Math.pow(2,r-52))},s.prototype.read=function(e){var t=this.index;if(t+e<=this.length)return this.dataView.subarray(t,t+e);throw new Error("BinaryPackFailure: read index out of range")},a.prototype.getBuffer=function(){return this.bufferBuilder.getBuffer()},a.prototype.pack=function(e){var t=typeof e;if("string"===t)this.pack_string(e);else if("number"===t)Math.floor(e)===e?this.pack_integer(e):this.pack_double(e);else if("boolean"===t)!0===e?this.bufferBuilder.append(195):!1===e&&this.bufferBuilder.append(194);else if("undefined"===t)this.bufferBuilder.append(192);else{if("object"!==t)throw new Error('Type "'+t+'" not yet supported');if(null===e)this.bufferBuilder.append(192);else{var r=e.constructor;if(r==Array)this.pack_array(e);else if(r==Blob||r==File||e instanceof Blob||e instanceof File)this.pack_bin(e);else if(r==ArrayBuffer)i.useArrayBufferView?this.pack_bin(new Uint8Array(e)):this.pack_bin(e);else if("BYTES_PER_ELEMENT"in e)i.useArrayBufferView?this.pack_bin(new Uint8Array(e.buffer)):this.pack_bin(e.buffer);else if(r==Object||r.toString().startsWith("class"))this.pack_object(e);else if(r==Date)this.pack_string(e.toString());else{if("function"!=typeof e.toBinaryPack)throw new Error('Type "'+r.toString()+'" not yet supported');this.bufferBuilder.append(e.toBinaryPack())}}}this.bufferBuilder.flush()},a.prototype.pack_bin=function(e){var t=e.length||e.byteLength||e.size;if(t<=15)this.pack_uint8(160+t);else if(t<=65535)this.bufferBuilder.append(218),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(219),this.pack_uint32(t)}this.bufferBuilder.append(e)},a.prototype.pack_string=function(e){var t=function(e){return e.length>600?new Blob([e]).size:e.replace(/[^\u0000-\u007F]/g,c).length}(e);if(t<=15)this.pack_uint8(176+t);else if(t<=65535)this.bufferBuilder.append(216),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(217),this.pack_uint32(t)}this.bufferBuilder.append(e)},a.prototype.pack_array=function(e){var t=e.length;if(t<=15)this.pack_uint8(144+t);else if(t<=65535)this.bufferBuilder.append(220),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(221),this.pack_uint32(t)}for(var r=0;r<t;r++)this.pack(e[r])},a.prototype.pack_integer=function(e){if(e>=-32&&e<=127)this.bufferBuilder.append(255&e);else if(e>=0&&e<=255)this.bufferBuilder.append(204),this.pack_uint8(e);else if(e>=-128&&e<=127)this.bufferBuilder.append(208),this.pack_int8(e);else if(e>=0&&e<=65535)this.bufferBuilder.append(205),this.pack_uint16(e);else if(e>=-32768&&e<=32767)this.bufferBuilder.append(209),this.pack_int16(e);else if(e>=0&&e<=4294967295)this.bufferBuilder.append(206),this.pack_uint32(e);else if(e>=-2147483648&&e<=2147483647)this.bufferBuilder.append(210),this.pack_int32(e);else if(e>=-0x8000000000000000&&e<=0x8000000000000000)this.bufferBuilder.append(211),this.pack_int64(e);else{if(!(e>=0&&e<=0x10000000000000000))throw new Error("Invalid integer");this.bufferBuilder.append(207),this.pack_uint64(e)}},a.prototype.pack_double=function(e){var t=0;e<0&&(t=1,e=-e);var r=Math.floor(Math.log(e)/Math.LN2),n=e/Math.pow(2,r)-1,i=Math.floor(n*Math.pow(2,52)),o=Math.pow(2,32),s=t<<31|r+1023<<20|i/o&1048575,a=i%o;this.bufferBuilder.append(203),this.pack_int32(s),this.pack_int32(a)},a.prototype.pack_object=function(e){var t=Object.keys(e).length;if(t<=15)this.pack_uint8(128+t);else if(t<=65535)this.bufferBuilder.append(222),this.pack_uint16(t);else{if(!(t<=4294967295))throw new Error("Invalid length");this.bufferBuilder.append(223),this.pack_uint32(t)}for(var r in e)e.hasOwnProperty(r)&&(this.pack(r),this.pack(e[r]))},a.prototype.pack_uint8=function(e){this.bufferBuilder.append(e)},a.prototype.pack_uint16=function(e){this.bufferBuilder.append(e>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_uint32=function(e){var t=4294967295&e;this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t)},a.prototype.pack_uint64=function(e){var t=e/Math.pow(2,32),r=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&r)>>>24),this.bufferBuilder.append((16711680&r)>>>16),this.bufferBuilder.append((65280&r)>>>8),this.bufferBuilder.append(255&r)},a.prototype.pack_int8=function(e){this.bufferBuilder.append(255&e)},a.prototype.pack_int16=function(e){this.bufferBuilder.append((65280&e)>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_int32=function(e){this.bufferBuilder.append(e>>>24&255),this.bufferBuilder.append((16711680&e)>>>16),this.bufferBuilder.append((65280&e)>>>8),this.bufferBuilder.append(255&e)},a.prototype.pack_int64=function(e){var t=Math.floor(e/Math.pow(2,32)),r=e%Math.pow(2,32);this.bufferBuilder.append((4278190080&t)>>>24),this.bufferBuilder.append((16711680&t)>>>16),this.bufferBuilder.append((65280&t)>>>8),this.bufferBuilder.append(255&t),this.bufferBuilder.append((4278190080&r)>>>24),this.bufferBuilder.append((16711680&r)>>>16),this.bufferBuilder.append((65280&r)>>>8),this.bufferBuilder.append(255&r)}},{"./bufferbuilder":"EgBh"}],iSxC:[function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.extractVersion=s,r.wrapPeerConnectionEvent=function(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&n(t)};return this._eventMap=this._eventMap||{},this._eventMap[n]=o,i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[r])return o.apply(this,arguments);var n=this._eventMap[r];return delete this._eventMap[r],o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},r.disableLog=function(e){return"boolean"!=typeof e?new Error("Argument type: "+n(e)+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},r.disableWarnings=function(e){return"boolean"!=typeof e?new Error("Argument type: "+n(e)+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},r.log=function(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},r.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var{navigator:t}=e,r={browser:null,version:null};if(void 0===e||!e.navigator)return r.browser="Not a browser.",r;if(t.mozGetUserMedia)r.browser="firefox",r.version=s(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)r.browser="chrome",r.version=s(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))r.browser="edge",r.version=s(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return r.browser="Not a supported browser.",r;r.browser="safari",r.version=s(t.userAgent,/AppleWebKit\/(\d+)\./,1),r.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return r},r.compactObject=function e(t){return a(t)?Object.keys(t).reduce((function(r,n){var i=a(t[n]),o=i?e(t[n]):t[n],s=i&&!Object.keys(o).length;return void 0===o||s?r:Object.assign(r,function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},n,o))}),{}):t},r.walkStats=c,r.filterStats=function(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&c(e,r,i)}))})),i};var i=!0,o=!0;function s(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function a(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(n){n.endsWith("Id")?c(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((function(t){c(e,e.get(t),r)}))})))}},{}],s6SN:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices){var r=n.detectBrowser(e),i=function(e){if("object"!==o(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"===o(e[r])?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var s={};"number"==typeof n.ideal?(s[i("min",r)]=n.ideal,t.optional.push(s),(s={})[i("max",r)]=n.ideal,t.optional.push(s)):(s[i("",r)]=n.ideal,t.optional.push(s))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach((function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,n){if(r.version>=61)return n(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===o(e.audio)){var a=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"===o(e.video)){var c=e.video.facingMode;c=c&&("object"===o(c)?c:{ideal:c});var u,h=r.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!t.mediaDevices.getSupportedConstraints||!t.mediaDevices.getSupportedConstraints().facingMode||h)&&(delete e.video.facingMode,"environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u))return t.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return u.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&u.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=c.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=i(e.video),s("chrome: "+JSON.stringify(e)),n(e)}));e.video=i(e.video)}return s("chrome: "+JSON.stringify(e)),n(e)},c=function(e){return r.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(t.getUserMedia=function(e,r,n){a(e,(function(e){t.webkitGetUserMedia(e,r,(function(e){n&&n(c(e))}))}))}.bind(t),t.mediaDevices.getUserMedia){var u=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return a(e,(function(e){return u(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(c(e))}))}))}}}};var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}(e("../utils.js"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=n.log},{"../utils.js":"iSxC"}],VHa8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],uI5X:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(e){if("object"!==c(e)||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)n.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}));else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.track.id})):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})),t.stream.getTracks().forEach((function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.id})):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}},r.shimGetSendersWithDtmf=function(e){if("object"===c(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===c(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},r.shimGetStats=function(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,[r,n,i]=arguments;if(arguments.length>0&&"function"==typeof r)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof r))return t.apply(this,[]);var o=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};return arguments.length>=2?t.apply(this,[function(e){n(s(o(e)))},r]):new Promise((function(r,n){t.apply(e,[function(e){r(s(o(e)))},n])})).then(n,i)}}},r.shimSenderReceiverGetStats=function(e){if("object"===c(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return n.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=i.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),n.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return n.filterStats(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,i=arguments[0];return this.getSenders().forEach((function(e){e.track===i&&(t?n=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===i&&(r?n=!0:r=e),e.track===i})),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}},r.shimAddTrackRemoveTrackWithNative=u,r.shimAddTrackRemoveTrack=function(e){if(e.RTCPeerConnection){var t=n.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return u(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}i.apply(this,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((function(e){return e.track===t})))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var o=this._streams[r.id];if(o)o.addTrack(t),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=a({},t,(function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[function(r){var n=h(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return h(e,t)}))}));e.RTCPeerConnection.prototype[t]=n[t]}));var s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=(e=this,r=(t=arguments[0]).sdp,Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})),s.apply(this,arguments)):s.apply(this,arguments);var e,t,r};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:h(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(n){r._streams[n].getTracks().find((function(t){return e.track===t}))&&(t=r._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function h(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}},r.shimPeerConnection=function(e){var t=n.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection){t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=a({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}));var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?t.version<78&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}},r.fixNegotiationNeeded=function(e){n.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){if("stable"===e.target.signalingState)return e}))},Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}}),Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}(e("../utils.js")),i=e("./getusermedia"),o=e("./getdisplaymedia");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===n.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}},{"../utils.js":"iSxC","./getusermedia":"s6SN","./getdisplaymedia":"VHa8"}],NZ1C:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.filterIceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var i="string"==typeof t;return i&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!r?(r=!0,!0):t&&!r})),delete e.url,e.urls=i?t[0]:t,!!t.length}}))};var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}(e("../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}},{"../utils":"iSxC"}],YHvh:[function(e,t,r){"use strict";var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},n.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},n.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:r[t[n]]=t[n+1]}return r},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},n.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},n.getIceParameters=function(e,t){var r=n.splitLines(e);return{usernameFragment:(r=r.concat(n.splitLines(t))).filter((function(e){return 0===e.indexOf("a=ice-ufrag:")}))[0].substr(12),password:r.filter((function(e){return 0===e.indexOf("a=ice-pwd:")}))[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=n.splitLines(e)[0].split(" "),i=3;i<r.length;i++){var o=r[i],s=n.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var a=n.parseRtpMap(s),c=n.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=c.length?n.parseFmtp(c[0]):{},a.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(n.parseExtmap(e))})),t},n.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){r+=n.writeRtpMap(e),r+=n.writeFmtp(e),r+=n.writeRtcpFb(e)}));var i=0;return t.codecs.forEach((function(e){e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),r+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){r+=n.writeExtmap(e)})),r},n.parseRtpEncodingParameters=function(e){var t,r=[],i=n.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=a.length>0&&a[0].ssrc,u=n.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),r.push(n),o&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:s?"red+ulpfec":"red"},r.push(n))}})),0===r.length&&c&&r.push({ssrc:c});var h=n.matchPrefix(e,"b=");return h.length&&(h=0===h[0].indexOf("b=TIAS:")?parseInt(h[0].substr(7),10):0===h[0].indexOf("b=AS:")?1e3*parseInt(h[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=h}))),r},n.parseRtcpParameters=function(e){var t={},r=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var i=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=n.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},n.parseMsid=function(e){var t,r=n.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var i=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},n.parseSctpDescription=function(e){var t,r=n.parseMLine(e),i=n.matchPrefix(e,"a=max-message-size:");i.length>0&&(t=parseInt(i[0].substr(19),10)),isNaN(t)&&(t=65536);var o=n.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};if(n.matchPrefix(e,"a=sctpmap:").length>0){var s=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:t}}},n.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,r){var i=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||n.generateSessionId())+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,r,i){var o=n.writeRtpDescription(e.kind,t);if(o+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(e,t){for(var r=n.splitLines(e),i=0;i<r.length;i++)switch(r[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[i].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}],NJ2u:[function(e,t,r){"use strict";var n=e("sdp");function i(e,t,r,i,o){var s=n.writeRtpDescription(e.kind,t);if(s+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===r?"actpass":o||"active"),s+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),s}function o(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var r=0;r<t.length;r++)if(t[r].payloadType===e||t[r].preferredPayloadType===e)return t[r]},i=function(e,t,r,i){var o=n(e.parameters.apt,r),s=n(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach((function(n){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(n.name.toLowerCase()===s.name.toLowerCase()&&n.clockRate===s.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&s.parameters.apt&&!i(n,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(n.numChannels,s.numChannels),r.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter((function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var n=0;n<t.headerExtensions.length;n++){var i=t.headerExtensions[n];if(e.uri===i.uri){r.headerExtensions.push(i);break}}})),r}function s(e,t,r){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(r)}function a(e,t){var r=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return r||e.addRemoteCandidate(t),!r}function c(e,t){var r=new Error(t);return r.name=e,r.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],r}t.exports=function(e,t){function r(t,r){r.addTrack(t),r.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,r,n,i){var o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=i,e.setTimeout((function(){t._dispatchEvent("track",o)}))}var h=function(r){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){i[e]=o[e].bind(o)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",r=JSON.parse(JSON.stringify(r||{})),this.usingBundle="max-bundle"===r.bundlePolicy,"negotiate"===r.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(r.rtcpMuxPolicy||(r.rtcpMuxPolicy="require"),r.iceTransportPolicy){case"all":case"relay":break;default:r.iceTransportPolicy="all"}switch(r.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:r.bundlePolicy="balanced"}if(r.iceServers=function(e,t){var r=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof n;return i&&(n=[n]),n=n.filter((function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||r?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(r=!0,!0)})),delete e.url,e.urls=i?n[0]:n,!!n.length}}))}(r.iceServers||[],t),this._iceGatherers=[],r.iceCandidatePoolSize)for(var s=r.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:r.iceServers,gatherPolicy:r.iceTransportPolicy}));else r.iceCandidatePoolSize=0;this._config=r,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(h.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(h.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),h.prototype.onicecandidate=null,h.prototype.onaddstream=null,h.prototype.ontrack=null,h.prototype.onremovestream=null,h.prototype.onsignalingstatechange=null,h.prototype.oniceconnectionstatechange=null,h.prototype.onconnectionstatechange=null,h.prototype.onicegatheringstatechange=null,h.prototype.onnegotiationneeded=null,h.prototype.ondatachannel=null,h.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},h.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},h.prototype.getConfiguration=function(){return this._config},h.prototype.getLocalStreams=function(){return this.localStreams},h.prototype.getRemoteStreams=function(){return this.remoteStreams},h.prototype._createTransceiver=function(e,t){var r=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&r)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();n.iceTransport=i.iceTransport,n.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(n),n},h.prototype.addTrack=function(t,r){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(n=this.transceivers[i]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(r)&&this.localStreams.push(r),n.track=t,n.stream=r,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},h.prototype.addStream=function(e){var r=this;if(t>=15025)e.getTracks().forEach((function(t){r.addTrack(t,e)}));else{var n=e.clone();e.getTracks().forEach((function(e,t){var r=n.getTracks()[t];e.addEventListener("enabled",(function(e){r.enabled=e.enabled}))})),n.getTracks().forEach((function(e){r.addTrack(e,n)}))}},h.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var r=this.transceivers.find((function(e){return e.rtpSender===t}));if(!r)throw c("InvalidAccessError","Sender was not created by this connection.");var n=r.stream;r.rtpSender.stop(),r.rtpSender=null,r.track=null,r.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},h.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var r=t.getSenders().find((function(t){return t.track===e}));r&&t.removeTrack(r)}))},h.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},h.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},h.prototype._createIceGatherer=function(t,r){var n=this;if(r&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var r=!e.candidate||0===Object.keys(e.candidate).length;i.state=r?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},h.prototype._gather=function(t,r){var i=this,o=this.transceivers[r].iceGatherer;if(!o.onlocalcandidate){var s=this.transceivers[r].bufferedCandidateEvents;this.transceivers[r].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[r].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&r>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:r};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var u=n.writeCandidate(a);s.candidate=Object.assign(s.candidate,n.parseCandidate(u)),s.candidate.candidate=u,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var h=n.getMediaSections(i._localDescription.sdp);h[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i._localDescription.sdp=n.getDescription(i._localDescription.sdp)+h.join("");var l=i.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",s),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout((function(){s.forEach((function(e){o.onlocalcandidate(e)}))}),0)}},h.prototype._createIceAndDtlsTransports=function(){var t=this,r=new e.RTCIceTransport(null);r.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(r);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:r,dtlsTransport:n}},h.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var r=this.transceivers[e].iceTransport;r&&(delete r.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},h.prototype._transceive=function(e,r,i){var s=o(e.localCapabilities,e.remoteCapabilities);r&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),i&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?s.encodings=e.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},h.prototype.setLocalDescription=function(e){var t,r,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),r=t.shift(),t.forEach((function(e,t){var r=n.parseRtpParameters(e);i.transceivers[t].localCapabilities=r})),i.transceivers.forEach((function(e,t){i._gather(e.mid,t)}));else if("answer"===e.type){t=n.splitSections(i._remoteDescription.sdp),r=t.shift();var a=n.matchPrefix(r,"a=ice-lite").length>0;t.forEach((function(e,t){var s=i.transceivers[t],c=s.iceGatherer,u=s.iceTransport,h=s.dtlsTransport,l=s.localCapabilities,d=s.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length||s.rejected)){var p=n.getIceParameters(e,r),f=n.getDtlsParameters(e,r);a&&(f.role="server"),i.usingBundle&&0!==t||(i._gather(s.mid,t),"new"===u.state&&u.start(c,p,a?"controlling":"controlled"),"new"===h.state&&h.start(f));var m=o(l,d);i._transceive(s,m.codecs.length>0,!1)}}))}return i._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},h.prototype.setRemoteDescription=function(i){var h=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!s("setRemoteDescription",i.type,h.signalingState)||h._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+h.signalingState));var l={};h.remoteStreams.forEach((function(e){l[e.id]=e}));var d=[],p=n.splitSections(i.sdp),f=p.shift(),m=n.matchPrefix(f,"a=ice-lite").length>0,v=n.matchPrefix(f,"a=group:BUNDLE ").length>0;h.usingBundle=v;var g=n.matchPrefix(f,"a=ice-options:")[0];return h.canTrickleIceCandidates=!!g&&g.substr(14).split(" ").indexOf("trickle")>=0,p.forEach((function(s,c){var u=n.splitLines(s),p=n.getKind(s),g=n.isRejected(s)&&0===n.matchPrefix(s,"a=bundle-only").length,y=u[0].substr(2).split(" ")[2],_=n.getDirection(s,f),b=n.parseMsid(s),x=n.getMid(s)||n.generateIdentifier();if(g||"application"===p&&("DTLS/SCTP"===y||"UDP/DTLS/SCTP"===y))h.transceivers[c]={mid:x,kind:p,protocol:y,rejected:!0};else{var w,T,S,C,P,E,I,A,M;!g&&h.transceivers[c]&&h.transceivers[c].rejected&&(h.transceivers[c]=h._createTransceiver(p,!0));var O,R,D=n.parseRtpParameters(s);g||(O=n.getIceParameters(s,f),(R=n.getDtlsParameters(s,f)).role="client"),I=n.parseRtpEncodingParameters(s);var k=n.parseRtcpParameters(s),L=n.matchPrefix(s,"a=end-of-candidates",f).length>0,B=n.matchPrefix(s,"a=candidate:").map((function(e){return n.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===i.type||"answer"===i.type)&&!g&&v&&c>0&&h.transceivers[c]&&(h._disposeIceAndDtlsTransports(c),h.transceivers[c].iceGatherer=h.transceivers[0].iceGatherer,h.transceivers[c].iceTransport=h.transceivers[0].iceTransport,h.transceivers[c].dtlsTransport=h.transceivers[0].dtlsTransport,h.transceivers[c].rtpSender&&h.transceivers[c].rtpSender.setTransport(h.transceivers[0].dtlsTransport),h.transceivers[c].rtpReceiver&&h.transceivers[c].rtpReceiver.setTransport(h.transceivers[0].dtlsTransport)),"offer"!==i.type||g)"answer"!==i.type||g||(T=(w=h.transceivers[c]).iceGatherer,S=w.iceTransport,C=w.dtlsTransport,P=w.rtpReceiver,E=w.sendEncodingParameters,A=w.localCapabilities,h.transceivers[c].recvEncodingParameters=I,h.transceivers[c].remoteCapabilities=D,h.transceivers[c].rtcpParameters=k,B.length&&"new"===S.state&&(!m&&!L||v&&0!==c?B.forEach((function(e){a(w.iceTransport,e)})):S.setRemoteCandidates(B)),v&&0!==c||("new"===S.state&&S.start(T,O,"controlling"),"new"===C.state&&C.start(R)),!o(w.localCapabilities,w.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&w.sendEncodingParameters[0].rtx&&delete w.sendEncodingParameters[0].rtx,h._transceive(w,"sendrecv"===_||"recvonly"===_,"sendrecv"===_||"sendonly"===_),!P||"sendrecv"!==_&&"sendonly"!==_?delete w.rtpReceiver:(M=P.track,b?(l[b.stream]||(l[b.stream]=new e.MediaStream),r(M,l[b.stream]),d.push([M,P,l[b.stream]])):(l.default||(l.default=new e.MediaStream),r(M,l.default),d.push([M,P,l.default]))));else{(w=h.transceivers[c]||h._createTransceiver(p)).mid=x,w.iceGatherer||(w.iceGatherer=h._createIceGatherer(c,v)),B.length&&"new"===w.iceTransport.state&&(!L||v&&0!==c?B.forEach((function(e){a(w.iceTransport,e)})):w.iceTransport.setRemoteCandidates(B)),A=e.RTCRtpReceiver.getCapabilities(p),t<15019&&(A.codecs=A.codecs.filter((function(e){return"rtx"!==e.name}))),E=w.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var F,N=!1;"sendrecv"===_||"sendonly"===_?(N=!w.rtpReceiver,P=w.rtpReceiver||new e.RTCRtpReceiver(w.dtlsTransport,p),N&&(M=P.track,b&&"-"===b.stream||(b?(l[b.stream]||(l[b.stream]=new e.MediaStream,Object.defineProperty(l[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(M,"id",{get:function(){return b.track}}),F=l[b.stream]):(l.default||(l.default=new e.MediaStream),F=l.default)),F&&(r(M,F),w.associatedRemoteMediaStreams.push(F)),d.push([M,P,F]))):w.rtpReceiver&&w.rtpReceiver.track&&(w.associatedRemoteMediaStreams.forEach((function(t){var r,n,i=t.getTracks().find((function(e){return e.id===w.rtpReceiver.track.id}));i&&(r=i,(n=t).removeTrack(r),n.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:r})))})),w.associatedRemoteMediaStreams=[]),w.localCapabilities=A,w.remoteCapabilities=D,w.rtpReceiver=P,w.rtcpParameters=k,w.sendEncodingParameters=E,w.recvEncodingParameters=I,h._transceive(h.transceivers[c],!1,N)}}})),void 0===h._dtlsRole&&(h._dtlsRole="offer"===i.type?"active":"passive"),h._remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?h._updateSignalingState("have-remote-offer"):h._updateSignalingState("stable"),Object.keys(l).forEach((function(t){var r=l[t];if(r.getTracks().length){if(-1===h.remoteStreams.indexOf(r)){h.remoteStreams.push(r);var n=new Event("addstream");n.stream=r,e.setTimeout((function(){h._dispatchEvent("addstream",n)}))}d.forEach((function(e){var t=e[0],n=e[1];r.id===e[2].id&&u(h,t,n,[r])}))}})),d.forEach((function(e){e[2]||u(h,e[0],e[1],[])})),e.setTimeout((function(){h&&h.transceivers&&h.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},h.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},h.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},h.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},h.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var r=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",r)}},h.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var r=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",r)}},h.prototype.createOffer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=r.transceivers.filter((function(e){return"audio"===e.kind})).length,s=r.transceivers.filter((function(e){return"video"===e.kind})).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(o=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(s=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(r.transceivers.forEach((function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)}));o>0||s>0;)o>0&&(r._createTransceiver("audio"),o--),s>0&&(r._createTransceiver("video"),s--);var u=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.transceivers.forEach((function(i,o){var s=i.track,a=i.kind,c=i.mid||n.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=r._createIceGatherer(o,r.usingBundle));var u=e.RTCRtpSender.getCapabilities(a);t<15019&&(u.codecs=u.codecs.filter((function(e){return"rtx"!==e.name}))),u.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),u.headerExtensions.forEach((function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var h=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];s&&t>=15019&&"video"===a&&!h[0].rtx&&(h[0].rtx={ssrc:h[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=u,i.sendEncodingParameters=h})),"max-compat"!==r._config.bundlePolicy&&(u+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",r.transceivers.forEach((function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,r._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===r.iceGatheringState||0!==t&&r.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,u+="a="+n.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))}));var h=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(h)},h.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=n.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n";var a=n.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach((function(e,n){if(!(n+1>a)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?s+="m=application 0 DTLS/SCTP 5000\r\n":s+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;e.stream&&("audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1}));var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=i(e,u,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}}));var u=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(u)},h.prototype.addIceCandidate=function(e){var t,r=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,o){if(!r._remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<r.transceivers.length;u++)if(r.transceivers[u].mid===e.sdpMid){s=u;break}var h=r.transceivers[s];if(!h)return o(c("OperationError","Can not add ICE candidate"));if(h.rejected)return i();var l=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return i();if(l.component&&1!==l.component)return i();if((0===s||s>0&&h.iceTransport!==r.transceivers[0].iceTransport)&&!a(h.iceTransport,l))return o(c("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(t=n.getMediaSections(r._remoteDescription.sdp))[s]+="a="+(l.type?d:"end-of-candidates")+"\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join("")}else for(var p=0;p<r.transceivers.length&&(r.transceivers[p].rejected||(r.transceivers[p].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(r._remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",r._remoteDescription.sdp=n.getDescription(r._remoteDescription.sdp)+t.join(""),!r.usingBundle));p++);i()}))},h.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var r=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?r=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(r=e.rtpReceiver)})),!r)throw c("InvalidAccessError","Invalid selector.");return r.getStats()}var n=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&n.push(e[t].getStats())}))})),Promise.all(n).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))},["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var r=e[t];if(r&&r.prototype&&r.prototype.getStats){var n=r.prototype.getStats;r.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(r){e[r].type=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type}(e[r]),t.set(r,e[r])})),t}))}}}));var l=["createOffer","createAnswer"];return l.forEach((function(e){var t=h.prototype[e];h.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=h.prototype[e];h.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=h.prototype[e];h.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),h}},{sdp:"YHvh"}],YdKx:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=e&&e.navigator,r=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return r(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],P3bV:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e){"getDisplayMedia"in e.navigator&&e.navigator.mediaDevices&&(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||(e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)))}},{}],XRic:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimPeerConnection=function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var r=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){r.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var s=(0,o.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,i.filterIceServers)(e.iceServers,t.version),n.log("ICE servers after filtering:",e.iceServers)),new s(e)},e.RTCPeerConnection.prototype=s.prototype},r.shimReplaceTrack=function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)},Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}}),Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}(e("../utils")),i=e("./filtericeservers"),o=function(e){return e&&e.__esModule?e:{default:e}}(e("rtcpeerconnection-shim")),s=e("./getusermedia"),a=e("./getdisplaymedia");function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}},{"../utils":"iSxC","./filtericeservers":"NZ1C","rtcpeerconnection-shim":"NJ2u","./getusermedia":"YdKx","./getdisplaymedia":"P3bV"}],GzSv:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetUserMedia=function(e){var t=n.detectBrowser(e),r=e&&e.navigator,i=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,i){n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,i)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var s=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},a=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===o(e)&&"object"===o(e.audio)&&(e=JSON.parse(JSON.stringify(e)),s(e.audio,"autoGainControl","mozAutoGainControl"),s(e.audio,"noiseSuppression","mozNoiseSuppression")),a(e)},i&&i.prototype.getSettings){var c=i.prototype.getSettings;i.prototype.getSettings=function(){var e=c.apply(this,arguments);return s(e,"mozAutoGainControl","autoGainControl"),s(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var u=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===o(e)&&(e=JSON.parse(JSON.stringify(e)),s(e,"autoGainControl","mozAutoGainControl"),s(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}};var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}(e("../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{"../utils":"iSxC"}],UuGU:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},{}],Fzdr:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimOnTrack=function(e){"object"===a(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(e){var t=n.detectBrowser(e);if("object"===a(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){if(!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]})),t.version<68){var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var[e,r,n]=arguments;return o.apply(this,[e||null]).then((function(e){if(t.version<53&&!r)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,r){e.set(r,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(r,n)}}},r.shimSenderGetStats=function(e){if("object"===a(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},r.shimReceiverGetStats=function(e){if("object"===a(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),n.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},r.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;n.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},r.shimAddTransceiver=function(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((function(e){if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(r){var{sender:i}=n,o=i.getParameters();"encodings"in o||(o.encodings=e.sendEncodings,this.setParametersPromises.push(i.setParameters(o).catch((function(){}))))}return n})}},r.shimCreateOffer=function(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}},r.shimCreateAnswer=function(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}},Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return i.shimGetUserMedia}}),Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return o.shimGetDisplayMedia}});var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}(e("../utils")),i=e("./getusermedia"),o=e("./getdisplaymedia");function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{"../utils":"iSxC","./getusermedia":"GzSv","./getdisplaymedia":"UuGU"}],t1lL:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimLocalStreamsAPI=function(e){if("object"===o(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(n){return t.call(r,n,e)})),e.getVideoTracks().forEach((function(n){return t.call(r,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){var r=arguments[1];return r&&(this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach((function(e){n.includes(e.track)&&t.removeTrack(e)}))}})}},r.shimRemoteStreamsAPI=function(e){if("object"===o(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}},r.shimCallbacksAPI=function(e){if("object"===o(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var c=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=c,c=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=c,c=function(e,t,r){var n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=c}},r.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(s(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))},r.shimConstraints=s,r.shimRTCIceServerUrls=function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var i=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,i.push(s)):i.push(e.iceServers[o])}e.iceServers=i}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},r.shimTrackEventTransceiver=function(e){"object"===o(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}};var n=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=n?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(r,o,s):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}(e("../utils"));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e){return e&&void 0!==e.video?Object.assign({},e,{video:n.compactObject(e.video)}):e}},{"../utils":"iSxC"}],GOQK:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimRTCIceCandidate=function(e){if(e.RTCIceCandidate&&(!e.RTCIceCandidate||!("foundation"in e.RTCIceCandidate.prototype))){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===s(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),i=n.default.parseCandidate(e.candidate),o=Object.assign(r,i);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,i.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}},r.shimMaxMessageSize=function(e){if(e.RTCPeerConnection){var t=i.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;var t=n.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=n.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){var i,o=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r}(arguments[0]),s=(u=o,h=65536,"firefox"===t.browser&&(h=t.version<57?-1===u?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),h),a=function(e,r){var i=65536;"firefox"===t.browser&&57===t.version&&(i=65535);var o=n.default.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?i=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(i=2147483637),i}(arguments[0],o);i=0===s&&0===a?Number.POSITIVE_INFINITY:0===s||0===a?Math.max(s,a):Math.min(s,a);var c={};Object.defineProperty(c,"maxMessageSize",{get:function(){return i}}),this._sctp=c}var u,h;return r.apply(this,arguments)}}},r.shimSendThrowTypeError=function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},i.wrapPeerConnectionEvent(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}},r.shimConnectionState=function(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}},r.removeAllowExtmapMixed=function(e){if(e.RTCPeerConnection){var t=i.detectBrowser(e);if(!("chrome"===t.browser&&t.version>=71)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(e){return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(e.sdp=e.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n")),r.apply(this,arguments)}}}};var n=function(e){return e&&e.__esModule?e:{default:e}}(e("sdp")),i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=o();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var s=n?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(r,i,s):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}(e("./utils"));function o(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return o=function(){return e},e}function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},{sdp:"YHvh","./utils":"iSxC"}],KtlG:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var{window:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},r=n.log,u=n.detectBrowser(e),h={browserDetails:u,commonShim:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(u.browser){case"chrome":if(!i||!i.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),h;r("adapter.js shimming chrome."),h.browserShim=i,i.shimGetUserMedia(e),i.shimMediaStream(e),i.shimPeerConnection(e),i.shimOnTrack(e),i.shimAddTrackRemoveTrack(e),i.shimGetSendersWithDtmf(e),i.shimGetStats(e),i.shimSenderReceiverGetStats(e),i.fixNegotiationNeeded(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;case"firefox":if(!s||!s.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),h;r("adapter.js shimming firefox."),h.browserShim=s,s.shimGetUserMedia(e),s.shimPeerConnection(e),s.shimOnTrack(e),s.shimRemoveStream(e),s.shimSenderGetStats(e),s.shimReceiverGetStats(e),s.shimRTCDataChannel(e),s.shimAddTransceiver(e),s.shimCreateOffer(e),s.shimCreateAnswer(e),c.shimRTCIceCandidate(e),c.shimConnectionState(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"edge":if(!o||!o.shimPeerConnection||!t.shimEdge)return r("MS edge shim is not included in this adapter release."),h;r("adapter.js shimming edge."),h.browserShim=o,o.shimGetUserMedia(e),o.shimGetDisplayMedia(e),o.shimPeerConnection(e),o.shimReplaceTrack(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e);break;case"safari":if(!a||!t.shimSafari)return r("Safari shim is not included in this adapter release."),h;r("adapter.js shimming safari."),h.browserShim=a,a.shimRTCIceServerUrls(e),a.shimCreateOfferLegacy(e),a.shimCallbacksAPI(e),a.shimLocalStreamsAPI(e),a.shimRemoteStreamsAPI(e),a.shimTrackEventTransceiver(e),a.shimGetUserMedia(e),c.shimRTCIceCandidate(e),c.shimMaxMessageSize(e),c.shimSendThrowTypeError(e),c.removeAllowExtmapMixed(e);break;default:r("Unsupported browser!")}return h};var n=h(e("./utils")),i=h(e("./chrome/chrome_shim")),o=h(e("./edge/edge_shim")),s=h(e("./firefox/firefox_shim")),a=h(e("./safari/safari_shim")),c=h(e("./common_shim"));function u(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return u=function(){return e},e}function h(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=u();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if(Object.prototype.hasOwnProperty.call(e,i)){var o=n?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(r,i,o):r[i]=e[i]}return r.default=e,t&&t.set(e,r),r}},{"./utils":"iSxC","./chrome/chrome_shim":"uI5X","./edge/edge_shim":"XRic","./firefox/firefox_shim":"Fzdr","./safari/safari_shim":"t1lL","./common_shim":"GOQK"}],tI1X:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var n=(0,e("./adapter_factory.js").adapterFactory)({window:window});r.default=n},{"./adapter_factory.js":"KtlG"}],sXtV:[function(e,t,r){"use strict";var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("webrtc-adapter"));r.webRTCAdapter=i.default},{"webrtc-adapter":"tI1X"}],I31f:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./adapter");r.Supports=new(function(){function e(){this.isIOS=["iPad","iPhone","iPod"].includes(navigator.platform),this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}return e.prototype.isWebRTCSupported=function(){return"undefined"!=typeof RTCPeerConnection},e.prototype.isBrowserSupported=function(){var e=this.getBrowser(),t=this.getVersion();return!!this.supportedBrowsers.includes(e)&&("chrome"===e?t>=this.minChromeVersion:"firefox"===e?t>=this.minFirefoxVersion:"safari"===e&&!this.isIOS&&t>=this.minSafariVersion)},e.prototype.getBrowser=function(){return n.webRTCAdapter.browserDetails.browser},e.prototype.getVersion=function(){return n.webRTCAdapter.browserDetails.version||0},e.prototype.isUnifiedPlanSupported=function(){var e,t=this.getBrowser(),r=n.webRTCAdapter.browserDetails.version||0;if("chrome"===t&&r<72)return!1;if("firefox"===t&&r>=59)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var i=!1;try{(e=new RTCPeerConnection).addTransceiver("audio"),i=!0}catch(e){}finally{e&&e.close()}return i},e.prototype.toString=function(){return"Supports: \n    browser:"+this.getBrowser()+" \n    version:"+this.getVersion()+" \n    isIOS:"+this.isIOS+" \n    isWebRTCSupported:"+this.isWebRTCSupported()+" \n    isBrowserSupported:"+this.isBrowserSupported()+" \n    isUnifiedPlanSupported:"+this.isUnifiedPlanSupported()},e}())},{"./adapter":"sXtV"}],BHXf:[function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(r,"__esModule",{value:!0});var i=n(e("peerjs-js-binarypack")),o=e("./supports"),s={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:0.peerjs.com:3478",username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};r.util=new(function(){function e(){this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.chunkedMTU=16300,this.defaultConfig=s,this.browser=o.Supports.getBrowser(),this.browserVersion=o.Supports.getVersion(),this.supports=function(){var e,t={browser:o.Supports.isBrowserSupported(),webRTC:o.Supports.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!t.webRTC)return t;try{e=new RTCPeerConnection(s),t.audioVideo=!0;var r=void 0;try{r=e.createDataChannel("_PEERJSTEST",{ordered:!0}),t.data=!0,t.reliable=!!r.ordered;try{r.binaryType="blob",t.binaryBlob=!o.Supports.isIOS}catch(e){}}catch(e){}finally{r&&r.close()}}catch(e){}finally{e&&e.close()}return t}(),this.pack=i.pack,this.unpack=i.unpack,this._dataCount=1}return e.prototype.noop=function(){},e.prototype.validateId=function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e)},e.prototype.chunk=function(e){for(var t=[],n=e.size,i=Math.ceil(n/r.util.chunkedMTU),o=0,s=0;s<n;){var a=Math.min(n,s+r.util.chunkedMTU),c=e.slice(s,a),u={__peerData:this._dataCount,n:o,data:c,total:i};t.push(u),s=a,o++}return this._dataCount++,t},e.prototype.blobToArrayBuffer=function(e,t){var r=new FileReader;return r.onload=function(e){e.target&&t(e.target.result)},r.readAsArrayBuffer(e),r},e.prototype.binaryStringToArrayBuffer=function(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer},e.prototype.randomToken=function(){return Math.random().toString(36).substr(2)},e.prototype.isSecure=function(){return"https:"===location.protocol},e}())},{"peerjs-js-binarypack":"kdPp","./supports":"I31f"}],JJlS:[function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i="~";function o(){}function s(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function a(e,t,r,n,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new s(r,n||e,o),c=i?i+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function u(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),u.prototype.eventNames=function(){var e,t,r=[];if(0===this._eventsCount)return r;for(t in e=this._events)n.call(e,t)&&r.push(i?t.slice(1):t);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},u.prototype.listeners=function(e){var t=i?i+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,o=r.length,s=new Array(o);n<o;n++)s[n]=r[n].fn;return s},u.prototype.listenerCount=function(e){var t=i?i+e:e,r=this._events[t];return r?r.fn?1:r.length:0},u.prototype.emit=function(e,t,r,n,o,s){var a=i?i+e:e;if(!this._events[a])return!1;var c,u,h=this._events[a],l=arguments.length;if(h.fn){switch(h.once&&this.removeListener(e,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,t),!0;case 3:return h.fn.call(h.context,t,r),!0;case 4:return h.fn.call(h.context,t,r,n),!0;case 5:return h.fn.call(h.context,t,r,n,o),!0;case 6:return h.fn.call(h.context,t,r,n,o,s),!0}for(u=1,c=new Array(l-1);u<l;u++)c[u-1]=arguments[u];h.fn.apply(h.context,c)}else{var d,p=h.length;for(u=0;u<p;u++)switch(h[u].once&&this.removeListener(e,h[u].fn,void 0,!0),l){case 1:h[u].fn.call(h[u].context);break;case 2:h[u].fn.call(h[u].context,t);break;case 3:h[u].fn.call(h[u].context,t,r);break;case 4:h[u].fn.call(h[u].context,t,r,n);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];h[u].fn.apply(h[u].context,c)}}return!0},u.prototype.on=function(e,t,r){return a(this,e,t,r,!1)},u.prototype.once=function(e,t,r){return a(this,e,t,r,!0)},u.prototype.removeListener=function(e,t,r,n){var o=i?i+e:e;if(!this._events[o])return this;if(!t)return c(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||n&&!s.once||r&&s.context!==r||c(this,o);else{for(var a=0,u=[],h=s.length;a<h;a++)(s[a].fn!==t||n&&!s[a].once||r&&s[a].context!==r)&&u.push(s[a]);u.length?this._events[o]=1===u.length?u[0]:u:c(this,o)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&c(this,t)):(this._events=new o,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=i,u.EventEmitter=u,void 0!==t&&(t.exports=u)},{}],WOs9:[function(e,t,r){"use strict";var n=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},i=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(n(arguments[t]));return e};Object.defineProperty(r,"__esModule",{value:!0});var o,s="PeerJS: ";!function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"}(o=r.LogLevel||(r.LogLevel={}));var a=function(){function e(){this._logLevel=o.Disabled}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){this._logLevel=e},enumerable:!0,configurable:!0}),e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=o.All&&this._print.apply(this,i([o.All],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=o.Warnings&&this._print.apply(this,i([o.Warnings],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._logLevel>=o.Errors&&this._print.apply(this,i([o.Errors],e))},e.prototype.setLogFunction=function(e){this._print=e},e.prototype._print=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=i([s],t);for(var a in n)n[a]instanceof Error&&(n[a]="("+n[a].name+") "+n[a].message);e>=o.All?console.log.apply(console,i(n)):e>=o.Warnings?console.warn.apply(console,i(["WARNING"],n)):e>=o.Errors&&console.error.apply(console,i(["ERROR"],n))},e}();r.default=new a},{}],ZRYf:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),function(e){e.Open="open",e.Stream="stream",e.Data="data",e.Close="close",e.Error="error",e.IceStateChanged="iceStateChanged"}(r.ConnectionEventType||(r.ConnectionEventType={})),function(e){e.Data="data",e.Media="media"}(r.ConnectionType||(r.ConnectionType={})),function(e){e.Open="open",e.Close="close",e.Connection="connection",e.Call="call",e.Disconnected="disconnected",e.Error="error"}(r.PeerEventType||(r.PeerEventType={})),function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"}(r.PeerErrorType||(r.PeerErrorType={})),function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json"}(r.SerializationType||(r.SerializationType={})),function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"}(r.SocketEventType||(r.SocketEventType={})),function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"}(r.ServerMessageType||(r.ServerMessageType={}))},{}],wJlv:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},o=this&&this.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(i(arguments[t]));return e},s=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var c=e("eventemitter3"),u=a(e("./logger")),h=e("./enums"),l=function(e){function t(t,r,n,i,o,s){void 0===s&&(s=5e3);var a=e.call(this)||this;a.pingInterval=s,a._disconnected=!0,a._messagesQueue=[];var c=t?"wss://":"ws://";return a._baseUrl=c+r+":"+n+i+"peerjs?key="+o,a}return n(t,e),t.prototype.start=function(e,t){var r=this;this._id=e;var n=this._baseUrl+"&id="+e+"&token="+t;!this._socket&&this._disconnected&&(this._socket=new WebSocket(n),this._disconnected=!1,this._socket.onmessage=function(e){var t;try{t=JSON.parse(e.data),u.default.log("Server message received:",t)}catch(t){return void u.default.log("Invalid server message",e.data)}r.emit(h.SocketEventType.Message,t)},this._socket.onclose=function(e){r._disconnected||(u.default.log("Socket closed.",e),r._cleanup(),r._disconnected=!0,r.emit(h.SocketEventType.Disconnected))},this._socket.onopen=function(){r._disconnected||(r._sendQueuedMessages(),u.default.log("Socket open"),r._scheduleHeartbeat())})},t.prototype._scheduleHeartbeat=function(){var e=this;this._wsPingTimer=setTimeout((function(){e._sendHeartbeat()}),this.pingInterval)},t.prototype._sendHeartbeat=function(){if(this._wsOpen()){var e=JSON.stringify({type:h.ServerMessageType.Heartbeat});this._socket.send(e),this._scheduleHeartbeat()}else u.default.log("Cannot send heartbeat, because socket closed")},t.prototype._wsOpen=function(){return!!this._socket&&1===this._socket.readyState},t.prototype._sendQueuedMessages=function(){var e,t,r=o(this._messagesQueue);this._messagesQueue=[];try{for(var n=s(r),i=n.next();!i.done;i=n.next()){var a=i.value;this.send(a)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},t.prototype.send=function(e){if(!this._disconnected)if(this._id)if(e.type){if(this._wsOpen()){var t=JSON.stringify(e);this._socket.send(t)}}else this.emit(h.SocketEventType.Error,"Invalid message");else this._messagesQueue.push(e)},t.prototype.close=function(){this._disconnected||(this._cleanup(),this._disconnected=!0)},t.prototype._cleanup=function(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)},t}(c.EventEmitter);r.Socket=l},{eventemitter3:"JJlS","./logger":"WOs9","./enums":"ZRYf"}],HCdX:[function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=e("./util"),c=s(e("./logger")),u=e("./enums"),h=function(){function e(e){this.connection=e}return e.prototype.startConnection=function(e){var t=this._startPeerConnection();if(this.connection.peerConnection=t,this.connection.type===u.ConnectionType.Media&&e._stream&&this._addTracksToConnection(e._stream,t),e.originator){if(this.connection.type===u.ConnectionType.Data){var r=this.connection,n={ordered:!!e.reliable},i=t.createDataChannel(r.label,n);r.initialize(i)}this._makeOffer()}else this.handleSDP("OFFER",e.sdp)},e.prototype._startPeerConnection=function(){c.default.log("Creating RTCPeerConnection.");var e=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(e),e},e.prototype._setupListeners=function(e){var t=this,r=this.connection.peer,n=this.connection.connectionId,i=this.connection.type,o=this.connection.provider;c.default.log("Listening for ICE candidates."),e.onicecandidate=function(e){e.candidate&&e.candidate.candidate&&(c.default.log("Received ICE candidates for "+r+":",e.candidate),o.socket.send({type:u.ServerMessageType.Candidate,payload:{candidate:e.candidate,type:i,connectionId:n},dst:r}))},e.oniceconnectionstatechange=function(){switch(e.iceConnectionState){case"failed":c.default.log("iceConnectionState is failed, closing connections to "+r),t.connection.emit(u.ConnectionEventType.Error,new Error("Negotiation of connection to "+r+" failed.")),t.connection.close();break;case"closed":c.default.log("iceConnectionState is closed, closing connections to "+r),t.connection.emit(u.ConnectionEventType.Error,new Error("Connection to "+r+" closed.")),t.connection.close();break;case"disconnected":c.default.log("iceConnectionState is disconnected, closing connections to "+r),t.connection.emit(u.ConnectionEventType.Error,new Error("Connection to "+r+" disconnected.")),t.connection.close();break;case"completed":e.onicecandidate=a.util.noop}t.connection.emit(u.ConnectionEventType.IceStateChanged,e.iceConnectionState)},c.default.log("Listening for data channel"),e.ondatachannel=function(e){c.default.log("Received data channel");var t=e.channel;o.getConnection(r,n).initialize(t)},c.default.log("Listening for remote stream"),e.ontrack=function(e){c.default.log("Received remote stream");var i=e.streams[0],s=o.getConnection(r,n);if(s.type===u.ConnectionType.Media){var a=s;t._addStreamToMediaConnection(i,a)}}},e.prototype.cleanup=function(){c.default.log("Cleaning up PeerConnection to "+this.connection.peer);var e=this.connection.peerConnection;if(e){this.connection.peerConnection=null,e.onicecandidate=e.oniceconnectionstatechange=e.ondatachannel=e.ontrack=function(){};var t="closed"!==e.signalingState,r=!1;if(this.connection.type===u.ConnectionType.Data){var n=this.connection.dataChannel;n&&(r=!!n.readyState&&"closed"!==n.readyState)}(t||r)&&e.close()}},e.prototype._makeOffer=function(){return i(this,void 0,Promise,(function(){var e,t,r,i,s,h,l;return o(this,(function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createOffer(this.connection.options.constraints)];case 2:r=o.sent(),c.default.log("Created offer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(r)];case 4:return o.sent(),c.default.log("Set localDescription:",r,"for:"+this.connection.peer),i={sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata,browser:a.util.browser},this.connection.type===u.ConnectionType.Data&&(s=this.connection,i=n(n({},i),{label:s.label,reliable:s.reliable,serialization:s.serialization})),t.socket.send({type:u.ServerMessageType.Offer,payload:i,dst:this.connection.peer}),[3,6];case 5:return"OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"!=(h=o.sent())&&(t.emitError(u.PeerErrorType.WebRTC,h),c.default.log("Failed to setLocalDescription, ",h)),[3,6];case 6:return[3,8];case 7:return l=o.sent(),t.emitError(u.PeerErrorType.WebRTC,l),c.default.log("Failed to createOffer, ",l),[3,8];case 8:return[2]}}))}))},e.prototype._makeAnswer=function(){return i(this,void 0,Promise,(function(){var e,t,r,n,i;return o(this,(function(o){switch(o.label){case 0:e=this.connection.peerConnection,t=this.connection.provider,o.label=1;case 1:return o.trys.push([1,7,,8]),[4,e.createAnswer()];case 2:r=o.sent(),c.default.log("Created answer."),this.connection.options.sdpTransform&&"function"==typeof this.connection.options.sdpTransform&&(r.sdp=this.connection.options.sdpTransform(r.sdp)||r.sdp),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,e.setLocalDescription(r)];case 4:return o.sent(),c.default.log("Set localDescription:",r,"for:"+this.connection.peer),t.socket.send({type:u.ServerMessageType.Answer,payload:{sdp:r,type:this.connection.type,connectionId:this.connection.connectionId,browser:a.util.browser},dst:this.connection.peer}),[3,6];case 5:return n=o.sent(),t.emitError(u.PeerErrorType.WebRTC,n),c.default.log("Failed to setLocalDescription, ",n),[3,6];case 6:return[3,8];case 7:return i=o.sent(),t.emitError(u.PeerErrorType.WebRTC,i),c.default.log("Failed to create answer, ",i),[3,8];case 8:return[2]}}))}))},e.prototype.handleSDP=function(e,t){return i(this,void 0,Promise,(function(){var r,n,i,s;return o(this,(function(o){switch(o.label){case 0:t=new RTCSessionDescription(t),r=this.connection.peerConnection,n=this.connection.provider,c.default.log("Setting remote description",t),i=this,o.label=1;case 1:return o.trys.push([1,5,,6]),[4,r.setRemoteDescription(t)];case 2:return o.sent(),c.default.log("Set remoteDescription:"+e+" for:"+this.connection.peer),"OFFER"!==e?[3,4]:[4,i._makeAnswer()];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return s=o.sent(),n.emitError(u.PeerErrorType.WebRTC,s),c.default.log("Failed to setRemoteDescription, ",s),[3,6];case 6:return[2]}}))}))},e.prototype.handleCandidate=function(e){return i(this,void 0,Promise,(function(){var t,r,n,i,s,a;return o(this,(function(o){switch(o.label){case 0:c.default.log("handleCandidate:",e),t=e.candidate,r=e.sdpMLineIndex,n=e.sdpMid,i=this.connection.peerConnection,s=this.connection.provider,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,i.addIceCandidate(new RTCIceCandidate({sdpMid:n,sdpMLineIndex:r,candidate:t}))];case 2:return o.sent(),c.default.log("Added ICE candidate for:"+this.connection.peer),[3,4];case 3:return a=o.sent(),s.emitError(u.PeerErrorType.WebRTC,a),c.default.log("Failed to handleCandidate, ",a),[3,4];case 4:return[2]}}))}))},e.prototype._addTracksToConnection=function(e,t){if(c.default.log("add tracks from stream "+e.id+" to peer connection"),!t.addTrack)return c.default.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");e.getTracks().forEach((function(r){t.addTrack(r,e)}))},e.prototype._addStreamToMediaConnection=function(e,t){c.default.log("add stream "+e.id+" to media connection "+t.connectionId),t.addStream(e)},e}();r.Negotiator=h},{"./util":"BHXf","./logger":"WOs9","./enums":"ZRYf"}],tQFK:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(r,"__esModule",{value:!0});var i=function(e){function t(t,r,n){var i=e.call(this)||this;return i.peer=t,i.provider=r,i.options=n,i._open=!1,i.metadata=n.metadata,i}return n(t,e),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),t}(e("eventemitter3").EventEmitter);r.BaseConnection=i},{eventemitter3:"JJlS"}],dbHP:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var a=e("./util"),c=s(e("./logger")),u=e("./negotiator"),h=e("./enums"),l=function(e){function t(r,n,i){var o=e.call(this,r,n,i)||this;return o._localStream=o.options._stream,o.connectionId=o.options.connectionId||t.ID_PREFIX+a.util.randomToken(),o._negotiator=new u.Negotiator(o),o._localStream&&o._negotiator.startConnection({_stream:o._localStream,originator:!0}),o}return n(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return h.ConnectionType.Media},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"localStream",{get:function(){return this._localStream},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"remoteStream",{get:function(){return this._remoteStream},enumerable:!0,configurable:!0}),t.prototype.addStream=function(t){c.default.log("Receiving stream",t),this._remoteStream=t,e.prototype.emit.call(this,h.ConnectionEventType.Stream,t)},t.prototype.handleMessage=function(e){var t=e.type,r=e.payload;switch(e.type){case h.ServerMessageType.Answer:this._negotiator.handleSDP(t,r.sdp),this._open=!0;break;case h.ServerMessageType.Candidate:this._negotiator.handleCandidate(r.candidate);break;default:c.default.warn("Unrecognized message type:"+t+" from peer:"+this.peer)}},t.prototype.answer=function(e,t){var r,n;if(void 0===t&&(t={}),this._localStream)c.default.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this._localStream=e,t&&t.sdpTransform&&(this.options.sdpTransform=t.sdpTransform),this._negotiator.startConnection(i(i({},this.options._payload),{_stream:e}));var s=this.provider._getMessages(this.connectionId);try{for(var a=o(s),u=a.next();!u.done;u=a.next()){var h=u.value;this.handleMessage(h)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}this._open=!0}},t.prototype.close=function(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,e.prototype.emit.call(this,h.ConnectionEventType.Close))},t.ID_PREFIX="mc_",t}(e("./baseconnection").BaseConnection);r.MediaConnection=l},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK"}],GGp6:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var o=e("eventemitter3"),s=i(e("./logger")),a=function(e){function t(){var t=e.call(this)||this;return t.fileReader=new FileReader,t._queue=[],t._processing=!1,t.fileReader.onload=function(e){t._processing=!1,e.target&&t.emit("done",e.target.result),t.doNextTask()},t.fileReader.onerror=function(e){s.default.error("EncodingQueue error:",e),t._processing=!1,t.destroy(),t.emit("error",e)},t}return n(t,e),Object.defineProperty(t.prototype,"queue",{get:function(){return this._queue},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this.queue.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"processing",{get:function(){return this._processing},enumerable:!0,configurable:!0}),t.prototype.enque=function(e){this.queue.push(e),this.processing||this.doNextTask()},t.prototype.destroy=function(){this.fileReader.abort(),this._queue=[]},t.prototype.doNextTask=function(){0!==this.size&&(this.processing||(this._processing=!0,this.fileReader.readAsArrayBuffer(this.queue.shift())))},t}(o.EventEmitter);r.EncodingQueue=a},{eventemitter3:"JJlS","./logger":"WOs9"}],GBTQ:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=e("./util"),a=o(e("./logger")),c=e("./negotiator"),u=e("./enums"),h=e("./baseconnection"),l=e("./encodingQueue"),d=function(e){function t(r,n,i){var o=e.call(this,r,n,i)||this;return o.stringify=JSON.stringify,o.parse=JSON.parse,o._buffer=[],o._bufferSize=0,o._buffering=!1,o._chunkedData={},o._encodingQueue=new l.EncodingQueue,o.connectionId=o.options.connectionId||t.ID_PREFIX+s.util.randomToken(),o.label=o.options.label||o.connectionId,o.serialization=o.options.serialization||u.SerializationType.Binary,o.reliable=!!o.options.reliable,o._encodingQueue.on("done",(function(e){o._bufferedSend(e)})),o._encodingQueue.on("error",(function(){a.default.error("DC#"+o.connectionId+": Error occured in encoding from blob to arraybuffer, close DC"),o.close()})),o._negotiator=new c.Negotiator(o),o._negotiator.startConnection(o.options._payload||{originator:!0}),o}return n(t,e),Object.defineProperty(t.prototype,"type",{get:function(){return u.ConnectionType.Data},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataChannel",{get:function(){return this._dc},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferSize",{get:function(){return this._bufferSize},enumerable:!0,configurable:!0}),t.prototype.initialize=function(e){this._dc=e,this._configureDataChannel()},t.prototype._configureDataChannel=function(){var e=this;s.util.supports.binaryBlob&&!s.util.supports.reliable||(this.dataChannel.binaryType="arraybuffer"),this.dataChannel.onopen=function(){a.default.log("DC#"+e.connectionId+" dc connection success"),e._open=!0,e.emit(u.ConnectionEventType.Open)},this.dataChannel.onmessage=function(t){a.default.log("DC#"+e.connectionId+" dc onmessage:",t.data),e._handleDataMessage(t)},this.dataChannel.onclose=function(){a.default.log("DC#"+e.connectionId+" dc closed for:",e.peer),e.close()}},t.prototype._handleDataMessage=function(t){var r=this,n=t.data,i=n.constructor,o=n;if(this.serialization===u.SerializationType.Binary||this.serialization===u.SerializationType.BinaryUTF8){if(i===Blob)return void s.util.blobToArrayBuffer(n,(function(e){var t=s.util.unpack(e);r.emit(u.ConnectionEventType.Data,t)}));if(i===ArrayBuffer)o=s.util.unpack(n);else if(i===String){var a=s.util.binaryStringToArrayBuffer(n);o=s.util.unpack(a)}}else this.serialization===u.SerializationType.JSON&&(o=this.parse(n));o.__peerData?this._handleChunk(o):e.prototype.emit.call(this,u.ConnectionEventType.Data,o)},t.prototype._handleChunk=function(e){var t=e.__peerData,r=this._chunkedData[t]||{data:[],count:0,total:e.total};if(r.data[e.n]=e.data,r.count++,this._chunkedData[t]=r,r.total===r.count){delete this._chunkedData[t];var n=new Blob(r.data);this._handleDataMessage({data:n})}},t.prototype.close=function(){this._buffer=[],this._bufferSize=0,this._chunkedData={},this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this._dc=null),this._encodingQueue&&(this._encodingQueue.destroy(),this._encodingQueue.removeAllListeners(),this._encodingQueue=null),this.open&&(this._open=!1,e.prototype.emit.call(this,u.ConnectionEventType.Close))},t.prototype.send=function(t,r){if(this.open)if(this.serialization===u.SerializationType.JSON)this._bufferedSend(this.stringify(t));else if(this.serialization===u.SerializationType.Binary||this.serialization===u.SerializationType.BinaryUTF8){var n=s.util.pack(t);if(!r&&n.size>s.util.chunkedMTU)return void this._sendChunks(n);s.util.supports.binaryBlob?this._bufferedSend(n):this._encodingQueue.enque(n)}else this._bufferedSend(t);else e.prototype.emit.call(this,u.ConnectionEventType.Error,new Error("Connection is not open. You should listen for the `open` event before sending messages."))},t.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this._bufferSize=this._buffer.length)},t.prototype._trySend=function(e){var r=this;if(!this.open)return!1;if(this.dataChannel.bufferedAmount>t.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout((function(){r._buffering=!1,r._tryBuffer()}),50),!1;try{this.dataChannel.send(e)}catch(e){return a.default.error("DC#:"+this.connectionId+" Error when sending:",e),this._buffering=!0,this.close(),!1}return!0},t.prototype._tryBuffer=function(){if(this.open&&0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}},t.prototype._sendChunks=function(e){var t,r,n=s.util.chunk(e);a.default.log("DC#"+this.connectionId+" Try to send "+n.length+" chunks...");try{for(var o=i(n),c=o.next();!c.done;c=o.next()){var u=c.value;this.send(u,!0)}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}},t.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case u.ServerMessageType.Answer:this._negotiator.handleSDP(e.type,t.sdp);break;case u.ServerMessageType.Candidate:this._negotiator.handleCandidate(t.candidate);break;default:a.default.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},t.ID_PREFIX="dc_",t.MAX_BUFFERED_AMOUNT=8388608,t}(h.BaseConnection);r.DataConnection=d},{"./util":"BHXf","./logger":"WOs9","./negotiator":"HCdX","./enums":"ZRYf","./baseconnection":"tQFK","./encodingQueue":"GGp6"}],in7L:[function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(i,o){function s(e){try{c(n.next(e))}catch(e){o(e)}}function a(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(s,a)}c((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var s=e("./util"),a=o(e("./logger")),c=function(){function e(e){this._options=e}return e.prototype._buildUrl=function(e){return(this._options.secure?"https://":"http://")+this._options.host+":"+this._options.port+this._options.path+this._options.key+"/"+e+"?ts="+(new Date).getTime()+Math.random()},e.prototype.retrieveId=function(){return n(this,void 0,Promise,(function(){var e,t,r,n;return i(this,(function(i){switch(i.label){case 0:e=this._buildUrl("id"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(e)];case 2:if(200!==(t=i.sent()).status)throw new Error("Error. Status:"+t.status);return[2,t.text()];case 3:throw r=i.sent(),a.default.error("Error retrieving ID",r),n="","/"===this._options.path&&this._options.host!==s.util.CLOUD_HOST&&(n=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+n);case 4:return[2]}}))}))},e.prototype.listAllPeers=function(){return n(this,void 0,Promise,(function(){var e,t,r,n;return i(this,(function(i){switch(i.label){case 0:e=this._buildUrl("peers"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(e)];case 2:if(200!==(t=i.sent()).status){if(401===t.status)throw"",r=this._options.host===s.util.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+r);throw new Error("Error. Status:"+t.status)}return[2,t.json()];case 3:throw n=i.sent(),a.default.error("Error retrieving list peers",n),new Error("Could not get list peers from the server."+n);case 4:return[2]}}))}))},e}();r.API=c},{"./util":"BHXf","./logger":"WOs9"}],Hxpd:[function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},s=this&&this.__read||function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});var c=e("eventemitter3"),u=e("./util"),h=a(e("./logger")),l=e("./socket"),d=e("./mediaconnection"),p=e("./dataconnection"),f=e("./enums"),m=e("./api"),v=function(e){function t(r,n){var o,s=e.call(this)||this;return s._id=null,s._lastServerId=null,s._destroyed=!1,s._disconnected=!1,s._open=!1,s._connections=new Map,s._lostMessages=new Map,r&&r.constructor==Object?n=r:r&&(o=r.toString()),n=i({debug:0,host:u.util.CLOUD_HOST,port:u.util.CLOUD_PORT,path:"/",key:t.DEFAULT_KEY,token:u.util.randomToken(),config:u.util.defaultConfig},n),s._options=n,"/"===s._options.host&&(s._options.host=window.location.hostname),s._options.path&&("/"!==s._options.path[0]&&(s._options.path="/"+s._options.path),"/"!==s._options.path[s._options.path.length-1]&&(s._options.path+="/")),void 0===s._options.secure&&s._options.host!==u.util.CLOUD_HOST?s._options.secure=u.util.isSecure():s._options.host==u.util.CLOUD_HOST&&(s._options.secure=!0),s._options.logFunction&&h.default.setLogFunction(s._options.logFunction),h.default.logLevel=s._options.debug||0,s._api=new m.API(n),s._socket=s._createServerConnection(),u.util.supports.audioVideo||u.util.supports.data?o&&!u.util.validateId(o)?(s._delayedAbort(f.PeerErrorType.InvalidID,'ID "'+o+'" is invalid'),s):(o?s._initialize(o):s._api.retrieveId().then((function(e){return s._initialize(e)})).catch((function(e){return s._abort(f.PeerErrorType.ServerError,e)})),s):(s._delayedAbort(f.PeerErrorType.BrowserIncompatible,"The current browser does not support WebRTC"),s)}return n(t,e),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this._options},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"open",{get:function(){return this._open},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"socket",{get:function(){return this._socket},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"connections",{get:function(){var e,t,r=Object.create(null);try{for(var n=o(this._connections),i=n.next();!i.done;i=n.next()){var a=s(i.value,2),c=a[0],u=a[1];r[c]=u}}catch(t){e={error:t}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return r},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"destroyed",{get:function(){return this._destroyed},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"disconnected",{get:function(){return this._disconnected},enumerable:!0,configurable:!0}),t.prototype._createServerConnection=function(){var e=this,t=new l.Socket(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(f.SocketEventType.Message,(function(t){e._handleMessage(t)})),t.on(f.SocketEventType.Error,(function(t){e._abort(f.PeerErrorType.SocketError,t)})),t.on(f.SocketEventType.Disconnected,(function(){e.disconnected||(e.emitError(f.PeerErrorType.Network,"Lost connection to server."),e.disconnect())})),t.on(f.SocketEventType.Close,(function(){e.disconnected||e._abort(f.PeerErrorType.SocketClosed,"Underlying socket is already closed.")})),t},t.prototype._initialize=function(e){this._id=e,this.socket.start(e,this._options.token)},t.prototype._handleMessage=function(e){var t,r,n=e.type,i=e.payload,s=e.src;switch(n){case f.ServerMessageType.Open:this._lastServerId=this.id,this._open=!0,this.emit(f.PeerEventType.Open,this.id);break;case f.ServerMessageType.Error:this._abort(f.PeerErrorType.ServerError,i.msg);break;case f.ServerMessageType.IdTaken:this._abort(f.PeerErrorType.UnavailableID,'ID "'+this.id+'" is taken');break;case f.ServerMessageType.InvalidKey:this._abort(f.PeerErrorType.InvalidKey,'API KEY "'+this._options.key+'" is invalid');break;case f.ServerMessageType.Leave:h.default.log("Received leave message from "+s),this._cleanupPeer(s),this._connections.delete(s);break;case f.ServerMessageType.Expire:this.emitError(f.PeerErrorType.PeerUnavailable,"Could not connect to peer "+s);break;case f.ServerMessageType.Offer:var a=i.connectionId;if((v=this.getConnection(s,a))&&(v.close(),h.default.warn("Offer received for existing Connection ID:"+a)),i.type===f.ConnectionType.Media)v=new d.MediaConnection(s,this,{connectionId:a,_payload:i,metadata:i.metadata}),this._addConnection(s,v),this.emit(f.PeerEventType.Call,v);else{if(i.type!==f.ConnectionType.Data)return void h.default.warn("Received malformed connection type:"+i.type);v=new p.DataConnection(s,this,{connectionId:a,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable}),this._addConnection(s,v),this.emit(f.PeerEventType.Connection,v)}var c=this._getMessages(a);try{for(var u=o(c),l=u.next();!l.done;l=u.next()){var m=l.value;v.handleMessage(m)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}break;default:if(!i)return void h.default.warn("You received a malformed message from "+s+" of type "+n);var v;a=i.connectionId,(v=this.getConnection(s,a))&&v.peerConnection?v.handleMessage(e):a?this._storeMessage(a,e):h.default.warn("You received an unrecognized message:",e)}},t.prototype._storeMessage=function(e,t){this._lostMessages.has(e)||this._lostMessages.set(e,[]),this._lostMessages.get(e).push(t)},t.prototype._getMessages=function(e){var t=this._lostMessages.get(e);return t?(this._lostMessages.delete(e),t):[]},t.prototype.connect=function(e,t){if(void 0===t&&(t={}),this.disconnected)return h.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError(f.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");var r=new p.DataConnection(e,this,t);return this._addConnection(e,r),r},t.prototype.call=function(e,t,r){if(void 0===r&&(r={}),this.disconnected)return h.default.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError(f.PeerErrorType.Disconnected,"Cannot connect to new Peer after disconnecting from server.");if(t){r._stream=t;var n=new d.MediaConnection(e,this,r);return this._addConnection(e,n),n}h.default.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")},t.prototype._addConnection=function(e,t){h.default.log("add connection "+t.type+":"+t.connectionId+" to peerId:"+e),this._connections.has(e)||this._connections.set(e,[]),this._connections.get(e).push(t)},t.prototype._removeConnection=function(e){var t=this._connections.get(e.peer);if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}this._lostMessages.delete(e.connectionId)},t.prototype.getConnection=function(e,t){var r,n,i=this._connections.get(e);if(!i)return null;try{for(var s=o(i),a=s.next();!a.done;a=s.next()){var c=a.value;if(c.connectionId===t)return c}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return null},t.prototype._delayedAbort=function(e,t){var r=this;setTimeout((function(){r._abort(e,t)}),0)},t.prototype._abort=function(e,t){h.default.error("Aborting!"),this.emitError(e,t),this._lastServerId?this.disconnect():this.destroy()},t.prototype.emitError=function(e,t){var r;h.default.error("Error:",t),(r="string"==typeof t?new Error(t):t).type=e,this.emit(f.PeerEventType.Error,r)},t.prototype.destroy=function(){this.destroyed||(h.default.log("Destroy peer with ID:"+this.id),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit(f.PeerEventType.Close))},t.prototype._cleanup=function(){var e,t;try{for(var r=o(this._connections.keys()),n=r.next();!n.done;n=r.next()){var i=n.value;this._cleanupPeer(i),this._connections.delete(i)}}catch(t){e={error:t}}finally{try{n&&!n.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}this.socket.removeAllListeners()},t.prototype._cleanupPeer=function(e){var t,r,n=this._connections.get(e);if(n)try{for(var i=o(n),s=i.next();!s.done;s=i.next())s.value.close()}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},t.prototype.disconnect=function(){if(!this.disconnected){var e=this.id;h.default.log("Disconnect peer with ID:"+e),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=e,this._id=null,this.emit(f.PeerEventType.Disconnected,e)}},t.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)h.default.log("Attempting reconnection to server with ID "+this._lastServerId),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");h.default.error("In a hurry? We're still trying to make the initial connection!")}},t.prototype.listAllPeers=function(e){var t=this;void 0===e&&(e=function(e){}),this._api.listAllPeers().then((function(t){return e(t)})).catch((function(e){return t._abort(f.PeerErrorType.ServerError,e)}))},t.DEFAULT_KEY="peerjs",t}(c.EventEmitter);r.Peer=v},{eventemitter3:"JJlS","./util":"BHXf","./logger":"WOs9","./socket":"wJlv","./mediaconnection":"dbHP","./dataconnection":"GBTQ","./enums":"ZRYf","./api":"in7L"}],iTK6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=e("./util"),i=e("./peer");r.peerjs={Peer:i.Peer,util:n.util},r.default=i.Peer,window.peerjs=r.peerjs,window.Peer=i.Peer},{"./util":"BHXf","./peer":"Hxpd"}]},{},["iTK6"]);const P=["front","back","left","right"];function E(e,t,r,n,i,o=1){t=t.replace("pet_","");let s={idle:[],front:[],back:[],left:[],right:[]};Unicorn.RemoveObject(e);const a=16*o/60;return P.forEach(e=>{let n=r+"_"+e;for(let i=0;i<10;i++)Unicorn.Load("pet_"+n+i,`${O}/assets/pets/${t}/${n}/${n}${i+1}.png`),s[e].push("pet_"+r+"_"+e+i)}),Unicorn.AddObject(e,{type:"circle",scale:{x:3,y:3},animations:{idle:{framerate:a,frames:[s.front[0]],loop:!0},front:{framerate:a,frames:s.front,loop:!0},back:{framerate:a,frames:s.back,loop:!0},left:{framerate:a,frames:s.left,loop:!0},right:{framerate:a,frames:s.right,loop:!0}},x:-1e3,y:-1e3,z:100,radius:24,isStatic:!0})}window.WebFontConfig={custom:{families:["Pixeltype"]},active(){!function(){if(document.hidden)return void document.addEventListener("visibilitychange",()=>{location.reload()},!1);Unicorn.Create("unicorn-display",{width:1920,height:1080,background:"transparent",init:te,update:re,channel:M.channel,username:M.oauth?M.channel:void 0,password:M.oauth,onCommand:B,onChat:F,gravity:{x:0,y:0}}),ComfyJS.onConnected=async(e,t,r)=>{if(r){let e=await D();0!==e&&(R=e.session,setInterval(()=>{D()},6e4))}}}()}},function(){const e=document.createElement("script");e.src=("https:"===document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",e.type="text/javascript",e.async="true";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}();let I="Hide n' Seek",A={},M={},O="";let R="";async function D(){}window.setupGame=function(e,t,r){I=e,A=t,M=r,O=A.path||""};class k extends class{listeners={};on(e,t){return this.listeners.hasOwnProperty(e)||(this.listeners[e]=[]),this.listeners[e].push(t),this}emit(e,...t){if(!this.listeners.hasOwnProperty(e))return null;for(let r=0;r<this.listeners[e].length;r++){this.listeners[e][r].call(this,...t)}}}{constructor(){super(),this.peer=new Peer(null,{debug:2,host:"api.pixelplush.dev",port:9e3,secure:!0,path:"/pixelplush"}),this.peers={}}connect(e=null,t={}){this._setup(e,!e,t)}_setup(e,t=!1,r={}){this.isServer=t;let n=this;this.peer.on("open",(function(t){if(null===n.peer.id?n.peer.id=n.id:n.id=n.peer.id,console.log("ID:",n.id),n.emit("connected",n.id),!n.isServer){console.log("connecting...");let t=n.peer.connect(e,{metadata:r});t.on("data",(function(e){n.emit("data",e.data,e.ts,t.peer)})),t.on("open",(function(){console.log(t.peer,"ready"),n.peers[t.peer]=t,n.emit("join",t.peer)})),t.on("close",(function(){console.log(t.peer,"closed"),delete n.peers[t.peer],n.emit("leave",t.peer)})),t.on("error",(function(e){console.log(t.peer,e),n.emit("error",e,t.peer)}))}})),this.peer.on("connection",(function(e){n.peers[e.peer]&&console.log(e.peer,"was already connected"),n.peers[e.peer]=e,e.on("data",(function(t){n.emit("data",t.data,t.ts,e.peer)})),e.on("open",(function(){console.log(e.peer,"ready"),n.peers[e.peer]=e,n.emit("join",e.peer,e.metadata)})),e.on("close",(function(){console.log(e.peer,"closed"),delete n.peers[e.peer],n.emit("leave",e.peer)})),e.on("error",(function(t){console.log(e.peer,t),n.emit("error",t,e.peer)}))})),this.peer.on("close",(function(){n.emit("closed")})),this.peer.on("disconnected",(function(){n.emit("disconnected")})),this.peer.on("error",(function(e){e.type,console.log(e),n.emit("error",{error:e})}))}send(e,t=null,r=0){let n=Date.now();t?this.peers[t]&&this.peers[t].open&&(r>0?setTimeout(()=>{this.peers[t].send({ts:n,data:e})},r):this.peers[t].send({ts:n,data:e})):Object.keys(this.peers).forEach(t=>{this.peers[t].open&&(r>0?setTimeout(()=>{this.peers[t].send({ts:n,data:e})},r):this.peers[t].send({ts:n,data:e}))})}}function L(e,t){return Object.keys(e.players).forEach(r=>{!function(e,t,r){let n=e.players[t],i=n.gX-n.x,o=n.gY-n.y,s=Math.sqrt(i*i+o*o);s>.5&&(i/=s,o/=s);let a=n.x+r*i*.001*100,c=n.y+r*o*.001*100;Math.abs(a-n.gX)<5&&(a=n.gX);Math.abs(c-n.gY)<5&&(c=n.gY);let u="front";u=s>.5?Math.abs(i)>Math.abs(o)?i<0?"left":"right":o<0?"back":"front":"idle";n.x=a,n.y=c,n.anim=u,e.players[t]=n}(e,r,t)}),e}function B(e,t,r,n,i){}function F(e,t,r,n,i){}const N="8m07ghhogjy0q09moeunnpdu51i60n";let j={},U={},G=Date.now(),X=null,V="",z={players:{},trees:[]};function H(){return new Promise((e,t)=>{try{let t=new k;t.on("connected",r=>{console.log("Connected:",r),j=function(){let e={players:{},trees:[]};for(let t=0;t<11;t++)for(let r=0;r<20;r++)if((t<4||t>5)&&(r<9||r>11)&&Math.random()<.15){let n=A.objects[ne(A.objects.length)],i=100+1720*r/19,o=100+880*t/10-20;e.trees.push({type:n,x:i,y:o})}return e}(),setInterval(()=>{L(j,60),t.send({type:"sync",state:j})},60),e(t.id)}),t.on("join",(e,t)=>{console.log("join",e,j,t);let r=t.style.pet&&"pet_none"!==t.style.pet?t.style.pet:Math.random()>.5?"pet_rabbit1":"pet_rabbit2";!function(e,t,r,n){if(!e.players[t]){let i=ne(288)+864,o=ne(2160/11)+4320/11;e.players[t]={id:0,name:r,character:n,x:i,y:o,gX:i,gY:o,anim:""}}}(j,e,t.displayName,r)}),t.on("leave",e=>{var t,r;r=e,(t=j).players[r]&&delete t.players[r]}),t.on("data",(e,t,r)=>{"move"===e.type&&(j.players[r].id=e.id,j.players[r].gX=e.x,j.players[r].gY=e.y)}),t.connect()}catch(e){t(e)}})}let W={},Y=!1,q=!1,J=!1,K=0;function Z(e){q=!0,$(e)}function Q(e){q=!1}function $(e){if(q){let t=e.data.originalEvent.layerX,r=e.data.originalEvent.layerY;Y=t-W.x!=0||r-W.y!=0,W.x=Math.min(1870,Math.max(50,t)),W.y=Math.min(1030,Math.max(50,r))}}function ee(e){$(e),J=!0,q=!1,K++}async function te(){n.settings.SCALE_MODE=n.SCALE_MODES.NEAREST,Unicorn.Load("map",`${O}/assets/${A.map}.png`);let e=Unicorn.AddBacklay("map","map",0,0,{scale:{x:3,y:3}});e.interactive=!0,e.buttonMode=!0,e.on("pointerdown",Z),e.on("pointerup",Q),e.on("pointermove",$),e.on("pointertap",ee),A.objects.forEach(e=>{Unicorn.Load(e,`${O}/assets/${e}.png`)});let t=params.get("code");t||(console.log("starting server"),t=await H(),console.log("code",t)),ComfyTwitch.Check().then(async e=>{if(e)try{if(account=await fetch("https://api.pixelplush.dev/v1/accounts",{headers:{Twitch:e.token}}).then(e=>e.json()),console.log(account),account.error)throw"Login Error";let r=await ComfyTwitch.GetUser(N,e.user_id);console.log(r),document.querySelector("#login").innerText="Logout",document.querySelector("#login").addEventListener("click",(function(){ComfyTwitch.Logout(),window.location.reload()})),V=await function(e,t){return new Promise((r,n)=>{try{let n=new k;console.log(n),n.on("connected",e=>{console.log("Connected:",e),setInterval(()=>{q?(Y&&(n.send({type:"move",id:K++,x:W.x,y:W.y}),X.players[n.id].id=K,X.players[n.id].gX=W.x,X.players[n.id].gY=W.y),J=!0):J&&(n.send({type:"move",id:K,x:W.x,y:W.y}),X.players[n.id].id=K,X.players[n.id].gX=W.x,X.players[n.id].gY=W.y,J=!1)},60),r(n.id)}),n.on("data",(e,t,r)=>{if("sync"===e.type)if(G=t,U=Object.assign({},null===X?{}:X.players),null===X)X=e.state,X.trees.forEach((e,t)=>{let r=Unicorn.AddObject("tree_"+t,{type:"circle",sprite:e.type,scale:{x:3,y:3},x:e.x,y:e.y,z:e.y+42,radius:24,isStatic:!0});z.trees.push(r)}),Object.keys(X.players).forEach(e=>{let t=E(e,X.players[e].character,X.players[e].character.replace("pet_",""));Unicorn.SetPosition(t.label,X.players[e].x,X.players[e].y),t.animations[t.currentAnimation].zIndex=t.position.y,console.log("loaded",t);let r=Unicorn.AddText("name_"+e,X.players[e].name,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffffff",lineJoin:"round",stroke:"#000000",strokeThickness:6});r.anchor.set(.5),z.players[e]={sprite:t,name:r}});else{let t=Object.keys(X.players),r=Object.keys(e.state.players),i=r.filter(e=>!t.includes(e));t.filter(e=>!r.includes(e)).forEach(e=>{Unicorn.RemoveObject(e),delete z.players[e],delete X.players[e]}),t=Object.keys(X.players),t.forEach(t=>{if(t===n.id){if(e.state.players[t]&&e.state.players[t].id===X.players[t].id){let r=e.state.players[t];r.gX===r.x&&r.gY===r.y&&(X.players[t]=e.state.players[t])}}else{let r=e.state.players[t];r.gX===r.x&&r.gY===r.y?X.players[t]=e.state.players[t]:(X.players[t].gX=e.state.players[t].gX,X.players[t].gY=e.state.players[t].gY)}X.players[t].anim!==z.players[t].sprite.currentAnimation&&Unicorn.PlayObjectAnimation(z.players[t].sprite.label,X.players[t].anim),z.players[t].sprite.animations[z.players[t].sprite.currentAnimation].zIndex=X.players[t].y}),i.forEach(t=>{X.players[t]=e.state.players[t];let r=E(t,X.players[t].character,X.players[t].character.replace("pet_",""));Unicorn.SetPosition(r.label,X.players[t].x,X.players[t].y),r.animations[r.currentAnimation].zIndex=r.position.y,console.log("loaded",r);let n=Unicorn.AddText("name_"+t,X.players[t].name,-1e3,-1e3,{fontFamily:"Pixeltype",fontSize:40,fontWeight:"bold",fill:"#ffffff",lineJoin:"round",stroke:"#000000",strokeThickness:6});n.anchor.set(.5),z.players[t]={sprite:r,name:n}})}}),n.connect(e,t)}catch(e){n(e)}})}(t,account),document.getElementById("connect-link").innerText=`${location.origin}${location.pathname}?code=${t}`,document.getElementById("connect-link").href=`${location.origin}${location.pathname}?code=${t}`}catch(e){console.log("Auth Validate Failed",e)}else{const e=window.location.origin;document.querySelector("#login").addEventListener("click",(function(){ComfyTwitch.Login(N,e,["user:read:email"])}))}})}function re(e,t){null!==X&&(L(X,t),Object.keys(X.players).forEach(e=>{Unicorn.SetPosition(z.players[e].sprite.label,X.players[e].x,X.players[e].y),X.players[e].anim!==z.players[e].sprite.currentAnimation&&Unicorn.PlayObjectAnimation(z.players[e].sprite.label,X.players[e].anim),z.players[e].sprite.animations[z.players[e].sprite.currentAnimation].zIndex=X.players[e].y,z.players[e].name.position.x=z.players[e].sprite.position.x,z.players[e].name.position.y=z.players[e].sprite.position.y-60}))}function ne(e){return Math.floor(Math.random()*e)}